using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.CompilerServices;
using System.Security.Cryptography;
using System.Text;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Input;
using ReLogic.Utilities;
using Terraria.Audio;
using Terraria.DataStructures;
using Terraria.Enums;
using Terraria.GameContent;
using Terraria.GameContent.Achievements;
using Terraria.GameContent.Events;
using Terraria.GameContent.Tile_Entities;
using Terraria.GameContent.UI;
using Terraria.GameInput;
using Terraria.Graphics.Capture;
using Terraria.Graphics.Effects;
using Terraria.Graphics.Shaders;
using Terraria.ID;
using Terraria.IO;
using Terraria.Localization;
using Terraria.ObjectData;
using Terraria.Social;
using Terraria.UI;
using Terraria.UI.Chat;
using Terraria.UI.Gamepad;
using Terraria.Utilities;
using Terraria.World.Generation;

namespace Terraria
{
	// Token: 0x0200002B RID: 43
	public class Player : Entity
	{
		// Token: 0x0600040F RID: 1039 RVA: 0x00283920 File Offset: 0x00281B20
		public Player()
		{
			this.width = 20;
			this.height = 42;
			this.name = string.Empty;
			this.bodyFrame.Width = 40;
			this.bodyFrame.Height = 56;
			this.legFrame.Width = 40;
			this.legFrame.Height = 56;
			for (int i = 0; i < 59; i++)
			{
				if (i < this.armor.Length)
				{
					this.armor[i] = new Item();
				}
				this.inventory[i] = new Item();
			}
			for (int j = 0; j < 40; j++)
			{
				this.bank.item[j] = new Item();
				this.bank2.item[j] = new Item();
				this.bank3.item[j] = new Item();
			}
			for (int k = 0; k < this.dye.Length; k++)
			{
				this.dye[k] = new Item();
			}
			for (int l = 0; l < this.miscEquips.Length; l++)
			{
				this.miscEquips[l] = new Item();
			}
			for (int m = 0; m < this.miscDyes.Length; m++)
			{
				this.miscDyes[m] = new Item();
			}
			this.trashItem = new Item();
			this.grappling[0] = -1;
			this.inventory[0].SetDefaults(3507, false);
			this.inventory[1].SetDefaults(3509, false);
			this.inventory[2].SetDefaults(3506, false);
			this.statManaMax = 20;
			this.extraAccessory = false;
			if (Main.cEd)
			{
				this.inventory[3].SetDefaults(603, false);
			}
			for (int n = 0; n < 470; n++)
			{
				this.adjTile[n] = false;
				this.oldAdjTile[n] = false;
			}
			this.hitTile = new HitTile();
			this.mount = new Mount();
		}

		// Token: 0x06000354 RID: 852 RVA: 0x00226DB8 File Offset: 0x00224FB8
		public void AddBuff(int type, int time1, bool quiet = true)
		{
			if (this.buffImmune[type])
			{
				return;
			}
			int num = time1;
			if (Main.expertMode && this.whoAmI == Main.myPlayer && (type == 20 || type == 22 || type == 23 || type == 24 || type == 30 || type == 31 || type == 32 || type == 33 || type == 35 || type == 36 || type == 39 || type == 44 || type == 46 || type == 47 || type == 69 || type == 70 || type == 80))
			{
				num = (int)(Main.expertDebuffTime * (float)num);
			}
			if (!quiet && Main.netMode == 1)
			{
				bool flag = true;
				for (int i = 0; i < 22; i++)
				{
					if (this.buffType[i] == type)
					{
						flag = false;
						break;
					}
				}
				if (flag)
				{
					NetMessage.SendData(55, -1, -1, null, this.whoAmI, (float)type, (float)num, 0f, 0, 0, 0);
				}
			}
			int num2 = -1;
			for (int j = 0; j < 22; j++)
			{
				if (this.buffType[j] == type)
				{
					if (type == 94)
					{
						this.buffTime[j] += num;
						if (this.buffTime[j] > Player.manaSickTimeMax)
						{
							this.buffTime[j] = Player.manaSickTimeMax;
							return;
						}
					}
					else if (this.buffTime[j] < num)
					{
						this.buffTime[j] = num;
					}
					return;
				}
			}
			if (Main.vanityPet[type] || Main.lightPet[type])
			{
				for (int k = 0; k < 22; k++)
				{
					if (Main.vanityPet[type] && Main.vanityPet[this.buffType[k]])
					{
						this.DelBuff(k);
					}
					if (Main.lightPet[type] && Main.lightPet[this.buffType[k]])
					{
						this.DelBuff(k);
					}
				}
			}
			while (num2 == -1)
			{
				int num3 = -1;
				for (int l = 0; l < 22; l++)
				{
					if (!Main.debuff[this.buffType[l]])
					{
						num3 = l;
						break;
					}
				}
				if (num3 == -1)
				{
					return;
				}
				for (int m = num3; m < 22; m++)
				{
					if (this.buffType[m] == 0)
					{
						num2 = m;
						break;
					}
				}
				if (num2 == -1)
				{
					this.DelBuff(num3);
				}
			}
			this.buffType[num2] = type;
			this.buffTime[num2] = num;
			if (Main.meleeBuff[type])
			{
				for (int n = 0; n < 22; n++)
				{
					if (n != num2 && Main.meleeBuff[this.buffType[n]])
					{
						this.DelBuff(n);
					}
				}
			}
		}

		// Token: 0x060003FC RID: 1020 RVA: 0x00280D6C File Offset: 0x0027EF6C
		public void addDPS(int dmg)
		{
			if (this.dpsStarted)
			{
				this.dpsLastHit = DateTime.Now;
				this.dpsDamage += dmg;
				this.dpsEnd = DateTime.Now;
				return;
			}
			this.dpsStarted = true;
			this.dpsStart = DateTime.Now;
			this.dpsEnd = DateTime.Now;
			this.dpsLastHit = DateTime.Now;
			this.dpsDamage = dmg;
		}

		// Token: 0x060003C6 RID: 966 RVA: 0x00260650 File Offset: 0x0025E850
		public void AdjTiles()
		{
			int num = 4;
			int num2 = 3;
			for (int i = 0; i < 470; i++)
			{
				this.oldAdjTile[i] = this.adjTile[i];
				this.adjTile[i] = false;
			}
			this.oldAdjWater = this.adjWater;
			this.adjWater = false;
			this.oldAdjHoney = this.adjHoney;
			this.adjHoney = false;
			this.oldAdjLava = this.adjLava;
			this.adjLava = false;
			this.alchemyTable = false;
			int num3 = (int)((this.position.X + (float)(this.width / 2)) / 16f);
			int num4 = (int)((this.position.Y + (float)this.height) / 16f);
			for (int j = num3 - num; j <= num3 + num; j++)
			{
				for (int k = num4 - num2; k < num4 + num2; k++)
				{
					if (Main.tile[j, k].active())
					{
						this.adjTile[(int)Main.tile[j, k].type] = true;
						if (Main.tile[j, k].type == 302)
						{
							this.adjTile[17] = true;
						}
						if (Main.tile[j, k].type == 77)
						{
							this.adjTile[17] = true;
						}
						if (Main.tile[j, k].type == 133)
						{
							this.adjTile[17] = true;
							this.adjTile[77] = true;
						}
						if (Main.tile[j, k].type == 134)
						{
							this.adjTile[16] = true;
						}
						if (Main.tile[j, k].type == 354 || Main.tile[j, k].type == 469)
						{
							this.adjTile[14] = true;
						}
						if (Main.tile[j, k].type == 355)
						{
							this.adjTile[13] = true;
							this.adjTile[14] = true;
							this.alchemyTable = true;
						}
					}
					if (Main.tile[j, k].liquid > 200 && Main.tile[j, k].liquidType() == 0)
					{
						this.adjWater = true;
					}
					if (Main.tile[j, k].liquid > 200 && Main.tile[j, k].liquidType() == 2)
					{
						this.adjHoney = true;
					}
					if (Main.tile[j, k].liquid > 200 && Main.tile[j, k].liquidType() == 1)
					{
						this.adjLava = true;
					}
				}
			}
			if (Main.playerInventory)
			{
				bool flag = false;
				for (int l = 0; l < 470; l++)
				{
					if (this.oldAdjTile[l] != this.adjTile[l])
					{
						flag = true;
						break;
					}
				}
				if (this.adjWater != this.oldAdjWater)
				{
					flag = true;
				}
				if (this.adjHoney != this.oldAdjHoney)
				{
					flag = true;
				}
				if (this.adjLava != this.oldAdjLava)
				{
					flag = true;
				}
				if (flag)
				{
					Recipe.FindRecipes();
				}
			}
		}

		// Token: 0x060003F1 RID: 1009 RVA: 0x0027FAF8 File Offset: 0x0027DCF8
		private void ApplyAnimation(Item sItem)
		{
			if (sItem.melee)
			{
				this.itemAnimation = (int)((float)sItem.useAnimation * this.meleeSpeed);
				this.itemAnimationMax = (int)((float)sItem.useAnimation * this.meleeSpeed);
				return;
			}
			if (sItem.createTile >= 0)
			{
				this.itemAnimation = (int)((float)sItem.useAnimation * this.tileSpeed);
				this.itemAnimationMax = (int)((float)sItem.useAnimation * this.tileSpeed);
				return;
			}
			if (sItem.createWall >= 0)
			{
				this.itemAnimation = (int)((float)sItem.useAnimation * this.wallSpeed);
				this.itemAnimationMax = (int)((float)sItem.useAnimation * this.wallSpeed);
				return;
			}
			this.itemAnimation = sItem.useAnimation;
			this.itemAnimationMax = sItem.useAnimation;
			this.reuseDelay = sItem.reuseDelay;
		}

		// Token: 0x06000391 RID: 913 RVA: 0x002472C0 File Offset: 0x002454C0
		public void ApplyDamageToNPC(NPC npc, int damage, float knockback, int direction, bool crit)
		{
            damage *= 100;
			npc.StrikeNPC(damage, knockback, direction, crit, false, false);
			if (Main.netMode != 0)
			{
				NetMessage.SendData(28, -1, -1, null, npc.whoAmI, (float)damage, knockback, (float)direction, crit.ToInt(), 0, 0);
			}
			int num = Item.NPCtoBanner(npc.BannerID());
			if (num >= 0)
			{
				this.lastCreatureHit = num;
			}
		}

		// Token: 0x06000370 RID: 880 RVA: 0x0022EFA4 File Offset: 0x0022D1A4
		public int ArmorSetDye()
		{
			switch (Main.rand.Next(3))
			{
				case 0:
					return this.cHead;
				case 1:
					return this.cBody;
				case 2:
					return this.cLegs;
				default:
					return this.cBody;
			}
		}

		// Token: 0x06000375 RID: 885 RVA: 0x0023297C File Offset: 0x00230B7C
		public int beeDamage(int dmg)
		{
			if (this.makeStrongBee)
			{
				return dmg + Main.rand.Next(1, 4);
			}
			return dmg + Main.rand.Next(2);
		}

		// Token: 0x06000376 RID: 886 RVA: 0x002329A2 File Offset: 0x00230BA2
		public float beeKB(float KB)
		{
			if (this.makeStrongBee)
			{
				return 0.5f + KB * 1.1f;
			}
			return KB;
		}

		// Token: 0x06000374 RID: 884 RVA: 0x0023294C File Offset: 0x00230B4C
		public int beeType()
		{
			if (this.strongBees && Main.rand.Next(2) == 0)
			{
				this.makeStrongBee = true;
				return 566;
			}
			this.makeStrongBee = false;
			return 181;
		}

		// Token: 0x060003A9 RID: 937 RVA: 0x0024E528 File Offset: 0x0024C728
		public void BordersMovement()
		{
			if (this.position.X < Main.leftWorld + 640f + 16f)
			{
				this.position.X = Main.leftWorld + 640f + 16f;
				this.velocity.X = 0f;
			}
			if (this.position.X + (float)this.width > Main.rightWorld - 640f - 32f)
			{
				this.position.X = Main.rightWorld - 640f - 32f - (float)this.width;
				this.velocity.X = 0f;
			}
			if (this.position.Y < Main.topWorld + 640f + 16f)
			{
				this.position.Y = Main.topWorld + 640f + 16f;
				if ((double)this.velocity.Y < 0.11)
				{
					this.velocity.Y = 0.11f;
				}
				this.gravDir = 1f;
				AchievementsHelper.HandleSpecialEvent(this, 11);
			}
			if (this.position.Y > Main.bottomWorld - 640f - 32f - (float)this.height)
			{
				this.position.Y = Main.bottomWorld - 640f - 32f - (float)this.height;
				this.velocity.Y = 0f;
			}
			if (this.position.Y > Main.bottomWorld - 640f - 150f - (float)this.height)
			{
				AchievementsHelper.HandleSpecialEvent(this, 10);
			}
		}

		// Token: 0x060003C3 RID: 963 RVA: 0x0025F580 File Offset: 0x0025D780
		public bool BuyItem(int price, int customCurrency = -1)
		{
			if (customCurrency != -1)
			{
				return CustomCurrencyManager.BuyItem(this, price, customCurrency);
			}
			bool flag;
			long num = Utils.CoinsCount(out flag, this.inventory, new int[]
			{
				58,
				57,
				56,
				55,
				54
			});
			long num2 = Utils.CoinsCount(out flag, this.bank.item, new int[0]);
			long num3 = Utils.CoinsCount(out flag, this.bank2.item, new int[0]);
			long num4 = Utils.CoinsCount(out flag, this.bank3.item, new int[0]);
			if (Utils.CoinsCombineStacks(out flag, new long[]
			{
				num,
				num2,
				num3,
				num4
			}) < (long)price)
			{
				return false;
			}
			List<Item[]> list = new List<Item[]>();
			Dictionary<int, List<int>> dictionary = new Dictionary<int, List<int>>();
			List<Point> list2 = new List<Point>();
			List<Point> list3 = new List<Point>();
			List<Point> list4 = new List<Point>();
			List<Point> list5 = new List<Point>();
			List<Point> list6 = new List<Point>();
			list.Add(this.inventory);
			list.Add(this.bank.item);
			list.Add(this.bank2.item);
			list.Add(this.bank3.item);
			for (int i = 0; i < list.Count; i++)
			{
				dictionary[i] = new List<int>();
			}
			dictionary[0] = new List<int>
			{
				58,
				57,
				56,
				55,
				54
			};
			for (int j = 0; j < list.Count; j++)
			{
				for (int k = 0; k < list[j].Length; k++)
				{
					if (!dictionary[j].Contains(k) && list[j][k].type >= 71 && list[j][k].type <= 74)
					{
						list3.Add(new Point(j, k));
					}
				}
			}
			int num5 = 0;
			for (int l = list[num5].Length - 1; l >= 0; l--)
			{
				if (!dictionary[num5].Contains(l) && (list[num5][l].type == 0 || list[num5][l].stack == 0))
				{
					list2.Add(new Point(num5, l));
				}
			}
			num5 = 1;
			for (int m = list[num5].Length - 1; m >= 0; m--)
			{
				if (!dictionary[num5].Contains(m) && (list[num5][m].type == 0 || list[num5][m].stack == 0))
				{
					list4.Add(new Point(num5, m));
				}
			}
			num5 = 2;
			for (int n = list[num5].Length - 1; n >= 0; n--)
			{
				if (!dictionary[num5].Contains(n) && (list[num5][n].type == 0 || list[num5][n].stack == 0))
				{
					list5.Add(new Point(num5, n));
				}
			}
			num5 = 3;
			for (int num6 = list[num5].Length - 1; num6 >= 0; num6--)
			{
				if (!dictionary[num5].Contains(num6) && (list[num5][num6].type == 0 || list[num5][num6].stack == 0))
				{
					list6.Add(new Point(num5, num6));
				}
			}
			return !Player.TryPurchasing(price, list, list3, list2, list4, list5, list6);
		}

		// Token: 0x060003C5 RID: 965 RVA: 0x0025FFB4 File Offset: 0x0025E1B4
		public bool BuyItemOld(int price)
		{
			if (price == 0)
			{
				return true;
			}
			long num = 0L;
			Item[] array = new Item[54];
			for (int i = 0; i < 54; i++)
			{
				array[i] = new Item();
				array[i] = this.inventory[i].Clone();
				if (this.inventory[i].type == 71)
				{
					num += (long)this.inventory[i].stack;
				}
				if (this.inventory[i].type == 72)
				{
					num += (long)(this.inventory[i].stack * 100);
				}
				if (this.inventory[i].type == 73)
				{
					num += (long)(this.inventory[i].stack * 10000);
				}
				if (this.inventory[i].type == 74)
				{
					num += (long)(this.inventory[i].stack * 1000000);
				}
			}
			if (num >= (long)price)
			{
				int j = price;
				while (j > 0)
				{
					if (j >= 1000000)
					{
						for (int k = 0; k < 54; k++)
						{
							if (this.inventory[k].type == 74)
							{
								while (this.inventory[k].stack > 0 && j >= 1000000)
								{
									j -= 1000000;
									this.inventory[k].stack--;
									if (this.inventory[k].stack == 0)
									{
										this.inventory[k].type = 0;
									}
								}
							}
						}
					}
					if (j >= 10000)
					{
						for (int l = 0; l < 54; l++)
						{
							if (this.inventory[l].type == 73)
							{
								while (this.inventory[l].stack > 0 && j >= 10000)
								{
									j -= 10000;
									this.inventory[l].stack--;
									if (this.inventory[l].stack == 0)
									{
										this.inventory[l].type = 0;
									}
								}
							}
						}
					}
					if (j >= 100)
					{
						for (int m = 0; m < 54; m++)
						{
							if (this.inventory[m].type == 72)
							{
								while (this.inventory[m].stack > 0 && j >= 100)
								{
									j -= 100;
									this.inventory[m].stack--;
									if (this.inventory[m].stack == 0)
									{
										this.inventory[m].type = 0;
									}
								}
							}
						}
					}
					if (j >= 1)
					{
						for (int n = 0; n < 54; n++)
						{
							if (this.inventory[n].type == 71)
							{
								while (this.inventory[n].stack > 0 && j >= 1)
								{
									j--;
									this.inventory[n].stack--;
									if (this.inventory[n].stack == 0)
									{
										this.inventory[n].type = 0;
									}
								}
							}
						}
					}
					if (j > 0)
					{
						int num2 = -1;
						for (int num3 = 53; num3 >= 0; num3--)
						{
							if (this.inventory[num3].type == 0 || this.inventory[num3].stack == 0)
							{
								num2 = num3;
								break;
							}
						}
						if (num2 < 0)
						{
							for (int num4 = 0; num4 < 54; num4++)
							{
								this.inventory[num4] = array[num4].Clone();
							}
							return false;
						}
						bool flag = true;
						if (j >= 10000)
						{
							for (int num5 = 0; num5 < 58; num5++)
							{
								if (this.inventory[num5].type == 74 && this.inventory[num5].stack >= 1)
								{
									this.inventory[num5].stack--;
									if (this.inventory[num5].stack == 0)
									{
										this.inventory[num5].type = 0;
									}
									this.inventory[num2].SetDefaults(73, false);
									this.inventory[num2].stack = 100;
									flag = false;
									break;
								}
							}
						}
						else if (j >= 100)
						{
							for (int num6 = 0; num6 < 54; num6++)
							{
								if (this.inventory[num6].type == 73 && this.inventory[num6].stack >= 1)
								{
									this.inventory[num6].stack--;
									if (this.inventory[num6].stack == 0)
									{
										this.inventory[num6].type = 0;
									}
									this.inventory[num2].SetDefaults(72, false);
									this.inventory[num2].stack = 100;
									flag = false;
									break;
								}
							}
						}
						else if (j >= 1)
						{
							for (int num7 = 0; num7 < 54; num7++)
							{
								if (this.inventory[num7].type == 72 && this.inventory[num7].stack >= 1)
								{
									this.inventory[num7].stack--;
									if (this.inventory[num7].stack == 0)
									{
										this.inventory[num7].type = 0;
									}
									this.inventory[num2].SetDefaults(71, false);
									this.inventory[num2].stack = 100;
									flag = false;
									break;
								}
							}
						}
						if (flag)
						{
							if (j < 10000)
							{
								for (int num8 = 0; num8 < 54; num8++)
								{
									if (this.inventory[num8].type == 73 && this.inventory[num8].stack >= 1)
									{
										this.inventory[num8].stack--;
										if (this.inventory[num8].stack == 0)
										{
											this.inventory[num8].type = 0;
										}
										this.inventory[num2].SetDefaults(72, false);
										this.inventory[num2].stack = 100;
										flag = false;
										break;
									}
								}
							}
							if (flag && j < 1000000)
							{
								for (int num9 = 0; num9 < 54; num9++)
								{
									if (this.inventory[num9].type == 74 && this.inventory[num9].stack >= 1)
									{
										this.inventory[num9].stack--;
										if (this.inventory[num9].stack == 0)
										{
											this.inventory[num9].type = 0;
										}
										this.inventory[num2].SetDefaults(73, false);
										this.inventory[num2].stack = 100;
										break;
									}
								}
							}
						}
					}
				}
				return true;
			}
			return false;
		}

		// Token: 0x060003E8 RID: 1000 RVA: 0x0026C874 File Offset: 0x0026AA74
		public bool CanHit(Entity ent)
		{
			return Collision.CanHit(this.position, this.width, this.height, ent.position, ent.width, ent.height) || Collision.CanHitLine(base.Center + new Vector2((float)(this.direction * this.width / 2), this.gravDir * (float)(-(float)this.height) / 3f), 0, 0, ent.Center + new Vector2(0f, (float)(-(float)ent.height / 3)), 0, 0) || Collision.CanHitLine(base.Center + new Vector2((float)(this.direction * this.width / 2), this.gravDir * (float)(-(float)this.height) / 3f), 0, 0, ent.Center, 0, 0) || Collision.CanHitLine(base.Center + new Vector2((float)(this.direction * this.width / 2), 0f), 0, 0, ent.Center + new Vector2(0f, (float)(ent.height / 3)), 0, 0);
		}

		// Token: 0x060003AF RID: 943 RVA: 0x002594E4 File Offset: 0x002576E4
		public bool CanParryAgainst(Rectangle blockingPlayerRect, Rectangle enemyRect, Vector2 enemyVelocity)
		{
			return this.shieldParryTimeLeft > 0 && Math.Sign(enemyRect.Center.X - blockingPlayerRect.Center.X) == this.direction && enemyVelocity != Vector2.Zero && !this.immune;
		}

		// Token: 0x06000396 RID: 918 RVA: 0x00249FF4 File Offset: 0x002481F4
		public void CarpetMovement()
		{
			bool flag = false;
			if (this.grappling[0] == -1 && this.carpet && !this.jumpAgainCloud && !this.jumpAgainSandstorm && !this.jumpAgainBlizzard && !this.jumpAgainFart && !this.jumpAgainSail && !this.jumpAgainUnicorn && this.jump == 0 && this.velocity.Y != 0f && this.rocketTime == 0 && this.wingTime == 0f && !this.mount.Active)
			{
				if (this.controlJump && this.canCarpet)
				{
					this.canCarpet = false;
					this.carpetTime = 300;
				}
				if (this.carpetTime > 0 && this.controlJump)
				{
					this.fallStart = (int)(this.position.Y / 16f);
					flag = true;
					this.carpetTime--;
					float num = this.gravity;
					if (this.gravDir == 1f && this.velocity.Y > -num)
					{
						this.velocity.Y = -(num + 1E-06f);
					}
					else if (this.gravDir == -1f && this.velocity.Y < num)
					{
						this.velocity.Y = num + 1E-06f;
					}
					this.carpetFrameCounter += 1f + Math.Abs(this.velocity.X * 0.5f);
					if (this.carpetFrameCounter > 8f)
					{
						this.carpetFrameCounter = 0f;
						this.carpetFrame++;
					}
					if (this.carpetFrame < 0)
					{
						this.carpetFrame = 0;
					}
					if (this.carpetFrame > 5)
					{
						this.carpetFrame = 0;
					}
				}
			}
			if (!flag)
			{
				this.carpetFrame = -1;
				return;
			}
			this.slowFall = false;
		}

		// Token: 0x060003DB RID: 987 RVA: 0x0026BCA0 File Offset: 0x00269EA0
		public void ChangeDir(int dir)
		{
			if (!this.pulley || this.pulleyDir != 2)
			{
				this.direction = dir;
				return;
			}
			if (this.pulleyDir == 2 && dir == this.direction)
			{
				return;
			}
			int num = (int)(this.position.X + (float)(this.width / 2)) / 16 * 16 + 8 - this.width / 2;
			if (!Collision.SolidCollision(new Vector2((float)num, this.position.Y), this.width, this.height))
			{
				if (this.whoAmI == Main.myPlayer)
				{
					Main.cameraX = Main.cameraX + this.position.X - (float)num;
				}
				this.pulleyDir = 1;
				this.position.X = (float)num;
				this.direction = dir;
			}
		}

		// Token: 0x06000406 RID: 1030 RVA: 0x00281D8C File Offset: 0x0027FF8C
		public void ChangeSpawn(int x, int y)
		{
			int num = 0;
			while (num < 200 && this.spN[num] != null)
			{
				if (this.spN[num] == Main.worldName && this.spI[num] == Main.worldID)
				{
					for (int i = num; i > 0; i--)
					{
						this.spN[i] = this.spN[i - 1];
						this.spI[i] = this.spI[i - 1];
						this.spX[i] = this.spX[i - 1];
						this.spY[i] = this.spY[i - 1];
					}
					this.spN[0] = Main.worldName;
					this.spI[0] = Main.worldID;
					this.spX[0] = x;
					this.spY[0] = y;
					return;
				}
				num++;
			}
			for (int j = 199; j > 0; j--)
			{
				if (this.spN[j - 1] != null)
				{
					this.spN[j] = this.spN[j - 1];
					this.spI[j] = this.spI[j - 1];
					this.spX[j] = this.spX[j - 1];
					this.spY[j] = this.spY[j - 1];
				}
			}
			this.spN[0] = Main.worldName;
			this.spI[0] = Main.worldID;
			this.spX[0] = x;
			this.spY[0] = y;
		}

		// Token: 0x060003BD RID: 957 RVA: 0x0025E118 File Offset: 0x0025C318
		public Color ChatColor()
		{
			byte b = this.difficulty;
			if (b == 1)
			{
				return Main.mcColor;
			}
			if (b != 2)
			{
				return Color.White;
			}
			return Main.hcColor;
		}

		// Token: 0x060003E5 RID: 997 RVA: 0x0026C4A0 File Offset: 0x0026A6A0
		private bool CheckDD2CrystalPaymentLock(Item item)
		{
			if (!DD2Event.Ongoing)
			{
				return true;
			}
			int requiredDD2CrystalsToUse = this.GetRequiredDD2CrystalsToUse(item);
			return this.CountItem(3822, requiredDD2CrystalsToUse) >= requiredDD2CrystalsToUse;
		}

		// Token: 0x060003FD RID: 1021 RVA: 0x00280DD8 File Offset: 0x0027EFD8
		public void checkDPSTime()
		{
			int num = 3;
			if (!this.dpsStarted)
			{
				return;
			}
			if ((DateTime.Now - this.dpsLastHit).Seconds >= num)
			{
				this.dpsStarted = false;
			}
		}

		// Token: 0x060003A0 RID: 928 RVA: 0x0024D118 File Offset: 0x0024B318
		public void CheckDrowning()
		{
			bool flag = Collision.DrownCollision(this.position, this.width, this.height, this.gravDir);
			if (this.armor[0].type == 250)
			{
				flag = true;
			}
			if (this.inventory[this.selectedItem].type == 186)
			{
				try
				{
					int num = (int)((this.position.X + (float)(this.width / 2) + (float)(6 * this.direction)) / 16f);
					int num2 = 0;
					if (this.gravDir == -1f)
					{
						num2 = this.height;
					}
					int num3 = (int)((this.position.Y + (float)num2 - 44f * this.gravDir) / 16f);
					if (Main.tile[num, num3].liquid < 128)
					{
						if (Main.tile[num, num3] == null)
						{
							Main.tile[num, num3] = new Tile();
						}
						if (!Main.tile[num, num3].active() || !Main.tileSolid[(int)Main.tile[num, num3].type] || Main.tileSolidTop[(int)Main.tile[num, num3].type])
						{
							flag = false;
						}
					}
				}
				catch
				{
				}
			}
			if (this.gills)
			{
				flag = false;
			}
			if (Main.myPlayer == this.whoAmI)
			{
				if (this.merman)
				{
					flag = false;
				}
				if (flag)
				{
					this.breathCD++;
					int num4 = 7;
					if (this.inventory[this.selectedItem].type == 186)
					{
						num4 *= 2;
					}
					if (this.accDivingHelm)
					{
						num4 *= 4;
					}
					if (this.breathCD >= num4)
					{
						this.breathCD = 0;
						this.breath--;
						if (this.breath == 0)
						{
							Main.PlaySound(23, -1, -1, 1, 1f, 0f);
						}
						if (this.breath <= 0)
						{
							this.lifeRegenTime = 0;
							this.breath = 0;
							this.statLife -= 2;
							if (this.statLife <= 0)
							{
								this.statLife = 0;
								this.KillMe(PlayerDeathReason.ByOther(1), 10.0, 0, false);
							}
						}
					}
				}
				else
				{
					this.breath += 3;
					if (this.breath > this.breathMax)
					{
						this.breath = this.breathMax;
					}
					this.breathCD = 0;
				}
			}
			if (flag && Main.rand.Next(20) == 0 && !this.lavaWet && !this.honeyWet)
			{
				int num5 = 0;
				if (this.gravDir == -1f)
				{
					num5 += this.height - 12;
				}
				if (this.inventory[this.selectedItem].type == 186)
				{
					Dust.NewDust(new Vector2(this.position.X + (float)(10 * this.direction) + 4f, this.position.Y + (float)num5 - 54f * this.gravDir), this.width - 8, 8, 34, 0f, 0f, 0, default(Color), 1.2f);
					return;
				}
				Dust.NewDust(new Vector2(this.position.X + (float)(12 * this.direction), this.position.Y + (float)num5 + 4f * this.gravDir), this.width - 8, 8, 34, 0f, 0f, 0, default(Color), 1.2f);
			}
		}

		// Token: 0x060003A1 RID: 929 RVA: 0x0024D4BC File Offset: 0x0024B6BC
		public void CheckIceBreak()
		{
			if (this.velocity.Y > 7f)
			{
				Vector2 expr_26 = this.position + this.velocity;
				int num = (int)(expr_26.X / 16f);
				int num2 = (int)((expr_26.X + (float)this.width) / 16f);
				int num3 = (int)((this.position.Y + (float)this.height + 1f) / 16f);
				for (int i = num; i <= num2; i++)
				{
					for (int j = num3; j <= num3 + 1; j++)
					{
						if (Main.tile[i, j].nactive() && Main.tile[i, j].type == 162 && !WorldGen.SolidTile(i, j - 1))
						{
							WorldGen.KillTile(i, j, false, false, false);
							if (Main.netMode == 1)
							{
								NetMessage.SendData(17, -1, -1, null, 0, (float)i, (float)j, 0f, 0, 0, 0);
							}
						}
					}
				}
			}
		}

		// Token: 0x06000414 RID: 1044 RVA: 0x00285330 File Offset: 0x00283530
		public bool CheckMana(int amount, bool pay = false, bool blockQuickMana = false)
		{
			int num = (int)((float)amount * this.manaCost);
			if (this.statMana >= num)
			{
				if (pay)
				{
					this.statMana -= num;
				}
				return true;
			}
			if (!this.manaFlower || blockQuickMana)
			{
				return false;
			}
			this.QuickMana();
			if (this.statMana >= num)
			{
				if (pay)
				{
					this.statMana -= num;
				}
				return true;
			}
			return false;
		}

		// Token: 0x06000403 RID: 1027 RVA: 0x00281B0C File Offset: 0x0027FD0C
		public static bool CheckSpawn(int x, int y)
		{
			if (x < 10 || x > Main.maxTilesX - 10 || y < 10 || y > Main.maxTilesX - 10)
			{
				return false;
			}
			if (Main.tile[x, y - 1] == null)
			{
				return false;
			}
			if (!Main.tile[x, y - 1].active() || Main.tile[x, y - 1].type != 79)
			{
				return false;
			}
			for (int i = x - 1; i <= x + 1; i++)
			{
				for (int j = y - 3; j < y; j++)
				{
					if (Main.tile[i, j] == null)
					{
						return false;
					}
					if (Main.tile[i, j].nactive() && Main.tileSolid[(int)Main.tile[i, j].type] && !Main.tileSolidTop[(int)Main.tile[i, j].type])
					{
						Main.NewText(Language.GetTextValue("Game.BedObstructed"), 255, 240, 20, false);
						return false;
					}
				}
			}
			return WorldGen.StartRoomCheck(x, y - 1);
		}

		// Token: 0x06000356 RID: 854 RVA: 0x0022709C File Offset: 0x0022529C
		public void ClearBuff(int type)
		{
			for (int i = 0; i < 22; i++)
			{
				if (this.buffType[i] == type)
				{
					this.DelBuff(i);
				}
			}
		}

		// Token: 0x06000402 RID: 1026 RVA: 0x00281838 File Offset: 0x0027FA38
		public object clientClone()
		{
			Player player = new Player();
			player.zone1 = this.zone1;
			player.zone2 = this.zone2;
			player.zone3 = this.zone3;
			player.zone4 = this.zone4;
			player.extraAccessory = this.extraAccessory;
			player.MinionRestTargetPoint = this.MinionRestTargetPoint;
			player.MinionAttackTargetNPC = this.MinionAttackTargetNPC;
			player.direction = this.direction;
			player.selectedItem = this.selectedItem;
			player.controlUp = this.controlUp;
			player.controlDown = this.controlDown;
			player.controlLeft = this.controlLeft;
			player.controlRight = this.controlRight;
			player.controlJump = this.controlJump;
			player.controlUseItem = this.controlUseItem;
			player.statLife = this.statLife;
			player.statLifeMax = this.statLifeMax;
			player.statMana = this.statMana;
			player.statManaMax = this.statManaMax;
			player.position.X = this.position.X;
			player.chest = this.chest;
			player.talkNPC = this.talkNPC;
			player.hideVisual = this.hideVisual;
			player.hideMisc = this.hideMisc;
			for (int i = 0; i < 59; i++)
			{
				player.inventory[i] = this.inventory[i].Clone();
				if (i < this.armor.Length)
				{
					player.armor[i] = this.armor[i].Clone();
				}
				if (i < this.dye.Length)
				{
					player.dye[i] = this.dye[i].Clone();
				}
				if (i < this.miscEquips.Length)
				{
					player.miscEquips[i] = this.miscEquips[i].Clone();
				}
				if (i < this.miscDyes.Length)
				{
					player.miscDyes[i] = this.miscDyes[i].Clone();
				}
				if (i < this.bank.item.Length)
				{
					player.bank.item[i] = this.bank.item[i].Clone();
				}
				if (i < this.bank2.item.Length)
				{
					player.bank2.item[i] = this.bank2.item[i].Clone();
				}
				if (i < this.bank3.item.Length)
				{
					player.bank3.item[i] = this.bank3.item[i].Clone();
				}
			}
			player.trashItem = this.trashItem.Clone();
			for (int j = 0; j < 22; j++)
			{
				player.buffType[j] = this.buffType[j];
				player.buffTime[j] = this.buffTime[j];
			}
			this.DpadRadial.CopyTo(player.DpadRadial);
			this.CircularRadial.CopyTo(player.CircularRadial);
			return player;
		}

		// Token: 0x06000401 RID: 1025 RVA: 0x00003C56 File Offset: 0x00001E56
		public object Clone()
		{
			return base.MemberwiseClone();
		}

		// Token: 0x060003AA RID: 938 RVA: 0x0024E6D8 File Offset: 0x0024C8D8
		public void CollectTaxes()
		{
			int num = Item.buyPrice(0, 0, 0, 50);
			int num2 = Item.buyPrice(0, 10, 0, 0);
			if (!NPC.taxCollector)
			{
				return;
			}
			if (this.taxMoney >= num2)
			{
				return;
			}
			int num3 = 0;
			for (int i = 0; i < 200; i++)
			{
				if (Main.npc[i].active && !Main.npc[i].homeless && NPC.TypeToHeadIndex(Main.npc[i].type) > 0)
				{
					num3++;
				}
			}
			this.taxMoney += num * num3;
			if (this.taxMoney > num2)
			{
				this.taxMoney = num2;
			}
		}

		// Token: 0x06000390 RID: 912 RVA: 0x002471A0 File Offset: 0x002453A0
		private int CollideWithNPCs(Rectangle myRect, float Damage, float Knockback, int NPCImmuneTime, int PlayerImmuneTime)
		{
			int num = 0;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.active && !nPC.dontTakeDamage && !nPC.friendly && nPC.immune[this.whoAmI] == 0)
				{
					Rectangle rect = nPC.getRect();
					if (myRect.Intersects(rect) && (nPC.noTileCollide || Collision.CanHit(this.position, this.width, this.height, nPC.position, nPC.width, nPC.height)))
					{
						int direction = this.direction;
						if (this.velocity.X < 0f)
						{
							direction = -1;
						}
						if (this.velocity.X > 0f)
						{
							direction = 1;
						}
						if (this.whoAmI == Main.myPlayer)
						{
							this.ApplyDamageToNPC(nPC, (int)Damage, Knockback, direction, false);
						}
						nPC.immune[this.whoAmI] = NPCImmuneTime;
						this.immune = true;
						this.immuneNoBlink = true;
						this.immuneTime = PlayerImmuneTime;
						num++;
						break;
					}
				}
			}
			return num;
		}

		// Token: 0x06000419 RID: 1049 RVA: 0x00285528 File Offset: 0x00283728
		public void CommandForbiddenStorm()
		{
			List<int> list = new List<int>();
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.type == 656 && projectile.owner == this.whoAmI)
				{
					list.Add(i);
				}
			}
			bool flag = StrayMethods.CanSpawnSandstormFriendly(this.MinionRestTargetPoint, 30, 30);
			bool arg_80_0 = this.MinionRestTargetPoint == Vector2.Zero;
			Vector2 center = base.Center;
			Vector2 value = this.MinionRestTargetPoint;
			if (arg_80_0)
			{
				value = center;
			}
			bool flag2 = false;
			float[] array = new float[10];
			Vector2 v = value - center;
			Collision.LaserScan(center, v.SafeNormalize(Vector2.Zero), 60f, v.Length(), array);
			float num = 0f;
			for (int j = 0; j < array.Length; j++)
			{
				if (array[j] > num)
				{
					num = array[j];
				}
			}
			float[] array2 = array;
			for (int k = 0; k < array2.Length; k++)
			{
				if (Math.Abs(array2[k] - v.Length()) < 10f)
				{
					flag2 = true;
					break;
				}
			}
			if (list.Count <= 1)
			{
				Vector2 vector = center + v.SafeNormalize(Vector2.Zero) * num;
				Vector2 value2 = vector - center;
				if (value2.Length() > 0f)
				{
					for (float num2 = 0f; num2 < value2.Length(); num2 += 15f)
					{
						Vector2 position = center + value2 * (num2 / value2.Length());
						Dust expr_1AD = Main.dust[Dust.NewDust(position, 0, 0, 269, 0f, 0f, 0, default(Color), 1f)];
						expr_1AD.position = position;
						expr_1AD.fadeIn = 0.5f;
						expr_1AD.scale = 0.7f;
						expr_1AD.velocity *= 0.4f;
						expr_1AD.noLight = true;
					}
				}
				for (float num3 = 0f; num3 < 6.28318548f; num3 += 0.209439516f)
				{
					Dust expr_236 = Main.dust[Dust.NewDust(vector, 0, 0, 269, 0f, 0f, 0, default(Color), 1f)];
					expr_236.position = vector;
					expr_236.fadeIn = 1f;
					expr_236.scale = 0.3f;
					expr_236.noLight = true;
				}
			}
			flag &= (list.Count <= 1);
			flag &= flag2;
			if (flag)
			{
				flag = this.CheckMana(20, true, false);
				if (flag)
				{
					this.manaRegenDelay = (int)this.maxRegenDelay;
				}
			}
			if (!flag)
			{
				return;
			}
			foreach (int current in list)
			{
				Projectile projectile2 = Main.projectile[current];
				if (projectile2.ai[0] < 780f)
				{
					projectile2.ai[0] = 780f + projectile2.ai[0] % 60f;
					projectile2.netUpdate = true;
				}
			}
			int damage = (int)(20f * (1f + this.magicDamage + this.minionDamage - 2f));
			Projectile arg_362_0 = Main.projectile[Projectile.NewProjectile(this.MinionRestTargetPoint, Vector2.Zero, 656, damage, 0f, Main.myPlayer, 0f, 0f)];
		}

		// Token: 0x06000372 RID: 882 RVA: 0x002326C4 File Offset: 0x002308C4
		private void CommonPetBuffHandle(int buffIndex, ref bool petBool, int petProjID)
		{
			this.buffTime[buffIndex] = 18000;
			petBool = true;
			bool flag = true;
			if (this.ownedProjectileCounts[petProjID] > 0)
			{
				flag = false;
			}
			if (flag && this.whoAmI == Main.myPlayer)
			{
				Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, petProjID, 0, 0f, this.whoAmI, 0f, 0f);
			}
		}

		// Token: 0x0600036B RID: 875 RVA: 0x0022D150 File Offset: 0x0022B350
		public bool ConsumeItem(int type, bool reverseOrder = false)
		{
			int num = 0;
			int num2 = 58;
			int num3 = 1;
			if (reverseOrder)
			{
				num = 57;
				num2 = -1;
				num3 = -1;
			}
			for (int num4 = num; num4 != num2; num4 += num3)
			{
				if (this.inventory[num4].stack > 0 && this.inventory[num4].type == type)
				{
					this.inventory[num4].stack--;
					if (this.inventory[num4].stack <= 0)
					{
						this.inventory[num4].SetDefaults(0, false);
					}
					return true;
				}
			}
			return false;
		}

		// Token: 0x06000416 RID: 1046 RVA: 0x002853B4 File Offset: 0x002835B4
		public bool ConsumeSolarFlare()
		{
			if (!this.setSolar || this.solarShields <= 0)
			{
				return false;
			}
			if (Main.netMode == 1 && this.whoAmI != Main.myPlayer)
			{
				return true;
			}
			this.solarShields--;
			for (int i = 0; i < 22; i++)
			{
				if (this.buffType[i] >= 170 && this.buffType[i] <= 172)
				{
					this.DelBuff(i);
				}
			}
			if (this.solarShields > 0)
			{
				this.AddBuff(170 + this.solarShields - 1, 5, false);
			}
			this.solarCounter = 0;
			return true;
		}

		// Token: 0x06000357 RID: 855 RVA: 0x002270C8 File Offset: 0x002252C8
		public int CountBuffs()
		{
			int num = 0;
			for (int i = 0; i < 22; i++)
			{
				if (this.buffType[num] > 0)
				{
					num++;
				}
			}
			return num;
		}

		// Token: 0x06000373 RID: 883 RVA: 0x00232754 File Offset: 0x00230954
		public void Counterweight(Vector2 hitPos, int dmg, float kb)
		{
			if (!this.yoyoGlove && this.counterWeight <= 0)
			{
				return;
			}
			int num = -1;
			int num2 = 0;
			int num3 = 0;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].owner == this.whoAmI)
				{
					if (Main.projectile[i].counterweight)
					{
						num3++;
					}
					else if (Main.projectile[i].aiStyle == 99)
					{
						num2++;
						num = i;
					}
				}
			}
			if (this.yoyoGlove && num2 < 2)
			{
				if (num >= 0)
				{
					Vector2 vector = hitPos - base.Center;
					vector.Normalize();
					vector *= 16f;
					Projectile.NewProjectile(base.Center.X, base.Center.Y, vector.X, vector.Y, Main.projectile[num].type, Main.projectile[num].damage, Main.projectile[num].knockBack, this.whoAmI, 1f, 0f);
					return;
				}
			}
			else if (num3 < num2)
			{
				Vector2 vector2 = hitPos - base.Center;
				vector2.Normalize();
				vector2 *= 16f;
				float knockBack = (kb + 6f) / 2f;
				if (num3 > 0)
				{
					Projectile.NewProjectile(base.Center.X, base.Center.Y, vector2.X, vector2.Y, this.counterWeight, (int)((double)dmg * 0.8), knockBack, this.whoAmI, 1f, 0f);
					return;
				}
				Projectile.NewProjectile(base.Center.X, base.Center.Y, vector2.X, vector2.Y, this.counterWeight, (int)((double)dmg * 0.8), knockBack, this.whoAmI, 0f, 0f);
			}
		}

		// Token: 0x0600036A RID: 874 RVA: 0x0022D0FC File Offset: 0x0022B2FC
		public int CountItem(int type, int stopCountingAt = 0)
		{
			int num = 0;
			for (int num2 = 0; num2 != 58; num2++)
			{
				if (this.inventory[num2].stack > 0 && this.inventory[num2].type == type)
				{
					num += this.inventory[num2].stack;
					if (num >= stopCountingAt)
					{
						return num;
					}
				}
			}
			return num;
		}

		// Token: 0x06000394 RID: 916 RVA: 0x00248654 File Offset: 0x00246854
		public void DashMovement()
		{
			if (this.dash == 2 && this.eocDash > 0)
			{
				if (this.eocHit < 0)
				{
					Rectangle rectangle = new Rectangle((int)((double)this.position.X + (double)this.velocity.X * 0.5 - 4.0), (int)((double)this.position.Y + (double)this.velocity.Y * 0.5 - 4.0), this.width + 8, this.height + 8);
					for (int i = 0; i < 200; i++)
					{
						if (Main.npc[i].active && !Main.npc[i].dontTakeDamage && !Main.npc[i].friendly)
						{
							NPC nPC = Main.npc[i];
							Rectangle rect = nPC.getRect();
							if (rectangle.Intersects(rect) && (nPC.noTileCollide || this.CanHit(nPC)))
							{
								float num = 30f * this.meleeDamage;
								float num2 = 9f;
								bool crit = false;
								if (this.kbGlove)
								{
									num2 *= 2f;
								}
								if (this.kbBuff)
								{
									num2 *= 1.5f;
								}
								if (Main.rand.Next(100) < this.meleeCrit)
								{
									crit = true;
								}
								int num3 = this.direction;
								if (this.velocity.X < 0f)
								{
									num3 = -1;
								}
								if (this.velocity.X > 0f)
								{
									num3 = 1;
								}
								if (this.whoAmI == Main.myPlayer)
								{
									this.ApplyDamageToNPC(nPC, (int)num, num2, num3, crit);
								}
								this.eocDash = 10;
								this.dashDelay = 30;
								this.velocity.X = (float)(-(float)num3 * 9);
								this.velocity.Y = -4f;
								this.immune = true;
								this.immuneNoBlink = true;
								this.immuneTime = 4;
								this.eocHit = i;
							}
						}
					}
				}
				else if ((!this.controlLeft || this.velocity.X >= 0f) && (!this.controlRight || this.velocity.X <= 0f))
				{
					this.velocity.X = this.velocity.X * 0.95f;
				}
			}
			if (this.dash == 3 && this.dashDelay < 0 && this.whoAmI == Main.myPlayer)
			{
				Rectangle rectangle2 = new Rectangle((int)((double)this.position.X + (double)this.velocity.X * 0.5 - 4.0), (int)((double)this.position.Y + (double)this.velocity.Y * 0.5 - 4.0), this.width + 8, this.height + 8);
				for (int j = 0; j < 200; j++)
				{
					if (Main.npc[j].active && !Main.npc[j].dontTakeDamage && !Main.npc[j].friendly && Main.npc[j].immune[this.whoAmI] <= 0)
					{
						NPC nPC2 = Main.npc[j];
						Rectangle rect2 = nPC2.getRect();
						if (rectangle2.Intersects(rect2) && (nPC2.noTileCollide || this.CanHit(nPC2)))
						{
							if (!this.solarDashConsumedFlare)
							{
								this.solarDashConsumedFlare = true;
								this.ConsumeSolarFlare();
							}
							float num4 = 150f * this.meleeDamage;
							float num5 = 9f;
							bool crit2 = false;
							if (this.kbGlove)
							{
								num5 *= 2f;
							}
							if (this.kbBuff)
							{
								num5 *= 1.5f;
							}
							if (Main.rand.Next(100) < this.meleeCrit)
							{
								crit2 = true;
							}
							int direction = this.direction;
							if (this.velocity.X < 0f)
							{
								direction = -1;
							}
							if (this.velocity.X > 0f)
							{
								direction = 1;
							}
							if (this.whoAmI == Main.myPlayer)
							{
								this.ApplyDamageToNPC(nPC2, (int)num4, num5, direction, crit2);
								int num6 = Projectile.NewProjectile(base.Center.X, base.Center.Y, 0f, 0f, 608, 150, 15f, Main.myPlayer, 0f, 0f);
								Main.projectile[num6].Kill();
							}
							nPC2.immune[this.whoAmI] = 6;
							this.immune = true;
							this.immuneNoBlink = true;
							this.immuneTime = 4;
						}
					}
				}
			}
			if (this.dashDelay > 0)
			{
				if (this.eocDash > 0)
				{
					this.eocDash--;
				}
				if (this.eocDash == 0)
				{
					this.eocHit = -1;
				}
				this.dashDelay--;
				return;
			}
			if (this.dashDelay < 0)
			{
				float num7 = 12f;
				float num8 = 0.992f;
				float num9 = Math.Max(this.accRunSpeed, this.maxRunSpeed);
				float num10 = 0.96f;
				int num11 = 20;
				if (this.dash == 1)
				{
					for (int k = 0; k < 2; k++)
					{
						int num12;
						if (this.velocity.Y == 0f)
						{
							num12 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height - 4f), this.width, 8, 31, 0f, 0f, 100, default(Color), 1.4f);
						}
						else
						{
							num12 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)(this.height / 2) - 8f), this.width, 16, 31, 0f, 0f, 100, default(Color), 1.4f);
						}
						Main.dust[num12].velocity *= 0.1f;
						Main.dust[num12].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
						Main.dust[num12].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
					}
				}
				else if (this.dash == 2)
				{
					for (int l = 0; l < 0; l++)
					{
						int num13;
						if (this.velocity.Y == 0f)
						{
							num13 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height - 4f), this.width, 8, 31, 0f, 0f, 100, default(Color), 1.4f);
						}
						else
						{
							num13 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)(this.height / 2) - 8f), this.width, 16, 31, 0f, 0f, 100, default(Color), 1.4f);
						}
						Main.dust[num13].velocity *= 0.1f;
						Main.dust[num13].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
						Main.dust[num13].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
					}
					num8 = 0.985f;
					num10 = 0.94f;
					num11 = 30;
				}
				else if (this.dash == 3)
				{
					for (int m = 0; m < 4; m++)
					{
						int num14 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + 4f), this.width, this.height - 8, 6, 0f, 0f, 100, default(Color), 1.7f);
						Main.dust[num14].velocity *= 0.1f;
						Main.dust[num14].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
						Main.dust[num14].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
						Main.dust[num14].noGravity = true;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num14].fadeIn = 0.5f;
						}
					}
					num7 = 14f;
					num8 = 0.985f;
					num10 = 0.94f;
					num11 = 20;
				}
				else if (this.dash == 4)
				{
					for (int n = 0; n < 2; n++)
					{
						int num15 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + 4f), this.width, this.height - 8, 229, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num15].velocity *= 0.1f;
						Main.dust[num15].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
						Main.dust[num15].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						Main.dust[num15].noGravity = true;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num15].fadeIn = 0.3f;
						}
					}
					num8 = 0.985f;
					num10 = 0.94f;
					num11 = 20;
				}
				if (this.dash > 0)
				{
					this.vortexStealthActive = false;
					if (this.velocity.X > num7 || this.velocity.X < -num7)
					{
						this.velocity.X = this.velocity.X * num8;
						return;
					}
					if (this.velocity.X > num9 || this.velocity.X < -num9)
					{
						this.velocity.X = this.velocity.X * num10;
						return;
					}
					this.dashDelay = num11;
					if (this.velocity.X < 0f)
					{
						this.velocity.X = -num9;
						return;
					}
					if (this.velocity.X > 0f)
					{
						this.velocity.X = num9;
						return;
					}
				}
			}
			else if (this.dash > 0 && !this.mount.Active)
			{
				if (this.dash == 1)
				{
					int num16 = 0;
					bool flag = false;
					if (this.dashTime > 0)
					{
						this.dashTime--;
					}
					if (this.dashTime < 0)
					{
						this.dashTime++;
					}
					if (this.controlRight && this.releaseRight)
					{
						if (this.dashTime > 0)
						{
							num16 = 1;
							flag = true;
							this.dashTime = 0;
						}
						else
						{
							this.dashTime = 15;
						}
					}
					else if (this.controlLeft && this.releaseLeft)
					{
						if (this.dashTime < 0)
						{
							num16 = -1;
							flag = true;
							this.dashTime = 0;
						}
						else
						{
							this.dashTime = -15;
						}
					}
					if (flag)
					{
						this.velocity.X = 16.9f * (float)num16;
						Point point = (base.Center + new Vector2((float)(num16 * this.width / 2 + 2), this.gravDir * (float)(-(float)this.height) / 2f + this.gravDir * 2f)).ToTileCoordinates();
						Point point2 = (base.Center + new Vector2((float)(num16 * this.width / 2 + 2), 0f)).ToTileCoordinates();
						if (WorldGen.SolidOrSlopedTile(point.X, point.Y) || WorldGen.SolidOrSlopedTile(point2.X, point2.Y))
						{
							this.velocity.X = this.velocity.X / 2f;
						}
						this.dashDelay = -1;
						for (int num17 = 0; num17 < 20; num17++)
						{
							int num18 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 31, 0f, 0f, 100, default(Color), 2f);
							Dust expr_CD4_cp_0_cp_0 = Main.dust[num18];
							expr_CD4_cp_0_cp_0.position.X = expr_CD4_cp_0_cp_0.position.X + (float)Main.rand.Next(-5, 6);
							Dust expr_CF8_cp_0_cp_0 = Main.dust[num18];
							expr_CF8_cp_0_cp_0.position.Y = expr_CF8_cp_0_cp_0.position.Y + (float)Main.rand.Next(-5, 6);
							Main.dust[num18].velocity *= 0.2f;
							Main.dust[num18].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
							Main.dust[num18].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
						}
						int num19 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 34f), default(Vector2), Main.rand.Next(61, 64), 1f);
						Main.gore[num19].velocity.X = (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num19].velocity.Y = (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num19].velocity *= 0.4f;
						num19 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 14f), default(Vector2), Main.rand.Next(61, 64), 1f);
						Main.gore[num19].velocity.X = (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num19].velocity.Y = (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.gore[num19].velocity *= 0.4f;
						return;
					}
				}
				else if (this.dash == 2)
				{
					int num20 = 0;
					bool flag2 = false;
					if (this.dashTime > 0)
					{
						this.dashTime--;
					}
					if (this.dashTime < 0)
					{
						this.dashTime++;
					}
					if (this.controlRight && this.releaseRight)
					{
						if (this.dashTime > 0)
						{
							num20 = 1;
							flag2 = true;
							this.dashTime = 0;
						}
						else
						{
							this.dashTime = 15;
						}
					}
					else if (this.controlLeft && this.releaseLeft)
					{
						if (this.dashTime < 0)
						{
							num20 = -1;
							flag2 = true;
							this.dashTime = 0;
						}
						else
						{
							this.dashTime = -15;
						}
					}
					if (flag2)
					{
						this.velocity.X = 14.5f * (float)num20;
						Point point3 = (base.Center + new Vector2((float)(num20 * this.width / 2 + 2), this.gravDir * (float)(-(float)this.height) / 2f + this.gravDir * 2f)).ToTileCoordinates();
						Point point4 = (base.Center + new Vector2((float)(num20 * this.width / 2 + 2), 0f)).ToTileCoordinates();
						if (WorldGen.SolidOrSlopedTile(point3.X, point3.Y) || WorldGen.SolidOrSlopedTile(point4.X, point4.Y))
						{
							this.velocity.X = this.velocity.X / 2f;
						}
						this.dashDelay = -1;
						this.eocDash = 15;
						for (int num21 = 0; num21 < 0; num21++)
						{
							int num22 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 31, 0f, 0f, 100, default(Color), 2f);
							Dust expr_10F6_cp_0_cp_0 = Main.dust[num22];
							expr_10F6_cp_0_cp_0.position.X = expr_10F6_cp_0_cp_0.position.X + (float)Main.rand.Next(-5, 6);
							Dust expr_111A_cp_0_cp_0 = Main.dust[num22];
							expr_111A_cp_0_cp_0.position.Y = expr_111A_cp_0_cp_0.position.Y + (float)Main.rand.Next(-5, 6);
							Main.dust[num22].velocity *= 0.2f;
							Main.dust[num22].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
							Main.dust[num22].shader = GameShaders.Armor.GetSecondaryShader(this.cShield, this);
						}
						return;
					}
				}
				else if (this.dash == 3)
				{
					int num23 = 0;
					bool flag3 = false;
					if (this.dashTime > 0)
					{
						this.dashTime--;
					}
					if (this.dashTime < 0)
					{
						this.dashTime++;
					}
					if (this.controlRight && this.releaseRight)
					{
						if (this.dashTime > 0)
						{
							num23 = 1;
							flag3 = true;
							this.dashTime = 0;
							this.solarDashing = true;
							this.solarDashConsumedFlare = false;
						}
						else
						{
							this.dashTime = 15;
						}
					}
					else if (this.controlLeft && this.releaseLeft)
					{
						if (this.dashTime < 0)
						{
							num23 = -1;
							flag3 = true;
							this.dashTime = 0;
							this.solarDashing = true;
							this.solarDashConsumedFlare = false;
						}
						else
						{
							this.dashTime = -15;
						}
					}
					if (flag3)
					{
						this.velocity.X = 21.9f * (float)num23;
						Point point5 = (base.Center + new Vector2((float)(num23 * this.width / 2 + 2), this.gravDir * (float)(-(float)this.height) / 2f + this.gravDir * 2f)).ToTileCoordinates();
						Point point6 = (base.Center + new Vector2((float)(num23 * this.width / 2 + 2), 0f)).ToTileCoordinates();
						if (WorldGen.SolidOrSlopedTile(point5.X, point5.Y) || WorldGen.SolidOrSlopedTile(point6.X, point6.Y))
						{
							this.velocity.X = this.velocity.X / 2f;
						}
						this.dashDelay = -1;
						for (int num24 = 0; num24 < 20; num24++)
						{
							int num25 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 6, 0f, 0f, 100, default(Color), 2f);
							Dust expr_1396_cp_0_cp_0 = Main.dust[num25];
							expr_1396_cp_0_cp_0.position.X = expr_1396_cp_0_cp_0.position.X + (float)Main.rand.Next(-5, 6);
							Dust expr_13BA_cp_0_cp_0 = Main.dust[num25];
							expr_13BA_cp_0_cp_0.position.Y = expr_13BA_cp_0_cp_0.position.Y + (float)Main.rand.Next(-5, 6);
							Main.dust[num25].velocity *= 0.2f;
							Main.dust[num25].scale *= 1f + (float)Main.rand.Next(20) * 0.01f;
							Main.dust[num25].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
							Main.dust[num25].noGravity = true;
							Main.dust[num25].fadeIn = 0.5f;
						}
					}
				}
			}
		}

		// Token: 0x06000355 RID: 853 RVA: 0x00227014 File Offset: 0x00225214
		public void DelBuff(int b)
		{
			this.buffTime[b] = 0;
			this.buffType[b] = 0;
			for (int i = 0; i < 21; i++)
			{
				if (this.buffTime[i] == 0 || this.buffType[i] == 0)
				{
					for (int j = i + 1; j < 22; j++)
					{
						this.buffTime[j - 1] = this.buffTime[j];
						this.buffType[j - 1] = this.buffType[j];
						this.buffTime[j] = 0;
						this.buffType[j] = 0;
					}
				}
			}
		}

		// Token: 0x060003D5 RID: 981 RVA: 0x00266188 File Offset: 0x00264388
		public void DoCoins(int i)
		{
			if (this.inventory[i].stack == 100 && (this.inventory[i].type == 71 || this.inventory[i].type == 72 || this.inventory[i].type == 73))
			{
				this.inventory[i].SetDefaults(this.inventory[i].type + 1, false);
				for (int j = 0; j < 54; j++)
				{
					if (this.inventory[j].IsTheSameAs(this.inventory[i]) && j != i && this.inventory[j].type == this.inventory[i].type && this.inventory[j].stack < this.inventory[j].maxStack)
					{
						this.inventory[j].stack++;
						this.inventory[i].SetDefaults(0, false);
						this.inventory[i].active = false;
						this.inventory[i].TurnToAir();
						this.DoCoins(j);
					}
				}
			}
		}

		// Token: 0x06000397 RID: 919 RVA: 0x0024A1F0 File Offset: 0x002483F0
		public void DoubleJumpVisuals()
		{
			if (this.dJumpEffectCloud && this.doubleJumpCloud && !this.jumpAgainCloud && (this.jumpAgainSandstorm || !this.doubleJumpSandstorm) && ((this.gravDir == 1f && this.velocity.Y < 0f) || (this.gravDir == -1f && this.velocity.Y > 0f)))
			{
				int num = this.height;
				if (this.gravDir == -1f)
				{
					num = -6;
				}
				int num2 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)num), this.width + 8, 4, 16, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
				Main.dust[num2].velocity.X = Main.dust[num2].velocity.X * 0.5f - this.velocity.X * 0.1f;
				Main.dust[num2].velocity.Y = Main.dust[num2].velocity.Y * 0.5f - this.velocity.Y * 0.3f;
			}
			if (this.dJumpEffectSandstorm && this.doubleJumpSandstorm && !this.jumpAgainSandstorm && ((this.gravDir == 1f && this.velocity.Y < 0f) || (this.gravDir == -1f && this.velocity.Y > 0f)))
			{
				int num3 = this.height;
				if (this.gravDir == -1f)
				{
					num3 = -6;
				}
				float num4 = ((float)this.jump / 75f + 1f) / 2f;
				for (int i = 0; i < 3; i++)
				{
					int num5 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)(num3 / 2)), this.width, 32, 124, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 150, default(Color), 1f * num4);
					Main.dust[num5].velocity *= 0.5f * num4;
					Main.dust[num5].fadeIn = 1.5f * num4;
				}
				this.sandStorm = true;
				if (this.miscCounter % 3 == 0)
				{
					int num6 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 18f, this.position.Y + (float)(num3 / 2)), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(220, 223), num4);
					Main.gore[num6].velocity = this.velocity * 0.3f * num4;
					Main.gore[num6].alpha = 100;
				}
			}
			if (this.dJumpEffectFart && this.doubleJumpFart && !this.jumpAgainFart && ((this.gravDir == 1f && this.velocity.Y < 0f) || (this.gravDir == -1f && this.velocity.Y > 0f)))
			{
				int num7 = this.height;
				if (this.gravDir == -1f)
				{
					num7 = -6;
				}
				int num8 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)num7), this.width + 8, 4, 188, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
				Main.dust[num8].velocity.X = Main.dust[num8].velocity.X * 0.5f - this.velocity.X * 0.1f;
				Main.dust[num8].velocity.Y = Main.dust[num8].velocity.Y * 0.5f - this.velocity.Y * 0.3f;
				Main.dust[num8].velocity *= 0.5f;
			}
			if (this.dJumpEffectUnicorn && this.doubleJumpUnicorn && !this.jumpAgainUnicorn && ((this.gravDir == 1f && this.velocity.Y < 0f) || (this.gravDir == -1f && this.velocity.Y > 0f)))
			{
				Dust expr_59D = Main.dust[Dust.NewDust(this.position, this.width, this.height, Utils.SelectRandom<int>(Main.rand, new int[]
				{
					176,
					177,
					179
				}), 0f, 0f, 0, default(Color), 1f)];
				expr_59D.velocity = Vector2.Zero;
				expr_59D.noGravity = true;
				expr_59D.scale = 0.5f + Main.rand.NextFloat() * 0.8f;
				expr_59D.fadeIn = 1f + Main.rand.NextFloat() * 2f;
				expr_59D.shader = GameShaders.Armor.GetSecondaryShader(this.cMount, this);
			}
			if (this.dJumpEffectSail && this.doubleJumpSail && !this.jumpAgainSail && ((this.gravDir == 1f && this.velocity.Y < 1f) || (this.gravDir == -1f && this.velocity.Y > 1f)))
			{
				int num9 = 1;
				if (this.jump > 0)
				{
					num9 = 2;
				}
				int num10 = this.height - 6;
				if (this.gravDir == -1f)
				{
					num10 = 6;
				}
				for (int j = 0; j < num9; j++)
				{
					int num11 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)num10), this.width, 12, 253, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 100, default(Color), 1.5f);
					Main.dust[num11].scale += (float)Main.rand.Next(-5, 3) * 0.1f;
					if (this.jump <= 0)
					{
						Main.dust[num11].scale *= 0.8f;
					}
					else
					{
						Main.dust[num11].velocity -= this.velocity / 5f;
					}
					Main.dust[num11].noGravity = true;
					Vector2 value = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
					value.Normalize();
					value *= (float)Main.rand.Next(81) * 0.1f;
				}
			}
			if (this.dJumpEffectBlizzard && this.doubleJumpBlizzard && !this.jumpAgainBlizzard && ((this.gravDir == 1f && this.velocity.Y < 0f) || (this.gravDir == -1f && this.velocity.Y > 0f)))
			{
				int num12 = this.height - 6;
				if (this.gravDir == -1f)
				{
					num12 = 6;
				}
				for (int k = 0; k < 2; k++)
				{
					int num13 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)num12), this.width, 12, 76, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 0, default(Color), 1f);
					Main.dust[num13].velocity *= 0.1f;
					if (k == 0)
					{
						Main.dust[num13].velocity += this.velocity * 0.03f;
					}
					else
					{
						Main.dust[num13].velocity -= this.velocity * 0.03f;
					}
					Main.dust[num13].velocity -= this.velocity * 0.1f;
					Main.dust[num13].noGravity = true;
					Main.dust[num13].noLight = true;
				}
				for (int l = 0; l < 3; l++)
				{
					int num14 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)num12), this.width, 12, 76, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 0, default(Color), 1f);
					Main.dust[num14].fadeIn = 1.5f;
					Main.dust[num14].velocity *= 0.6f;
					Main.dust[num14].velocity += this.velocity * 0.8f;
					Main.dust[num14].noGravity = true;
					Main.dust[num14].noLight = true;
				}
				for (int m = 0; m < 3; m++)
				{
					int num15 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)num12), this.width, 12, 76, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 0, default(Color), 1f);
					Main.dust[num15].fadeIn = 1.5f;
					Main.dust[num15].velocity *= 0.6f;
					Main.dust[num15].velocity -= this.velocity * 0.8f;
					Main.dust[num15].noGravity = true;
					Main.dust[num15].noLight = true;
				}
			}
		}

		// Token: 0x060003FF RID: 1023 RVA: 0x00280EF0 File Offset: 0x0027F0F0
		public int DropCoins()
		{
			int num = 0;
			for (int i = 0; i < 59; i++)
			{
				if (this.inventory[i].type >= 71 && this.inventory[i].type <= 74)
				{
					int num2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.inventory[i].type, 1, false, 0, false, false);
					int num3 = this.inventory[i].stack / 2;
					if (Main.expertMode)
					{
						num3 = (int)((double)this.inventory[i].stack * 0.25);
					}
					num3 = this.inventory[i].stack - num3;
					this.inventory[i].stack -= num3;
					if (this.inventory[i].type == 71)
					{
						num += num3;
					}
					if (this.inventory[i].type == 72)
					{
						num += num3 * 100;
					}
					if (this.inventory[i].type == 73)
					{
						num += num3 * 10000;
					}
					if (this.inventory[i].type == 74)
					{
						num += num3 * 1000000;
					}
					if (this.inventory[i].stack <= 0)
					{
						this.inventory[i] = new Item();
					}
					Main.item[num2].stack = num3;
					Main.item[num2].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
					Main.item[num2].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
					Main.item[num2].noGrabDelay = 100;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num2, 0f, 0f, 0f, 0, 0, 0);
					}
					if (i == 58)
					{
						Main.mouseItem = this.inventory[i].Clone();
					}
				}
			}
			this.lostCoins = num;
			this.lostCoinString = Main.ValueToCoins(this.lostCoins);
			return num;
		}

		// Token: 0x06000351 RID: 849 RVA: 0x002265BC File Offset: 0x002247BC
		public void dropItemCheck()
		{
			if (!Main.playerInventory)
			{
				this.noThrow = 0;
			}
			if (this.noThrow > 0)
			{
				this.noThrow--;
			}
			if (!Main.InGuideCraftMenu && Main.guideItem.type > 0)
			{
				Main.guideItem.position = base.Center;
				Item item = this.GetItem(this.whoAmI, Main.guideItem, false, true);
				if (item.stack > 0)
				{
					int num = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item.type, item.stack, false, (int)Main.guideItem.prefix, true, false);
					Main.item[num].newAndShiny = false;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				Main.guideItem = new Item();
			}
			if (!Main.InReforgeMenu && Main.reforgeItem.type > 0)
			{
				Main.reforgeItem.position = base.Center;
				Item item2 = this.GetItem(this.whoAmI, Main.reforgeItem, false, true);
				if (item2.stack > 0)
				{
					int num2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, (int)Main.reforgeItem.prefix, true, false);
					Main.item[num2].newAndShiny = false;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num2, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				Main.reforgeItem = new Item();
			}
			if (Main.myPlayer == this.whoAmI)
			{
				this.inventory[58] = Main.mouseItem.Clone();
			}
			bool flag = true;
			if (Main.mouseItem.type > 0 && Main.mouseItem.stack > 0)
			{
				if (!Main.gamePaused)
				{
					Player.tileTargetX = (int)(((float)Main.mouseX + Main.screenPosition.X) / 16f);
					Player.tileTargetY = (int)(((float)Main.mouseY + Main.screenPosition.Y) / 16f);
					if (this.gravDir == -1f)
					{
						Player.tileTargetY = (int)((Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16f);
					}
				}
				if (this.selectedItem != 58)
				{
					this.oldSelectItem = this.selectedItem;
				}
				this.selectedItem = 58;
				flag = false;
			}
			if (flag && this.selectedItem == 58 && this.itemTime == 0 && this.itemAnimation == 0)
			{
				this.selectedItem = this.oldSelectItem;
			}
			if (WorldGen.InWorld(Player.tileTargetX, Player.tileTargetY, 0) && Main.tile[Player.tileTargetX, Player.tileTargetY] != null && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 334 && this.ItemFitsWeaponRack(this.inventory[this.selectedItem]))
			{
				this.noThrow = 2;
			}
			if (WorldGen.InWorld(Player.tileTargetX, Player.tileTargetY, 0) && Main.tile[Player.tileTargetX, Player.tileTargetY] != null && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 395 && this.ItemFitsItemFrame(this.inventory[this.selectedItem]))
			{
				this.noThrow = 2;
			}
			if (Main.mouseItem.type > 0 && !Main.playerInventory)
			{
				Main.mouseItem.position = base.Center;
				Item item3 = this.GetItem(this.whoAmI, Main.mouseItem, false, true);
				if (item3.stack > 0)
				{
					int num3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item3.type, item3.stack, false, 0, true, false);
					Main.item[num3].newAndShiny = false;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num3, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				Main.mouseItem = new Item();
				this.inventory[58] = new Item();
				Recipe.FindRecipes();
			}
			if (((this.controlThrow && this.releaseThrow && !this.inventory[this.selectedItem].favorited && this.inventory[this.selectedItem].type > 0 && !Main.drawingPlayerChat) || (((Main.mouseRight && !this.mouseInterface && Main.mouseRightRelease) || !Main.playerInventory) && Main.mouseItem.type > 0 && Main.mouseItem.stack > 0)) && this.noThrow <= 0)
			{
				this.DropSelectedItem();
			}
			if (Main.gamePaused && this.selectedItem == 58)
			{
				this.selectedItem = this.oldSelectItem;
			}
		}

		// Token: 0x06000400 RID: 1024 RVA: 0x00281108 File Offset: 0x0027F308
		public void DropItems()
		{
			for (int i = 0; i < 59; i++)
			{
				if (this.inventory[i].stack > 0 && this.inventory[i].Name != "Copper Pickaxe" && this.inventory[i].Name != "Copper Axe" && this.inventory[i].Name != "Copper Shortsword")
				{
					int num = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.inventory[i].type, 1, false, 0, false, false);
					Main.item[num].netDefaults(this.inventory[i].netID);
					Main.item[num].Prefix((int)this.inventory[i].prefix);
					Main.item[num].stack = this.inventory[i].stack;
					Main.item[num].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
					Main.item[num].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
					Main.item[num].noGrabDelay = 100;
					Main.item[num].newAndShiny = false;
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, num, 0f, 0f, 0f, 0, 0, 0);
					}
				}
				this.inventory[i] = new Item();
				if (i < this.armor.Length)
				{
					if (this.armor[i].stack > 0)
					{
						int num2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.armor[i].type, 1, false, 0, false, false);
						Main.item[num2].netDefaults(this.armor[i].netID);
						Main.item[num2].Prefix((int)this.armor[i].prefix);
						Main.item[num2].stack = this.armor[i].stack;
						Main.item[num2].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
						Main.item[num2].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
						Main.item[num2].noGrabDelay = 100;
						Main.item[num2].newAndShiny = false;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num2, 0f, 0f, 0f, 0, 0, 0);
						}
					}
					this.armor[i] = new Item();
				}
				if (i < this.dye.Length)
				{
					if (this.dye[i].stack > 0)
					{
						int num3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.dye[i].type, 1, false, 0, false, false);
						Main.item[num3].netDefaults(this.dye[i].netID);
						Main.item[num3].Prefix((int)this.dye[i].prefix);
						Main.item[num3].stack = this.dye[i].stack;
						Main.item[num3].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
						Main.item[num3].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
						Main.item[num3].noGrabDelay = 100;
						Main.item[num3].newAndShiny = false;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num3, 0f, 0f, 0f, 0, 0, 0);
						}
					}
					this.dye[i] = new Item();
				}
				if (i < this.miscEquips.Length)
				{
					if (this.miscEquips[i].stack > 0)
					{
						int num4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.miscEquips[i].type, 1, false, 0, false, false);
						Main.item[num4].netDefaults(this.miscEquips[i].netID);
						Main.item[num4].Prefix((int)this.miscEquips[i].prefix);
						Main.item[num4].stack = this.miscEquips[i].stack;
						Main.item[num4].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
						Main.item[num4].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
						Main.item[num4].noGrabDelay = 100;
						Main.item[num4].newAndShiny = false;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num4, 0f, 0f, 0f, 0, 0, 0);
						}
					}
					this.miscEquips[i] = new Item();
				}
				if (i < this.miscDyes.Length)
				{
					if (this.miscDyes[i].stack > 0)
					{
						int num5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.miscDyes[i].type, 1, false, 0, false, false);
						Main.item[num5].netDefaults(this.miscDyes[i].netID);
						Main.item[num5].Prefix((int)this.miscDyes[i].prefix);
						Main.item[num5].stack = this.miscDyes[i].stack;
						Main.item[num5].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
						Main.item[num5].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
						Main.item[num5].noGrabDelay = 100;
						Main.item[num5].newAndShiny = false;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num5, 0f, 0f, 0f, 0, 0, 0);
						}
					}
					this.miscDyes[i] = new Item();
				}
			}
			this.inventory[0].SetDefaults(3507, false);
			this.inventory[0].Prefix(-1);
			this.inventory[1].SetDefaults(3509, false);
			this.inventory[1].Prefix(-1);
			this.inventory[2].SetDefaults(3506, false);
			this.inventory[2].Prefix(-1);
			Main.mouseItem = new Item();
		}

		// Token: 0x06000352 RID: 850 RVA: 0x00226ABC File Offset: 0x00224CBC
		public void DropSelectedItem()
		{
			bool flag = false;
			if (this.inventory[this.selectedItem].favorited)
			{
				this.inventory[this.selectedItem] = this.GetItem(this.whoAmI, this.inventory[this.selectedItem], false, true);
				if (this.selectedItem == 58)
				{
					Main.mouseItem = this.inventory[this.selectedItem];
				}
				Recipe.FindRecipes();
				if (this.inventory[this.selectedItem].type == 0)
				{
					flag = true;
				}
			}
			if (!flag)
			{
				Item item = new Item();
				bool flag2 = false;
				if (((Main.mouseRight && !this.mouseInterface && Main.mouseRightRelease) || !Main.playerInventory) && Main.mouseItem.type > 0 && Main.mouseItem.stack > 0)
				{
					item = this.inventory[this.selectedItem];
					this.inventory[this.selectedItem] = Main.mouseItem;
					this.delayUseItem = true;
					this.controlUseItem = false;
					flag2 = true;
				}
				int num = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.inventory[this.selectedItem].type, 1, false, 0, false, false);
				if (!flag2 && this.inventory[this.selectedItem].type == 8 && this.inventory[this.selectedItem].stack > 1)
				{
					this.inventory[this.selectedItem].stack--;
				}
				else
				{
					this.inventory[this.selectedItem].position = Main.item[num].position;
					Main.item[num] = this.inventory[this.selectedItem];
					this.inventory[this.selectedItem] = new Item();
					if (this.selectedItem == 58)
					{
						Main.mouseItem = new Item();
					}
				}
				if (Main.netMode == 0)
				{
					Main.item[num].noGrabDelay = 100;
				}
				Main.item[num].velocity.Y = -2f;
				Main.item[num].velocity.X = (float)(4 * this.direction) + this.velocity.X;
				Main.item[num].favorited = false;
				Main.item[num].newAndShiny = false;
				if (((Main.mouseRight && !this.mouseInterface) || !Main.playerInventory) && Main.mouseItem.type > 0)
				{
					this.inventory[this.selectedItem] = item;
					Main.mouseItem = new Item();
				}
				else
				{
					this.itemAnimation = 10;
					this.itemAnimationMax = 10;
				}
				Recipe.FindRecipes();
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, num, 0f, 0f, 0f, 0, 0, 0);
				}
			}
		}

		// Token: 0x060003D3 RID: 979 RVA: 0x00265E2C File Offset: 0x0026402C
		public void DropTombstone(int coinsOwned, NetworkText deathText, int hitDirection)
		{
			if (Main.netMode != 1)
			{
				float num = (float)Main.rand.Next(-35, 36) * 0.1f;
				while (num < 2f && num > -2f)
				{
					num += (float)Main.rand.Next(-30, 31) * 0.1f;
				}
				int num2 = Main.rand.Next(6);
				if (coinsOwned > 100000)
				{
					num2 = Main.rand.Next(5);
					num2 += 527;
				}
				else if (num2 == 0)
				{
					num2 = 43;
				}
				else
				{
					num2 = 200 + num2;
				}
				int num3 = Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), (float)Main.rand.Next(10, 30) * 0.1f * (float)hitDirection + num, (float)Main.rand.Next(-40, -20) * 0.1f, num2, 0, 0f, Main.myPlayer, 0f, 0f);
				Main.projectile[num3].miscText = deathText.ToString();
			}
		}

		// Token: 0x060003A5 RID: 933 RVA: 0x0024D7E4 File Offset: 0x0024B9E4
		public unsafe void DryCollision(bool fallThrough, bool ignorePlats)
		{
			int height;
			if (this.onTrack)
			{
				height = this.height - 10;
			}
			else
			{
				height = this.height;
			}
			if (this.velocity.Length() > 16f)
			{
				Vector2 arg_69_0 = Collision.TileCollision(this.position, this.velocity, this.width, height, fallThrough, ignorePlats, (int)this.gravDir);
				float num = this.velocity.Length();
				Vector2 value = Vector2.Normalize(this.velocity);
				if (arg_69_0.Y == 0f)
				{
					value.Y = 0f;
				}
				Vector2 vector = Vector2.Zero;
				bool flag = this.mount.Type == 7 || this.mount.Type == 8 || this.mount.Type == 12;
				Vector2 arg_BC_0 = Vector2.Zero;
				while (num > 0f)
				{
					float num2 = num;
					if (num2 > 16f)
					{
						num2 = 16f;
					}
					num -= num2;
					Vector2 velocity = value * num2;
					this.velocity = velocity;
					this.SlopeDownMovement();
					velocity = this.velocity;
					if (this.velocity.Y == this.gravity && (!this.mount.Active || (!this.mount.Cart && !flag)))
					{
						Collision.StepDown(ref this.position, ref velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.waterWalk || this.waterWalk2);
					}
					if (this.gravDir == -1f)
					{
						if ((this.carpetFrame != -1 || this.velocity.Y <= this.gravity) && !this.controlUp)
						{
							Collision.StepUp(ref this.position, ref velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.controlUp, 0);
						}
					}
					else if (flag || ((this.carpetFrame != -1 || this.velocity.Y >= this.gravity) && !this.controlDown && !this.mount.Cart))
					{
						Collision.StepUp(ref this.position, ref velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.controlUp, 0);
					}
					Vector2 vector2 = Collision.TileCollision(this.position, velocity, this.width, height, fallThrough, ignorePlats, (int)this.gravDir);
					if (Collision.up && this.gravDir == 1f)
					{
						this.jump = 0;
					}
					if (this.waterWalk || this.waterWalk2)
					{
						Vector2 arg_2B5_0 = this.velocity;
						vector2 = Collision.WaterCollision(this.position, vector2, this.width, this.height, fallThrough, false, this.waterWalk);
						if (arg_2B5_0 != this.velocity)
						{
							this.fallStart = (int)(this.position.Y / 16f);
						}
					}
					this.position += vector2;
					bool falling = false;
					if (vector2.Y > this.gravity)
					{
						falling = true;
					}
					if (vector2.Y < -this.gravity)
					{
						falling = true;
					}
					this.velocity = vector2;
					this.UpdateTouchingTiles();
					this.TryBouncingBlocks(falling);
					this.TryLandingOnDetonator();
					this.SlopingCollision(fallThrough);
					Collision.StepConveyorBelt(this, this.gravDir);
					vector2 = this.velocity;
					vector += vector2;
				}
				this.velocity = vector;
				return;
			}
			this.velocity = Collision.TileCollision(this.position, this.velocity, this.width, height, fallThrough, ignorePlats, (int)this.gravDir);
			if (Collision.up && this.gravDir == 1f)
			{
				this.jump = 0;
			}
			if (this.waterWalk || this.waterWalk2)
			{
				Vector2 arg_3EB_0 = this.velocity;
				this.velocity = Collision.WaterCollision(this.position, this.velocity, this.width, this.height, fallThrough, false, this.waterWalk);
				if (arg_3EB_0 != this.velocity)
				{
					this.fallStart = (int)(this.position.Y / 16f);
				}
			}
			this.position += this.velocity;
		}

		// Token: 0x060003DA RID: 986 RVA: 0x0026B380 File Offset: 0x00269580
		private static void ExtractinatorUse(int extractType)
		{
			int num = 5000;
			int num2 = 25;
			int num3 = 50;
			int num4 = -1;
			if (extractType == 1)
			{
				num /= 3;
				num2 *= 2;
				num3 /= 2;
				num4 = 10;
			}
			int num5 = 1;
			int num6;
			if (num4 != -1 && Main.rand.Next(num4) == 0)
			{
				num6 = 3380;
				if (Main.rand.Next(5) == 0)
				{
					num5 += Main.rand.Next(2);
				}
				if (Main.rand.Next(10) == 0)
				{
					num5 += Main.rand.Next(3);
				}
				if (Main.rand.Next(15) == 0)
				{
					num5 += Main.rand.Next(4);
				}
			}
			else if (Main.rand.Next(2) == 0)
			{
				if (Main.rand.Next(12000) == 0)
				{
					num6 = 74;
					if (Main.rand.Next(14) == 0)
					{
						num5 += Main.rand.Next(0, 2);
					}
					if (Main.rand.Next(14) == 0)
					{
						num5 += Main.rand.Next(0, 2);
					}
					if (Main.rand.Next(14) == 0)
					{
						num5 += Main.rand.Next(0, 2);
					}
				}
				else if (Main.rand.Next(800) == 0)
				{
					num6 = 73;
					if (Main.rand.Next(6) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(6) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(6) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(6) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(6) == 0)
					{
						num5 += Main.rand.Next(1, 20);
					}
				}
				else if (Main.rand.Next(60) == 0)
				{
					num6 = 72;
					if (Main.rand.Next(4) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(4) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(4) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(4) == 0)
					{
						num5 += Main.rand.Next(5, 25);
					}
				}
				else
				{
					num6 = 71;
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(10, 25);
					}
				}
			}
			else if (num != -1 && Main.rand.Next(num) == 0)
			{
				num6 = 1242;
			}
			else if (num2 != -1 && Main.rand.Next(num2) == 0)
			{
				num6 = Main.rand.Next(6);
				if (num6 == 0)
				{
					num6 = 181;
				}
				else if (num6 == 1)
				{
					num6 = 180;
				}
				else if (num6 == 2)
				{
					num6 = 177;
				}
				else if (num6 == 3)
				{
					num6 = 179;
				}
				else if (num6 == 4)
				{
					num6 = 178;
				}
				else
				{
					num6 = 182;
				}
				if (Main.rand.Next(20) == 0)
				{
					num5 += Main.rand.Next(0, 2);
				}
				if (Main.rand.Next(30) == 0)
				{
					num5 += Main.rand.Next(0, 3);
				}
				if (Main.rand.Next(40) == 0)
				{
					num5 += Main.rand.Next(0, 4);
				}
				if (Main.rand.Next(50) == 0)
				{
					num5 += Main.rand.Next(0, 5);
				}
				if (Main.rand.Next(60) == 0)
				{
					num5 += Main.rand.Next(0, 6);
				}
			}
			else if (num3 != -1 && Main.rand.Next(num3) == 0)
			{
				num6 = 999;
				if (Main.rand.Next(20) == 0)
				{
					num5 += Main.rand.Next(0, 2);
				}
				if (Main.rand.Next(30) == 0)
				{
					num5 += Main.rand.Next(0, 3);
				}
				if (Main.rand.Next(40) == 0)
				{
					num5 += Main.rand.Next(0, 4);
				}
				if (Main.rand.Next(50) == 0)
				{
					num5 += Main.rand.Next(0, 5);
				}
				if (Main.rand.Next(60) == 0)
				{
					num5 += Main.rand.Next(0, 6);
				}
			}
			else if (Main.rand.Next(3) == 0)
			{
				if (Main.rand.Next(5000) == 0)
				{
					num6 = 74;
					if (Main.rand.Next(10) == 0)
					{
						num5 += Main.rand.Next(0, 3);
					}
					if (Main.rand.Next(10) == 0)
					{
						num5 += Main.rand.Next(0, 3);
					}
					if (Main.rand.Next(10) == 0)
					{
						num5 += Main.rand.Next(0, 3);
					}
					if (Main.rand.Next(10) == 0)
					{
						num5 += Main.rand.Next(0, 3);
					}
					if (Main.rand.Next(10) == 0)
					{
						num5 += Main.rand.Next(0, 3);
					}
				}
				else if (Main.rand.Next(400) == 0)
				{
					num6 = 73;
					if (Main.rand.Next(5) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(5) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(5) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(5) == 0)
					{
						num5 += Main.rand.Next(1, 21);
					}
					if (Main.rand.Next(5) == 0)
					{
						num5 += Main.rand.Next(1, 20);
					}
				}
				else if (Main.rand.Next(30) == 0)
				{
					num6 = 72;
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(5, 26);
					}
					if (Main.rand.Next(3) == 0)
					{
						num5 += Main.rand.Next(5, 25);
					}
				}
				else
				{
					num6 = 71;
					if (Main.rand.Next(2) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(2) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(2) == 0)
					{
						num5 += Main.rand.Next(10, 26);
					}
					if (Main.rand.Next(2) == 0)
					{
						num5 += Main.rand.Next(10, 25);
					}
				}
			}
			else
			{
				num6 = Main.rand.Next(8);
				if (num6 == 0)
				{
					num6 = 12;
				}
				else if (num6 == 1)
				{
					num6 = 11;
				}
				else if (num6 == 2)
				{
					num6 = 14;
				}
				else if (num6 == 3)
				{
					num6 = 13;
				}
				else if (num6 == 4)
				{
					num6 = 699;
				}
				else if (num6 == 5)
				{
					num6 = 700;
				}
				else if (num6 == 6)
				{
					num6 = 701;
				}
				else
				{
					num6 = 702;
				}
				if (Main.rand.Next(20) == 0)
				{
					num5 += Main.rand.Next(0, 2);
				}
				if (Main.rand.Next(30) == 0)
				{
					num5 += Main.rand.Next(0, 3);
				}
				if (Main.rand.Next(40) == 0)
				{
					num5 += Main.rand.Next(0, 4);
				}
				if (Main.rand.Next(50) == 0)
				{
					num5 += Main.rand.Next(0, 5);
				}
				if (Main.rand.Next(60) == 0)
				{
					num5 += Main.rand.Next(0, 6);
				}
			}
			if (num6 > 0)
			{
				Vector2 vector = Main.ReverseGravitySupport(Main.MouseScreen, 0f) + Main.screenPosition;
				int number = Item.NewItem((int)vector.X, (int)vector.Y, 1, 1, num6, num5, false, -1, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
				}
			}
		}

		// Token: 0x060003D6 RID: 982 RVA: 0x002662AC File Offset: 0x002644AC
		public Item FillAmmo(int plr, Item newItem, bool noText = false)
		{
			for (int i = 54; i < 58; i++)
			{
				if (this.inventory[i].type > 0 && this.inventory[i].stack < this.inventory[i].maxStack && newItem.IsTheSameAs(this.inventory[i]))
				{
					Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					if (newItem.stack + this.inventory[i].stack <= this.inventory[i].maxStack)
					{
						this.inventory[i].stack += newItem.stack;
						if (!noText)
						{
							ItemText.NewText(newItem, newItem.stack, false, false);
						}
						this.DoCoins(i);
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						return new Item();
					}
					newItem.stack -= this.inventory[i].maxStack - this.inventory[i].stack;
					if (!noText)
					{
						ItemText.NewText(newItem, this.inventory[i].maxStack - this.inventory[i].stack, false, false);
					}
					this.inventory[i].stack = this.inventory[i].maxStack;
					this.DoCoins(i);
					if (plr == Main.myPlayer)
					{
						Recipe.FindRecipes();
					}
				}
			}
			if (newItem.bait <= 0 && newItem.type != 169 && newItem.type != 75 && newItem.type != 23 && newItem.type != 408 && newItem.type != 370 && newItem.type != 1246 && newItem.type != 154 && !newItem.notAmmo)
			{
				for (int j = 54; j < 58; j++)
				{
					if (this.inventory[j].type == 0)
					{
						this.inventory[j] = newItem;
						if (!noText)
						{
							ItemText.NewText(newItem, newItem.stack, false, false);
						}
						this.DoCoins(j);
						Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						return new Item();
					}
				}
			}
			return newItem;
		}

		// Token: 0x06000353 RID: 851 RVA: 0x00226D78 File Offset: 0x00224F78
		public int FindBuffIndex(int type)
		{
			if (this.buffImmune[type])
			{
				return -1;
			}
			for (int i = 0; i < 22; i++)
			{
				if (this.buffTime[i] >= 1 && this.buffType[i] == type)
				{
					return i;
				}
			}
			return -1;
		}

		// Token: 0x0600034F RID: 847 RVA: 0x002262D8 File Offset: 0x002244D8
		public static byte FindClosest(Vector2 Position, int Width, int Height)
		{
			byte result = 0;
			for (int i = 0; i < 255; i++)
			{
				if (Main.player[i].active)
				{
					result = (byte)i;
					break;
				}
			}
			float num = -1f;
			for (int j = 0; j < 255; j++)
			{
				if (Main.player[j].active && !Main.player[j].dead)
				{
					float num2 = Math.Abs(Main.player[j].position.X + (float)(Main.player[j].width / 2) - (Position.X + (float)(Width / 2))) + Math.Abs(Main.player[j].position.Y + (float)(Main.player[j].height / 2) - (Position.Y + (float)(Height / 2)));
					if (num == -1f || num2 < num)
					{
						num = num2;
						result = (byte)j;
					}
				}
			}
			return result;
		}

		// Token: 0x0600040C RID: 1036 RVA: 0x0028385C File Offset: 0x00281A5C
		public int FindItem(int netid)
		{
			for (int i = 0; i < 58; i++)
			{
				if (netid == this.inventory[i].netID && this.inventory[i].stack > 0)
				{
					return i;
				}
			}
			return -1;
		}

		// Token: 0x0600040D RID: 1037 RVA: 0x0028389C File Offset: 0x00281A9C
		public int FindItem(List<int> netids)
		{
			for (int i = 0; i < 58; i++)
			{
				if (this.inventory[i].stack > 0 && netids.Contains(this.inventory[i].netID))
				{
					return i;
				}
			}
			return -1;
		}

		// Token: 0x0600040E RID: 1038 RVA: 0x002838E0 File Offset: 0x00281AE0
		public int FindItem(bool[] validtypes)
		{
			for (int i = 0; i < 58; i++)
			{
				if (this.inventory[i].stack > 0 && validtypes[this.inventory[i].type])
				{
					return i;
				}
			}
			return -1;
		}

		// Token: 0x0600038E RID: 910 RVA: 0x00245184 File Offset: 0x00243384
		public void FindPulley()
		{
			if (this.controlUp || this.controlDown)
			{
				int num = (int)(this.position.X + (float)(this.width / 2)) / 16;
				int num2 = (int)(this.position.Y - 8f) / 16;
				if (Main.tile[num, num2] != null && Main.tile[num, num2].active() && Main.tileRope[(int)Main.tile[num, num2].type])
				{
					float num3 = this.position.Y;
					if (Main.tile[num, num2 - 1] == null)
					{
						Main.tile[num, num2 - 1] = new Tile();
					}
					if (Main.tile[num, num2 + 1] == null)
					{
						Main.tile[num, num2 + 1] = new Tile();
					}
					if ((!Main.tile[num, num2 - 1].active() || !Main.tileRope[(int)Main.tile[num, num2 - 1].type]) && (!Main.tile[num, num2 + 1].active() || !Main.tileRope[(int)Main.tile[num, num2 + 1].type]))
					{
						num3 = (float)(num2 * 16 + 22);
					}
					float num4 = (float)(num * 16 + 8 - this.width / 2 + 6 * this.direction);
					int num5 = num * 16 + 8 - this.width / 2 + 6;
					int num6 = num * 16 + 8 - this.width / 2;
					int num7 = num * 16 + 8 - this.width / 2 + -6;
					int num8 = 1;
					float num9 = Math.Abs(this.position.X - (float)num5);
					if (Math.Abs(this.position.X - (float)num6) < num9)
					{
						num8 = 2;
						num9 = Math.Abs(this.position.X - (float)num6);
					}
					if (Math.Abs(this.position.X - (float)num7) < num9)
					{
						num8 = 3;
						num9 = Math.Abs(this.position.X - (float)num7);
					}
					if (num8 == 1)
					{
						num4 = (float)num5;
						this.pulleyDir = 2;
						this.direction = 1;
					}
					if (num8 == 2)
					{
						num4 = (float)num6;
						this.pulleyDir = 1;
					}
					if (num8 == 3)
					{
						num4 = (float)num7;
						this.pulleyDir = 2;
						this.direction = -1;
					}
					if (!Collision.SolidCollision(new Vector2(num4, this.position.Y), this.width, this.height))
					{
						if (this.whoAmI == Main.myPlayer)
						{
							Main.cameraX = Main.cameraX + this.position.X - num4;
						}
						this.pulley = true;
						this.position.X = num4;
						this.gfxOffY = this.position.Y - num3;
						this.stepSpeed = 2.5f;
						this.position.Y = num3;
						this.velocity.X = 0f;
						return;
					}
					num4 = (float)num5;
					this.pulleyDir = 2;
					this.direction = 1;
					if (!Collision.SolidCollision(new Vector2(num4, this.position.Y), this.width, this.height))
					{
						if (this.whoAmI == Main.myPlayer)
						{
							Main.cameraX = Main.cameraX + this.position.X - num4;
						}
						this.pulley = true;
						this.position.X = num4;
						this.gfxOffY = this.position.Y - num3;
						this.stepSpeed = 2.5f;
						this.position.Y = num3;
						this.velocity.X = 0f;
						return;
					}
					num4 = (float)num7;
					this.pulleyDir = 2;
					this.direction = -1;
					if (!Collision.SolidCollision(new Vector2(num4, this.position.Y), this.width, this.height))
					{
						if (this.whoAmI == Main.myPlayer)
						{
							Main.cameraX = Main.cameraX + this.position.X - num4;
						}
						this.pulley = true;
						this.position.X = num4;
						this.gfxOffY = this.position.Y - num3;
						this.stepSpeed = 2.5f;
						this.position.Y = num3;
						this.velocity.X = 0f;
					}
				}
			}
		}

		// Token: 0x060003EB RID: 1003 RVA: 0x0027EE68 File Offset: 0x0027D068
		public void FindSentryRestingSpot(int checkProj, out int worldX, out int worldY, out int pushYUp)
		{
			bool flag = false;
			int num = (int)((float)Main.mouseX + Main.screenPosition.X) / 16;
			int num2 = (int)((float)Main.mouseY + Main.screenPosition.Y) / 16;
			if (this.gravDir == -1f)
			{
				num2 = (int)(Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16;
			}
			worldX = num * 16 + 8;
			pushYUp = 41;
			switch (checkProj)
			{
				case 663:
					worldX += this.direction;
					break;
				case 664:
				case 666:
					break;
				case 665:
					pushYUp += 2;
					break;
				case 667:
					pushYUp += 3;
					break;
				default:
					switch (checkProj)
					{
						case 677:
							worldX += this.direction;
							break;
						case 678:
							worldX += this.direction;
							break;
						case 679:
							break;
						default:
							if (checkProj - 691 <= 2)
							{
								pushYUp = 20;
								worldX += this.direction;
								pushYUp += 2;
							}
							break;
					}
					break;
			}
			if (!flag)
			{
				while (num2 < Main.maxTilesY - 10 && Main.tile[num, num2] != null && !WorldGen.SolidTile2(num, num2) && Main.tile[num - 1, num2] != null && !WorldGen.SolidTile2(num - 1, num2) && Main.tile[num + 1, num2] != null && !WorldGen.SolidTile2(num + 1, num2))
				{
					num2++;
				}
				num2++;
			}
			num2--;
			pushYUp -= 14;
			worldY = num2 * 16;
		}

		// Token: 0x06000404 RID: 1028 RVA: 0x00281C20 File Offset: 0x0027FE20
		public void FindSpawn()
		{
			for (int i = 0; i < 200; i++)
			{
				if (this.spN[i] == null)
				{
					this.SpawnX = -1;
					this.SpawnY = -1;
					return;
				}
				if (this.spN[i] == Main.worldName && this.spI[i] == Main.worldID)
				{
					this.SpawnX = this.spX[i];
					this.SpawnY = this.spY[i];
					return;
				}
			}
		}

		// Token: 0x060003E0 RID: 992 RVA: 0x0026C1A0 File Offset: 0x0026A3A0
		public int FishingLevel()
		{
			int num = 0;
			int fishingPole = this.inventory[this.selectedItem].fishingPole;
			if (fishingPole == 0)
			{
				for (int i = 0; i < 58; i++)
				{
					if (this.inventory[i].fishingPole > fishingPole)
					{
						fishingPole = this.inventory[i].fishingPole;
					}
				}
			}
			int j = 0;
			while (j < 58)
			{
				if (this.inventory[j].stack > 0 && this.inventory[j].bait > 0)
				{
					if (this.inventory[j].type == 2673)
					{
						return -1;
					}
					num = this.inventory[j].bait;
					break;
				}
				else
				{
					j++;
				}
			}
			if (num == 0 || fishingPole == 0)
			{
				return 0;
			}
			int num2 = num + fishingPole + this.fishingSkill;
			if (Main.raining)
			{
				num2 = (int)((float)num2 * 1.2f);
			}
			if (Main.cloudBGAlpha > 0f)
			{
				num2 = (int)((float)num2 * 1.1f);
			}
			if (Main.dayTime && (Main.time < 5400.0 || Main.time > 48600.0))
			{
				num2 = (int)((float)num2 * 1.3f);
			}
			if (Main.dayTime && Main.time > 16200.0 && Main.time < 37800.0)
			{
				num2 = (int)((float)num2 * 0.8f);
			}
			if (!Main.dayTime && Main.time > 6480.0 && Main.time < 25920.0)
			{
				num2 = (int)((float)num2 * 0.8f);
			}
			if (Main.moonPhase == 0)
			{
				num2 = (int)((float)num2 * 1.1f);
			}
			if (Main.moonPhase == 1 || Main.moonPhase == 7)
			{
				num2 = (int)((float)num2 * 1.05f);
			}
			if (Main.moonPhase == 3 || Main.moonPhase == 5)
			{
				num2 = (int)((float)num2 * 0.95f);
			}
			if (Main.moonPhase == 4)
			{
				num2 = (int)((float)num2 * 0.9f);
			}
			return num2;
		}

		// Token: 0x060003A7 RID: 935 RVA: 0x0024DD68 File Offset: 0x0024BF68
		public void FloorVisuals(bool Falling)
		{
			int num = (int)((this.position.X + (float)(this.width / 2)) / 16f);
			int num2 = (int)((this.position.Y + (float)this.height) / 16f);
			if (this.gravDir == -1f)
			{
				num2 = (int)(this.position.Y - 0.1f) / 16;
			}
			int num3 = -1;
			if (Main.tile[num - 1, num2] == null)
			{
				Main.tile[num - 1, num2] = new Tile();
			}
			if (Main.tile[num + 1, num2] == null)
			{
				Main.tile[num + 1, num2] = new Tile();
			}
			if (Main.tile[num, num2] == null)
			{
				Main.tile[num, num2] = new Tile();
			}
			if (Main.tile[num, num2].nactive() && Main.tileSolid[(int)Main.tile[num, num2].type])
			{
				num3 = (int)Main.tile[num, num2].type;
			}
			else if (Main.tile[num - 1, num2].nactive() && Main.tileSolid[(int)Main.tile[num - 1, num2].type])
			{
				num3 = (int)Main.tile[num - 1, num2].type;
			}
			else if (Main.tile[num + 1, num2].nactive() && Main.tileSolid[(int)Main.tile[num + 1, num2].type])
			{
				num3 = (int)Main.tile[num + 1, num2].type;
			}
			if (num3 <= -1)
			{
				this.slippy = false;
				this.slippy2 = false;
				this.sticky = false;
				this.powerrun = false;
				return;
			}
			this.sticky = (num3 == 229);
			this.slippy = (num3 == 161 || num3 == 162 || num3 == 163 || num3 == 164 || num3 == 200 || num3 == 127);
			this.slippy2 = (num3 == 197);
			this.powerrun = (num3 == 198);
			if (Main.tile[num - 1, num2].slope() != 0 || Main.tile[num, num2].slope() != 0 || Main.tile[num + 1, num2].slope() != 0)
			{
				num3 = -1;
			}
			if (!this.wet && !this.mount.Cart)
			{
				this.MakeFloorDust(Falling, num3);
			}
		}

		// Token: 0x060003AB RID: 939 RVA: 0x0024E773 File Offset: 0x0024C973
		public void GamepadEnableGrappleCooldown()
		{
			this._quickGrappleCooldown = 3;
		}

		// Token: 0x06000412 RID: 1042 RVA: 0x00284584 File Offset: 0x00282784
		public void GetAnglerReward()
		{
			Item item = new Item();
			item.type = 0;
			float num = 1f;
			if (this.anglerQuestsFinished <= 50)
			{
				num -= (float)this.anglerQuestsFinished * 0.01f;
			}
			else if (this.anglerQuestsFinished <= 100)
			{
				num = 0.5f - (float)(this.anglerQuestsFinished - 50) * 0.005f;
			}
			else if (this.anglerQuestsFinished <= 150)
			{
				num = 0.25f - (float)(this.anglerQuestsFinished - 100) * 0.002f;
			}
			if (this.anglerQuestsFinished == 5)
			{
				item.SetDefaults(2428, false);
			}
			else if (this.anglerQuestsFinished == 10)
			{
				item.SetDefaults(2367, false);
			}
			else if (this.anglerQuestsFinished == 15)
			{
				item.SetDefaults(2368, false);
			}
			else if (this.anglerQuestsFinished == 20)
			{
				item.SetDefaults(2369, false);
			}
			else if (this.anglerQuestsFinished == 30)
			{
				item.SetDefaults(2294, false);
			}
			else if (this.anglerQuestsFinished > 75 && Main.rand.Next((int)(250f * num)) == 0)
			{
				item.SetDefaults(2294, false);
			}
			else if (Main.hardMode && this.anglerQuestsFinished > 25 && Main.rand.Next((int)(100f * num)) == 0)
			{
				item.SetDefaults(2422, false);
			}
			else if (Main.hardMode && this.anglerQuestsFinished > 10 && Main.rand.Next((int)(70f * num)) == 0)
			{
				item.SetDefaults(2494, false);
			}
			else if (Main.hardMode && this.anglerQuestsFinished > 10 && Main.rand.Next((int)(70f * num)) == 0)
			{
				item.SetDefaults(3031, false);
			}
			else if (Main.hardMode && this.anglerQuestsFinished > 10 && Main.rand.Next((int)(70f * num)) == 0)
			{
				item.SetDefaults(3032, false);
			}
			else if (Main.rand.Next((int)(80f * num)) == 0)
			{
				item.SetDefaults(3183, false);
			}
			else if (Main.rand.Next((int)(60f * num)) == 0)
			{
				item.SetDefaults(2360, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(2373, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(2374, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(2375, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(3120, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(3037, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(3096, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(2417, false);
			}
			else if (Main.rand.Next((int)(40f * num)) == 0)
			{
				item.SetDefaults(2498, false);
			}
			else
			{
				int num2 = Main.rand.Next(70);
				if (num2 == 0)
				{
					item.SetDefaults(2442, false);
				}
				else if (num2 == 1)
				{
					item.SetDefaults(2443, false);
				}
				else if (num2 == 2)
				{
					item.SetDefaults(2444, false);
				}
				else if (num2 == 3)
				{
					item.SetDefaults(2445, false);
				}
				else if (num2 == 4)
				{
					item.SetDefaults(2497, false);
				}
				else if (num2 == 5)
				{
					item.SetDefaults(2495, false);
				}
				else if (num2 == 6)
				{
					item.SetDefaults(2446, false);
				}
				else if (num2 == 7)
				{
					item.SetDefaults(2447, false);
				}
				else if (num2 == 8)
				{
					item.SetDefaults(2448, false);
				}
				else if (num2 == 9)
				{
					item.SetDefaults(2449, false);
				}
				else if (num2 == 10)
				{
					item.SetDefaults(2490, false);
				}
				else if (num2 == 11)
				{
					item.SetDefaults(2435, false);
					item.stack = Main.rand.Next(50, 151);
				}
				else if (num2 == 12)
				{
					item.SetDefaults(2496, false);
				}
				else
				{
					int num3 = Main.rand.Next(3);
					if (num3 == 0)
					{
						item.SetDefaults(2354, false);
						item.stack = Main.rand.Next(2, 6);
					}
					else if (num3 == 1)
					{
						item.SetDefaults(2355, false);
						item.stack = Main.rand.Next(2, 6);
					}
					else
					{
						item.SetDefaults(2356, false);
						item.stack = Main.rand.Next(2, 6);
					}
				}
			}
			item.position = base.Center;
			Item item2 = this.GetItem(this.whoAmI, item, true, false);
			if (item2.stack > 0)
			{
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
				}
			}
			if (item.type == 2417)
			{
				Item item3 = new Item();
				Item item4 = new Item();
				item3.SetDefaults(2418, false);
				item3.position = base.Center;
				item2 = this.GetItem(this.whoAmI, item3, true, false);
				if (item2.stack > 0)
				{
					int number2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number2, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				item4.SetDefaults(2419, false);
				item4.position = base.Center;
				item2 = this.GetItem(this.whoAmI, item4, true, false);
				if (item2.stack > 0)
				{
					int number3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number3, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
			else if (item.type == 2498)
			{
				Item item5 = new Item();
				Item item6 = new Item();
				item5.SetDefaults(2499, false);
				item5.position = base.Center;
				item2 = this.GetItem(this.whoAmI, item5, true, false);
				if (item2.stack > 0)
				{
					int number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				item6.SetDefaults(2500, false);
				item6.position = base.Center;
				item2 = this.GetItem(this.whoAmI, item6, true, false);
				if (item2.stack > 0)
				{
					int number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
			Item item7 = new Item();
			int num4 = (this.anglerQuestsFinished + 50) / 2;
			num4 = (int)((float)(num4 * Main.rand.Next(50, 201)) * 0.015f);
			num4 = (int)((double)num4 * 1.5);
			if (Main.expertMode)
			{
				num4 *= 2;
			}
			if (num4 > 100)
			{
				num4 /= 100;
				if (num4 > 10)
				{
					num4 = 10;
				}
				if (num4 < 1)
				{
					num4 = 1;
				}
				item7.SetDefaults(73, false);
				item7.stack = num4;
			}
			else
			{
				if (num4 > 99)
				{
					num4 = 99;
				}
				if (num4 < 1)
				{
					num4 = 1;
				}
				item7.SetDefaults(72, false);
				item7.stack = num4;
			}
			item7.position = base.Center;
			item2 = this.GetItem(this.whoAmI, item7, true, false);
			if (item2.stack > 0)
			{
				int number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
				}
			}
			if (Main.rand.Next((int)(100f * num)) <= 50)
			{
				Item item8 = new Item();
				if (Main.rand.Next((int)(15f * num)) == 0)
				{
					item8.SetDefaults(2676, false);
				}
				else if (Main.rand.Next((int)(5f * num)) == 0)
				{
					item8.SetDefaults(2675, false);
				}
				else
				{
					item8.SetDefaults(2674, false);
				}
				if (Main.rand.Next(25) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				if (Main.rand.Next(50) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				if (Main.rand.Next(100) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				if (Main.rand.Next(150) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				if (Main.rand.Next(200) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				if (Main.rand.Next(250) <= this.anglerQuestsFinished)
				{
					item8.stack++;
				}
				item8.position = base.Center;
				item2 = this.GetItem(this.whoAmI, item8, true, false);
				if (item2.stack > 0)
				{
					int number7 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number7, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
		}

		// Token: 0x060003FB RID: 1019 RVA: 0x00280CD8 File Offset: 0x0027EED8
		public Color GetDeathAlpha(Color newColor)
		{
			int arg_82_0 = (int)newColor.R + (int)((double)this.immuneAlpha * 0.9);
			int g = (int)newColor.G + (int)((double)this.immuneAlpha * 0.5);
			int b = (int)newColor.B + (int)((double)this.immuneAlpha * 0.5);
			int num = (int)newColor.A + (int)((double)this.immuneAlpha * 0.4);
			if (num < 0)
			{
				num = 0;
			}
			if (num > 255)
			{
				num = 255;
			}
			return new Color(arg_82_0, g, b, num);
		}

		// Token: 0x060003FE RID: 1022 RVA: 0x00280E14 File Offset: 0x0027F014
		public int getDPS()
		{
			TimeSpan timeSpan = this.dpsEnd - this.dpsStart;
			float num = (float)timeSpan.Milliseconds / 1000f;
			num += (float)timeSpan.Seconds;
			num += (float)timeSpan.Minutes / 60f;
			if (num >= 3f)
			{
				this.dpsStart = DateTime.Now;
				this.dpsStart = this.dpsStart.AddSeconds(-1.0);
				this.dpsDamage = (int)((float)this.dpsDamage / num);
				timeSpan = this.dpsEnd - this.dpsStart;
				num = (float)timeSpan.Milliseconds / 1000f;
				num += (float)timeSpan.Seconds;
				num += (float)timeSpan.Minutes / 60f;
			}
			if (num < 1f)
			{
				num = 1f;
			}
			return (int)((float)this.dpsDamage / num);
		}

		// Token: 0x06000413 RID: 1043 RVA: 0x002850D8 File Offset: 0x002832D8
		public void GetDyeTraderReward()
		{
			List<int> list = new List<int>
			{
				3560,
				3028,
				3041,
				3040,
				3025,
				3190,
				3027,
				3026,
				3554,
				3553,
				3555,
				2872,
				3534,
				2871
			};
			if (Main.hardMode)
			{
				list.Add(3039);
				list.Add(3038);
				list.Add(3598);
				list.Add(3597);
				list.Add(3600);
				list.Add(3042);
				list.Add(3533);
				list.Add(3561);
				if (NPC.downedMechBossAny)
				{
					list.Add(2883);
					list.Add(2869);
					list.Add(2873);
					list.Add(2870);
				}
				if (NPC.downedPlantBoss)
				{
					list.Add(2878);
					list.Add(2879);
					list.Add(2884);
					list.Add(2885);
				}
				if (NPC.downedMartians)
				{
					list.Add(2864);
					list.Add(3556);
				}
				if (NPC.downedMoonlord)
				{
					list.Add(3024);
				}
			}
			int type = list[Main.rand.Next(list.Count)];
			Item item = new Item();
			item.SetDefaults(type, false);
			item.stack = 3;
			item.position = base.Center;
			Item item2 = this.GetItem(this.whoAmI, item, true, false);
			if (item2.stack > 0)
			{
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item2.type, item2.stack, false, 0, true, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
				}
			}
		}

		// Token: 0x06000409 RID: 1033 RVA: 0x0028371C File Offset: 0x0028191C
		public static PlayerFileData GetFileData(string file, bool cloudSave)
		{
			if (file == null || (cloudSave && SocialAPI.Cloud == null))
			{
				return null;
			}
			PlayerFileData playerFileData = Player.LoadPlayer(file, cloudSave);
			if (playerFileData.Player != null)
			{
				if (playerFileData.Player.loadStatus != 0 && playerFileData.Player.loadStatus != 1)
				{
					if (FileUtilities.Exists(file + ".bak", cloudSave))
					{
						FileUtilities.Move(file + ".bak", file, cloudSave, true);
					}
					playerFileData = Player.LoadPlayer(file, cloudSave);
					if (playerFileData.Player == null)
					{
						return null;
					}
				}
				return playerFileData;
			}
			return null;
		}

		// Token: 0x0600040A RID: 1034 RVA: 0x002837A0 File Offset: 0x002819A0
		public Color GetHairColor(bool useLighting = true)
		{
			Color color = Lighting.GetColor((int)((double)this.position.X + (double)this.width * 0.5) / 16, (int)(((double)this.position.Y + (double)this.height * 0.25) / 16.0));
			return GameShaders.Hair.GetColor((short)this.hairDye, this, useLighting ? color : Color.White);
		}

		// Token: 0x060003F9 RID: 1017 RVA: 0x00280C50 File Offset: 0x0027EE50
		public Color GetImmuneAlpha(Color newColor, float alphaReduction)
		{
			float num = (float)(255 - this.immuneAlpha) / 255f;
			if (alphaReduction > 0f)
			{
				num *= 1f - alphaReduction;
			}
			if (this.immuneAlpha > 125)
			{
				return Color.Transparent;
			}
			return Color.Multiply(newColor, num);
		}

		// Token: 0x060003FA RID: 1018 RVA: 0x00280C9C File Offset: 0x0027EE9C
		public Color GetImmuneAlphaPure(Color newColor, float alphaReduction)
		{
			float num = (float)(255 - this.immuneAlpha) / 255f;
			if (alphaReduction > 0f)
			{
				num *= 1f - alphaReduction;
			}
			return Color.Multiply(newColor, num);
		}

		// Token: 0x060003D7 RID: 983 RVA: 0x0026651C File Offset: 0x0026471C
		public Item GetItem(int plr, Item newItem, bool longText = false, bool noText = false)
		{
			bool flag = newItem.type >= 71 && newItem.type <= 74;
			Item item = newItem;
			int num = 50;
			if (newItem.noGrabDelay > 0)
			{
				return item;
			}
			int num2 = 0;
			if (newItem.uniqueStack && this.HasItem(newItem.type))
			{
				return item;
			}
			if (newItem.type == 71 || newItem.type == 72 || newItem.type == 73 || newItem.type == 74)
			{
				num2 = -4;
				num = 54;
			}
			if (((item.ammo > 0 || item.bait > 0) && !item.notAmmo) || item.type == 530)
			{
				item = this.FillAmmo(plr, item, noText);
				if (item.type == 0 || item.stack == 0)
				{
					return new Item();
				}
			}
			for (int i = num2; i < 50; i++)
			{
				int num3 = i;
				if (num3 < 0)
				{
					num3 = 54 + i;
				}
				if (this.inventory[num3].type > 0 && this.inventory[num3].stack < this.inventory[num3].maxStack && item.IsTheSameAs(this.inventory[num3]))
				{
					if (flag)
					{
						Main.PlaySound(38, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					}
					else
					{
						Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					}
					if (item.stack + this.inventory[num3].stack <= this.inventory[num3].maxStack)
					{
						this.inventory[num3].stack += item.stack;
						if (!noText)
						{
							ItemText.NewText(newItem, item.stack, false, longText);
						}
						this.DoCoins(num3);
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						AchievementsHelper.NotifyItemPickup(this, item);
						return new Item();
					}
					AchievementsHelper.NotifyItemPickup(this, item, this.inventory[num3].maxStack - this.inventory[num3].stack);
					item.stack -= this.inventory[num3].maxStack - this.inventory[num3].stack;
					if (!noText)
					{
						ItemText.NewText(newItem, this.inventory[num3].maxStack - this.inventory[num3].stack, false, longText);
					}
					this.inventory[num3].stack = this.inventory[num3].maxStack;
					this.DoCoins(num3);
					if (plr == Main.myPlayer)
					{
						Recipe.FindRecipes();
					}
				}
			}
			if (newItem.type != 71 && newItem.type != 72 && newItem.type != 73 && newItem.type != 74 && newItem.useStyle > 0)
			{
				for (int j = 0; j < 10; j++)
				{
					if (this.inventory[j].type == 0)
					{
						this.inventory[j] = item;
						if (!noText)
						{
							ItemText.NewText(newItem, newItem.stack, false, longText);
						}
						this.DoCoins(j);
						if (flag)
						{
							Main.PlaySound(38, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						else
						{
							Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						AchievementsHelper.NotifyItemPickup(this, item);
						return new Item();
					}
				}
			}
			if (newItem.favorited)
			{
				for (int k = 0; k < num; k++)
				{
					if (this.inventory[k].type == 0)
					{
						this.inventory[k] = item;
						if (!noText)
						{
							ItemText.NewText(newItem, newItem.stack, false, longText);
						}
						this.DoCoins(k);
						if (flag)
						{
							Main.PlaySound(38, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						else
						{
							Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						AchievementsHelper.NotifyItemPickup(this, item);
						return new Item();
					}
				}
			}
			else
			{
				for (int l = num - 1; l >= 0; l--)
				{
					if (this.inventory[l].type == 0)
					{
						this.inventory[l] = item;
						if (!noText)
						{
							ItemText.NewText(newItem, newItem.stack, false, longText);
						}
						this.DoCoins(l);
						if (flag)
						{
							Main.PlaySound(38, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						else
						{
							Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						if (plr == Main.myPlayer)
						{
							Recipe.FindRecipes();
						}
						AchievementsHelper.NotifyItemPickup(this, item);
						return new Item();
					}
				}
			}
			return item;
		}

		// Token: 0x060003DC RID: 988 RVA: 0x000089B0 File Offset: 0x00006BB0
		public Rectangle getRect()
		{
			return new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height);
		}

		// Token: 0x060003E6 RID: 998 RVA: 0x0026C4D0 File Offset: 0x0026A6D0
		private int GetRequiredDD2CrystalsToUse(Item item)
		{
			switch (item.type)
			{
				case 3818:
				case 3819:
				case 3820:
					return 10;
				case 3824:
				case 3825:
				case 3826:
					return 10;
				case 3829:
				case 3830:
				case 3831:
					return 10;
				case 3832:
				case 3833:
				case 3834:
					return 10;
			}
			return 0;
		}

		// Token: 0x060003F0 RID: 1008 RVA: 0x0027F9BC File Offset: 0x0027DBBC
		public int GetWeaponDamage(Item sItem)
		{
			int num = sItem.damage;
			if (num > 0)
			{
				if (sItem.melee)
				{
					num = (int)((float)num * this.meleeDamage + 5E-06f);
				}
				else if (sItem.ranged)
				{
					num = (int)((float)num * this.rangedDamage + 5E-06f);
					if (sItem.useAmmo == AmmoID.Arrow || sItem.useAmmo == AmmoID.Stake)
					{
						num = (int)((float)num * this.arrowDamage + 5E-06f);
					}
					if (sItem.useAmmo == AmmoID.Bullet || sItem.useAmmo == AmmoID.CandyCorn)
					{
						num = (int)((float)num * this.bulletDamage + 5E-06f);
					}
					if (sItem.useAmmo == AmmoID.Rocket || sItem.useAmmo == AmmoID.StyngerBolt || sItem.useAmmo == AmmoID.JackOLantern || sItem.useAmmo == AmmoID.NailFriendly)
					{
						num = (int)((float)num * this.rocketDamage + 5E-06f);
					}
				}
				else if (sItem.thrown)
				{
					num = (int)((float)num * this.thrownDamage + 5E-06f);
				}
				else if (sItem.magic)
				{
					num = (int)((float)num * this.magicDamage + 5E-06f);
				}
				else if (sItem.summon)
				{
					num = (int)((float)num * this.minionDamage);
				}
			}
			return num;
		}

		// Token: 0x060003EF RID: 1007 RVA: 0x0027F918 File Offset: 0x0027DB18
		public float GetWeaponKnockback(Item sItem, float KnockBack)
		{
			if (sItem.summon)
			{
				KnockBack += this.minionKB;
			}
			if (sItem.melee && this.kbGlove)
			{
				KnockBack *= 2f;
			}
			if (this.kbBuff)
			{
				KnockBack *= 1.5f;
			}
			if (sItem.ranged && this.shroomiteStealth)
			{
				KnockBack *= 1f + (1f - this.stealth) * 0.5f;
			}
			if (sItem.ranged && this.setVortex)
			{
				KnockBack *= 1f + (1f - this.stealth) * 0.5f;
			}
			return KnockBack;
		}

		// Token: 0x06000362 RID: 866 RVA: 0x00228BBC File Offset: 0x00226DBC
		public void Ghost()
		{
			this.immune = false;
			this.immuneAlpha = 0;
			this.controlUp = false;
			this.controlLeft = false;
			this.controlDown = false;
			this.controlRight = false;
			this.controlJump = false;
			if (Main.hasFocus && !Main.drawingPlayerChat && !Main.editSign && !Main.editChest && !Main.blockInput)
			{
				PlayerInput.Triggers.Current.CopyInto(this);
			}
			if (this.controlUp || this.controlJump)
			{
				if (this.velocity.Y > 0f)
				{
					this.velocity.Y = this.velocity.Y * 0.9f;
				}
				this.velocity.Y = this.velocity.Y - 0.1f;
				if (this.velocity.Y < -3f)
				{
					this.velocity.Y = -3f;
				}
			}
			else if (this.controlDown)
			{
				if (this.velocity.Y < 0f)
				{
					this.velocity.Y = this.velocity.Y * 0.9f;
				}
				this.velocity.Y = this.velocity.Y + 0.1f;
				if (this.velocity.Y > 3f)
				{
					this.velocity.Y = 3f;
				}
			}
			else if ((double)this.velocity.Y < -0.1 || (double)this.velocity.Y > 0.1)
			{
				this.velocity.Y = this.velocity.Y * 0.9f;
			}
			else
			{
				this.velocity.Y = 0f;
			}
			if (this.controlLeft && !this.controlRight)
			{
				if (this.velocity.X > 0f)
				{
					this.velocity.X = this.velocity.X * 0.9f;
				}
				this.velocity.X = this.velocity.X - 0.1f;
				if (this.velocity.X < -3f)
				{
					this.velocity.X = -3f;
				}
			}
			else if (this.controlRight && !this.controlLeft)
			{
				if (this.velocity.X < 0f)
				{
					this.velocity.X = this.velocity.X * 0.9f;
				}
				this.velocity.X = this.velocity.X + 0.1f;
				if (this.velocity.X > 3f)
				{
					this.velocity.X = 3f;
				}
			}
			else if ((double)this.velocity.X < -0.1 || (double)this.velocity.X > 0.1)
			{
				this.velocity.X = this.velocity.X * 0.9f;
			}
			else
			{
				this.velocity.X = 0f;
			}
			this.position += this.velocity;
			this.ghostFrameCounter++;
			if (this.velocity.X < 0f)
			{
				this.direction = -1;
			}
			else if (this.velocity.X > 0f)
			{
				this.direction = 1;
			}
			if (this.ghostFrameCounter >= 8)
			{
				this.ghostFrameCounter = 0;
				this.ghostFrame++;
				if (this.ghostFrame >= 4)
				{
					this.ghostFrame = 0;
				}
			}
			if (this.position.X < Main.leftWorld + (float)(Lighting.offScreenTiles * 16) + 16f)
			{
				this.position.X = Main.leftWorld + (float)(Lighting.offScreenTiles * 16) + 16f;
				this.velocity.X = 0f;
			}
			if (this.position.X + (float)this.width > Main.rightWorld - (float)(Lighting.offScreenTiles * 16) - 32f)
			{
				this.position.X = Main.rightWorld - (float)(Lighting.offScreenTiles * 16) - 32f - (float)this.width;
				this.velocity.X = 0f;
			}
			if (this.position.Y < Main.topWorld + (float)(Lighting.offScreenTiles * 16) + 16f)
			{
				this.position.Y = Main.topWorld + (float)(Lighting.offScreenTiles * 16) + 16f;
				if ((double)this.velocity.Y < -0.1)
				{
					this.velocity.Y = -0.1f;
				}
			}
			if (this.position.Y > Main.bottomWorld - (float)(Lighting.offScreenTiles * 16) - 32f - (float)this.height)
			{
				this.position.Y = Main.bottomWorld - (float)(Lighting.offScreenTiles * 16) - 32f - (float)this.height;
				this.velocity.Y = 0f;
			}
		}

		// Token: 0x060003C1 RID: 961 RVA: 0x0025E4B8 File Offset: 0x0025C6B8
		private void GrabItems(int i)
		{
			for (int j = 0; j < 400; j++)
			{
				if (Main.item[j].active && Main.item[j].noGrabDelay == 0 && Main.item[j].owner == i)
				{
					int num = Player.defaultItemGrabRange;
					if (this.goldRing && Main.item[j].type >= 71 && Main.item[j].type <= 74)
					{
						num += Item.coinGrabRange;
					}
					if (this.manaMagnet && (Main.item[j].type == 184 || Main.item[j].type == 1735 || Main.item[j].type == 1868))
					{
						num += Item.manaGrabRange;
					}
					if (this.lifeMagnet && (Main.item[j].type == 58 || Main.item[j].type == 1734 || Main.item[j].type == 1867))
					{
						num += Item.lifeGrabRange;
					}
					if (Main.item[j].type == 3822)
					{
						num += 50;
					}
					if (ItemID.Sets.NebulaPickup[Main.item[j].type])
					{
						num += 100;
					}
					if (new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height).Intersects(new Rectangle((int)Main.item[j].position.X, (int)Main.item[j].position.Y, Main.item[j].width, Main.item[j].height)))
					{
						if (i == Main.myPlayer && (this.inventory[this.selectedItem].type != 0 || this.itemAnimation <= 0))
						{
							if (ItemID.Sets.NebulaPickup[Main.item[j].type])
							{
								Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
								int num2 = Main.item[j].buffType;
								Main.item[j] = new Item();
								if (Main.netMode == 1)
								{
									NetMessage.SendData(102, -1, -1, null, i, (float)num2, base.Center.X, base.Center.Y, 0, 0, 0);
									NetMessage.SendData(21, -1, -1, null, j, 0f, 0f, 0f, 0, 0, 0);
								}
								else
								{
									this.NebulaLevelup(num2);
								}
							}
							if (Main.item[j].type == 58 || Main.item[j].type == 1734 || Main.item[j].type == 1867)
							{
								Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
								this.statLife += 20;
								if (Main.myPlayer == this.whoAmI)
								{
									this.HealEffect(20, true);
								}
								if (this.statLife > this.statLifeMax2)
								{
									this.statLife = this.statLifeMax2;
								}
								Main.item[j] = new Item();
								if (Main.netMode == 1)
								{
									NetMessage.SendData(21, -1, -1, null, j, 0f, 0f, 0f, 0, 0, 0);
								}
							}
							else if (Main.item[j].type == 184 || Main.item[j].type == 1735 || Main.item[j].type == 1868)
							{
								Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
								this.statMana += 100;
								if (Main.myPlayer == this.whoAmI)
								{
									this.ManaEffect(100);
								}
								if (this.statMana > this.statManaMax2)
								{
									this.statMana = this.statManaMax2;
								}
								Main.item[j] = new Item();
								if (Main.netMode == 1)
								{
									NetMessage.SendData(21, -1, -1, null, j, 0f, 0f, 0f, 0, 0, 0);
								}
							}
							else
							{
								Main.item[j] = this.GetItem(i, Main.item[j], false, false);
								if (Main.netMode == 1)
								{
									NetMessage.SendData(21, -1, -1, null, j, 0f, 0f, 0f, 0, 0, 0);
								}
							}
						}
					}
					else if (new Rectangle((int)this.position.X - num, (int)this.position.Y - num, this.width + num * 2, this.height + num * 2).Intersects(new Rectangle((int)Main.item[j].position.X, (int)Main.item[j].position.Y, Main.item[j].width, Main.item[j].height)) && this.ItemSpace(Main.item[j]))
					{
						Main.item[j].beingGrabbed = true;
						if (this.manaMagnet && (Main.item[j].type == 184 || Main.item[j].type == 1735 || Main.item[j].type == 1868))
						{
							float arg_5F4_0 = 12f;
							Vector2 vector = new Vector2(Main.item[j].position.X + (float)(Main.item[j].width / 2), Main.item[j].position.Y + (float)(Main.item[j].height / 2));
							float num3 = base.Center.X - vector.X;
							float num4 = base.Center.Y - vector.Y;
							float num5 = (float)Math.Sqrt((double)(num3 * num3 + num4 * num4));
							num5 = arg_5F4_0 / num5;
							num3 *= num5;
							num4 *= num5;
							int num6 = 5;
							Main.item[j].velocity.X = (Main.item[j].velocity.X * (float)(num6 - 1) + num3) / (float)num6;
							Main.item[j].velocity.Y = (Main.item[j].velocity.Y * (float)(num6 - 1) + num4) / (float)num6;
						}
						else if (this.lifeMagnet && (Main.item[j].type == 58 || Main.item[j].type == 1734 || Main.item[j].type == 1867))
						{
							float arg_73D_0 = 15f;
							Vector2 vector2 = new Vector2(Main.item[j].position.X + (float)(Main.item[j].width / 2), Main.item[j].position.Y + (float)(Main.item[j].height / 2));
							float num7 = base.Center.X - vector2.X;
							float num8 = base.Center.Y - vector2.Y;
							float num9 = (float)Math.Sqrt((double)(num7 * num7 + num8 * num8));
							num9 = arg_73D_0 / num9;
							num7 *= num9;
							num8 *= num9;
							int num10 = 5;
							Main.item[j].velocity.X = (Main.item[j].velocity.X * (float)(num10 - 1) + num7) / (float)num10;
							Main.item[j].velocity.Y = (Main.item[j].velocity.Y * (float)(num10 - 1) + num8) / (float)num10;
						}
						else if (this.goldRing && Main.item[j].type >= 71 && Main.item[j].type <= 74)
						{
							float arg_873_0 = 12f;
							Vector2 vector3 = new Vector2(Main.item[j].position.X + (float)(Main.item[j].width / 2), Main.item[j].position.Y + (float)(Main.item[j].height / 2));
							float num11 = base.Center.X - vector3.X;
							float num12 = base.Center.Y - vector3.Y;
							float num13 = (float)Math.Sqrt((double)(num11 * num11 + num12 * num12));
							num13 = arg_873_0 / num13;
							num11 *= num13;
							num12 *= num13;
							int num14 = 5;
							Main.item[j].velocity.X = (Main.item[j].velocity.X * (float)(num14 - 1) + num11) / (float)num14;
							Main.item[j].velocity.Y = (Main.item[j].velocity.Y * (float)(num14 - 1) + num12) / (float)num14;
						}
						else if (ItemID.Sets.NebulaPickup[Main.item[j].type])
						{
							float arg_98F_0 = 12f;
							Vector2 vector4 = new Vector2(Main.item[j].position.X + (float)(Main.item[j].width / 2), Main.item[j].position.Y + (float)(Main.item[j].height / 2));
							float num15 = base.Center.X - vector4.X;
							float num16 = base.Center.Y - vector4.Y;
							float num17 = (float)Math.Sqrt((double)(num15 * num15 + num16 * num16));
							num17 = arg_98F_0 / num17;
							num15 *= num17;
							num16 *= num17;
							int num18 = 5;
							Main.item[j].velocity.X = (Main.item[j].velocity.X * (float)(num18 - 1) + num15) / (float)num18;
							Main.item[j].velocity.Y = (Main.item[j].velocity.Y * (float)(num18 - 1) + num16) / (float)num18;
						}
						else
						{
							if ((double)this.position.X + (double)this.width * 0.5 > (double)Main.item[j].position.X + (double)Main.item[j].width * 0.5)
							{
								if (Main.item[j].velocity.X < Player.itemGrabSpeedMax + this.velocity.X)
								{
									Item expr_A85_cp_0_cp_0 = Main.item[j];
									expr_A85_cp_0_cp_0.velocity.X = expr_A85_cp_0_cp_0.velocity.X + Player.itemGrabSpeed;
								}
								if (Main.item[j].velocity.X < 0f)
								{
									Item expr_ABA_cp_0_cp_0 = Main.item[j];
									expr_ABA_cp_0_cp_0.velocity.X = expr_ABA_cp_0_cp_0.velocity.X + Player.itemGrabSpeed * 0.75f;
								}
							}
							else
							{
								if (Main.item[j].velocity.X > -Player.itemGrabSpeedMax + this.velocity.X)
								{
									Item expr_B01_cp_0_cp_0 = Main.item[j];
									expr_B01_cp_0_cp_0.velocity.X = expr_B01_cp_0_cp_0.velocity.X - Player.itemGrabSpeed;
								}
								if (Main.item[j].velocity.X > 0f)
								{
									Item expr_B33_cp_0_cp_0 = Main.item[j];
									expr_B33_cp_0_cp_0.velocity.X = expr_B33_cp_0_cp_0.velocity.X - Player.itemGrabSpeed * 0.75f;
								}
							}
							if ((double)this.position.Y + (double)this.height * 0.5 > (double)Main.item[j].position.Y + (double)Main.item[j].height * 0.5)
							{
								if (Main.item[j].velocity.Y < Player.itemGrabSpeedMax)
								{
									Item expr_BB5_cp_0_cp_0 = Main.item[j];
									expr_BB5_cp_0_cp_0.velocity.Y = expr_BB5_cp_0_cp_0.velocity.Y + Player.itemGrabSpeed;
								}
								if (Main.item[j].velocity.Y < 0f)
								{
									Item expr_BEA_cp_0_cp_0 = Main.item[j];
									expr_BEA_cp_0_cp_0.velocity.Y = expr_BEA_cp_0_cp_0.velocity.Y + Player.itemGrabSpeed * 0.75f;
								}
							}
							else
							{
								if (Main.item[j].velocity.Y > -Player.itemGrabSpeedMax)
								{
									Item expr_C25_cp_0_cp_0 = Main.item[j];
									expr_C25_cp_0_cp_0.velocity.Y = expr_C25_cp_0_cp_0.velocity.Y - Player.itemGrabSpeed;
								}
								if (Main.item[j].velocity.Y > 0f)
								{
									Item expr_C57_cp_0_cp_0 = Main.item[j];
									expr_C57_cp_0_cp_0.velocity.Y = expr_C57_cp_0_cp_0.velocity.Y - Player.itemGrabSpeed * 0.75f;
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x0600039C RID: 924 RVA: 0x0024BDDC File Offset: 0x00249FDC
		public void GrappleMovement()
		{
			if (this.grappling[0] >= 0)
			{
				if (Main.myPlayer == this.whoAmI && this.mount.Active)
				{
					this.mount.Dismount(this);
				}
				this.canCarpet = true;
				this.carpetFrame = -1;
				this.wingFrame = 1;
				if (this.velocity.Y == 0f || (this.wet && (double)this.velocity.Y > -0.02 && (double)this.velocity.Y < 0.02))
				{
					this.wingFrame = 0;
				}
				if (this.wings == 4)
				{
					this.wingFrame = 3;
				}
				if (this.wings == 30)
				{
					this.wingFrame = 0;
				}
				this.wingTime = (float)this.wingTimeMax;
				this.rocketTime = this.rocketTimeMax;
				this.rocketDelay = 0;
				this.rocketFrame = false;
				this.canRocket = false;
				this.rocketRelease = false;
				this.fallStart = (int)(this.position.Y / 16f);
				int num = -1;
				float num2 = 0f;
				float num3 = 0f;
				for (int i = 0; i < this.grapCount; i++)
				{
					Projectile projectile = Main.projectile[this.grappling[i]];
					num2 += projectile.position.X + (float)(projectile.width / 2);
					num3 += projectile.position.Y + (float)(projectile.height / 2);
					if (projectile.type == 403)
					{
						num = i;
					}
					else if (projectile.type == 446)
					{
						Vector2 vector = new Vector2((float)(this.controlRight.ToInt() - this.controlLeft.ToInt()), (float)(this.controlDown.ToInt() - this.controlUp.ToInt()) * this.gravDir);
						if (vector != Vector2.Zero)
						{
							vector.Normalize();
						}
						vector *= 100f;
						Vector2 vector2 = Vector2.Normalize(base.Center - projectile.Center + vector);
						if (float.IsNaN(vector2.X) || float.IsNaN(vector2.Y))
						{
							vector2 = -Vector2.UnitY;
						}
						float num4 = 200f;
						num2 += vector2.X * num4;
						num3 += vector2.Y * num4;
					}
					else if (projectile.type == 652)
					{
						Vector2 vector3 = new Vector2((float)(this.controlRight.ToInt() - this.controlLeft.ToInt()), (float)(this.controlDown.ToInt() - this.controlUp.ToInt()) * this.gravDir);
						if (vector3 != Vector2.Zero)
						{
							vector3.Normalize();
						}
						Vector2 vector4 = projectile.Center - base.Center;
						Vector2 vector5 = vector4;
						if (vector5 != Vector2.Zero)
						{
							vector5.Normalize();
						}
						Vector2 vector6 = Vector2.Zero;
						if (vector3 != Vector2.Zero)
						{
							vector6 = vector5 * Vector2.Dot(vector5, vector3);
						}
						float num5 = 6f;
						if (Vector2.Dot(vector6, vector4) < 0f && vector4.Length() >= 600f)
						{
							num5 = 0f;
						}
						num2 += -vector4.X + vector6.X * num5;
						num3 += -vector4.Y + vector6.Y * num5;
					}
				}
				num2 /= (float)this.grapCount;
				num3 /= (float)this.grapCount;
				Vector2 vector7 = new Vector2(this.position.X + (float)this.width * 0.5f, this.position.Y + (float)this.height * 0.5f);
				float num6 = num2 - vector7.X;
				float num7 = num3 - vector7.Y;
				float num8 = (float)Math.Sqrt((double)(num6 * num6 + num7 * num7));
				float num9 = 11f;
				if (Main.projectile[this.grappling[0]].type == 315)
				{
					num9 = 16f;
				}
				if (Main.projectile[this.grappling[0]].type >= 646 && Main.projectile[this.grappling[0]].type <= 649)
				{
					num9 = 13f;
				}
				float num10;
				if (num8 > num9)
				{
					num10 = num9 / num8;
				}
				else
				{
					num10 = 1f;
				}
				num6 *= num10;
				num7 *= num10;
				if (num7 > 0f)
				{
					this.GoingDownWithGrapple = true;
				}
				this.velocity.X = num6;
				this.velocity.Y = num7;
				if (num != -1)
				{
					Projectile projectile2 = Main.projectile[this.grappling[num]];
					if (projectile2.position.X < this.position.X + (float)this.width && projectile2.position.X + (float)projectile2.width >= this.position.X && projectile2.position.Y < this.position.Y + (float)this.height && projectile2.position.Y + (float)projectile2.height >= this.position.Y)
					{
						int num11 = (int)(projectile2.position.X + (float)(projectile2.width / 2)) / 16;
						int num12 = (int)(projectile2.position.Y + (float)(projectile2.height / 2)) / 16;
						this.velocity = Vector2.Zero;
						if (Main.tile[num11, num12].type == 314)
						{
							Vector2 position;
							position.X = projectile2.position.X + (float)(projectile2.width / 2) - (float)(this.width / 2);
							position.Y = projectile2.position.Y + (float)(projectile2.height / 2) - (float)(this.height / 2);
							this.grappling[0] = -1;
							this.grapCount = 0;
							for (int j = 0; j < 1000; j++)
							{
								if (Main.projectile[j].active && Main.projectile[j].owner == this.whoAmI && Main.projectile[j].aiStyle == 7)
								{
									Main.projectile[j].Kill();
								}
							}
							int num13 = 13;
							if (this.miscEquips[2].stack > 0 && this.miscEquips[2].mountType >= 0 && MountID.Sets.Cart[this.miscEquips[2].mountType] && (!this.miscEquips[2].expertOnly || Main.expertMode))
							{
								num13 = this.miscEquips[2].mountType;
							}
							int num14 = this.height + Mount.GetHeightBoost(num13);
							if (Minecart.GetOnTrack(num11, num12, ref position, this.width, num14) && !Collision.SolidCollision(position, this.width, num14 - 20))
							{
								this.position = position;
								DelegateMethods.Minecart.rotation = this.fullRotation;
								DelegateMethods.Minecart.rotationOrigin = this.fullRotationOrigin;
								this.mount.SetMount(num13, this, this.minecartLeft);
								Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 25);
							}
						}
					}
				}
				if (this.itemAnimation == 0)
				{
					if (this.velocity.X > 0f)
					{
						this.ChangeDir(1);
					}
					if (this.velocity.X < 0f)
					{
						this.ChangeDir(-1);
					}
				}
				if (this.controlJump)
				{
					if (this.releaseJump)
					{
						if ((this.velocity.Y == 0f || (this.wet && (double)this.velocity.Y > -0.02 && (double)this.velocity.Y < 0.02)) && !this.controlDown)
						{
							this.velocity.Y = -Player.jumpSpeed;
							this.jump = Player.jumpHeight / 2;
							this.releaseJump = false;
						}
						else
						{
							this.velocity.Y = this.velocity.Y + 0.01f;
							this.releaseJump = false;
						}
						if (this.doubleJumpCloud)
						{
							this.jumpAgainCloud = true;
						}
						if (this.doubleJumpSandstorm)
						{
							this.jumpAgainSandstorm = true;
						}
						if (this.doubleJumpBlizzard)
						{
							this.jumpAgainBlizzard = true;
						}
						if (this.doubleJumpFart)
						{
							this.jumpAgainFart = true;
						}
						if (this.doubleJumpSail)
						{
							this.jumpAgainSail = true;
						}
						if (this.doubleJumpUnicorn)
						{
							this.jumpAgainUnicorn = true;
						}
						this.grappling[0] = 0;
						this.grapCount = 0;
						for (int k = 0; k < 1000; k++)
						{
							if (Main.projectile[k].active && Main.projectile[k].owner == this.whoAmI && Main.projectile[k].aiStyle == 7)
							{
								Main.projectile[k].Kill();
							}
						}
						return;
					}
				}
				else
				{
					this.releaseJump = true;
				}
			}
		}

		// Token: 0x060003B3 RID: 947 RVA: 0x00259AB0 File Offset: 0x00257CB0
		private void HandleHotbar()
		{
			int num = PlayerInput.Triggers.Current.HotbarPlus.ToInt() - PlayerInput.Triggers.Current.HotbarMinus.ToInt();
			if (PlayerInput.CurrentProfile.HotbarAllowsRadial && num != 0 && PlayerInput.Triggers.Current.HotbarHoldTime > PlayerInput.CurrentProfile.HotbarRadialHoldTimeRequired && PlayerInput.CurrentProfile.HotbarRadialHoldTimeRequired != -1)
			{
				PlayerInput.MiscSettingsTEMP.HotbarRadialShouldBeUsed = true;
				PlayerInput.Triggers.Current.HotbarScrollCD = 2;
			}
			if (PlayerInput.CurrentProfile.HotbarRadialHoldTimeRequired != -1)
			{
				num = PlayerInput.Triggers.JustReleased.HotbarPlus.ToInt() - PlayerInput.Triggers.JustReleased.HotbarMinus.ToInt();
				if (PlayerInput.Triggers.Current.HotbarScrollCD == 1 && num != 0)
				{
					num = 0;
				}
			}
			if (PlayerInput.Triggers.Current.HotbarScrollCD == 0 && num != 0)
			{
				this.HotbarOffset += num;
				PlayerInput.Triggers.Current.HotbarScrollCD = 8;
			}
			if (!Main.inFancyUI && !Main.ingameOptionsWindow)
			{
				this.HotbarOffset += PlayerInput.ScrollWheelDelta / -120;
			}
			this.ScrollHotbar(this.HotbarOffset);
			this.HotbarOffset = 0;
		}

		// Token: 0x060003F2 RID: 1010 RVA: 0x0027FBC4 File Offset: 0x0027DDC4
		public bool HasAmmo(Item sItem, bool canUse)
		{
			if (sItem.useAmmo > 0)
			{
				canUse = false;
				for (int i = 0; i < 58; i++)
				{
					if (this.inventory[i].ammo == sItem.useAmmo && this.inventory[i].stack > 0)
					{
						canUse = true;
						break;
					}
				}
			}
			return canUse;
		}

		// Token: 0x0600040B RID: 1035 RVA: 0x0028381C File Offset: 0x00281A1C
		public bool HasItem(int type)
		{
			for (int i = 0; i < 58; i++)
			{
				if (type == this.inventory[i].type && this.inventory[i].stack > 0)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x060003E1 RID: 993 RVA: 0x0026C370 File Offset: 0x0026A570
		public bool HasUnityPotion()
		{
			for (int i = 0; i < 58; i++)
			{
				if (this.inventory[i].type == 2997 && this.inventory[i].stack > 0)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x0600034D RID: 845 RVA: 0x002261E4 File Offset: 0x002243E4
		public void HealEffect(int healAmount, bool broadcast = true)
		{
			CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.HealLife, healAmount, false, false);
			if (broadcast && Main.netMode == 1 && this.whoAmI == Main.myPlayer)
			{
				NetMessage.SendData(35, -1, -1, null, this.whoAmI, (float)healAmount, 0f, 0f, 0, 0, 0);
			}
		}

		// Token: 0x060003A3 RID: 931 RVA: 0x0024D65C File Offset: 0x0024B85C
		public void HoneyCollision(bool fallThrough, bool ignorePlats)
		{
			int height;
			if (this.onTrack)
			{
				height = this.height - 20;
			}
			else
			{
				height = this.height;
			}
			Vector2 velocity = this.velocity;
			this.velocity = Collision.TileCollision(this.position, this.velocity, this.width, height, fallThrough, ignorePlats, (int)this.gravDir);
			Vector2 value = this.velocity * 0.25f;
			if (this.velocity.X != velocity.X)
			{
				value.X = this.velocity.X;
			}
			if (this.velocity.Y != velocity.Y)
			{
				value.Y = this.velocity.Y;
			}
			this.position += value;
		}

		// Token: 0x0600038F RID: 911 RVA: 0x002455C8 File Offset: 0x002437C8
		public void HorizontalMovement()
		{
			if (this.chilled)
			{
				this.accRunSpeed = this.maxRunSpeed;
			}
			bool flag = (this.itemAnimation == 0 || this.inventory[this.selectedItem].useTurn) && this.mount.AllowDirectionChange;
			bool flag2 = this.controlLeft || this.controlRight;
			float num = (this.accRunSpeed + this.maxRunSpeed) / 2f;
			float num2 = 0f;
			bool flag3 = false;
			if (this.windPushed && !((this.mount.Active && this.velocity.Y == 0f) & flag2))
			{
				num2 = (float)Math.Sign(Main.windSpeed) * 0.07f;
				if (Math.Abs(Main.windSpeed) > 0.5f)
				{
					num2 *= 1.37f;
				}
				if (this.velocity.Y != 0f)
				{
					num2 *= 1.5f;
				}
				if (flag2)
				{
					num2 *= 0.8f;
				}
				flag3 = true;
				if (Math.Sign(this.direction) != Math.Sign(num2))
				{
					num -= Math.Abs(num2) * 40f;
				}
			}
			if (this.trackBoost != 0f)
			{
				this.velocity.X = this.velocity.X + this.trackBoost;
				this.trackBoost = 0f;
				if (this.velocity.X < 0f)
				{
					if (this.velocity.X < -this.maxRunSpeed)
					{
						this.velocity.X = -this.maxRunSpeed;
					}
				}
				else if (this.velocity.X > this.maxRunSpeed)
				{
					this.velocity.X = this.maxRunSpeed;
				}
			}
			if (this.controlLeft && this.velocity.X > -this.maxRunSpeed)
			{
				if (!this.mount.Active || !this.mount.Cart || this.velocity.Y == 0f)
				{
					if (this.velocity.X > this.runSlowdown)
					{
						this.velocity.X = this.velocity.X - this.runSlowdown;
					}
					this.velocity.X = this.velocity.X - this.runAcceleration;
				}
				if (this.onWrongGround)
				{
					if (this.velocity.X < -this.runSlowdown)
					{
						this.velocity.X = this.velocity.X + this.runSlowdown;
					}
					else
					{
						this.velocity.X = 0f;
					}
				}
				if (this.mount.Active && this.mount.Cart && !this.onWrongGround)
				{
					if (this.velocity.X < 0f & flag)
					{
						this.direction = -1;
					}
					else if (this.itemAnimation <= 0 && this.velocity.Y == 0f)
					{
						Main.PlaySound(SoundID.Item55, (int)this.position.X + this.width / 2, (int)this.position.Y + this.height / 2);
						DelegateMethods.Minecart.rotation = this.fullRotation;
						DelegateMethods.Minecart.rotationOrigin = this.fullRotationOrigin;
						if ((double)Math.Abs(this.velocity.X) > (double)this.maxRunSpeed * 0.66)
						{
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.66f, this.width, this.height, 1);
							}
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.33f, this.width, this.height, 1);
							}
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
							}
						}
						else if ((double)Math.Abs(this.velocity.X) > (double)this.maxRunSpeed * 0.33)
						{
							if (Main.rand.Next(3) != 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.5f, this.width, this.height, 1);
							}
							if (Main.rand.Next(3) != 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
							}
						}
						else
						{
							Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
						}
					}
				}
				else if (!this.sandStorm && (this.itemAnimation == 0 || this.inventory[this.selectedItem].useTurn) && this.mount.AllowDirectionChange)
				{
					this.direction = -1;
				}
			}
			else if (this.controlRight && this.velocity.X < this.maxRunSpeed)
			{
				if (!this.mount.Active || !this.mount.Cart || this.velocity.Y == 0f)
				{
					if (this.velocity.X < -this.runSlowdown)
					{
						this.velocity.X = this.velocity.X + this.runSlowdown;
					}
					this.velocity.X = this.velocity.X + this.runAcceleration;
				}
				if (this.onWrongGround)
				{
					if (this.velocity.X > this.runSlowdown)
					{
						this.velocity.X = this.velocity.X - this.runSlowdown;
					}
					else
					{
						this.velocity.X = 0f;
					}
				}
				if (this.mount.Active && this.mount.Cart && !this.onWrongGround)
				{
					if (this.velocity.X > 0f & flag)
					{
						this.direction = 1;
					}
					else if (this.itemAnimation <= 0 && this.velocity.Y == 0f)
					{
						Main.PlaySound(SoundID.Item55, (int)this.position.X + this.width / 2, (int)this.position.Y + this.height / 2);
						DelegateMethods.Minecart.rotation = this.fullRotation;
						DelegateMethods.Minecart.rotationOrigin = this.fullRotationOrigin;
						if ((double)Math.Abs(this.velocity.X) > (double)this.maxRunSpeed * 0.66)
						{
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.66f, this.width, this.height, 1);
							}
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.33f, this.width, this.height, 1);
							}
							if (Main.rand.Next(2) == 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
							}
						}
						else if ((double)Math.Abs(this.velocity.X) > (double)this.maxRunSpeed * 0.33)
						{
							if (Main.rand.Next(3) != 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position + this.velocity * 0.5f, this.width, this.height, 1);
							}
							if (Main.rand.Next(3) != 0)
							{
								Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
							}
						}
						else
						{
							Minecart.WheelSparks(this.mount.MinecartDust, this.position, this.width, this.height, 1);
						}
					}
				}
				else if (!this.sandStorm && (this.itemAnimation == 0 || this.inventory[this.selectedItem].useTurn) && this.mount.AllowDirectionChange)
				{
					this.direction = 1;
				}
			}
			else if (this.controlLeft && this.velocity.X > -this.accRunSpeed && this.dashDelay >= 0)
			{
				if (this.mount.Active && this.mount.Cart)
				{
					if (this.velocity.X < 0f)
					{
						this.direction = -1;
					}
				}
				else if ((this.itemAnimation == 0 || this.inventory[this.selectedItem].useTurn) && this.mount.AllowDirectionChange)
				{
					this.direction = -1;
				}
				if (this.velocity.Y == 0f || this.wingsLogic > 0 || this.mount.CanFly)
				{
					if (this.velocity.X > this.runSlowdown)
					{
						this.velocity.X = this.velocity.X - this.runSlowdown;
					}
					this.velocity.X = this.velocity.X - this.runAcceleration * 0.2f;
					if (this.wingsLogic > 0)
					{
						this.velocity.X = this.velocity.X - this.runAcceleration * 0.2f;
					}
				}
				if (this.onWrongGround)
				{
					if (this.velocity.X < this.runSlowdown)
					{
						this.velocity.X = this.velocity.X + this.runSlowdown;
					}
					else
					{
						this.velocity.X = 0f;
					}
				}
				if (this.velocity.X < -num && this.velocity.Y == 0f && !this.mount.Active)
				{
					int num3 = 0;
					if (this.gravDir == -1f)
					{
						num3 -= this.height;
					}
					if (this.runSoundDelay == 0 && this.velocity.Y == 0f)
					{
						Main.PlaySound(this.hermesStepSound.SoundType, (int)this.position.X, (int)this.position.Y, this.hermesStepSound.SoundStyle, 1f, 0f);
						this.runSoundDelay = this.hermesStepSound.IntendedCooldown;
					}
					if (this.wings == 3)
					{
						int num4 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num3), this.width + 8, 4, 186, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num4].velocity *= 0.025f;
						Main.dust[num4].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						num4 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num3), this.width + 8, 4, 186, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num4].velocity *= 0.2f;
						Main.dust[num4].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
					}
					else if (this.sailDash)
					{
						for (int i = 0; i < 4; i++)
						{
							int num5 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y), this.width + 8, this.height, 253, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
							Main.dust[num5].noGravity = true;
							Main.dust[num5].velocity.X = Main.dust[num5].velocity.X * 0.2f;
							Main.dust[num5].velocity.Y = Main.dust[num5].velocity.Y * 0.2f;
							Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
							Main.dust[num5].scale += (float)Main.rand.Next(-5, 3) * 0.1f;
							Vector2 value = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
							value.Normalize();
							value *= (float)Main.rand.Next(81) * 0.1f;
						}
					}
					else if (this.coldDash)
					{
						for (int j = 0; j < 2; j++)
						{
							int num6;
							if (j == 0)
							{
								num6 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
							}
							else
							{
								num6 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2), this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
							}
							Main.dust[num6].scale *= 1f + (float)Main.rand.Next(20, 40) * 0.01f;
							Main.dust[num6].noGravity = true;
							Main.dust[num6].noLight = true;
							Main.dust[num6].velocity *= 0.001f;
							Dust expr_EFC_cp_0_cp_0 = Main.dust[num6];
							expr_EFC_cp_0_cp_0.velocity.Y = expr_EFC_cp_0_cp_0.velocity.Y - 0.003f;
							Main.dust[num6].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
						}
					}
					else
					{
						int num7 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num3), this.width + 8, 4, 16, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num7].velocity.X = Main.dust[num7].velocity.X * 0.2f;
						Main.dust[num7].velocity.Y = Main.dust[num7].velocity.Y * 0.2f;
						Main.dust[num7].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
					}
				}
			}
			else if (this.controlRight && this.velocity.X < this.accRunSpeed && this.dashDelay >= 0)
			{
				if (this.mount.Active && this.mount.Cart)
				{
					if (this.velocity.X > 0f)
					{
						this.direction = -1;
					}
				}
				else if ((this.itemAnimation == 0 || this.inventory[this.selectedItem].useTurn) && this.mount.AllowDirectionChange)
				{
					this.direction = 1;
				}
				if (this.velocity.Y == 0f || this.wingsLogic > 0 || this.mount.CanFly)
				{
					if (this.velocity.X < -this.runSlowdown)
					{
						this.velocity.X = this.velocity.X + this.runSlowdown;
					}
					this.velocity.X = this.velocity.X + this.runAcceleration * 0.2f;
					if (this.wingsLogic > 0)
					{
						this.velocity.X = this.velocity.X + this.runAcceleration * 0.2f;
					}
				}
				if (this.onWrongGround)
				{
					if (this.velocity.X > this.runSlowdown)
					{
						this.velocity.X = this.velocity.X - this.runSlowdown;
					}
					else
					{
						this.velocity.X = 0f;
					}
				}
				if (this.velocity.X > num && this.velocity.Y == 0f && !this.mount.Active)
				{
					int num8 = 0;
					if (this.gravDir == -1f)
					{
						num8 -= this.height;
					}
					if (this.runSoundDelay == 0 && this.velocity.Y == 0f)
					{
						Main.PlaySound(this.hermesStepSound.SoundType, (int)this.position.X, (int)this.position.Y, this.hermesStepSound.SoundStyle, 1f, 0f);
						this.runSoundDelay = this.hermesStepSound.IntendedCooldown;
					}
					if (this.wings == 3)
					{
						int num9 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num8), this.width + 8, 4, 186, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num9].velocity *= 0.025f;
						Main.dust[num9].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						num9 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num8), this.width + 8, 4, 186, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num9].velocity *= 0.2f;
						Main.dust[num9].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
					}
					else if (this.sailDash)
					{
						for (int k = 0; k < 4; k++)
						{
							int num10 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y), this.width + 8, this.height, 253, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
							Main.dust[num10].noGravity = true;
							Main.dust[num10].velocity.X = Main.dust[num10].velocity.X * 0.2f;
							Main.dust[num10].velocity.Y = Main.dust[num10].velocity.Y * 0.2f;
							Main.dust[num10].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
							Main.dust[num10].scale += (float)Main.rand.Next(-5, 3) * 0.1f;
							Vector2 value2 = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
							value2.Normalize();
							value2 *= (float)Main.rand.Next(81) * 0.1f;
						}
					}
					else if (this.coldDash)
					{
						for (int l = 0; l < 2; l++)
						{
							int num11;
							if (l == 0)
							{
								num11 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
							}
							else
							{
								num11 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2), this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
							}
							Main.dust[num11].scale *= 1f + (float)Main.rand.Next(20, 40) * 0.01f;
							Main.dust[num11].noGravity = true;
							Main.dust[num11].noLight = true;
							Main.dust[num11].velocity *= 0.001f;
							Dust expr_167F_cp_0_cp_0 = Main.dust[num11];
							expr_167F_cp_0_cp_0.velocity.Y = expr_167F_cp_0_cp_0.velocity.Y - 0.003f;
							Main.dust[num11].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
						}
					}
					else
					{
						int num12 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)this.height + (float)num8), this.width + 8, 4, 16, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 50, default(Color), 1.5f);
						Main.dust[num12].velocity.X = Main.dust[num12].velocity.X * 0.2f;
						Main.dust[num12].velocity.Y = Main.dust[num12].velocity.Y * 0.2f;
						Main.dust[num12].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
					}
				}
			}
			else if (this.mount.Active && this.mount.Cart && Math.Abs(this.velocity.X) >= 1f)
			{
				if (this.onWrongGround)
				{
					if (this.velocity.X > 0f)
					{
						if (this.velocity.X > this.runSlowdown)
						{
							this.velocity.X = this.velocity.X - this.runSlowdown;
						}
						else
						{
							this.velocity.X = 0f;
						}
					}
					else if (this.velocity.X < 0f)
					{
						if (this.velocity.X < -this.runSlowdown)
						{
							this.velocity.X = this.velocity.X + this.runSlowdown;
						}
						else
						{
							this.velocity.X = 0f;
						}
					}
				}
				if (this.velocity.X > this.maxRunSpeed)
				{
					this.velocity.X = this.maxRunSpeed;
				}
				if (this.velocity.X < -this.maxRunSpeed)
				{
					this.velocity.X = -this.maxRunSpeed;
				}
			}
			else if (this.velocity.Y == 0f)
			{
				if (this.velocity.X > this.runSlowdown)
				{
					this.velocity.X = this.velocity.X - this.runSlowdown;
				}
				else if (this.velocity.X < -this.runSlowdown)
				{
					this.velocity.X = this.velocity.X + this.runSlowdown;
				}
				else
				{
					this.velocity.X = 0f;
				}
			}
			else if (!this.PortalPhysicsEnabled)
			{
				if ((double)this.velocity.X > (double)this.runSlowdown * 0.5)
				{
					this.velocity.X = this.velocity.X - this.runSlowdown * 0.5f;
				}
				else if ((double)this.velocity.X < (double)(-(double)this.runSlowdown) * 0.5)
				{
					this.velocity.X = this.velocity.X + this.runSlowdown * 0.5f;
				}
				else
				{
					this.velocity.X = 0f;
				}
			}
			if (flag3)
			{
				if (num2 < 0f && this.velocity.X > num2)
				{
					this.velocity.X = this.velocity.X + num2;
					if (this.velocity.X < num2)
					{
						this.velocity.X = num2;
					}
				}
				if (num2 > 0f && this.velocity.X < num2)
				{
					this.velocity.X = this.velocity.X + num2;
					if (this.velocity.X > num2)
					{
						this.velocity.X = num2;
					}
				}
			}
			if (this.mount.Active && this.mount.Type == 10 && Math.Abs(this.velocity.X) > this.mount.DashSpeed - this.mount.RunSpeed / 2f)
			{
				Rectangle rect = this.getRect();
				if (this.direction == 1)
				{
					rect.Offset(this.width - 1, 0);
				}
				rect.Width = 2;
				rect.Inflate(6, 12);
				float damage = 80f * this.minionDamage;
				float knockback = 10f;
				int nPCImmuneTime = 30;
				int playerImmuneTime = 6;
				this.CollideWithNPCs(rect, damage, knockback, nPCImmuneTime, playerImmuneTime);
			}
			if (this.mount.Active && this.mount.Type == 14 && Math.Abs(this.velocity.X) > this.mount.RunSpeed / 2f)
			{
				Rectangle rect2 = this.getRect();
				if (this.direction == 1)
				{
					rect2.Offset(this.width - 1, 0);
				}
				rect2.Width = 2;
				rect2.Inflate(6, 12);
				float damage2 = 90f * this.minionDamage;
				float knockback2 = 10f;
				int nPCImmuneTime2 = 30;
				int playerImmuneTime2 = 6;
				this.CollideWithNPCs(rect2, damage2, knockback2, nPCImmuneTime2, playerImmuneTime2);
			}
		}

		// Token: 0x060003CF RID: 975 RVA: 0x00264798 File Offset: 0x00262998
		public double Hurt(PlayerDeathReason damageSource, int Damage, int hitDirection, bool pvp = false, bool quiet = false, bool Crit = false, int cooldownCounter = -1)
		{
			bool flag = !this.immune;
			bool flag2 = false;
			int hitContext = cooldownCounter;
			if (cooldownCounter == 0)
			{
				flag = (this.hurtCooldowns[cooldownCounter] <= 0);
			}
			if (cooldownCounter == 1)
			{
				flag = (this.hurtCooldowns[cooldownCounter] <= 0);
			}
			if (cooldownCounter == 2)
			{
				flag2 = true;
				cooldownCounter = -1;
			}
			if (!flag)
			{
				return 0.0;
			}
			if (this.whoAmI == Main.myPlayer && this.blackBelt && Main.rand.Next(10) == 0)
			{
				this.NinjaDodge();
				return 0.0;
			}
			if (this.whoAmI == Main.myPlayer && this.shadowDodge)
			{
				this.ShadowDodge();
				return 0.0;
			}
			if (this.whoAmI == Main.myPlayer && this.panic)
			{
				this.AddBuff(63, 300, true);
			}
			if (this.whoAmI == Main.myPlayer && this.setSquireT2)
			{
				this.AddBuff(205, 300, true);
			}
			this.stealth = 1f;
			if (Main.netMode == 1)
			{
				NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
			}
			int num = Damage;
			double num2 = Main.CalculatePlayerDamage(num, this.statDefense);
			if (Crit)
			{
				num *= 2;
			}
			if (num2 >= 1.0)
			{
				if (this.invis)
				{
					for (int i = 0; i < 22; i++)
					{
						if (this.buffType[i] == 10)
						{
							this.DelBuff(i);
						}
					}
				}
				num2 = (double)((int)((double)(1f - this.endurance) * num2));
				if (num2 < 1.0)
				{
					num2 = 1.0;
				}
				if (this.ConsumeSolarFlare())
				{
					float num3 = 0.3f;
					num2 = (double)((int)((double)(1f - num3) * num2));
					if (num2 < 1.0)
					{
						num2 = 1.0;
					}
					if (this.whoAmI == Main.myPlayer)
					{
						int num4 = Projectile.NewProjectile(base.Center.X, base.Center.Y, 0f, 0f, 608, 150, 15f, Main.myPlayer, 0f, 0f);
						Main.projectile[num4].Kill();
					}
				}
				if (this.beetleDefense && this.beetleOrbs > 0)
				{
					float num5 = 0.15f * (float)this.beetleOrbs;
					num2 = (double)((int)((double)(1f - num5) * num2));
					this.beetleOrbs--;
					for (int j = 0; j < 22; j++)
					{
						if (this.buffType[j] >= 95 && this.buffType[j] <= 97)
						{
							this.DelBuff(j);
						}
					}
					if (this.beetleOrbs > 0)
					{
						this.AddBuff(95 + this.beetleOrbs - 1, 5, false);
					}
					this.beetleCounter = 0f;
					if (num2 < 1.0)
					{
						num2 = 1.0;
					}
				}
				if (this.magicCuffs)
				{
					int num6 = num;
					this.statMana += num6;
					if (this.statMana > this.statManaMax2)
					{
						this.statMana = this.statManaMax2;
					}
					this.ManaEffect(num6);
				}
				if (this.defendedByPaladin)
				{
					if (this.whoAmI != Main.myPlayer)
					{
						if (Main.player[Main.myPlayer].hasPaladinShield)
						{
							Player player = Main.player[Main.myPlayer];
							if (player.team == this.team && this.team != 0)
							{
								float num7 = player.Distance(base.Center);
								bool flag3 = num7 < 800f;
								if (flag3)
								{
									for (int k = 0; k < 255; k++)
									{
										if (k != Main.myPlayer && Main.player[k].active && !Main.player[k].dead && !Main.player[k].immune && Main.player[k].hasPaladinShield && Main.player[k].team == this.team && (float)Main.player[k].statLife > (float)Main.player[k].statLifeMax2 * 0.25f)
										{
											float num8 = Main.player[k].Distance(base.Center);
											if (num7 > num8 || (num7 == num8 && k < Main.myPlayer))
											{
												flag3 = false;
												break;
											}
										}
									}
								}
								if (flag3)
								{
									int damage = (int)(num2 * 0.25);
									num2 = (double)((int)(num2 * 0.75));
									player.Hurt(PlayerDeathReason.LegacyEmpty(), damage, 0, false, false, false, -1);
								}
							}
						}
					}
					else
					{
						bool flag4 = false;
						for (int l = 0; l < 255; l++)
						{
							if (l != Main.myPlayer && Main.player[l].active && !Main.player[l].dead && !Main.player[l].immune && Main.player[l].hasPaladinShield && Main.player[l].team == this.team && (float)Main.player[l].statLife > (float)Main.player[l].statLifeMax2 * 0.25f)
							{
								flag4 = true;
								break;
							}
						}
						if (flag4)
						{
							num2 = (double)((int)(num2 * 0.75));
						}
					}
				}
				if (this.brainOfConfusion && Main.myPlayer == this.whoAmI)
				{
					for (int m = 0; m < 200; m++)
					{
						if (Main.npc[m].active && !Main.npc[m].friendly)
						{
							int num9 = 300;
							num9 += (int)num2 * 2;
							if (Main.rand.Next(500) < num9)
							{
								float arg_67A_0 = (Main.npc[m].Center - base.Center).Length();
								float num10 = (float)Main.rand.Next(200 + (int)num2 / 2, 301 + (int)num2 * 2);
								if (num10 > 500f)
								{
									num10 = 500f + (num10 - 500f) * 0.75f;
								}
								if (num10 > 700f)
								{
									num10 = 700f + (num10 - 700f) * 0.5f;
								}
								if (num10 > 900f)
								{
									num10 = 900f + (num10 - 900f) * 0.25f;
								}
								if (arg_67A_0 < num10)
								{
									float num11 = (float)Main.rand.Next(90 + (int)num2 / 3, 300 + (int)num2 / 2);
									Main.npc[m].AddBuff(31, (int)num11, false);
								}
							}
						}
					}
					Projectile.NewProjectile(base.Center.X + (float)Main.rand.Next(-40, 40), base.Center.Y - (float)Main.rand.Next(20, 60), this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 565, 0, 0f, this.whoAmI, 0f, 0f);
				}
				if (Main.netMode == 1 && this.whoAmI == Main.myPlayer && !quiet)
				{
					NetMessage.SendData(13, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					NetMessage.SendData(16, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					NetMessage.SendPlayerHurt(this.whoAmI, damageSource, Damage, hitDirection, Crit, pvp, hitContext, -1, -1);
				}
				Color color = Crit ? CombatText.DamagedFriendlyCrit : CombatText.DamagedFriendly;
				CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), color, (int)num2, Crit, false);
				this.statLife -= (int)num2;
				if (cooldownCounter == -1)
				{
					this.immune = true;
					if (num2 == 1.0)
					{
						this.immuneTime = 20;
						if (this.longInvince)
						{
							this.immuneTime += 20;
						}
					}
					else
					{
						this.immuneTime = 40;
						if (this.longInvince)
						{
							this.immuneTime += 40;
						}
					}
					if (pvp)
					{
						this.immuneTime = 8;
					}
				}
				else if (cooldownCounter == 0)
				{
					if (num2 == 1.0)
					{
						this.hurtCooldowns[cooldownCounter] = (this.longInvince ? 40 : 20);
					}
					else
					{
						this.hurtCooldowns[cooldownCounter] = (this.longInvince ? 80 : 40);
					}
				}
				else if (cooldownCounter == 1)
				{
					if (num2 == 1.0)
					{
						this.hurtCooldowns[cooldownCounter] = (this.longInvince ? 40 : 20);
					}
					else
					{
						this.hurtCooldowns[cooldownCounter] = (this.longInvince ? 80 : 40);
					}
				}
				this.lifeRegenTime = 0;
				if (this.whoAmI == Main.myPlayer)
				{
					if (this.starCloak)
					{
						for (int n = 0; n < 3; n++)
						{
							float x = this.position.X + (float)Main.rand.Next(-400, 400);
							float y = this.position.Y - (float)Main.rand.Next(500, 800);
							Vector2 vector = new Vector2(x, y);
							float num12 = this.position.X + (float)(this.width / 2) - vector.X;
							float num13 = this.position.Y + (float)(this.height / 2) - vector.Y;
							num12 += (float)Main.rand.Next(-100, 101);
							float arg_9D9_0 = (float)23;
							float num14 = (float)Math.Sqrt((double)(num12 * num12 + num13 * num13));
							num14 = arg_9D9_0 / num14;
							num12 *= num14;
							num13 *= num14;
							int num15 = Projectile.NewProjectile(x, y, num12, num13, 92, 30, 5f, this.whoAmI, 0f, 0f);
							Main.projectile[num15].ai[1] = this.position.Y;
						}
					}
					if (this.bee)
					{
						int num16 = 1;
						if (Main.rand.Next(3) == 0)
						{
							num16++;
						}
						if (Main.rand.Next(3) == 0)
						{
							num16++;
						}
						if (this.strongBees && Main.rand.Next(3) == 0)
						{
							num16++;
						}
						for (int num17 = 0; num17 < num16; num17++)
						{
							float speedX = (float)Main.rand.Next(-35, 36) * 0.02f;
							float speedY = (float)Main.rand.Next(-35, 36) * 0.02f;
							Projectile.NewProjectile(this.position.X, this.position.Y, speedX, speedY, this.beeType(), this.beeDamage(7), this.beeKB(0f), Main.myPlayer, 0f, 0f);
						}
					}
				}
				if (flag2 && hitDirection != 0)
				{
					if (!this.mount.Active || !this.mount.Cart)
					{
						float num18 = 10.5f;
						float y2 = -7.5f;
						if (this.noKnockback)
						{
							num18 = 2.5f;
							y2 = -1.5f;
						}
						this.velocity.X = num18 * (float)hitDirection;
						this.velocity.Y = y2;
					}
				}
				else if (!this.noKnockback && hitDirection != 0 && (!this.mount.Active || !this.mount.Cart))
				{
					this.velocity.X = 4.5f * (float)hitDirection;
					this.velocity.Y = -3.5f;
				}
				if (this.stoned)
				{
					Main.PlaySound(0, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
				}
				else if (this.frostArmor)
				{
					Main.PlaySound(SoundID.Item27, this.position);
				}
				else if ((this.wereWolf || this.forceWerewolf) && !this.hideWolf)
				{
					Main.PlaySound(3, (int)this.position.X, (int)this.position.Y, 6, 1f, 0f);
				}
				else if (this.boneArmor)
				{
					Main.PlaySound(3, (int)this.position.X, (int)this.position.Y, 2, 1f, 0f);
				}
				else if (!this.Male)
				{
					Main.PlaySound(20, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
				}
				else
				{
					Main.PlaySound(1, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
				}
				if (this.statLife > 0)
				{
					double num19 = num2 / (double)this.statLifeMax2 * 100.0;
					float num20 = (float)(2 * hitDirection);
					float num21 = 0f;
					if (flag2)
					{
						num19 *= 12.0;
						num21 = 6f;
					}
					int num22 = 0;
					while ((double)num22 < num19)
					{
						if (this.stoned)
						{
							Dust.NewDust(this.position, this.width, this.height, 1, num20 + (float)hitDirection * num21 * Main.rand.NextFloat(), -2f, 0, default(Color), 1f);
						}
						else if (this.frostArmor)
						{
							int num23 = Dust.NewDust(this.position, this.width, this.height, 135, num20 + (float)hitDirection * num21 * Main.rand.NextFloat(), -2f, 0, default(Color), 1f);
							Main.dust[num23].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
						}
						else if (this.boneArmor)
						{
							int num24 = Dust.NewDust(this.position, this.width, this.height, 26, num20 + (float)hitDirection * num21 * Main.rand.NextFloat(), -2f, 0, default(Color), 1f);
							Main.dust[num24].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
						}
						else
						{
							Dust.NewDust(this.position, this.width, this.height, 5, num20 + (float)hitDirection * num21 * Main.rand.NextFloat(), -2f, 0, default(Color), 1f);
						}
						num22++;
					}
				}
				else
				{
					this.statLife = 0;
					if (this.whoAmI == Main.myPlayer)
					{
						this.KillMe(damageSource, num2, hitDirection, pvp);
					}
				}
			}
			if (pvp)
			{
				num2 = Main.CalculateDamage(num, this.statDefense);
			}
			return num2;
		}

		// Token: 0x060003CE RID: 974 RVA: 0x0026478A File Offset: 0x0026298A
		public double HurtOld(int Damage, int hitDirection, bool pvp = false, bool quiet = false, string deathText = " was slain...", bool Crit = false, int cooldownCounter = -1)
		{
			return 0.0;
		}

		// Token: 0x0600039E RID: 926 RVA: 0x0024CF30 File Offset: 0x0024B130
		public bool IsStackingItems()
		{
			for (int i = 0; i < this.inventoryChestStack.Length; i++)
			{
				if (this.inventoryChestStack[i])
				{
					if (this.inventory[i].type != 0 && this.inventory[i].stack != 0)
					{
						return true;
					}
					this.inventoryChestStack[i] = false;
				}
			}
			return false;
		}

		// Token: 0x060003E9 RID: 1001 RVA: 0x0026C9A8 File Offset: 0x0026ABA8
		public void ItemCheck(int i)
		{
			if (this.webbed || this.frozen || this.stoned)
			{
				return;
			}
			bool flag = false;
			float num = (float)this.mount.PlayerOffsetHitbox;
			Item item = this.inventory[this.selectedItem];
			if (this.mount.Active)
			{
				if (this.mount.Type == 8)
				{
					this.noItems = true;
					if (this.controlUseItem)
					{
						this.channel = true;
						if (this.releaseUseItem)
						{
							this.mount.UseAbility(this, Vector2.Zero, true);
						}
						this.releaseUseItem = false;
					}
				}
				if (this.whoAmI == Main.myPlayer && this.gravDir == -1f)
				{
					this.mount.Dismount(this);
				}
			}
			int weaponDamage = this.GetWeaponDamage(item);
			if (item.autoReuse && !this.noItems)
			{
				this.releaseUseItem = true;
				if (this.itemAnimation == 1 && item.stack > 0)
				{
					if (item.shoot > 0 && this.whoAmI != Main.myPlayer && this.controlUseItem && item.useStyle == 5)
					{
						this.ApplyAnimation(item);
						if (item.UseSound != null)
						{
							Main.PlaySound(item.UseSound, base.Center);
						}
					}
					else
					{
						this.itemAnimation = 0;
					}
				}
			}
			if (item.fishingPole > 0)
			{
				item.holdStyle = 0;
				if (this.itemTime == 0 && this.itemAnimation == 0)
				{
					for (int j = 0; j < 1000; j++)
					{
						if (Main.projectile[j].active && Main.projectile[j].owner == this.whoAmI && Main.projectile[j].bobber)
						{
							item.holdStyle = 1;
						}
					}
				}
			}
			if (this.itemAnimation == 0 && this.reuseDelay > 0)
			{
				this.itemAnimation = this.reuseDelay;
				this.itemTime = this.reuseDelay;
				this.reuseDelay = 0;
			}
			if (this.controlUseItem && this.releaseUseItem && (item.headSlot > 0 || item.bodySlot > 0 || item.legSlot > 0))
			{
				if (item.useStyle == 0)
				{
					this.releaseUseItem = false;
				}
				if (this.position.X / 16f - (float)Player.tileRangeX - (float)item.tileBoost <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)item.tileBoost - 1f >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)item.tileBoost <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)item.tileBoost - 2f >= (float)Player.tileTargetY)
				{
					int num2 = Player.tileTargetX;
					int num3 = Player.tileTargetY;
					if (Main.tile[num2, num3].active() && (Main.tile[num2, num3].type == 128 || Main.tile[num2, num3].type == 269))
					{
						int num4 = (int)Main.tile[num2, num3].frameY;
						int k = 0;
						if (item.bodySlot >= 0)
						{
							k = 1;
						}
						if (item.legSlot >= 0)
						{
							k = 2;
						}
						num4 /= 18;
						while (k > num4)
						{
							num3++;
							num4 = (int)Main.tile[num2, num3].frameY;
							num4 /= 18;
						}
						while (k < num4)
						{
							num3--;
							num4 = (int)Main.tile[num2, num3].frameY;
							num4 /= 18;
						}
						int l;
						for (l = (int)Main.tile[num2, num3].frameX; l >= 100; l -= 100)
						{
						}
						if (l >= 36)
						{
							l -= 36;
						}
						num2 -= l / 18;
						int m = (int)Main.tile[num2, num3].frameX;
						WorldGen.KillTile(num2, num3, true, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 0, (float)num2, (float)num3, 1f, 0, 0, 0);
						}
						while (m >= 100)
						{
							m -= 100;
						}
						if (num4 == 0 && item.headSlot >= 0)
						{
							Main.blockMouse = true;
							Main.tile[num2, num3].frameX = (short)(m + item.headSlot * 100);
							if (Main.netMode == 1)
							{
								NetMessage.SendTileSquare(-1, num2, num3, 1, TileChangeType.None);
							}
							item.stack--;
							if (item.stack <= 0)
							{
								item.SetDefaults(0, false);
								Main.mouseItem.SetDefaults(0, false);
							}
							if (this.selectedItem == 58)
							{
								Main.mouseItem = item.Clone();
							}
							this.releaseUseItem = false;
							this.mouseInterface = true;
						}
						else if (num4 == 1 && item.bodySlot >= 0)
						{
							Main.blockMouse = true;
							Main.tile[num2, num3].frameX = (short)(m + item.bodySlot * 100);
							if (Main.netMode == 1)
							{
								NetMessage.SendTileSquare(-1, num2, num3, 1, TileChangeType.None);
							}
							item.stack--;
							if (item.stack <= 0)
							{
								item.SetDefaults(0, false);
								Main.mouseItem.SetDefaults(0, false);
							}
							if (this.selectedItem == 58)
							{
								Main.mouseItem = item.Clone();
							}
							this.releaseUseItem = false;
							this.mouseInterface = true;
						}
						else if (num4 == 2 && item.legSlot >= 0 && !ArmorIDs.Legs.Sets.MannequinIncompatible.Contains(item.legSlot))
						{
							Main.blockMouse = true;
							Main.tile[num2, num3].frameX = (short)(m + item.legSlot * 100);
							if (Main.netMode == 1)
							{
								NetMessage.SendTileSquare(-1, num2, num3, 1, TileChangeType.None);
							}
							item.stack--;
							if (item.stack <= 0)
							{
								item.SetDefaults(0, false);
								Main.mouseItem.SetDefaults(0, false);
							}
							if (this.selectedItem == 58)
							{
								Main.mouseItem = item.Clone();
							}
							this.releaseUseItem = false;
							this.mouseInterface = true;
						}
					}
				}
			}
			if (Main.myPlayer == i && this.itemAnimation == 0 && TileObjectData.CustomPlace(item.createTile, item.placeStyle))
			{
				TileObject tileObject;
				TileObject.CanPlace(Player.tileTargetX, Player.tileTargetY, item.createTile, item.placeStyle, this.direction, out tileObject, true);
			}
			if (this.itemAnimation == 0 && this.altFunctionUse == 2)
			{
				this.altFunctionUse = 0;
			}
			if (this.controlUseItem && this.itemAnimation == 0 && this.releaseUseItem && item.useStyle > 0)
			{
				if (this.altFunctionUse == 1)
				{
					this.altFunctionUse = 2;
				}
				bool flag2 = true;
				if (item.shoot == 0)
				{
					this.itemRotation = 0f;
				}
				if (item.type == 3335 && (this.extraAccessory || !Main.expertMode))
				{
					flag2 = false;
				}
				if (this.pulley && item.fishingPole > 0)
				{
					flag2 = false;
				}
				if (item.type == 3611 && (WiresUI.Settings.ToolMode & (WiresUI.Settings.MultiToolMode.Red | WiresUI.Settings.MultiToolMode.Green | WiresUI.Settings.MultiToolMode.Blue | WiresUI.Settings.MultiToolMode.Yellow | WiresUI.Settings.MultiToolMode.Actuator)) == (WiresUI.Settings.MultiToolMode)0)
				{
					flag2 = false;
				}
				if ((item.type == 3611 || item.type == 3625) && this.wireOperationsCooldown > 0)
				{
					flag2 = false;
				}
				if (!this.CheckDD2CrystalPaymentLock(item))
				{
					flag2 = false;
				}
				if (this.whoAmI == Main.myPlayer && item.shoot > -1 && ProjectileID.Sets.IsADD2Turret[item.shoot] && !this.downedDD2EventAnyDifficulty && !DD2Event.Ongoing)
				{
					flag2 = false;
				}
				if (item.shoot > -1 && ProjectileID.Sets.IsADD2Turret[item.shoot] && DD2Event.Ongoing && i == Main.myPlayer)
				{
					int worldX;
					int worldY;
					int num5;
					this.FindSentryRestingSpot(item.shoot, out worldX, out worldY, out num5);
					if (Player.WouldSpotOverlapWithSentry(worldX, worldY))
					{
						flag2 = false;
					}
				}
				if (item.shoot > -1 && ProjectileID.Sets.IsADD2Turret[item.shoot] && i == Main.myPlayer)
				{
					int num6;
					int num7;
					int num8;
					this.FindSentryRestingSpot(item.shoot, out num6, out num7, out num8);
					num6 /= 16;
					num7 /= 16;
					num7--;
					if (WorldGen.SolidTile(num6, num7))
					{
						flag2 = false;
					}
				}
				if (this.wet && (item.shoot == 85 || item.shoot == 15 || item.shoot == 34))
				{
					flag2 = false;
				}
				if (item.makeNPC > 0 && !NPC.CanReleaseNPCs(this.whoAmI))
				{
					flag2 = false;
				}
				if (this.whoAmI == Main.myPlayer && item.type == 603 && !Main.cEd)
				{
					flag2 = false;
				}
				if (item.type == 1071 || item.type == 1072)
				{
					bool flag3 = false;
					for (int n = 0; n < 58; n++)
					{
						if (this.inventory[n].paint > 0)
						{
							flag3 = true;
							break;
						}
					}
					if (!flag3)
					{
						flag2 = false;
					}
				}
				if (this.noItems)
				{
					flag2 = false;
				}
				if (item.tileWand > 0)
				{
					int tileWand = item.tileWand;
					flag2 = false;
					for (int num9 = 0; num9 < 58; num9++)
					{
						if (tileWand == this.inventory[num9].type && this.inventory[num9].stack > 0)
						{
							flag2 = true;
							break;
						}
					}
				}
				if (item.fishingPole > 0)
				{
					for (int num10 = 0; num10 < 1000; num10++)
					{
						if (Main.projectile[num10].active && Main.projectile[num10].owner == this.whoAmI && Main.projectile[num10].bobber)
						{
							flag2 = false;
							if (this.whoAmI == Main.myPlayer && Main.projectile[num10].ai[0] == 0f)
							{
								Main.projectile[num10].ai[0] = 1f;
								float num11 = -10f;
								if (Main.projectile[num10].wet && Main.projectile[num10].velocity.Y > num11)
								{
									Main.projectile[num10].velocity.Y = num11;
								}
								Main.projectile[num10].netUpdate2 = true;
								if (Main.projectile[num10].ai[1] < 0f && Main.projectile[num10].localAI[1] != 0f)
								{
									bool flag4 = false;
									int num12 = 0;
									for (int num13 = 0; num13 < 58; num13++)
									{
										if (this.inventory[num13].stack > 0 && this.inventory[num13].bait > 0)
										{
											bool flag5 = false;
											int num14 = 1 + this.inventory[num13].bait / 5;
											if (num14 < 1)
											{
												num14 = 1;
											}
											if (this.accTackleBox)
											{
												num14++;
											}
											if (Main.rand.Next(num14) == 0)
											{
												flag5 = true;
											}
											if (Main.projectile[num10].localAI[1] < 0f)
											{
												flag5 = true;
											}
											if (Main.projectile[num10].localAI[1] > 0f)
											{
												Item expr_B01 = new Item();
												expr_B01.SetDefaults((int)Main.projectile[num10].localAI[1], false);
												if (expr_B01.rare < 0)
												{
													flag5 = false;
												}
											}
											if (flag5)
											{
												num12 = this.inventory[num13].type;
												this.inventory[num13].stack--;
												if (this.inventory[num13].stack <= 0)
												{
													this.inventory[num13].SetDefaults(0, false);
												}
											}
											flag4 = true;
											break;
										}
									}
									if (flag4)
									{
										if (num12 == 2673)
										{
											if (Main.netMode != 1)
											{
												NPC.SpawnOnPlayer(this.whoAmI, 370);
											}
											else
											{
												NetMessage.SendData(61, -1, -1, null, this.whoAmI, 370f, 0f, 0f, 0, 0, 0);
											}
											Main.projectile[num10].ai[0] = 2f;
										}
										else if (Main.rand.Next(7) == 0 && !this.accFishingLine)
										{
											Main.projectile[num10].ai[0] = 2f;
										}
										else
										{
											Main.projectile[num10].ai[1] = Main.projectile[num10].localAI[1];
										}
										Main.projectile[num10].netUpdate = true;
									}
								}
							}
						}
					}
				}
				if (item.shoot == 6 || item.shoot == 19 || item.shoot == 33 || item.shoot == 52 || item.shoot == 113 || item.shoot == 320 || item.shoot == 333 || item.shoot == 383 || item.shoot == 491)
				{
					for (int num15 = 0; num15 < 1000; num15++)
					{
						if (Main.projectile[num15].active && Main.projectile[num15].owner == Main.myPlayer && Main.projectile[num15].type == item.shoot)
						{
							flag2 = false;
						}
					}
				}
				if (item.shoot == 106)
				{
					int num16 = 0;
					for (int num17 = 0; num17 < 1000; num17++)
					{
						if (Main.projectile[num17].active && Main.projectile[num17].owner == Main.myPlayer && Main.projectile[num17].type == item.shoot)
						{
							num16++;
						}
					}
					if (num16 >= item.stack)
					{
						flag2 = false;
					}
				}
				if (item.shoot == 272)
				{
					int num18 = 0;
					for (int num19 = 0; num19 < 1000; num19++)
					{
						if (Main.projectile[num19].active && Main.projectile[num19].owner == Main.myPlayer && Main.projectile[num19].type == item.shoot)
						{
							num18++;
						}
					}
					if (num18 >= item.stack)
					{
						flag2 = false;
					}
				}
				if (item.shoot == 13 || item.shoot == 32 || (item.shoot >= 230 && item.shoot <= 235) || item.shoot == 315 || item.shoot == 331 || item.shoot == 372)
				{
					for (int num20 = 0; num20 < 1000; num20++)
					{
						if (Main.projectile[num20].active && Main.projectile[num20].owner == Main.myPlayer && Main.projectile[num20].type == item.shoot && Main.projectile[num20].ai[0] != 2f)
						{
							flag2 = false;
						}
					}
				}
				if (item.shoot == 332)
				{
					int num21 = 0;
					for (int num22 = 0; num22 < 1000; num22++)
					{
						if (Main.projectile[num22].active && Main.projectile[num22].owner == Main.myPlayer && Main.projectile[num22].type == item.shoot && Main.projectile[num22].ai[0] != 2f)
						{
							num21++;
						}
					}
					if (num21 >= 3)
					{
						flag2 = false;
					}
				}
				if (item.potion & flag2)
				{
					if (this.potionDelay <= 0)
					{
						if (item.type == 227)
						{
							this.potionDelay = this.restorationDelayTime;
							this.AddBuff(21, this.potionDelay, true);
						}
						else
						{
							this.potionDelay = this.potionDelayTime;
							this.AddBuff(21, this.potionDelay, true);
						}
					}
					else
					{
						flag2 = false;
					}
				}
				if (item.mana > 0 && this.silence)
				{
					flag2 = false;
				}
				if (item.mana > 0 & flag2)
				{
					bool flag6 = false;
					if (item.type == 2795)
					{
						flag6 = true;
					}
					if (item.shoot > 0 && ProjectileID.Sets.TurretFeature[item.shoot] && this.altFunctionUse == 2)
					{
						flag6 = true;
					}
					if (item.shoot > 0 && ProjectileID.Sets.MinionTargettingFeature[item.shoot] && this.altFunctionUse == 2)
					{
						flag6 = true;
					}
					if (item.type != 127 || !this.spaceGun)
					{
						if (this.statMana >= (int)((float)item.mana * this.manaCost))
						{
							if (!flag6)
							{
								this.statMana -= (int)((float)item.mana * this.manaCost);
							}
						}
						else if (this.manaFlower)
						{
							this.QuickMana();
							if (this.statMana >= (int)((float)item.mana * this.manaCost))
							{
								if (!flag6)
								{
									this.statMana -= (int)((float)item.mana * this.manaCost);
								}
							}
							else
							{
								flag2 = false;
							}
						}
						else
						{
							flag2 = false;
						}
					}
					if ((this.whoAmI == Main.myPlayer && item.buffType != 0 && item.buffTime != 0) & flag2)
					{
						this.AddBuff(item.buffType, item.buffTime, true);
					}
				}
				if (item.shoot <= 0 || !ProjectileID.Sets.MinionTargettingFeature[item.shoot] || this.altFunctionUse != 2)
				{
					this.ItemCheck_ApplyPetBuffs(item);
				}
				if (this.whoAmI == Main.myPlayer && this.gravDir == 1f && item.mountType != -1 && this.mount.CanMount(item.mountType, this))
				{
					this.mount.SetMount(item.mountType, this, false);
				}
				if (item.type == 43 && Main.dayTime)
				{
					flag2 = false;
				}
				if (item.type == 544 && Main.dayTime)
				{
					flag2 = false;
				}
				if (item.type == 556 && Main.dayTime)
				{
					flag2 = false;
				}
				if (item.type == 557 && Main.dayTime)
				{
					flag2 = false;
				}
				if (item.type == 70 && !this.ZoneCorrupt)
				{
					flag2 = false;
				}
				if (item.type == 1133 && !this.ZoneJungle)
				{
					flag2 = false;
				}
				if (item.type == 1844 && (Main.dayTime || Main.pumpkinMoon || Main.snowMoon || DD2Event.Ongoing))
				{
					flag2 = false;
				}
				if (item.type == 1958 && (Main.dayTime || Main.pumpkinMoon || Main.snowMoon || DD2Event.Ongoing))
				{
					flag2 = false;
				}
				if (item.type == 2767 && (!Main.dayTime || Main.eclipse || !Main.hardMode))
				{
					flag2 = false;
				}
				if (item.type == 3601 && (!NPC.downedGolemBoss || !Main.hardMode || NPC.AnyDanger() || NPC.AnyoneNearCultists()))
				{
					flag2 = false;
				}
				if (!this.SummonItemCheck())
				{
					flag2 = false;
				}
				if ((item.shoot == 17 & flag2) && i == Main.myPlayer)
				{
					int num23 = (int)((float)Main.mouseX + Main.screenPosition.X) / 16;
					int num24 = (int)((float)Main.mouseY + Main.screenPosition.Y) / 16;
					if (this.gravDir == -1f)
					{
						num24 = (int)(Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16;
					}
					Tile tile = Main.tile[num23, num24];
					if (tile.active() && (tile.type == 0 || tile.type == 2 || tile.type == 23 || tile.type == 109 || tile.type == 199))
					{
						WorldGen.KillTile(num23, num24, false, false, true);
						if (!Main.tile[num23, num24].active())
						{
							if (Main.netMode == 1)
							{
								NetMessage.SendData(17, -1, -1, null, 4, (float)num23, (float)num24, 0f, 0, 0, 0);
							}
						}
						else
						{
							flag2 = false;
						}
					}
					else
					{
						flag2 = false;
					}
				}
				if (flag2)
				{
					flag2 = this.HasAmmo(item, flag2);
				}
				if (flag2)
				{
					if (item.pick > 0 || item.axe > 0 || item.hammer > 0)
					{
						this.toolTime = 1;
					}
					if (this.grappling[0] > -1)
					{
						this.pulley = false;
						this.pulleyDir = 1;
						if (this.controlRight)
						{
							this.direction = 1;
						}
						else if (this.controlLeft)
						{
							this.direction = -1;
						}
					}
					this.channel = item.channel;
					this.attackCD = 0;
					this.ApplyAnimation(item);
					if (item.UseSound != null)
					{
						Main.PlaySound(item.UseSound, base.Center);
					}
				}
				if (((item.shoot <= 0 || !ProjectileID.Sets.MinionTargettingFeature[item.shoot] || this.altFunctionUse != 2) & flag2) && this.whoAmI == Main.myPlayer && item.shoot >= 0 && item.shoot < 714 && (ProjectileID.Sets.LightPet[item.shoot] || Main.projPet[item.shoot]))
				{
					if (ProjectileID.Sets.MinionSacrificable[item.shoot])
					{
						List<int> list = new List<int>();
						float num25 = 0f;
						for (int num26 = 0; num26 < 1000; num26++)
						{
							if (Main.projectile[num26].active && Main.projectile[num26].owner == i && Main.projectile[num26].minion)
							{
								int num27;
								for (num27 = 0; num27 < list.Count; num27++)
								{
									if (Main.projectile[list[num27]].minionSlots > Main.projectile[num26].minionSlots)
									{
										list.Insert(num27, num26);
										break;
									}
								}
								if (num27 == list.Count)
								{
									list.Add(num26);
								}
								num25 += Main.projectile[num26].minionSlots;
							}
						}
						float num28 = (float)ItemID.Sets.StaffMinionSlotsRequired[item.type];
						float num29 = 0f;
						int num30 = 388;
						int num31 = -1;
						for (int num32 = 0; num32 < list.Count; num32++)
						{
							int expr_15BA = Main.projectile[list[num32]].type;
							if (expr_15BA == 626)
							{
								list.RemoveAt(num32);
								num32--;
							}
							if (expr_15BA == 627)
							{
								if (Main.projectile[(int)Main.projectile[list[num32]].localAI[1]].type == 628)
								{
									num31 = list[num32];
								}
								list.RemoveAt(num32);
								num32--;
							}
						}
						if (num31 != -1)
						{
							list.Add(num31);
							list.Add(Projectile.GetByUUID(Main.projectile[num31].owner, Main.projectile[num31].ai[0]));
						}
						int num33 = 0;
						while (num33 < list.Count && num25 - num29 > (float)this.maxMinions - num28)
						{
							int type = Main.projectile[list[num33]].type;
							if (type != num30 && type != 625 && type != 628 && type != 623)
							{
								if (type == 388 && num30 == 387)
								{
									num30 = 388;
								}
								if (type == 387 && num30 == 388)
								{
									num30 = 387;
								}
								num29 += Main.projectile[list[num33]].minionSlots;
								if (type == 626 || type == 627)
								{
									int byUUID = Projectile.GetByUUID(Main.projectile[list[num33]].owner, Main.projectile[list[num33]].ai[0]);
									if (byUUID >= 0)
									{
										Projectile projectile = Main.projectile[byUUID];
										if (projectile.type != 625)
										{
											projectile.localAI[1] = Main.projectile[list[num33]].localAI[1];
										}
										projectile = Main.projectile[(int)Main.projectile[list[num33]].localAI[1]];
										projectile.ai[0] = Main.projectile[list[num33]].ai[0];
										projectile.ai[1] = 1f;
										projectile.netUpdate = true;
									}
								}
								Main.projectile[list[num33]].Kill();
							}
							num33++;
						}
						list.Clear();
						if (num25 + num28 >= 9f)
						{
							AchievementsHelper.HandleSpecialEvent(this, 6);
						}
					}
					else
					{
						for (int num34 = 0; num34 < 1000; num34++)
						{
							if (Main.projectile[num34].active && Main.projectile[num34].owner == i && Main.projectile[num34].type == item.shoot)
							{
								Main.projectile[num34].Kill();
							}
							if (item.shoot == 72)
							{
								if (Main.projectile[num34].active && Main.projectile[num34].owner == i && Main.projectile[num34].type == 86)
								{
									Main.projectile[num34].Kill();
								}
								if (Main.projectile[num34].active && Main.projectile[num34].owner == i && Main.projectile[num34].type == 87)
								{
									Main.projectile[num34].Kill();
								}
							}
						}
					}
				}
			}
			if (!this.controlUseItem)
			{
				bool arg_191C_0 = this.channel;
				this.channel = false;
			}
			if (this.itemAnimation > 0)
			{
				if (item.melee)
				{
					this.itemAnimationMax = (int)((float)item.useAnimation * this.meleeSpeed);
				}
				else
				{
					this.itemAnimationMax = item.useAnimation;
				}
				if (item.mana > 0 && !flag && (item.type != 127 || !this.spaceGun))
				{
					this.manaRegenDelay = (int)this.maxRegenDelay;
				}
				if (Main.dedServ)
				{
					this.itemHeight = item.height;
					this.itemWidth = item.width;
				}
				else
				{
					this.itemHeight = Main.itemTexture[item.type].Height;
					this.itemWidth = Main.itemTexture[item.type].Width;
				}
				this.itemAnimation--;
				if (!Main.dedServ)
				{
					if (item.useStyle == 1)
					{
						if (item.type > -1 && Item.claw[item.type])
						{
							if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.333)
							{
								float num35 = 10f;
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - num35) * (float)this.direction;
								this.itemLocation.Y = this.position.Y + 26f + num;
							}
							else if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.666)
							{
								float num36 = 8f;
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - num36) * (float)this.direction;
								num36 = 24f;
								this.itemLocation.Y = this.position.Y + num36 + num;
							}
							else
							{
								float num37 = 6f;
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f - ((float)Main.itemTexture[item.type].Width * 0.5f - num37) * (float)this.direction;
								num37 = 20f;
								this.itemLocation.Y = this.position.Y + num37 + num;
							}
							this.itemRotation = ((float)this.itemAnimation / (float)this.itemAnimationMax - 0.5f) * (float)(-(float)this.direction) * 3.5f - (float)this.direction * 0.3f;
						}
						else
						{
							if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.333)
							{
								float num38 = 10f;
								if (Main.itemTexture[item.type].Width > 32)
								{
									num38 = 14f;
								}
								if (Main.itemTexture[item.type].Width >= 52)
								{
									num38 = 24f;
								}
								if (Main.itemTexture[item.type].Width >= 64)
								{
									num38 = 28f;
								}
								if (Main.itemTexture[item.type].Width >= 92)
								{
									num38 = 38f;
								}
								if (item.type == 2330 || item.type == 2320 || item.type == 2341)
								{
									num38 += 8f;
								}
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - num38) * (float)this.direction;
								this.itemLocation.Y = this.position.Y + 24f + num;
							}
							else if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.666)
							{
								float num39 = 10f;
								if (Main.itemTexture[item.type].Width > 32)
								{
									num39 = 18f;
								}
								if (Main.itemTexture[item.type].Width >= 52)
								{
									num39 = 24f;
								}
								if (Main.itemTexture[item.type].Width >= 64)
								{
									num39 = 28f;
								}
								if (Main.itemTexture[item.type].Width >= 92)
								{
									num39 = 38f;
								}
								if (item.type == 2330 || item.type == 2320 || item.type == 2341)
								{
									num39 += 4f;
								}
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - num39) * (float)this.direction;
								num39 = 10f;
								if (Main.itemTexture[item.type].Height > 32)
								{
									num39 = 8f;
								}
								if (Main.itemTexture[item.type].Height > 52)
								{
									num39 = 12f;
								}
								if (Main.itemTexture[item.type].Height > 64)
								{
									num39 = 14f;
								}
								if (item.type == 2330 || item.type == 2320 || item.type == 2341)
								{
									num39 += 4f;
								}
								this.itemLocation.Y = this.position.Y + num39 + num;
							}
							else
							{
								float num40 = 6f;
								if (Main.itemTexture[item.type].Width > 32)
								{
									num40 = 14f;
								}
								if (Main.itemTexture[item.type].Width >= 48)
								{
									num40 = 18f;
								}
								if (Main.itemTexture[item.type].Width >= 52)
								{
									num40 = 24f;
								}
								if (Main.itemTexture[item.type].Width >= 64)
								{
									num40 = 28f;
								}
								if (Main.itemTexture[item.type].Width >= 92)
								{
									num40 = 38f;
								}
								if (item.type == 2330 || item.type == 2320 || item.type == 2341)
								{
									num40 += 4f;
								}
								this.itemLocation.X = this.position.X + (float)this.width * 0.5f - ((float)Main.itemTexture[item.type].Width * 0.5f - num40) * (float)this.direction;
								num40 = 10f;
								if (Main.itemTexture[item.type].Height > 32)
								{
									num40 = 10f;
								}
								if (Main.itemTexture[item.type].Height > 52)
								{
									num40 = 12f;
								}
								if (Main.itemTexture[item.type].Height > 64)
								{
									num40 = 14f;
								}
								if (item.type == 2330 || item.type == 2320 || item.type == 2341)
								{
									num40 += 4f;
								}
								this.itemLocation.Y = this.position.Y + num40 + num;
							}
							this.itemRotation = ((float)this.itemAnimation / (float)this.itemAnimationMax - 0.5f) * (float)(-(float)this.direction) * 3.5f - (float)this.direction * 0.3f;
						}
						if (this.gravDir == -1f)
						{
							this.itemRotation = -this.itemRotation;
							this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
						}
					}
					else if (item.useStyle == 2)
					{
						this.itemRotation = (float)this.itemAnimation / (float)this.itemAnimationMax * (float)this.direction * 2f + -1.4f * (float)this.direction;
						if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.5)
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - 9f - this.itemRotation * 12f * (float)this.direction) * (float)this.direction;
							this.itemLocation.Y = this.position.Y + 38f + this.itemRotation * (float)this.direction * 4f + num;
						}
						else
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - 9f - this.itemRotation * 16f * (float)this.direction) * (float)this.direction;
							this.itemLocation.Y = this.position.Y + 38f + this.itemRotation * (float)this.direction + num;
						}
						if (this.gravDir == -1f)
						{
							this.itemRotation = -this.itemRotation;
							this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
						}
					}
					else if (item.useStyle == 3)
					{
						if ((double)this.itemAnimation > (double)this.itemAnimationMax * 0.666)
						{
							this.itemLocation.X = -1000f;
							this.itemLocation.Y = -1000f;
							this.itemRotation = -1.3f * (float)this.direction;
						}
						else
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - 4f) * (float)this.direction;
							this.itemLocation.Y = this.position.Y + 24f + num;
							float num41 = (float)this.itemAnimation / (float)this.itemAnimationMax * (float)Main.itemTexture[item.type].Width * (float)this.direction * item.scale * 1.2f - (float)(10 * this.direction);
							if (num41 > -4f && this.direction == -1)
							{
								num41 = -8f;
							}
							if (num41 < 4f && this.direction == 1)
							{
								num41 = 8f;
							}
							this.itemLocation.X = this.itemLocation.X - num41;
							this.itemRotation = 0.8f * (float)this.direction;
						}
						if (this.gravDir == -1f)
						{
							this.itemRotation = -this.itemRotation;
							this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
						}
					}
					else if (item.useStyle == 4)
					{
						int num42 = 0;
						if (item.type == 3601)
						{
							num42 = 10;
						}
						this.itemRotation = 0f;
						this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f - 9f - this.itemRotation * 14f * (float)this.direction - 4f - (float)num42) * (float)this.direction;
						this.itemLocation.Y = this.position.Y + (float)Main.itemTexture[item.type].Height * 0.5f + 4f + num;
						if (this.gravDir == -1f)
						{
							this.itemRotation = -this.itemRotation;
							this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
						}
					}
					else if (item.useStyle == 5)
					{
						if (item.type == 3779)
						{
							this.itemRotation = 0f;
							this.itemLocation.X = base.Center.X + (float)(6 * this.direction);
							this.itemLocation.Y = this.MountedCenter.Y + 6f;
						}
						else if (Item.staff[item.type])
						{
							float scaleFactor = 6f;
							if (item.type == 3476)
							{
								scaleFactor = 14f;
							}
							this.itemLocation = this.MountedCenter;
							this.itemLocation += this.itemRotation.ToRotationVector2() * scaleFactor * (float)this.direction;
						}
						else
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f - (float)Main.itemTexture[item.type].Width * 0.5f - (float)(this.direction * 2);
							this.itemLocation.Y = this.MountedCenter.Y - (float)Main.itemTexture[item.type].Height * 0.5f;
						}
					}
				}
			}
			else if (item.holdStyle == 1 && !this.pulley)
			{
				if (Main.dedServ)
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + 20f * (float)this.direction;
				}
				else if (item.type == 930)
				{
					this.itemLocation.X = this.position.X + (float)(this.width / 2) * 0.5f - 12f - (float)(2 * this.direction);
					float num43 = this.position.X + (float)(this.width / 2) + (float)(38 * this.direction);
					if (this.direction == 1)
					{
						num43 -= 10f;
					}
					float num44 = this.MountedCenter.Y - 4f * this.gravDir;
					if (this.gravDir == -1f)
					{
						num44 -= 8f;
					}
					this.RotateRelativePoint(ref num43, ref num44);
					int num45 = 0;
					for (int num46 = 54; num46 < 58; num46++)
					{
						if (this.inventory[num46].stack > 0 && this.inventory[num46].ammo == 931)
						{
							num45 = this.inventory[num46].type;
							break;
						}
					}
					if (num45 == 0)
					{
						for (int num47 = 0; num47 < 54; num47++)
						{
							if (this.inventory[num47].stack > 0 && this.inventory[num47].ammo == 931)
							{
								num45 = this.inventory[num47].type;
								break;
							}
						}
					}
					if (num45 == 931)
					{
						num45 = 127;
					}
					else if (num45 == 1614)
					{
						num45 = 187;
					}
					if (num45 > 0)
					{
						int num48 = Dust.NewDust(new Vector2(num43, num44 + this.gfxOffY), 6, 6, num45, 0f, 0f, 100, default(Color), 1.6f);
						Main.dust[num48].noGravity = true;
						Dust expr_2928_cp_0_cp_0 = Main.dust[num48];
						expr_2928_cp_0_cp_0.velocity.Y = expr_2928_cp_0_cp_0.velocity.Y - 4f * this.gravDir;
					}
				}
				else if (item.type == 968)
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + (float)(8 * this.direction);
					if (this.whoAmI == Main.myPlayer)
					{
						int num49 = (int)(this.itemLocation.X + (float)Main.itemTexture[item.type].Width * 0.8f * (float)this.direction) / 16;
						int num50 = (int)(this.itemLocation.Y + num + (float)(Main.itemTexture[item.type].Height / 2)) / 16;
						if (Main.tile[num49, num50] == null)
						{
							Main.tile[num49, num50] = new Tile();
						}
						if (Main.tile[num49, num50].active() && Main.tile[num49, num50].type == 215 && Main.tile[num49, num50].frameY < 54)
						{
							this.miscTimer++;
							if (Main.rand.Next(5) == 0)
							{
								this.miscTimer++;
							}
							if (this.miscTimer > 900)
							{
								this.miscTimer = 0;
								item.SetDefaults(969, false);
								if (this.selectedItem == 58)
								{
									Main.mouseItem.SetDefaults(969, false);
								}
								for (int num51 = 0; num51 < 58; num51++)
								{
									if (this.inventory[num51].type == item.type && num51 != this.selectedItem && this.inventory[num51].stack < this.inventory[num51].maxStack)
									{
										Main.PlaySound(7, -1, -1, 1, 1f, 0f);
										this.inventory[num51].stack++;
										item.SetDefaults(0, false);
										if (this.selectedItem == 58)
										{
											Main.mouseItem.SetDefaults(0, false);
										}
									}
								}
							}
						}
						else
						{
							this.miscTimer = 0;
						}
					}
				}
				else if (item.type == 856)
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + (float)(4 * this.direction);
				}
				else if (item.fishingPole > 0)
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + (float)Main.itemTexture[item.type].Width * 0.18f * (float)this.direction;
				}
				else
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + ((float)Main.itemTexture[item.type].Width * 0.5f + 2f) * (float)this.direction;
					if (item.type == 282 || item.type == 286 || item.type == 3112)
					{
						this.itemLocation.X = this.itemLocation.X - (float)(this.direction * 2);
						this.itemLocation.Y = this.itemLocation.Y + 4f;
					}
					else if (item.type == 3002)
					{
						this.itemLocation.X = this.itemLocation.X - (float)(4 * this.direction);
						this.itemLocation.Y = this.itemLocation.Y + 2f;
					}
				}
				this.itemLocation.Y = this.position.Y + 24f + num;
				if (item.type == 856)
				{
					this.itemLocation.Y = this.position.Y + 34f + num;
				}
				if (item.type == 930)
				{
					this.itemLocation.Y = this.position.Y + 9f + num;
				}
				if (item.fishingPole > 0)
				{
					this.itemLocation.Y = this.itemLocation.Y + 4f;
				}
				else if (item.type == 3476)
				{
					this.itemLocation.X = base.Center.X + (float)(14 * this.direction);
					this.itemLocation.Y = this.MountedCenter.Y;
				}
				else if (item.type == 3779)
				{
					this.itemLocation.X = base.Center.X + (float)(6 * this.direction);
					this.itemLocation.Y = this.MountedCenter.Y + 6f;
				}
				else if (item.type == 353)
				{
					this.itemLocation.X = base.Center.X + (float)(8 * this.direction);
					this.itemLocation.Y = this.MountedCenter.Y + 11f;
				}
				this.itemRotation = 0f;
				if (this.gravDir == -1f)
				{
					this.itemRotation = -this.itemRotation;
					this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y) + num;
					if (item.type == 930)
					{
						this.itemLocation.Y = this.itemLocation.Y - 24f;
					}
				}
			}
			else if (item.holdStyle == 2 && !this.pulley)
			{
				if (item.type == 946)
				{
					this.itemRotation = 0f;
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f - (float)(16 * this.direction);
					this.itemLocation.Y = this.position.Y + 22f + num;
					this.fallStart = (int)(this.position.Y / 16f);
					if (this.gravDir == -1f)
					{
						this.itemRotation = -this.itemRotation;
						this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
						if (this.velocity.Y < -2f)
						{
							this.velocity.Y = -2f;
						}
					}
					else if (this.velocity.Y > 2f)
					{
						this.velocity.Y = 2f;
					}
				}
				else
				{
					this.itemLocation.X = this.position.X + (float)this.width * 0.5f + (float)(6 * this.direction);
					this.itemLocation.Y = this.position.Y + 16f + num;
					this.itemRotation = 0.79f * (float)(-(float)this.direction);
					if (this.gravDir == -1f)
					{
						this.itemRotation = -this.itemRotation;
						this.itemLocation.Y = this.position.Y + (float)this.height + (this.position.Y - this.itemLocation.Y);
					}
				}
			}
			else if (item.holdStyle == 3 && !this.pulley && !Main.dedServ)
			{
				this.itemLocation.X = this.position.X + (float)this.width * 0.5f - (float)Main.itemTexture[item.type].Width * 0.5f - (float)(this.direction * 2);
				this.itemLocation.Y = this.MountedCenter.Y - (float)Main.itemTexture[item.type].Height * 0.5f;
				this.itemRotation = 0f;
			}
			if ((((item.type == 974 || item.type == 8 || item.type == 1245 || item.type == 2274 || item.type == 3004 || item.type == 3045 || item.type == 3114 || (item.type >= 427 && item.type <= 433)) && !this.wet) || item.type == 523 || item.type == 1333) && !this.pulley)
			{
				float num52 = 1f;
				float num53 = 0.95f;
				float num54 = 0.8f;
				int num55 = 0;
				if (item.type == 523)
				{
					num55 = 8;
				}
				else if (item.type == 974)
				{
					num55 = 9;
				}
				else if (item.type == 1245)
				{
					num55 = 10;
				}
				else if (item.type == 1333)
				{
					num55 = 11;
				}
				else if (item.type == 2274)
				{
					num55 = 12;
				}
				else if (item.type == 3004)
				{
					num55 = 13;
				}
				else if (item.type == 3045)
				{
					num55 = 14;
				}
				else if (item.type == 3114)
				{
					num55 = 15;
				}
				else if (item.type >= 427)
				{
					num55 = item.type - 426;
				}
				if (num55 == 1)
				{
					num52 = 0f;
					num53 = 0.1f;
					num54 = 1.3f;
				}
				else if (num55 == 2)
				{
					num52 = 1f;
					num53 = 0.1f;
					num54 = 0.1f;
				}
				else if (num55 == 3)
				{
					num52 = 0f;
					num53 = 1f;
					num54 = 0.1f;
				}
				else if (num55 == 4)
				{
					num52 = 0.9f;
					num53 = 0f;
					num54 = 0.9f;
				}
				else if (num55 == 5)
				{
					num52 = 1.3f;
					num53 = 1.3f;
					num54 = 1.3f;
				}
				else if (num55 == 6)
				{
					num52 = 0.9f;
					num53 = 0.9f;
					num54 = 0f;
				}
				else if (num55 == 7)
				{
					num52 = 0.5f * Main.demonTorch + 1f * (1f - Main.demonTorch);
					num53 = 0.3f;
					num54 = 1f * Main.demonTorch + 0.5f * (1f - Main.demonTorch);
				}
				else if (num55 == 8)
				{
					num54 = 0.7f;
					num52 = 0.85f;
					num53 = 1f;
				}
				else if (num55 == 9)
				{
					num54 = 1f;
					num52 = 0.7f;
					num53 = 0.85f;
				}
				else if (num55 == 10)
				{
					num54 = 0f;
					num52 = 1f;
					num53 = 0.5f;
				}
				else if (num55 == 11)
				{
					num54 = 0.8f;
					num52 = 1.25f;
					num53 = 1.25f;
				}
				else if (num55 == 12)
				{
					num52 *= 0.75f;
					num53 *= 1.3499999f;
					num54 *= 1.5f;
				}
				else if (num55 == 13)
				{
					num52 = 0.95f;
					num53 = 0.65f;
					num54 = 1.3f;
				}
				else if (num55 == 14)
				{
					num52 = (float)Main.DiscoR / 255f;
					num53 = (float)Main.DiscoG / 255f;
					num54 = (float)Main.DiscoB / 255f;
				}
				else if (num55 == 15)
				{
					num52 = 1f;
					num53 = 0f;
					num54 = 1f;
				}
				int num56 = num55;
				if (num56 == 0)
				{
					num56 = 6;
				}
				else if (num56 == 8)
				{
					num56 = 75;
				}
				else if (num56 == 9)
				{
					num56 = 135;
				}
				else if (num56 == 10)
				{
					num56 = 158;
				}
				else if (num56 == 11)
				{
					num56 = 169;
				}
				else if (num56 == 12)
				{
					num56 = 156;
				}
				else if (num56 == 13)
				{
					num56 = 234;
				}
				else if (num56 == 14)
				{
					num56 = 66;
				}
				else if (num56 == 15)
				{
					num56 = 242;
				}
				else
				{
					num56 = 58 + num56;
				}
				int maxValue = 30;
				if (this.itemAnimation > 0)
				{
					maxValue = 7;
				}
				if (this.direction == -1)
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						int num57 = Dust.NewDust(new Vector2(this.itemLocation.X - 16f, this.itemLocation.Y - 14f * this.gravDir), 4, 4, num56, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num57].noGravity = true;
						}
						Main.dust[num57].velocity *= 0.3f;
						Dust expr_3641_cp_0_cp_0 = Main.dust[num57];
						expr_3641_cp_0_cp_0.velocity.Y = expr_3641_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num57].position = this.RotatedRelativePoint(Main.dust[num57].position, true);
						if (num56 == 66)
						{
							Main.dust[num57].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
							Main.dust[num57].noGravity = true;
						}
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 12f + this.velocity.X, this.itemLocation.Y - 14f + this.velocity.Y), true), num52, num53, num54);
				}
				else
				{
					if (Main.rand.Next(maxValue) == 0)
					{
						int num58 = Dust.NewDust(new Vector2(this.itemLocation.X + 6f, this.itemLocation.Y - 14f * this.gravDir), 4, 4, num56, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num58].noGravity = true;
						}
						Main.dust[num58].velocity *= 0.3f;
						Dust expr_37A5_cp_0_cp_0 = Main.dust[num58];
						expr_37A5_cp_0_cp_0.velocity.Y = expr_37A5_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num58].position = this.RotatedRelativePoint(Main.dust[num58].position, true);
						if (num56 == 66)
						{
							Main.dust[num58].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
							Main.dust[num58].noGravity = true;
						}
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 12f + this.velocity.X, this.itemLocation.Y - 14f + this.velocity.Y), true), num52, num53, num54);
				}
			}
			if ((item.type == 105 || item.type == 713) && !this.wet && !this.pulley)
			{
				int maxValue2 = 20;
				if (this.itemAnimation > 0)
				{
					maxValue2 = 7;
				}
				if (this.direction == -1)
				{
					if (Main.rand.Next(maxValue2) == 0)
					{
						int num59 = Dust.NewDust(new Vector2(this.itemLocation.X - 12f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 6, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num59].noGravity = true;
						}
						Main.dust[num59].velocity *= 0.3f;
						Dust expr_394F_cp_0_cp_0 = Main.dust[num59];
						expr_394F_cp_0_cp_0.velocity.Y = expr_394F_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num59].position = this.RotatedRelativePoint(Main.dust[num59].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 1f, 0.95f, 0.8f);
				}
				else
				{
					if (Main.rand.Next(maxValue2) == 0)
					{
						int num60 = Dust.NewDust(new Vector2(this.itemLocation.X + 4f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 6, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num60].noGravity = true;
						}
						Main.dust[num60].velocity *= 0.3f;
						Dust expr_3A7A_cp_0_cp_0 = Main.dust[num60];
						expr_3A7A_cp_0_cp_0.velocity.Y = expr_3A7A_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num60].position = this.RotatedRelativePoint(Main.dust[num60].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 1f, 0.95f, 0.8f);
				}
			}
			else if (item.type == 148 && !this.wet)
			{
				int maxValue3 = 10;
				if (this.itemAnimation > 0)
				{
					maxValue3 = 7;
				}
				if (this.direction == -1)
				{
					if (Main.rand.Next(maxValue3) == 0)
					{
						int num61 = Dust.NewDust(new Vector2(this.itemLocation.X - 12f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 172, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num61].noGravity = true;
						}
						Main.dust[num61].velocity *= 0.3f;
						Dust expr_3BE0_cp_0_cp_0 = Main.dust[num61];
						expr_3BE0_cp_0_cp_0.velocity.Y = expr_3BE0_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num61].position = this.RotatedRelativePoint(Main.dust[num61].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 0f, 0.5f, 1f);
				}
				else
				{
					if (Main.rand.Next(maxValue3) == 0)
					{
						int num62 = Dust.NewDust(new Vector2(this.itemLocation.X + 4f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 172, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num62].noGravity = true;
						}
						Main.dust[num62].velocity *= 0.3f;
						Dust expr_3D0F_cp_0_cp_0 = Main.dust[num62];
						expr_3D0F_cp_0_cp_0.velocity.Y = expr_3D0F_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num62].position = this.RotatedRelativePoint(Main.dust[num62].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 0f, 0.5f, 1f);
				}
			}
			else if (item.type == 3117 && !this.wet)
			{
				this.itemLocation.X = this.itemLocation.X - (float)(this.direction * 4);
				int maxValue4 = 10;
				if (this.itemAnimation > 0)
				{
					maxValue4 = 7;
				}
				if (this.direction == -1)
				{
					if (Main.rand.Next(maxValue4) == 0)
					{
						int num63 = Dust.NewDust(new Vector2(this.itemLocation.X - 10f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 242, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num63].noGravity = true;
						}
						Main.dust[num63].velocity *= 0.3f;
						Dust expr_3E8D_cp_0_cp_0 = Main.dust[num63];
						expr_3E8D_cp_0_cp_0.velocity.Y = expr_3E8D_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num63].position = this.RotatedRelativePoint(Main.dust[num63].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.9f, 0.1f, 0.75f);
				}
				else
				{
					if (Main.rand.Next(maxValue4) == 0)
					{
						int num64 = Dust.NewDust(new Vector2(this.itemLocation.X + 6f, this.itemLocation.Y - 20f * this.gravDir), 4, 4, 242, 0f, 0f, 100, default(Color), 1f);
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num64].noGravity = true;
						}
						Main.dust[num64].velocity *= 0.3f;
						Dust expr_3FBC_cp_0_cp_0 = Main.dust[num64];
						expr_3FBC_cp_0_cp_0.velocity.Y = expr_3FBC_cp_0_cp_0.velocity.Y - 1.5f;
						Main.dust[num64].position = this.RotatedRelativePoint(Main.dust[num64].position, true);
					}
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.9f, 0.1f, 0.75f);
				}
			}
			if (item.type == 282 && !this.pulley)
			{
				if (this.direction == -1)
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.7f, 1f, 0.8f);
				}
				else
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.7f, 1f, 0.8f);
				}
			}
			if (item.type == 3002 && !this.pulley)
			{
				float r = 1.05f;
				float g = 0.95f;
				float b = 0.55f;
				if (this.direction == -1)
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), r, g, b);
				}
				else
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), r, g, b);
				}
				this.spelunkerTimer += 1;
				if (this.spelunkerTimer >= 10)
				{
					this.spelunkerTimer = 0;
					int num65 = 30;
					int num66 = (int)base.Center.X / 16;
					int num67 = (int)base.Center.Y / 16;
					for (int num68 = num66 - num65; num68 <= num66 + num65; num68++)
					{
						for (int num69 = num67 - num65; num69 <= num67 + num65; num69++)
						{
							if (Main.rand.Next(4) == 0)
							{
								Vector2 vector = new Vector2((float)(num66 - num68), (float)(num67 - num69));
								if (vector.Length() < (float)num65 && num68 > 0 && num68 < Main.maxTilesX - 1 && num69 > 0 && num69 < Main.maxTilesY - 1 && Main.tile[num68, num69] != null && Main.tile[num68, num69].active())
								{
									bool flag7 = false;
									if (Main.tile[num68, num69].type == 185 && Main.tile[num68, num69].frameY == 18)
									{
										if (Main.tile[num68, num69].frameX >= 576 && Main.tile[num68, num69].frameX <= 882)
										{
											flag7 = true;
										}
									}
									else if (Main.tile[num68, num69].type == 186 && Main.tile[num68, num69].frameX >= 864 && Main.tile[num68, num69].frameX <= 1170)
									{
										flag7 = true;
									}
									if (flag7 || Main.tileSpelunker[(int)Main.tile[num68, num69].type] || (Main.tileAlch[(int)Main.tile[num68, num69].type] && Main.tile[num68, num69].type != 82))
									{
										int num70 = Dust.NewDust(new Vector2((float)(num68 * 16), (float)(num69 * 16)), 16, 16, 204, 0f, 0f, 150, default(Color), 0.3f);
										Main.dust[num70].fadeIn = 0.75f;
										Main.dust[num70].velocity *= 0.1f;
										Main.dust[num70].noLight = true;
									}
								}
							}
						}
					}
				}
			}
			if (item.type == 286 && !this.pulley)
			{
				if (this.direction == -1)
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.7f, 0.8f, 1f);
				}
				else
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 0.7f, 0.8f, 1f);
				}
			}
			if (item.type == 3112 && !this.pulley)
			{
				if (this.direction == -1)
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X - 16f + this.velocity.X, this.itemLocation.Y - 14f), true), 1f, 0.6f, 0.85f);
				}
				else
				{
					Lighting.AddLight(this.RotatedRelativePoint(new Vector2(this.itemLocation.X + 6f + this.velocity.X, this.itemLocation.Y - 14f), true), 1f, 0.6f, 0.85f);
				}
			}
			if (this.controlUseItem)
			{
				this.releaseUseItem = false;
			}
			else
			{
				this.releaseUseItem = true;
			}
			if (this.itemTime > 0)
			{
				this.itemTime--;
				if (this.itemTime == 0 && this.whoAmI == Main.myPlayer)
				{
					int type2 = item.type;
					if (type2 == 65 || type2 == 676 || type2 == 723 || type2 == 724 || type2 == 989 || type2 == 1226 || type2 == 1227)
					{
						Main.PlaySound(25, -1, -1, 1, 1f, 0f);
						for (int num71 = 0; num71 < 5; num71++)
						{
							int num72 = Dust.NewDust(this.position, this.width, this.height, 45, 0f, 0f, 255, default(Color), (float)Main.rand.Next(20, 26) * 0.1f);
							Main.dust[num72].noLight = true;
							Main.dust[num72].noGravity = true;
							Main.dust[num72].velocity *= 0.5f;
						}
					}
				}
			}
			if (i == Main.myPlayer)
			{
				bool flag8 = true;
				int type3 = item.type;
				if ((type3 == 65 || type3 == 676 || type3 == 723 || type3 == 724 || type3 == 757 || type3 == 674 || type3 == 675 || type3 == 989 || type3 == 1226 || type3 == 1227) && this.itemAnimation != this.itemAnimationMax - 1)
				{
					flag8 = false;
				}
				if (type3 == 3852)
				{
					if (this.itemAnimation < this.itemAnimationMax - 12)
					{
						flag8 = false;
					}
					if (this.altFunctionUse == 2 && this.itemAnimation != this.itemAnimationMax - 1)
					{
						flag8 = false;
					}
				}
				if (item.shoot > 0 && ProjectileID.Sets.TurretFeature[item.shoot] && this.altFunctionUse == 2 && flag8 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					for (int num73 = 0; num73 < 1000; num73++)
					{
						Projectile projectile2 = Main.projectile[num73];
						if (projectile2.active && projectile2.owner == Main.myPlayer && ProjectileID.Sets.TurretFeature[projectile2.type])
						{
							projectile2.Kill();
						}
					}
				}
				if (item.shoot > 0 && ProjectileID.Sets.MinionTargettingFeature[item.shoot] && this.altFunctionUse == 2 && flag8 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					this.MinionNPCTargetAim();
				}
				if ((item.shoot > 0 && this.itemAnimation > 0 && this.itemTime == 0) & flag8)
				{
					int num74 = item.shoot;
					float num75 = item.shootSpeed;
					if (this.inventory[this.selectedItem].thrown && num75 < 16f)
					{
						num75 *= this.thrownVelocity;
						if (num75 > 16f)
						{
							num75 = 16f;
						}
					}
					if (item.melee && num74 != 25 && num74 != 26 && num74 != 35)
					{
						num75 /= this.meleeSpeed;
					}
					bool flag9 = false;
					int num76 = weaponDamage;
					float num77 = item.knockBack;
					if (num74 == 13 || num74 == 32 || num74 == 315 || (num74 >= 230 && num74 <= 235) || num74 == 331)
					{
						this.grappling[0] = -1;
						this.grapCount = 0;
						for (int num78 = 0; num78 < 1000; num78++)
						{
							if (Main.projectile[num78].active && Main.projectile[num78].owner == i)
							{
								if (Main.projectile[num78].type == 13)
								{
									Main.projectile[num78].Kill();
								}
								if (Main.projectile[num78].type == 331)
								{
									Main.projectile[num78].Kill();
								}
								if (Main.projectile[num78].type == 315)
								{
									Main.projectile[num78].Kill();
								}
								if (Main.projectile[num78].type >= 230 && Main.projectile[num78].type <= 235)
								{
									Main.projectile[num78].Kill();
								}
							}
						}
					}
					if (item.useAmmo > 0)
					{
						this.PickAmmo(item, ref num74, ref num75, ref flag9, ref num76, ref num77, ItemID.Sets.gunProj[item.type]);
					}
					else
					{
						flag9 = true;
					}
					if (ItemID.Sets.gunProj[item.type])
					{
						num77 = item.knockBack;
						num76 = weaponDamage;
						num75 = item.shootSpeed;
					}
					if (item.type == 71)
					{
						flag9 = false;
					}
					if (item.type == 72)
					{
						flag9 = false;
					}
					if (item.type == 73)
					{
						flag9 = false;
					}
					if (item.type == 74)
					{
						flag9 = false;
					}
					if (item.type == 1254 && num74 == 14)
					{
						num74 = 242;
					}
					if (item.type == 1255 && num74 == 14)
					{
						num74 = 242;
					}
					if (item.type == 1265 && num74 == 14)
					{
						num74 = 242;
					}
					if (item.type == 3542)
					{
						if (Main.rand.Next(100) < 20)
						{
							num74++;
							num76 *= 3;
						}
						else
						{
							num75 -= 1f;
						}
					}
					if (num74 == 73)
					{
						for (int num79 = 0; num79 < 1000; num79++)
						{
							if (Main.projectile[num79].active && Main.projectile[num79].owner == i)
							{
								if (Main.projectile[num79].type == 73)
								{
									num74 = 74;
								}
								if (num74 == 74 && Main.projectile[num79].type == 74)
								{
									flag9 = false;
								}
							}
						}
					}
					if (flag9)
					{
						num77 = this.GetWeaponKnockback(item, num77);
						if (num74 == 228)
						{
							num77 = 0f;
						}
						if (num74 == 1 && item.type == 120)
						{
							num74 = 2;
						}
						if (item.type == 682)
						{
							num74 = 117;
						}
						if (item.type == 725)
						{
							num74 = 120;
						}
						if (item.type == 2796)
						{
							num74 = 442;
						}
						if (item.type == 2223)
						{
							num74 = 357;
						}
						this.itemTime = item.useTime;
						Vector2 vector2 = this.RotatedRelativePoint(this.MountedCenter, true);
						bool flag10 = true;
						int num80 = item.type;
						if (num80 == 3611)
						{
							flag10 = false;
						}
						Vector2 arg_4CE5_0 = Vector2.UnitX.RotatedBy((double)this.fullRotation, default(Vector2));
						Vector2 vector3 = Main.MouseWorld - vector2;
						Vector2 vector4 = this.itemRotation.ToRotationVector2() * (float)this.direction;
						if (item.type == 3852 && this.itemAnimation != this.itemAnimationMax - 1)
						{
							vector3 = vector4;
						}
						if (vector3 != Vector2.Zero)
						{
							vector3.Normalize();
						}
						float num81 = Vector2.Dot(arg_4CE5_0, vector3);
						if (flag10)
						{
							if (num81 > 0f)
							{
								this.ChangeDir(1);
							}
							else
							{
								this.ChangeDir(-1);
							}
						}
						if (item.type == 3094 || item.type == 3378 || item.type == 3543)
						{
							vector2.Y = this.position.Y + (float)(this.height / 3);
						}
						if (item.type == 2611)
						{
							Vector2 vector5 = vector3;
							if (vector5 != Vector2.Zero)
							{
								vector5.Normalize();
							}
							vector2 += vector5;
						}
						if (item.type == 3827)
						{
							vector2 += vector3.SafeNormalize(Vector2.Zero).RotatedBy((double)((float)this.direction * -1.57079637f), default(Vector2)) * 24f;
						}
						if (num74 == 9)
						{
							vector2 = new Vector2(this.position.X + (float)this.width * 0.5f + (float)(Main.rand.Next(201) * -(float)this.direction) + ((float)Main.mouseX + Main.screenPosition.X - this.position.X), this.MountedCenter.Y - 600f);
							num77 = 0f;
							num76 *= 2;
						}
						if (item.type == 986 || item.type == 281)
						{
							vector2.X += (float)(6 * this.direction);
							vector2.Y -= 6f * this.gravDir;
						}
						if (item.type == 3007)
						{
							vector2.X -= (float)(4 * this.direction);
							vector2.Y -= 1f * this.gravDir;
						}
						float num82 = (float)Main.mouseX + Main.screenPosition.X - vector2.X;
						float num83 = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y;
						if (item.type == 3852 && this.itemAnimation != this.itemAnimationMax - 1)
						{
							Vector2 expr_4F13 = vector4;
							num82 = expr_4F13.X;
							num83 = expr_4F13.Y;
						}
						if (this.gravDir == -1f)
						{
							num83 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector2.Y;
						}
						float num84 = (float)Math.Sqrt((double)(num82 * num82 + num83 * num83));
						float num85 = num84;
						if ((float.IsNaN(num82) && float.IsNaN(num83)) || (num82 == 0f && num83 == 0f))
						{
							num82 = (float)this.direction;
							num83 = 0f;
							num84 = num75;
						}
						else
						{
							num84 = num75 / num84;
						}
						if (item.type == 1929 || item.type == 2270)
						{
							num82 += (float)Main.rand.Next(-50, 51) * 0.03f / num84;
							num83 += (float)Main.rand.Next(-50, 51) * 0.03f / num84;
						}
						num82 *= num84;
						num83 *= num84;
						if (item.type == 757)
						{
							num76 = (int)((float)num76 * 1.25f);
						}
						if (num74 == 250)
						{
							for (int num86 = 0; num86 < 1000; num86++)
							{
								if (Main.projectile[num86].active && Main.projectile[num86].owner == this.whoAmI && (Main.projectile[num86].type == 250 || Main.projectile[num86].type == 251))
								{
									Main.projectile[num86].Kill();
								}
							}
						}
						if (num74 == 12)
						{
							vector2.X += num82 * 3f;
							vector2.Y += num83 * 3f;
						}
						if (item.useStyle == 5)
						{
							if (item.type == 3029)
							{
								Vector2 vector6 = new Vector2(num82, num83);
								vector6.X = (float)Main.mouseX + Main.screenPosition.X - vector2.X;
								vector6.Y = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y - 1000f;
								this.itemRotation = (float)Math.Atan2((double)(vector6.Y * (float)this.direction), (double)(vector6.X * (float)this.direction));
								NetMessage.SendData(13, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
								NetMessage.SendData(41, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
							}
							else if (item.type == 3779)
							{
								this.itemRotation = 0f;
								NetMessage.SendData(13, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
								NetMessage.SendData(41, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
							}
							else
							{
								this.itemRotation = (float)Math.Atan2((double)(num83 * (float)this.direction), (double)(num82 * (float)this.direction)) - this.fullRotation;
								NetMessage.SendData(13, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
								NetMessage.SendData(41, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
							}
						}
						if (num74 == 17)
						{
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							if (this.gravDir == -1f)
							{
								vector2.Y = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY;
							}
						}
						if (num74 == 76)
						{
							num74 += Main.rand.Next(3);
							num85 /= (float)(Main.screenHeight / 2);
							if (num85 > 1f)
							{
								num85 = 1f;
							}
							float num87 = num82 + (float)Main.rand.Next(-40, 41) * 0.01f;
							float num88 = num83 + (float)Main.rand.Next(-40, 41) * 0.01f;
							num87 *= num85 + 0.25f;
							num88 *= num85 + 0.25f;
							int num89 = Projectile.NewProjectile(vector2.X, vector2.Y, num87, num88, num74, num76, num77, i, 0f, 0f);
							Main.projectile[num89].ai[1] = 1f;
							num85 = num85 * 2f - 1f;
							if (num85 < -1f)
							{
								num85 = -1f;
							}
							if (num85 > 1f)
							{
								num85 = 1f;
							}
							Main.projectile[num89].ai[0] = num85;
							NetMessage.SendData(27, -1, -1, null, num89, 0f, 0f, 0f, 0, 0, 0);
						}
						else if (item.type == 3029)
						{
							int num90 = 3;
							if (Main.rand.Next(3) == 0)
							{
								num90++;
							}
							for (int num91 = 0; num91 < num90; num91++)
							{
								vector2 = new Vector2(this.position.X + (float)this.width * 0.5f + (float)(Main.rand.Next(201) * -(float)this.direction) + ((float)Main.mouseX + Main.screenPosition.X - this.position.X), this.MountedCenter.Y - 600f);
								vector2.X = (vector2.X * 10f + base.Center.X) / 11f + (float)Main.rand.Next(-100, 101);
								vector2.Y -= (float)(150 * num91);
								num82 = (float)Main.mouseX + Main.screenPosition.X - vector2.X;
								num83 = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y;
								if (num83 < 0f)
								{
									num83 *= -1f;
								}
								if (num83 < 20f)
								{
									num83 = 20f;
								}
								num84 = (float)Math.Sqrt((double)(num82 * num82 + num83 * num83));
								num84 = num75 / num84;
								num82 *= num84;
								num83 *= num84;
								float num92 = num82 + (float)Main.rand.Next(-40, 41) * 0.03f;
								float speedY = num83 + (float)Main.rand.Next(-40, 41) * 0.03f;
								num92 *= (float)Main.rand.Next(75, 150) * 0.01f;
								vector2.X += (float)Main.rand.Next(-50, 51);
								int num93 = Projectile.NewProjectile(vector2.X, vector2.Y, num92, speedY, num74, num76, num77, i, 0f, 0f);
								Main.projectile[num93].noDropItem = true;
							}
						}
						else if (item.type == 98 || item.type == 533)
						{
							float speedX = num82 + (float)Main.rand.Next(-40, 41) * 0.01f;
							float speedY2 = num83 + (float)Main.rand.Next(-40, 41) * 0.01f;
							Projectile.NewProjectile(vector2.X, vector2.Y, speedX, speedY2, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 1319)
						{
							float speedX2 = num82 + (float)Main.rand.Next(-40, 41) * 0.02f;
							float speedY3 = num83 + (float)Main.rand.Next(-40, 41) * 0.02f;
							int num94 = Projectile.NewProjectile(vector2.X, vector2.Y, speedX2, speedY3, num74, num76, num77, i, 0f, 0f);
							Main.projectile[num94].ranged = true;
							Main.projectile[num94].thrown = false;
						}
						else if (item.type == 3107)
						{
							float speedX3 = num82 + (float)Main.rand.Next(-40, 41) * 0.02f;
							float speedY4 = num83 + (float)Main.rand.Next(-40, 41) * 0.02f;
							Projectile.NewProjectile(vector2.X, vector2.Y, speedX3, speedY4, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3053)
						{
							Vector2 vector7 = new Vector2(num82, num83);
							vector7.Normalize();
							Vector2 value = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
							value.Normalize();
							vector7 = vector7 * 4f + value;
							vector7.Normalize();
							vector7 *= item.shootSpeed;
							float num95 = (float)Main.rand.Next(10, 80) * 0.001f;
							if (Main.rand.Next(2) == 0)
							{
								num95 *= -1f;
							}
							float num96 = (float)Main.rand.Next(10, 80) * 0.001f;
							if (Main.rand.Next(2) == 0)
							{
								num96 *= -1f;
							}
							Projectile.NewProjectile(vector2.X, vector2.Y, vector7.X, vector7.Y, num74, num76, num77, i, num96, num95);
						}
						else if (item.type == 3019)
						{
							Vector2 vector8 = new Vector2(num82, num83);
							float num97 = vector8.Length();
							vector8.X += (float)Main.rand.Next(-100, 101) * 0.01f * num97 * 0.15f;
							vector8.Y += (float)Main.rand.Next(-100, 101) * 0.01f * num97 * 0.15f;
							float num98 = num82 + (float)Main.rand.Next(-40, 41) * 0.03f;
							float num99 = num83 + (float)Main.rand.Next(-40, 41) * 0.03f;
							vector8.Normalize();
							vector8 *= num97;
							num98 *= (float)Main.rand.Next(50, 150) * 0.01f;
							num99 *= (float)Main.rand.Next(50, 150) * 0.01f;
							Vector2 vector9 = new Vector2(num98, num99);
							vector9.X += (float)Main.rand.Next(-100, 101) * 0.025f;
							vector9.Y += (float)Main.rand.Next(-100, 101) * 0.025f;
							vector9.Normalize();
							vector9 *= num97;
							num98 = vector9.X;
							num99 = vector9.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num98, num99, num74, num76, num77, i, vector8.X, vector8.Y);
						}
						else if (item.type == 2797)
						{
							Vector2 value2 = Vector2.Normalize(new Vector2(num82, num83)) * 40f * item.scale;
							if (Collision.CanHit(vector2, 0, 0, vector2 + value2, 0, 0))
							{
								vector2 += value2;
							}
							float ai = new Vector2(num82, num83).ToRotation();
							float num100 = 2.09439516f;
							int num101 = Main.rand.Next(4, 5);
							if (Main.rand.Next(4) == 0)
							{
								num101++;
							}
							for (int num102 = 0; num102 < num101; num102++)
							{
								float scaleFactor2 = (float)Main.rand.NextDouble() * 0.2f + 0.05f;
								Vector2 vector10 = new Vector2(num82, num83).RotatedBy((double)(num100 * (float)Main.rand.NextDouble() - num100 / 2f), default(Vector2)) * scaleFactor2;
								int num103 = Projectile.NewProjectile(vector2.X, vector2.Y, vector10.X, vector10.Y, 444, num76, num77, i, ai, 0f);
								Main.projectile[num103].localAI[0] = (float)num74;
								Main.projectile[num103].localAI[1] = num75;
							}
						}
						else if (item.type == 2270)
						{
							float num104 = num82 + (float)Main.rand.Next(-40, 41) * 0.05f;
							float num105 = num83 + (float)Main.rand.Next(-40, 41) * 0.05f;
							if (Main.rand.Next(3) == 0)
							{
								num104 *= 1f + (float)Main.rand.Next(-30, 31) * 0.02f;
								num105 *= 1f + (float)Main.rand.Next(-30, 31) * 0.02f;
							}
							Projectile.NewProjectile(vector2.X, vector2.Y, num104, num105, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 1930)
						{
							int num106 = 2 + Main.rand.Next(3);
							for (int num107 = 0; num107 < num106; num107++)
							{
								float num108 = num82;
								float num109 = num83;
								float num110 = 0.025f * (float)num107;
								num108 += (float)Main.rand.Next(-35, 36) * num110;
								num109 += (float)Main.rand.Next(-35, 36) * num110;
								num84 = (float)Math.Sqrt((double)(num108 * num108 + num109 * num109));
								num84 = num75 / num84;
								num108 *= num84;
								num109 *= num84;
								float arg_5D1F_0 = vector2.X + num82 * (float)(num106 - num107) * 1.75f;
								float y = vector2.Y + num83 * (float)(num106 - num107) * 1.75f;
								Projectile.NewProjectile(arg_5D1F_0, y, num108, num109, num74, num76, num77, i, (float)Main.rand.Next(0, 10 * (num107 + 1)), 0f);
							}
						}
						else if (item.type == 1931)
						{
							int num111 = 2;
							for (int num112 = 0; num112 < num111; num112++)
							{
								vector2 = new Vector2(this.position.X + (float)this.width * 0.5f + (float)(Main.rand.Next(201) * -(float)this.direction) + ((float)Main.mouseX + Main.screenPosition.X - this.position.X), this.MountedCenter.Y - 600f);
								vector2.X = (vector2.X + base.Center.X) / 2f + (float)Main.rand.Next(-200, 201);
								vector2.Y -= (float)(100 * num112);
								num82 = (float)Main.mouseX + Main.screenPosition.X - vector2.X;
								num83 = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y;
								if (num83 < 0f)
								{
									num83 *= -1f;
								}
								if (num83 < 20f)
								{
									num83 = 20f;
								}
								num84 = (float)Math.Sqrt((double)(num82 * num82 + num83 * num83));
								num84 = num75 / num84;
								num82 *= num84;
								num83 *= num84;
								float speedX4 = num82 + (float)Main.rand.Next(-40, 41) * 0.02f;
								float speedY5 = num83 + (float)Main.rand.Next(-40, 41) * 0.02f;
								Projectile.NewProjectile(vector2.X, vector2.Y, speedX4, speedY5, num74, num76, num77, i, 0f, (float)Main.rand.Next(5));
							}
						}
						else if (item.type == 2750)
						{
							int num113 = 1;
							for (int num114 = 0; num114 < num113; num114++)
							{
								vector2 = new Vector2(this.position.X + (float)this.width * 0.5f + (float)(Main.rand.Next(201) * -(float)this.direction) + ((float)Main.mouseX + Main.screenPosition.X - this.position.X), this.MountedCenter.Y - 600f);
								vector2.X = (vector2.X + base.Center.X) / 2f + (float)Main.rand.Next(-200, 201);
								vector2.Y -= (float)(100 * num114);
								num82 = (float)Main.mouseX + Main.screenPosition.X - vector2.X + (float)Main.rand.Next(-40, 41) * 0.03f;
								num83 = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y;
								if (num83 < 0f)
								{
									num83 *= -1f;
								}
								if (num83 < 20f)
								{
									num83 = 20f;
								}
								num84 = (float)Math.Sqrt((double)(num82 * num82 + num83 * num83));
								num84 = num75 / num84;
								num82 *= num84;
								num83 *= num84;
								float num115 = num82;
								float num116 = num83 + (float)Main.rand.Next(-40, 41) * 0.02f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num115 * 0.75f, num116 * 0.75f, num74 + Main.rand.Next(3), num76, num77, i, 0f, 0.5f + (float)Main.rand.NextDouble() * 0.3f);
							}
						}
						else if (item.type == 3570)
						{
							int num117 = 3;
							for (int num118 = 0; num118 < num117; num118++)
							{
								vector2 = new Vector2(this.position.X + (float)this.width * 0.5f + (float)(Main.rand.Next(201) * -(float)this.direction) + ((float)Main.mouseX + Main.screenPosition.X - this.position.X), this.MountedCenter.Y - 600f);
								vector2.X = (vector2.X + base.Center.X) / 2f + (float)Main.rand.Next(-200, 201);
								vector2.Y -= (float)(100 * num118);
								num82 = (float)Main.mouseX + Main.screenPosition.X - vector2.X;
								num83 = (float)Main.mouseY + Main.screenPosition.Y - vector2.Y;
								float ai2 = num83 + vector2.Y;
								if (num83 < 0f)
								{
									num83 *= -1f;
								}
								if (num83 < 20f)
								{
									num83 = 20f;
								}
								num84 = (float)Math.Sqrt((double)(num82 * num82 + num83 * num83));
								num84 = num75 / num84;
								num82 *= num84;
								num83 *= num84;
								Vector2 vector11 = new Vector2(num82, num83) / 2f;
								Projectile.NewProjectile(vector2.X, vector2.Y, vector11.X, vector11.Y, num74, num76, num77, i, 0f, ai2);
							}
						}
						else if (item.type == 3065)
						{
							Vector2 vector12 = Main.screenPosition + new Vector2((float)Main.mouseX, (float)Main.mouseY);
							float num119 = vector12.Y;
							if (num119 > base.Center.Y - 200f)
							{
								num119 = base.Center.Y - 200f;
							}
							for (int num120 = 0; num120 < 3; num120++)
							{
								vector2 = base.Center + new Vector2((float)(-(float)Main.rand.Next(0, 401) * this.direction), -600f);
								vector2.Y -= (float)(100 * num120);
								Vector2 vector13 = vector12 - vector2;
								if (vector13.Y < 0f)
								{
									vector13.Y *= -1f;
								}
								if (vector13.Y < 20f)
								{
									vector13.Y = 20f;
								}
								vector13.Normalize();
								vector13 *= num75;
								num82 = vector13.X;
								num83 = vector13.Y;
								float speedX5 = num82;
								float speedY6 = num83 + (float)Main.rand.Next(-40, 41) * 0.02f;
								Projectile.NewProjectile(vector2.X, vector2.Y, speedX5, speedY6, num74, num76 * 2, num77, i, 0f, num119);
							}
						}
						else if (item.type == 2624)
						{
							float num121 = 0.314159274f;
							int num122 = 5;
							Vector2 vector14 = new Vector2(num82, num83);
							vector14.Normalize();
							vector14 *= 40f;
							bool flag11 = Collision.CanHit(vector2, 0, 0, vector2 + vector14, 0, 0);
							for (int num123 = 0; num123 < num122; num123++)
							{
								float num124 = (float)num123 - ((float)num122 - 1f) / 2f;
								Vector2 vector15 = vector14.RotatedBy((double)(num121 * num124), default(Vector2));
								if (!flag11)
								{
									vector15 -= vector14;
								}
								int num125 = Projectile.NewProjectile(vector2.X + vector15.X, vector2.Y + vector15.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
								Main.projectile[num125].noDropItem = true;
							}
						}
						else if (item.type == 1929)
						{
							float speedX6 = num82 + (float)Main.rand.Next(-40, 41) * 0.03f;
							float speedY7 = num83 + (float)Main.rand.Next(-40, 41) * 0.03f;
							Projectile.NewProjectile(vector2.X, vector2.Y, speedX6, speedY7, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 1553)
						{
							float speedX7 = num82 + (float)Main.rand.Next(-40, 41) * 0.005f;
							float speedY8 = num83 + (float)Main.rand.Next(-40, 41) * 0.005f;
							Projectile.NewProjectile(vector2.X, vector2.Y, speedX7, speedY8, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 518)
						{
							float num126 = num82;
							float num127 = num83;
							num126 += (float)Main.rand.Next(-40, 41) * 0.04f;
							num127 += (float)Main.rand.Next(-40, 41) * 0.04f;
							Projectile.NewProjectile(vector2.X, vector2.Y, num126, num127, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 1265)
						{
							float num128 = num82;
							float num129 = num83;
							num128 += (float)Main.rand.Next(-30, 31) * 0.03f;
							num129 += (float)Main.rand.Next(-30, 31) * 0.03f;
							Projectile.NewProjectile(vector2.X, vector2.Y, num128, num129, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 534)
						{
							int num130 = Main.rand.Next(4, 6);
							for (int num131 = 0; num131 < num130; num131++)
							{
								float num132 = num82;
								float num133 = num83;
								num132 += (float)Main.rand.Next(-40, 41) * 0.05f;
								num133 += (float)Main.rand.Next(-40, 41) * 0.05f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num132, num133, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 2188)
						{
							int num134 = 4;
							if (Main.rand.Next(3) == 0)
							{
								num134++;
							}
							if (Main.rand.Next(4) == 0)
							{
								num134++;
							}
							if (Main.rand.Next(5) == 0)
							{
								num134++;
							}
							for (int num135 = 0; num135 < num134; num135++)
							{
								float num136 = num82;
								float num137 = num83;
								float num138 = 0.05f * (float)num135;
								num136 += (float)Main.rand.Next(-35, 36) * num138;
								num137 += (float)Main.rand.Next(-35, 36) * num138;
								num84 = (float)Math.Sqrt((double)(num136 * num136 + num137 * num137));
								num84 = num75 / num84;
								num136 *= num84;
								num137 *= num84;
								float arg_6837_0 = vector2.X;
								float y2 = vector2.Y;
								Projectile.NewProjectile(arg_6837_0, y2, num136, num137, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 1308)
						{
							int num139 = 3;
							if (Main.rand.Next(3) == 0)
							{
								num139++;
							}
							for (int num140 = 0; num140 < num139; num140++)
							{
								float num141 = num82;
								float num142 = num83;
								float num143 = 0.05f * (float)num140;
								num141 += (float)Main.rand.Next(-35, 36) * num143;
								num142 += (float)Main.rand.Next(-35, 36) * num143;
								num84 = (float)Math.Sqrt((double)(num141 * num141 + num142 * num142));
								num84 = num75 / num84;
								num141 *= num84;
								num142 *= num84;
								float arg_6910_0 = vector2.X;
								float y3 = vector2.Y;
								Projectile.NewProjectile(arg_6910_0, y3, num141, num142, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 1258)
						{
							float num144 = num82;
							float num145 = num83;
							num144 += (float)Main.rand.Next(-40, 41) * 0.01f;
							num145 += (float)Main.rand.Next(-40, 41) * 0.01f;
							vector2.X += (float)Main.rand.Next(-40, 41) * 0.05f;
							vector2.Y += (float)Main.rand.Next(-45, 36) * 0.05f;
							Projectile.NewProjectile(vector2.X, vector2.Y, num144, num145, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 964)
						{
							int num146 = Main.rand.Next(3, 5);
							for (int num147 = 0; num147 < num146; num147++)
							{
								float num148 = num82;
								float num149 = num83;
								num148 += (float)Main.rand.Next(-35, 36) * 0.04f;
								num149 += (float)Main.rand.Next(-35, 36) * 0.04f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num148, num149, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 1569)
						{
							int num150 = 4;
							if (Main.rand.Next(2) == 0)
							{
								num150++;
							}
							if (Main.rand.Next(4) == 0)
							{
								num150++;
							}
							if (Main.rand.Next(8) == 0)
							{
								num150++;
							}
							if (Main.rand.Next(16) == 0)
							{
								num150++;
							}
							for (int num151 = 0; num151 < num150; num151++)
							{
								float num152 = num82;
								float num153 = num83;
								float num154 = 0.05f * (float)num151;
								num152 += (float)Main.rand.Next(-35, 36) * num154;
								num153 += (float)Main.rand.Next(-35, 36) * num154;
								num84 = (float)Math.Sqrt((double)(num152 * num152 + num153 * num153));
								num84 = num75 / num84;
								num152 *= num84;
								num153 *= num84;
								float arg_6B76_0 = vector2.X;
								float y4 = vector2.Y;
								Projectile.NewProjectile(arg_6B76_0, y4, num152, num153, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 1572 || item.type == 2366 || item.type == 3571 || item.type == 3569)
						{
							bool arg_6C3D_0 = item.type == 3571 || item.type == 3569;
							int num155 = (int)((float)Main.mouseX + Main.screenPosition.X) / 16;
							int num156 = (int)((float)Main.mouseY + Main.screenPosition.Y) / 16;
							if (this.gravDir == -1f)
							{
								num156 = (int)(Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16;
							}
							if (!arg_6C3D_0)
							{
								while (num156 < Main.maxTilesY - 10 && Main.tile[num155, num156] != null && !WorldGen.SolidTile2(num155, num156) && Main.tile[num155 - 1, num156] != null && !WorldGen.SolidTile2(num155 - 1, num156) && Main.tile[num155 + 1, num156] != null && !WorldGen.SolidTile2(num155 + 1, num156))
								{
									num156++;
								}
								num156--;
							}
							Projectile.NewProjectile((float)Main.mouseX + Main.screenPosition.X, (float)(num156 * 16 - 24), 0f, 15f, num74, num76, num77, i, 0f, 0f);
							this.UpdateMaxTurrets();
						}
						else if (item.type == 1244 || item.type == 1256)
						{
							int num157 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
							Main.projectile[num157].ai[0] = (float)Main.mouseX + Main.screenPosition.X;
							Main.projectile[num157].ai[1] = (float)Main.mouseY + Main.screenPosition.Y;
						}
						else if (item.type == 1229)
						{
							int num158 = Main.rand.Next(2, 4);
							if (Main.rand.Next(5) == 0)
							{
								num158++;
							}
							for (int num159 = 0; num159 < num158; num159++)
							{
								float num160 = num82;
								float num161 = num83;
								if (num159 > 0)
								{
									num160 += (float)Main.rand.Next(-35, 36) * 0.04f;
									num161 += (float)Main.rand.Next(-35, 36) * 0.04f;
								}
								if (num159 > 1)
								{
									num160 += (float)Main.rand.Next(-35, 36) * 0.04f;
									num161 += (float)Main.rand.Next(-35, 36) * 0.04f;
								}
								if (num159 > 2)
								{
									num160 += (float)Main.rand.Next(-35, 36) * 0.04f;
									num161 += (float)Main.rand.Next(-35, 36) * 0.04f;
								}
								int num162 = Projectile.NewProjectile(vector2.X, vector2.Y, num160, num161, num74, num76, num77, i, 0f, 0f);
								Main.projectile[num162].noDropItem = true;
							}
						}
						else if (item.type == 1121)
						{
							int num163 = Main.rand.Next(1, 4);
							if (Main.rand.Next(6) == 0)
							{
								num163++;
							}
							if (Main.rand.Next(6) == 0)
							{
								num163++;
							}
							if (this.strongBees && Main.rand.Next(3) == 0)
							{
								num163++;
							}
							for (int num164 = 0; num164 < num163; num164++)
							{
								float num165 = num82;
								float num166 = num83;
								num165 += (float)Main.rand.Next(-35, 36) * 0.02f;
								num166 += (float)Main.rand.Next(-35, 36) * 0.02f;
								int num167 = Projectile.NewProjectile(vector2.X, vector2.Y, num165, num166, this.beeType(), this.beeDamage(num76), this.beeKB(num77), i, 0f, 0f);
								Main.projectile[num167].magic = true;
							}
						}
						else if (item.type == 1155)
						{
							int num168 = Main.rand.Next(2, 5);
							if (Main.rand.Next(5) == 0)
							{
								num168++;
							}
							if (Main.rand.Next(5) == 0)
							{
								num168++;
							}
							for (int num169 = 0; num169 < num168; num169++)
							{
								float num170 = num82;
								float num171 = num83;
								num170 += (float)Main.rand.Next(-35, 36) * 0.02f;
								num171 += (float)Main.rand.Next(-35, 36) * 0.02f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num170, num171, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 1801)
						{
							int num172 = Main.rand.Next(1, 4);
							for (int num173 = 0; num173 < num172; num173++)
							{
								float num174 = num82;
								float num175 = num83;
								num174 += (float)Main.rand.Next(-35, 36) * 0.05f;
								num175 += (float)Main.rand.Next(-35, 36) * 0.05f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num174, num175, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 679)
						{
							for (int num176 = 0; num176 < 6; num176++)
							{
								float num177 = num82;
								float num178 = num83;
								num177 += (float)Main.rand.Next(-40, 41) * 0.05f;
								num178 += (float)Main.rand.Next(-40, 41) * 0.05f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num177, num178, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 2623)
						{
							for (int num179 = 0; num179 < 3; num179++)
							{
								float num180 = num82;
								float num181 = num83;
								num180 += (float)Main.rand.Next(-40, 41) * 0.1f;
								num181 += (float)Main.rand.Next(-40, 41) * 0.1f;
								Projectile.NewProjectile(vector2.X, vector2.Y, num180, num181, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 3210)
						{
							Vector2 vector16 = new Vector2(num82, num83);
							vector16.X += (float)Main.rand.Next(-30, 31) * 0.04f;
							vector16.Y += (float)Main.rand.Next(-30, 31) * 0.03f;
							vector16.Normalize();
							vector16 *= (float)Main.rand.Next(70, 91) * 0.1f;
							vector16.X += (float)Main.rand.Next(-30, 31) * 0.04f;
							vector16.Y += (float)Main.rand.Next(-30, 31) * 0.03f;
							Projectile.NewProjectile(vector2.X, vector2.Y, vector16.X, vector16.Y, num74, num76, num77, i, (float)Main.rand.Next(20), 0f);
						}
						else if (item.type == 434)
						{
							float num182 = num82;
							float num183 = num83;
							if (this.itemAnimation < 5)
							{
								num182 += (float)Main.rand.Next(-40, 41) * 0.01f;
								num183 += (float)Main.rand.Next(-40, 41) * 0.01f;
								num182 *= 1.1f;
								num183 *= 1.1f;
							}
							else if (this.itemAnimation < 10)
							{
								num182 += (float)Main.rand.Next(-20, 21) * 0.01f;
								num183 += (float)Main.rand.Next(-20, 21) * 0.01f;
								num182 *= 1.05f;
								num183 *= 1.05f;
							}
							Projectile.NewProjectile(vector2.X, vector2.Y, num182, num183, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 1157)
						{
							num74 = Main.rand.Next(191, 195);
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							int num184 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
							Main.projectile[num184].localAI[0] = 30f;
						}
						else if (item.type == 1802)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2364 || item.type == 2365)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2535)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Vector2 vector17 = new Vector2(num82, num83);
							vector17 = vector17.RotatedBy(1.5707963705062866, default(Vector2));
							Projectile.NewProjectile(vector2.X + vector17.X, vector2.Y + vector17.Y, vector17.X, vector17.Y, num74, num76, num77, i, 0f, 0f);
							vector17 = vector17.RotatedBy(-3.1415927410125732, default(Vector2));
							Projectile.NewProjectile(vector2.X + vector17.X, vector2.Y + vector17.Y, vector17.X, vector17.Y, num74 + 1, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2551)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + Main.rand.Next(3), num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2584)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + Main.rand.Next(3), num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2621)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 2749 || item.type == 3249 || item.type == 3474)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3531)
						{
							int num185 = -1;
							int num186 = -1;
							for (int num187 = 0; num187 < 1000; num187++)
							{
								if (Main.projectile[num187].active && Main.projectile[num187].owner == Main.myPlayer)
								{
									if (num185 == -1 && Main.projectile[num187].type == 625)
									{
										num185 = num187;
									}
									if (num186 == -1 && Main.projectile[num187].type == 628)
									{
										num186 = num187;
									}
									if (num185 != -1 && num186 != -1)
									{
										break;
									}
								}
							}
							if (num185 == -1 && num186 == -1)
							{
								num82 = 0f;
								num83 = 0f;
								vector2.X = (float)Main.mouseX + Main.screenPosition.X;
								vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
								int num188 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
								num188 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + 1, num76, num77, i, (float)num188, 0f);
								int num189 = num188;
								num188 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + 2, num76, num77, i, (float)num188, 0f);
								Main.projectile[num189].localAI[1] = (float)num188;
								num189 = num188;
								num188 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + 3, num76, num77, i, (float)num188, 0f);
								Main.projectile[num189].localAI[1] = (float)num188;
							}
							else if (num185 != -1 && num186 != -1)
							{
								int num190 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + 1, num76, num77, i, (float)Projectile.GetByUUID(Main.myPlayer, Main.projectile[num186].ai[0]), 0f);
								int num191 = num190;
								num190 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74 + 2, num76, num77, i, (float)num190, 0f);
								Main.projectile[num191].localAI[1] = (float)num190;
								Main.projectile[num191].netUpdate = true;
								Main.projectile[num191].ai[1] = 1f;
								Main.projectile[num190].localAI[1] = (float)num186;
								Main.projectile[num190].netUpdate = true;
								Main.projectile[num190].ai[1] = 1f;
								Main.projectile[num186].ai[0] = (float)Main.projectile[num190].projUUID;
								Main.projectile[num186].netUpdate = true;
								Main.projectile[num186].ai[1] = 1f;
							}
						}
						else if (item.type == 1309)
						{
							num82 = 0f;
							num83 = 0f;
							vector2.X = (float)Main.mouseX + Main.screenPosition.X;
							vector2.Y = (float)Main.mouseY + Main.screenPosition.Y;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.shoot > 0 && (Main.projPet[item.shoot] || item.shoot == 72 || item.shoot == 18 || item.shoot == 500 || item.shoot == 650) && !item.summon)
						{
							for (int num192 = 0; num192 < 1000; num192++)
							{
								if (Main.projectile[num192].active && Main.projectile[num192].owner == this.whoAmI)
								{
									if (item.shoot == 72)
									{
										if (Main.projectile[num192].type == 72 || Main.projectile[num192].type == 86 || Main.projectile[num192].type == 87)
										{
											Main.projectile[num192].Kill();
										}
									}
									else if (item.shoot == Main.projectile[num192].type)
									{
										Main.projectile[num192].Kill();
									}
								}
							}
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3006)
						{
							Vector2 vector18;
							vector18.X = (float)Main.mouseX + Main.screenPosition.X;
							vector18.Y = (float)Main.mouseY + Main.screenPosition.Y;
							while (Collision.CanHitLine(this.position, this.width, this.height, vector2, 1, 1))
							{
								vector2.X += num82;
								vector2.Y += num83;
								if ((vector2 - vector18).Length() < 20f + Math.Abs(num82) + Math.Abs(num83))
								{
									vector2 = vector18;
									break;
								}
							}
							Projectile.NewProjectile(vector2.X, vector2.Y, 0f, 0f, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3014)
						{
							Vector2 vector19;
							vector19.X = (float)Main.mouseX + Main.screenPosition.X;
							vector19.Y = (float)Main.mouseY + Main.screenPosition.Y;
							while (Collision.CanHitLine(this.position, this.width, this.height, vector2, 1, 1))
							{
								vector2.X += num82;
								vector2.Y += num83;
								if ((vector2 - vector19).Length() < 20f + Math.Abs(num82) + Math.Abs(num83))
								{
									vector2 = vector19;
									break;
								}
							}
							bool flag12 = false;
							int num193 = (int)vector2.Y / 16;
							int num194 = (int)vector2.X / 16;
							int num195 = num193;
							while (num193 < Main.maxTilesY - 10 && num193 - num195 < 30 && !WorldGen.SolidTile(num194, num193) && !TileID.Sets.Platforms[(int)Main.tile[num194, num193].type])
							{
								num193++;
							}
							if (!WorldGen.SolidTile(num194, num193) && !TileID.Sets.Platforms[(int)Main.tile[num194, num193].type])
							{
								flag12 = true;
							}
							float num196 = (float)(num193 * 16);
							num193 = num195;
							while (num193 > 10 && num195 - num193 < 30 && !WorldGen.SolidTile(num194, num193))
							{
								num193--;
							}
							float num197 = (float)(num193 * 16 + 16);
							float num198 = num196 - num197;
							int num199 = 10;
							if (num198 > (float)(16 * num199))
							{
								num198 = (float)(16 * num199);
							}
							num197 = num196 - num198;
							vector2.X = (float)((int)(vector2.X / 16f) * 16);
							if (!flag12)
							{
								Projectile.NewProjectile(vector2.X, vector2.Y, 0f, 0f, num74, num76, num77, i, num197, num198);
							}
						}
						else if (item.type == 3384)
						{
							int num200 = (this.altFunctionUse == 2) ? 1 : 0;
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, (float)num200);
						}
						else if (item.type == 3473)
						{
							float ai3 = (Main.rand.NextFloat() - 0.5f) * 0.7853982f;
							Vector2 vector20 = new Vector2(num82, num83);
							Projectile.NewProjectile(vector2.X, vector2.Y, vector20.X, vector20.Y, num74, num76, num77, i, 0f, ai3);
						}
						else if (item.type == 3836)
						{
							float ai4 = Main.rand.NextFloat() * num75 * 0.75f * (float)this.direction;
							Vector2 velocity = new Vector2(num82, num83);
							Projectile.NewProjectile(vector2, velocity, num74, num76, num77, i, ai4, 0f);
						}
						else if (item.type == 3858)
						{
							bool arg_8497_0 = this.altFunctionUse == 2;
							Vector2 vector21 = new Vector2(num82, num83);
							if (arg_8497_0)
							{
								vector21 *= 1.5f;
								float ai5 = (0.3f + 0.7f * Main.rand.NextFloat()) * num75 * 1.75f * (float)this.direction;
								Projectile.NewProjectile(vector2, vector21, 708, (int)((float)num76 * 0.75f), num77 + 4f, i, ai5, 0f);
							}
							else
							{
								Projectile.NewProjectile(vector2, vector21, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 3859)
						{
							Vector2 vector22 = new Vector2(num82, num83);
							num74 = 710;
							num76 = (int)((float)num76 * 0.7f);
							vector22 *= 0.8f;
							Vector2 value3 = vector22.SafeNormalize(-Vector2.UnitY);
							float num201 = 0.0174532924f * (float)(-(float)this.direction);
							for (float num202 = -2.5f; num202 < 3f; num202 += 1f)
							{
								Projectile.NewProjectile(vector2, (vector22 + value3 * num202 * 0.5f).RotatedBy((double)(num202 * num201), default(Vector2)), num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 3870)
						{
							Vector2 value4 = Vector2.Normalize(new Vector2(num82, num83)) * 40f * item.scale;
							if (Collision.CanHit(vector2, 0, 0, vector2 + value4, 0, 0))
							{
								vector2 += value4;
							}
							Vector2 vector23 = new Vector2(num82, num83);
							vector23 *= 0.8f;
							Vector2 value5 = vector23.SafeNormalize(-Vector2.UnitY);
							float num203 = 0.0174532924f * (float)(-(float)this.direction);
							for (int num204 = 0; num204 <= 2; num204++)
							{
								Projectile.NewProjectile(vector2, (vector23 + value5 * (float)num204 * 1f).RotatedBy((double)((float)num204 * num203), default(Vector2)), num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 3542)
						{
							float num205 = (Main.rand.NextFloat() - 0.5f) * 0.7853982f * 0.7f;
							int num206 = 0;
							while (num206 < 10 && !Collision.CanHit(vector2, 0, 0, vector2 + new Vector2(num82, num83).RotatedBy((double)num205, default(Vector2)) * 100f, 0, 0))
							{
								num205 = (Main.rand.NextFloat() - 0.5f) * 0.7853982f * 0.7f;
								num206++;
							}
							Vector2 vector24 = new Vector2(num82, num83).RotatedBy((double)num205, default(Vector2)) * (0.95f + Main.rand.NextFloat() * 0.3f);
							Projectile.NewProjectile(vector2.X, vector2.Y, vector24.X, vector24.Y, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3779)
						{
							float num207 = Main.rand.NextFloat() * 6.28318548f;
							int num208 = 0;
							while (num208 < 10 && !Collision.CanHit(vector2, 0, 0, vector2 + new Vector2(num82, num83).RotatedBy((double)num207, default(Vector2)) * 100f, 0, 0))
							{
								num207 = Main.rand.NextFloat() * 6.28318548f;
								num208++;
							}
							Vector2 value6 = new Vector2(num82, num83).RotatedBy((double)num207, default(Vector2)) * (0.95f + Main.rand.NextFloat() * 0.3f);
							Projectile.NewProjectile(vector2 + value6 * 30f, Vector2.Zero, num74, num76, num77, i, -2f, 0f);
						}
						else if (item.type == 3787)
						{
							float f = Main.rand.NextFloat() * 6.28318548f;
							float value7 = 20f;
							float value8 = 60f;
							Vector2 vector25 = vector2 + f.ToRotationVector2() * MathHelper.Lerp(value7, value8, Main.rand.NextFloat());
							for (int num209 = 0; num209 < 50; num209++)
							{
								vector25 = vector2 + f.ToRotationVector2() * MathHelper.Lerp(value7, value8, Main.rand.NextFloat());
								if (Collision.CanHit(vector2, 0, 0, vector25 + (vector25 - vector2).SafeNormalize(Vector2.UnitX) * 8f, 0, 0))
								{
									break;
								}
								f = Main.rand.NextFloat() * 6.28318548f;
							}
							Vector2 vector26 = Main.MouseWorld - vector25;
							Vector2 vector27 = new Vector2(num82, num83).SafeNormalize(Vector2.UnitY) * num75;
							vector26 = vector26.SafeNormalize(vector27) * num75;
							vector26 = Vector2.Lerp(vector26, vector27, 0.25f);
							Projectile.NewProjectile(vector25, vector26, num74, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3788)
						{
							Vector2 vector28 = new Vector2(num82, num83);
							float num210 = 0.7853982f;
							for (int num211 = 0; num211 < 2; num211++)
							{
								Projectile.NewProjectile(vector2, vector28 + vector28.SafeNormalize(Vector2.Zero).RotatedBy((double)(num210 * (Main.rand.NextFloat() * 0.5f + 0.5f)), default(Vector2)) * Main.rand.NextFloatDirection() * 2f, num74, num76, num77, i, 0f, 0f);
								Projectile.NewProjectile(vector2, vector28 + vector28.SafeNormalize(Vector2.Zero).RotatedBy((double)(-(double)num210 * (Main.rand.NextFloat() * 0.5f + 0.5f)), default(Vector2)) * Main.rand.NextFloatDirection() * 2f, num74, num76, num77, i, 0f, 0f);
							}
							Projectile.NewProjectile(vector2, vector28.SafeNormalize(Vector2.UnitX * (float)this.direction) * (num75 * 1.3f), 661, num76 * 2, num77, i, 0f, 0f);
						}
						else if (item.type == 3475)
						{
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, 615, num76, num77, i, (float)(5 * Main.rand.Next(0, 20)), 0f);
						}
						else if (item.type == 3540)
						{
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, 630, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3854)
						{
							Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, 705, num76, num77, i, 0f, 0f);
						}
						else if (item.type == 3546)
						{
							for (int num212 = 0; num212 < 2; num212++)
							{
								float num213 = num82;
								float num214 = num83;
								num213 += (float)Main.rand.Next(-40, 41) * 0.05f;
								num214 += (float)Main.rand.Next(-40, 41) * 0.05f;
								Vector2 vector29 = vector2 + Vector2.Normalize(new Vector2(num213, num214).RotatedBy((double)(-1.57079637f * (float)this.direction), default(Vector2))) * 6f;
								Projectile.NewProjectile(vector29.X, vector29.Y, num213, num214, 167 + Main.rand.Next(4), num76, num77, i, 0f, 1f);
							}
						}
						else if (item.type == 3350)
						{
							float num215 = num82;
							float num216 = num83;
							num215 += (float)Main.rand.Next(-1, 2) * 0.5f;
							num216 += (float)Main.rand.Next(-1, 2) * 0.5f;
							if (Collision.CanHitLine(base.Center, 0, 0, vector2 + new Vector2(num215, num216) * 2f, 0, 0))
							{
								vector2 += new Vector2(num215, num216);
							}
							Projectile.NewProjectile(vector2.X, vector2.Y - this.gravDir * 4f, num215, num216, num74, num76, num77, i, 0f, (float)Main.rand.Next(12) / 6f);
						}
						else if (item.type == 3852)
						{
							if (this.altFunctionUse == 2)
							{
								Projectile.NewProjectile(vector2.X, base.Bottom.Y - 100f, (float)this.direction * num75, 0f, 704, num76 * 2, num77, i, 0f, 0f);
							}
							else
							{
								Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
							}
						}
						else if (item.type == 3818 || item.type == 3819 || item.type == 3820 || item.type == 3824 || item.type == 3825 || item.type == 3826 || item.type == 3829 || item.type == 3830 || item.type == 3831 || item.type == 3832 || item.type == 3833 || item.type == 3834)
						{
							this.PayDD2CrystalsBeforeUse(item);
							int num217;
							int num218;
							int num219;
							this.FindSentryRestingSpot(item.shoot, out num217, out num218, out num219);
							Projectile.NewProjectile((float)num217, (float)(num218 - num219), 0f, 0f, num74, num76, num77, i, 0f, 0f);
							this.UpdateMaxTurrets();
						}
						else
						{
							int num220 = Projectile.NewProjectile(vector2.X, vector2.Y, num82, num83, num74, num76, num77, i, 0f, 0f);
							if (item.type == 726)
							{
								Main.projectile[num220].magic = true;
							}
							if (item.type == 724 || item.type == 676)
							{
								Main.projectile[num220].melee = true;
							}
							if (num74 == 80)
							{
								Main.projectile[num220].ai[0] = (float)Player.tileTargetX;
								Main.projectile[num220].ai[1] = (float)Player.tileTargetY;
							}
							if (num74 == 442)
							{
								Main.projectile[num220].ai[0] = (float)Player.tileTargetX;
								Main.projectile[num220].ai[1] = (float)Player.tileTargetY;
							}
							if ((this.thrownCost50 || this.thrownCost33) && this.inventory[this.selectedItem].thrown)
							{
								Main.projectile[num220].noDropItem = true;
							}
							if (Main.projectile[num220].aiStyle == 99)
							{
								AchievementsHelper.HandleSpecialEvent(this, 7);
							}
						}
					}
					else if (item.useStyle == 5)
					{
						this.itemRotation = 0f;
						NetMessage.SendData(41, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.whoAmI == Main.myPlayer && (item.type == 509 || item.type == 510 || item.type == 849 || item.type == 850 || item.type == 851 || item.type == 3612 || item.type == 3620 || item.type == 3625) && this.position.X / 16f - (float)Player.tileRangeX - (float)item.tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)item.tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)item.tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)item.tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
				{
					if (!Main.GamepadDisableCursorItemIcon)
					{
						this.showItemIcon = true;
						Main.ItemIconCacheUpdate(item.type);
					}
					if (this.itemAnimation > 0 && this.itemTime == 0 && this.controlUseItem)
					{
						int num221 = Player.tileTargetX;
						int num222 = Player.tileTargetY;
						if (item.type == 509)
						{
							int num223 = -1;
							for (int num224 = 0; num224 < 58; num224++)
							{
								if (this.inventory[num224].stack > 0 && this.inventory[num224].type == 530)
								{
									num223 = num224;
									break;
								}
							}
							if (num223 >= 0 && WorldGen.PlaceWire(num221, num222))
							{
								this.inventory[num223].stack--;
								if (this.inventory[num223].stack <= 0)
								{
									this.inventory[num223].SetDefaults(0, false);
								}
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 5, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
						}
						else if (item.type == 850)
						{
							int num225 = -1;
							for (int num226 = 0; num226 < 58; num226++)
							{
								if (this.inventory[num226].stack > 0 && this.inventory[num226].type == 530)
								{
									num225 = num226;
									break;
								}
							}
							if (num225 >= 0 && WorldGen.PlaceWire2(num221, num222))
							{
								this.inventory[num225].stack--;
								if (this.inventory[num225].stack <= 0)
								{
									this.inventory[num225].SetDefaults(0, false);
								}
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 10, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
						}
						if (item.type == 851)
						{
							int num227 = -1;
							for (int num228 = 0; num228 < 58; num228++)
							{
								if (this.inventory[num228].stack > 0 && this.inventory[num228].type == 530)
								{
									num227 = num228;
									break;
								}
							}
							if (num227 >= 0 && WorldGen.PlaceWire3(num221, num222))
							{
								this.inventory[num227].stack--;
								if (this.inventory[num227].stack <= 0)
								{
									this.inventory[num227].SetDefaults(0, false);
								}
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 12, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
						}
						if (item.type == 3612)
						{
							int num229 = -1;
							for (int num230 = 0; num230 < 58; num230++)
							{
								if (this.inventory[num230].stack > 0 && this.inventory[num230].type == 530)
								{
									num229 = num230;
									break;
								}
							}
							if (num229 >= 0 && WorldGen.PlaceWire4(num221, num222))
							{
								this.inventory[num229].stack--;
								if (this.inventory[num229].stack <= 0)
								{
									this.inventory[num229].SetDefaults(0, false);
								}
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 16, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
						}
						else if (item.type == 510)
						{
							if (WorldGen.KillActuator(num221, num222))
							{
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 9, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
							else if (WorldGen.KillWire4(num221, num222))
							{
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 17, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
							else if (WorldGen.KillWire3(num221, num222))
							{
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 13, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
							else if (WorldGen.KillWire2(num221, num222))
							{
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 11, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
							else if (WorldGen.KillWire(num221, num222))
							{
								this.itemTime = item.useTime;
								NetMessage.SendData(17, -1, -1, null, 6, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							}
						}
						else if (item.type == 849 && item.stack > 0 && WorldGen.PlaceActuator(num221, num222))
						{
							this.itemTime = item.useTime;
							NetMessage.SendData(17, -1, -1, null, 8, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
							item.stack--;
							if (item.stack <= 0)
							{
								item.SetDefaults(0, false);
							}
						}
						if (item.type == 3620)
						{
							Tile tile2 = Main.tile[num221, num222];
							if (tile2 != null && tile2.actuator())
							{
								bool flag13 = tile2.inActive();
								if ((!this.ActuationRodLock || this.ActuationRodLockSetting == tile2.inActive()) && Wiring.Actuate(num221, num222) && flag13 != tile2.inActive())
								{
									this.ActuationRodLock = true;
									this.ActuationRodLockSetting = !tile2.inActive();
									this.itemTime = item.useTime;
									NetMessage.SendData(17, -1, -1, null, 19, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
								}
							}
						}
						if (item.type == 3625)
						{
							Point point = new Point(Player.tileTargetX, Player.tileTargetY);
							this.itemTime = item.useTime;
							WiresUI.Settings.MultiToolMode arg_9C15_0 = WiresUI.Settings.ToolMode;
							WiresUI.Settings.ToolMode &= ~WiresUI.Settings.MultiToolMode.Actuator;
							if (Main.netMode == 1)
							{
								NetMessage.SendData(109, -1, -1, null, point.X, (float)point.Y, (float)point.X, (float)point.Y, (int)WiresUI.Settings.ToolMode, 0, 0);
							}
							else
							{
								Wiring.MassWireOperation(point, point, this);
							}
							WiresUI.Settings.ToolMode = arg_9C15_0;
						}
					}
				}
				if (this.itemAnimation > 0 && this.itemTime == 0 && (item.type == 507 || item.type == 508))
				{
					this.itemTime = item.useTime;
					Vector2 vector30 = new Vector2(this.position.X + (float)this.width * 0.5f, this.position.Y + (float)this.height * 0.5f);
					float arg_9CD7_0 = (float)Main.mouseX + Main.screenPosition.X - vector30.X;
					float num231 = (float)Main.mouseY + Main.screenPosition.Y - vector30.Y;
					float num232 = (float)Math.Sqrt((double)(arg_9CD7_0 * arg_9CD7_0 + num231 * num231));
					num232 /= (float)(Main.screenHeight / 2);
					if (num232 > 1f)
					{
						num232 = 1f;
					}
					num232 = num232 * 2f - 1f;
					if (num232 < -1f)
					{
						num232 = -1f;
					}
					if (num232 > 1f)
					{
						num232 = 1f;
					}
					Main.harpNote = num232;
					LegacySoundStyle type4 = SoundID.Item26;
					if (item.type == 507)
					{
						type4 = SoundID.Item35;
					}
					Main.PlaySound(type4, this.position);
					NetMessage.SendData(58, -1, -1, null, this.whoAmI, num232, 0f, 0f, 0, 0, 0);
				}
				if (((item.type >= 205 && item.type <= 207) || item.type == 1128 || item.type == 3031 || item.type == 3032) && !this.noBuilding && this.position.X / 16f - (float)Player.tileRangeX - (float)item.tileBoost <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)item.tileBoost - 1f >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)item.tileBoost <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)item.tileBoost - 2f >= (float)Player.tileTargetY)
				{
					if (!Main.GamepadDisableCursorItemIcon)
					{
						this.showItemIcon = true;
						Main.ItemIconCacheUpdate(item.type);
					}
					if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
					{
						if (item.type == 205 || (item.type == 3032 && Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType() == 0))
						{
							int num233 = (int)Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType();
							int num234 = 0;
							for (int num235 = Player.tileTargetX - 1; num235 <= Player.tileTargetX + 1; num235++)
							{
								for (int num236 = Player.tileTargetY - 1; num236 <= Player.tileTargetY + 1; num236++)
								{
									if ((int)Main.tile[num235, num236].liquidType() == num233)
									{
										num234 += (int)Main.tile[num235, num236].liquid;
									}
								}
							}
							if (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid > 0 && (num234 > 100 || item.type == 3032))
							{
								int liquidType = (int)Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType();
								if (item.type != 3032)
								{
									if (!Main.tile[Player.tileTargetX, Player.tileTargetY].lava())
									{
										if (Main.tile[Player.tileTargetX, Player.tileTargetY].honey())
										{
											item.stack--;
											this.PutItemInInventory(1128, this.selectedItem);
										}
										else
										{
											item.stack--;
											this.PutItemInInventory(206, this.selectedItem);
										}
									}
									else
									{
										item.stack--;
										this.PutItemInInventory(207, this.selectedItem);
									}
								}
								Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
								this.itemTime = item.useTime;
								int num237 = (int)Main.tile[Player.tileTargetX, Player.tileTargetY].liquid;
								Main.tile[Player.tileTargetX, Player.tileTargetY].liquid = 0;
								Main.tile[Player.tileTargetX, Player.tileTargetY].lava(false);
								Main.tile[Player.tileTargetX, Player.tileTargetY].honey(false);
								WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, false);
								if (Main.netMode == 1)
								{
									NetMessage.sendWater(Player.tileTargetX, Player.tileTargetY);
								}
								else
								{
									Liquid.AddWater(Player.tileTargetX, Player.tileTargetY);
								}
								for (int num238 = Player.tileTargetX - 1; num238 <= Player.tileTargetX + 1; num238++)
								{
									for (int num239 = Player.tileTargetY - 1; num239 <= Player.tileTargetY + 1; num239++)
									{
										if (num237 < 256 && (int)Main.tile[num238, num239].liquidType() == num233)
										{
											int num240 = (int)Main.tile[num238, num239].liquid;
											if (num240 + num237 > 255)
											{
												num240 = 255 - num237;
											}
											num237 += num240;
											Tile expr_A2CD = Main.tile[num238, num239];
											expr_A2CD.liquid -= (byte)num240;
											Main.tile[num238, num239].liquidType(liquidType);
											if (Main.tile[num238, num239].liquid == 0)
											{
												Main.tile[num238, num239].lava(false);
												Main.tile[num238, num239].honey(false);
											}
											WorldGen.SquareTileFrame(num238, num239, false);
											if (Main.netMode == 1)
											{
												NetMessage.sendWater(num238, num239);
											}
											else
											{
												Liquid.AddWater(num238, num239);
											}
										}
									}
								}
							}
						}
						else if (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid < 200 && (!Main.tile[Player.tileTargetX, Player.tileTargetY].nactive() || !Main.tileSolid[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] || Main.tileSolidTop[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type]))
						{
							if (item.type == 207)
							{
								if (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid == 0 || Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType() == 1)
								{
									Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
									Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType(1);
									Main.tile[Player.tileTargetX, Player.tileTargetY].liquid = 255;
									WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, true);
									item.stack--;
									this.PutItemInInventory(205, this.selectedItem);
									this.itemTime = item.useTime;
									if (Main.netMode == 1)
									{
										NetMessage.sendWater(Player.tileTargetX, Player.tileTargetY);
									}
								}
							}
							else if (item.type == 206 || item.type == 3031)
							{
								if (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid == 0 || Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType() == 0)
								{
									Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
									Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType(0);
									Main.tile[Player.tileTargetX, Player.tileTargetY].liquid = 255;
									WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, true);
									if (item.type != 3031)
									{
										item.stack--;
										this.PutItemInInventory(205, this.selectedItem);
									}
									this.itemTime = item.useTime;
									if (Main.netMode == 1)
									{
										NetMessage.sendWater(Player.tileTargetX, Player.tileTargetY);
									}
								}
							}
							else if (item.type == 1128 && (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid == 0 || Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType() == 2))
							{
								Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
								Main.tile[Player.tileTargetX, Player.tileTargetY].liquidType(2);
								Main.tile[Player.tileTargetX, Player.tileTargetY].liquid = 255;
								WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, true);
								item.stack--;
								this.PutItemInInventory(205, this.selectedItem);
								this.itemTime = item.useTime;
								if (Main.netMode == 1)
								{
									NetMessage.sendWater(Player.tileTargetX, Player.tileTargetY);
								}
							}
						}
					}
				}
				if (!this.channel)
				{
					this.toolTime = this.itemTime;
				}
				else
				{
					this.toolTime--;
					if (this.toolTime < 0)
					{
						if (item.pick > 0)
						{
							this.toolTime = item.useTime;
						}
						else
						{
							this.toolTime = (int)((float)item.useTime * this.pickSpeed);
						}
					}
				}
				if (item.pick > 0 || item.axe > 0 || item.hammer > 0)
				{
					bool flag14 = this.position.X / 16f - (float)Player.tileRangeX - (float)item.tileBoost <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)item.tileBoost - 1f >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)item.tileBoost <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)item.tileBoost - 2f >= (float)Player.tileTargetY;
					if (this.noBuilding)
					{
						flag14 = false;
					}
					if (flag14)
					{
						int num241 = 0;
						bool flag15 = true;
						if (!Main.GamepadDisableCursorItemIcon)
						{
							this.showItemIcon = true;
							Main.ItemIconCacheUpdate(item.type);
						}
						if (this.toolTime == 0 && this.itemAnimation > 0 && this.controlUseItem && (!Main.tile[Player.tileTargetX, Player.tileTargetY].active() || (!Main.tileHammer[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] && !Main.tileSolid[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] && Main.tile[Player.tileTargetX, Player.tileTargetY].type != 314 && Main.tile[Player.tileTargetX, Player.tileTargetY].type != 424 && Main.tile[Player.tileTargetX, Player.tileTargetY].type != 442 && Main.tile[Player.tileTargetX, Player.tileTargetY].type != 351)))
						{
							this.poundRelease = false;
						}
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].active())
						{
							if ((item.pick > 0 && !Main.tileAxe[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] && !Main.tileHammer[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type]) || (item.axe > 0 && Main.tileAxe[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type]) || (item.hammer > 0 && Main.tileHammer[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type]))
							{
								flag15 = false;
							}
							if (this.toolTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
							{
								int tileId = this.hitTile.HitObject(Player.tileTargetX, Player.tileTargetY, 1);
								if (Main.tileNoFail[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
								{
									num241 = 100;
								}
								if (Main.tileHammer[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
								{
									flag15 = false;
									if (item.hammer > 0)
									{
										num241 += item.hammer;
										if (!WorldGen.CanKillTile(Player.tileTargetX, Player.tileTargetY))
										{
											num241 = 0;
										}
										if (Main.tile[Player.tileTargetX, Player.tileTargetY].type == 26 && (item.hammer < 80 || !Main.hardMode))
										{
											num241 = 0;
											this.Hurt(PlayerDeathReason.ByOther(4), this.statLife / 2, -this.direction, false, false, false, -1);
										}
										AchievementsHelper.CurrentlyMining = true;
										if (this.hitTile.AddDamage(tileId, num241, true) >= 100)
										{
											this.hitTile.Clear(tileId);
											WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, false, false, false);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
											}
										}
										else
										{
											WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, true, false, false);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
											}
										}
										if (num241 != 0)
										{
											this.hitTile.Prune();
										}
										this.itemTime = item.useTime;
										AchievementsHelper.CurrentlyMining = false;
									}
								}
								else if (Main.tileAxe[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
								{
									if (Main.tile[Player.tileTargetX, Player.tileTargetY].type == 80)
									{
										num241 += item.axe * 3;
									}
									else
									{
										num241 += item.axe;
									}
									if (item.axe > 0)
									{
										AchievementsHelper.CurrentlyMining = true;
										if (!WorldGen.CanKillTile(Player.tileTargetX, Player.tileTargetY))
										{
											num241 = 0;
										}
										if (this.hitTile.AddDamage(tileId, num241, true) >= 100)
										{
											this.hitTile.Clear(tileId);
											WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, false, false, false);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
											}
										}
										else
										{
											WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, true, false, false);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
											}
										}
										if (num241 != 0)
										{
											this.hitTile.Prune();
										}
										this.itemTime = item.useTime;
										AchievementsHelper.CurrentlyMining = false;
									}
								}
								else if (item.pick > 0)
								{
									this.PickTile(Player.tileTargetX, Player.tileTargetY, item.pick);
									this.itemTime = (int)((float)item.useTime * this.pickSpeed);
								}
								if (item.pick > 0)
								{
									this.itemTime = (int)((float)item.useTime * this.pickSpeed);
								}
								if (item.hammer > 0 && Main.tile[Player.tileTargetX, Player.tileTargetY].active() && ((Main.tileSolid[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] && Main.tile[Player.tileTargetX, Player.tileTargetY].type != 10) || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 314 || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 351 || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 424 || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 442) && this.poundRelease)
								{
									flag15 = false;
									this.itemTime = item.useTime;
									num241 += (int)((double)item.hammer * 1.25);
									num241 = 100;
									if (Main.tile[Player.tileTargetX, Player.tileTargetY - 1].active() && Main.tile[Player.tileTargetX, Player.tileTargetY - 1].type == 10)
									{
										num241 = 0;
									}
									if (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].active() && Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type == 10)
									{
										num241 = 0;
									}
									if (this.hitTile.AddDamage(tileId, num241, true) >= 100)
									{
										this.hitTile.Clear(tileId);
										if (this.poundRelease)
										{
											int num242 = Player.tileTargetX;
											int num243 = Player.tileTargetY;
											if (TileID.Sets.Platforms[(int)Main.tile[num242, num243].type])
											{
												if (Main.tile[num242, num243].halfBrick())
												{
													WorldGen.PoundTile(num242, num243);
													if (Main.netMode == 1)
													{
														NetMessage.SendData(17, -1, -1, null, 7, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
													}
												}
												else
												{
													int num244 = 1;
													int slope = 2;
													if (TileID.Sets.Platforms[(int)Main.tile[num242 + 1, num243 - 1].type] || TileID.Sets.Platforms[(int)Main.tile[num242 - 1, num243 + 1].type] || (WorldGen.SolidTile(num242 + 1, num243) && !WorldGen.SolidTile(num242 - 1, num243)))
													{
														num244 = 2;
														slope = 1;
													}
													if (Main.tile[num242, num243].slope() == 0)
													{
														WorldGen.SlopeTile(num242, num243, num244);
														int num245 = (int)Main.tile[num242, num243].slope();
														if (Main.netMode == 1)
														{
															NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num245, 0, 0, 0);
														}
													}
													else if ((int)Main.tile[num242, num243].slope() == num244)
													{
														WorldGen.SlopeTile(num242, num243, slope);
														int num246 = (int)Main.tile[num242, num243].slope();
														if (Main.netMode == 1)
														{
															NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num246, 0, 0, 0);
														}
													}
													else
													{
														WorldGen.SlopeTile(num242, num243, 0);
														int num247 = (int)Main.tile[num242, num243].slope();
														if (Main.netMode == 1)
														{
															NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num247, 0, 0, 0);
														}
														WorldGen.PoundTile(num242, num243);
														if (Main.netMode == 1)
														{
															NetMessage.SendData(17, -1, -1, null, 7, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
														}
													}
												}
											}
											else if (Main.tile[num242, num243].type == 314)
											{
												if (Minecart.FrameTrack(num242, num243, true, false) && Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 15, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
												}
											}
											else if (Main.tile[num242, num243].type == 137)
											{
												int num248 = 0;
												int num80 = (int)(Main.tile[num242, num243].frameY / 18);
												if (num80 > 2)
												{
													if (num80 - 3 <= 1)
													{
														switch (Main.tile[num242, num243].frameX / 18)
														{
															case 0:
															case 1:
																num248 = 3;
																break;
															case 2:
																num248 = 4;
																break;
															case 3:
																num248 = 2;
																break;
															case 4:
																num248 = 0;
																break;
														}
													}
												}
												else
												{
													switch (Main.tile[num242, num243].frameX / 18)
													{
														case 0:
															num248 = 2;
															break;
														case 1:
															num248 = 3;
															break;
														case 2:
															num248 = 4;
															break;
														case 3:
															num248 = 5;
															break;
														case 4:
															num248 = 1;
															break;
														case 5:
															num248 = 0;
															break;
													}
												}
												Main.tile[num242, num243].frameX = (short)(num248 * 18);
												if (Main.netMode == 1)
												{
													NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 1, TileChangeType.None);
												}
											}
											else if (Main.tile[num242, num243].type == 424)
											{
												if (Main.tile[num242, num243].frameX == 0)
												{
													Main.tile[num242, num243].frameX = 18;
												}
												else if (Main.tile[num242, num243].frameX == 18)
												{
													Main.tile[num242, num243].frameX = 36;
												}
												else
												{
													Main.tile[num242, num243].frameX = 0;
												}
												if (Main.netMode == 1)
												{
													NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 1, TileChangeType.None);
												}
											}
											else if (Main.tile[num242, num243].type == 442)
											{
												Tile tile3 = Main.tile[num242, num243 - 1];
												Tile tile4 = Main.tile[num242, num243 + 1];
												Tile tile5 = Main.tile[num242 - 1, num243];
												Tile tile6 = Main.tile[num242 + 1, num243];
												Tile tile7 = Main.tile[num242 - 1, num243 + 1];
												Tile tile8 = Main.tile[num242 + 1, num243 + 1];
												Tile tile9 = Main.tile[num242 - 1, num243 - 1];
												Tile tile10 = Main.tile[num242 + 1, num243 - 1];
												int num249 = -1;
												int num250 = -1;
												int num251 = -1;
												int num252 = -1;
												int num253 = -1;
												int num254 = -1;
												int num255 = -1;
												int num256 = -1;
												if (tile3 != null && tile3.nactive() && !tile3.bottomSlope())
												{
													num250 = (int)tile3.type;
												}
												if (tile4 != null && tile4.nactive() && !tile4.halfBrick() && !tile4.topSlope())
												{
													num249 = (int)tile4.type;
												}
												if (tile5 != null && tile5.nactive() && (tile5.slope() == 0 || tile5.slope() % 2 != 1))
												{
													num251 = (int)tile5.type;
												}
												if (tile6 != null && tile6.nactive() && (tile6.slope() == 0 || tile6.slope() % 2 != 0))
												{
													num252 = (int)tile6.type;
												}
												if (tile7 != null && tile7.nactive())
												{
													num253 = (int)tile7.type;
												}
												if (tile8 != null && tile8.nactive())
												{
													num254 = (int)tile8.type;
												}
												if (tile9 != null && tile9.nactive())
												{
													num255 = (int)tile9.type;
												}
												if (tile10 != null && tile10.nactive())
												{
													num256 = (int)tile10.type;
												}
												bool flag16 = false;
												bool flag17 = false;
												bool flag18 = false;
												bool flag19 = false;
												if (num249 >= 0 && Main.tileSolid[num249] && (!Main.tileNoAttach[num249] || TileID.Sets.Platforms[num249]) && (tile4.bottomSlope() || tile4.slope() == 0) && !tile4.halfBrick())
												{
													flag19 = true;
												}
												if (num250 >= 0 && Main.tileSolid[num250] && (!Main.tileNoAttach[num250] || (TileID.Sets.Platforms[num250] && tile3.halfBrick())) && (tile3.topSlope() || tile3.slope() == 0 || tile3.halfBrick()))
												{
													flag16 = true;
												}
												if ((num251 >= 0 && Main.tileSolid[num251] && !Main.tileNoAttach[num251] && (tile5.leftSlope() || tile5.slope() == 0) && !tile5.halfBrick()) || num251 == 124 || (num251 == 5 && num255 == 5 && num253 == 5))
												{
													flag17 = true;
												}
												if ((num252 >= 0 && Main.tileSolid[num252] && !Main.tileNoAttach[num252] && (tile6.rightSlope() || tile6.slope() == 0) && !tile6.halfBrick()) || num252 == 124 || (num252 == 5 && num256 == 5 && num254 == 5))
												{
													flag18 = true;
												}
												int num257 = (int)(Main.tile[num242, num243].frameX / 22);
												short num258 = -2;
												switch (num257)
												{
													case 0:
														if (flag17)
														{
															num258 = 2;
														}
														else if (flag16)
														{
															num258 = 1;
														}
														else if (flag18)
														{
															num258 = 3;
														}
														else
														{
															num258 = -1;
														}
														break;
													case 1:
														if (flag18)
														{
															num258 = 3;
														}
														else if (flag19)
														{
															num258 = 0;
														}
														else if (flag17)
														{
															num258 = 2;
														}
														else
														{
															num258 = -1;
														}
														break;
													case 2:
														if (flag16)
														{
															num258 = 1;
														}
														else if (flag18)
														{
															num258 = 3;
														}
														else if (flag19)
														{
															num258 = 0;
														}
														else
														{
															num258 = -1;
														}
														break;
													case 3:
														if (flag19)
														{
															num258 = 0;
														}
														else if (flag17)
														{
															num258 = 2;
														}
														else if (flag16)
														{
															num258 = 1;
														}
														else
														{
															num258 = -1;
														}
														break;
												}
												if (num258 != -1)
												{
													if (num258 == -2)
													{
														num258 = 0;
													}
													Main.tile[num242, num243].frameX = (short)(22 * num258);
													if (Main.netMode == 1)
													{
														NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 1, TileChangeType.None);
													}
												}
											}
											else if ((Main.tile[num242, num243].halfBrick() || Main.tile[num242, num243].slope() != 0) && !Main.tileSolidTop[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
											{
												int num259 = 1;
												int num260 = 1;
												int num261 = 2;
												if ((WorldGen.SolidTile(num242 + 1, num243) || Main.tile[num242 + 1, num243].slope() == 1 || Main.tile[num242 + 1, num243].slope() == 3) && !WorldGen.SolidTile(num242 - 1, num243))
												{
													num260 = 2;
													num261 = 1;
												}
												if (WorldGen.SolidTile(num242, num243 - 1) && !WorldGen.SolidTile(num242, num243 + 1))
												{
													num259 = -1;
												}
												if (num259 == 1)
												{
													if (Main.tile[num242, num243].slope() == 0)
													{
														WorldGen.SlopeTile(num242, num243, num260);
													}
													else if ((int)Main.tile[num242, num243].slope() == num260)
													{
														WorldGen.SlopeTile(num242, num243, num261);
													}
													else if ((int)Main.tile[num242, num243].slope() == num261)
													{
														WorldGen.SlopeTile(num242, num243, num260 + 2);
													}
													else if ((int)Main.tile[num242, num243].slope() == num260 + 2)
													{
														WorldGen.SlopeTile(num242, num243, num261 + 2);
													}
													else
													{
														WorldGen.SlopeTile(num242, num243, 0);
													}
												}
												else if (Main.tile[num242, num243].slope() == 0)
												{
													WorldGen.SlopeTile(num242, num243, num260 + 2);
												}
												else if ((int)Main.tile[num242, num243].slope() == num260 + 2)
												{
													WorldGen.SlopeTile(num242, num243, num261 + 2);
												}
												else if ((int)Main.tile[num242, num243].slope() == num261 + 2)
												{
													WorldGen.SlopeTile(num242, num243, num260);
												}
												else if ((int)Main.tile[num242, num243].slope() == num260)
												{
													WorldGen.SlopeTile(num242, num243, num261);
												}
												else
												{
													WorldGen.SlopeTile(num242, num243, 0);
												}
												int num262 = (int)Main.tile[num242, num243].slope();
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num262, 0, 0, 0);
												}
											}
											else
											{
												WorldGen.PoundTile(num242, num243);
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 7, (float)Player.tileTargetX, (float)Player.tileTargetY, 1f, 0, 0, 0);
												}
											}
											this.poundRelease = false;
										}
									}
									else
									{
										WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, true, true, false);
										Main.PlaySound(0, Player.tileTargetX * 16, Player.tileTargetY * 16, 1, 1f, 0f);
									}
								}
								else
								{
									this.poundRelease = false;
								}
							}
						}
						if (this.releaseUseItem)
						{
							this.poundRelease = true;
						}
						int num263 = Player.tileTargetX;
						int num264 = Player.tileTargetY;
						bool flag20 = true;
						if (Main.tile[num263, num264].wall > 0)
						{
							if (!Main.wallHouse[(int)Main.tile[num263, num264].wall])
							{
								for (int num265 = num263 - 1; num265 < num263 + 2; num265++)
								{
									for (int num266 = num264 - 1; num266 < num264 + 2; num266++)
									{
										if (Main.tile[num265, num266].wall != Main.tile[num263, num264].wall)
										{
											flag20 = false;
											break;
										}
									}
								}
							}
							else
							{
								flag20 = false;
							}
						}
						if (flag20 && !Main.tile[num263, num264].active())
						{
							int num267 = -1;
							if ((double)(((float)Main.mouseX + Main.screenPosition.X) / 16f) < Math.Round((double)(((float)Main.mouseX + Main.screenPosition.X) / 16f)))
							{
								num267 = 0;
							}
							int num268 = -1;
							if ((double)(((float)Main.mouseY + Main.screenPosition.Y) / 16f) < Math.Round((double)(((float)Main.mouseY + Main.screenPosition.Y) / 16f)))
							{
								num268 = 0;
							}
							for (int num269 = Player.tileTargetX + num267; num269 <= Player.tileTargetX + num267 + 1; num269++)
							{
								for (int num270 = Player.tileTargetY + num268; num270 <= Player.tileTargetY + num268 + 1; num270++)
								{
									if (flag20)
									{
										num263 = num269;
										num264 = num270;
										if (Main.tile[num263, num264].wall > 0)
										{
											if (!Main.wallHouse[(int)Main.tile[num263, num264].wall])
											{
												for (int num271 = num263 - 1; num271 < num263 + 2; num271++)
												{
													for (int num272 = num264 - 1; num272 < num264 + 2; num272++)
													{
														if (Main.tile[num271, num272].wall != Main.tile[num263, num264].wall)
														{
															flag20 = false;
															break;
														}
													}
												}
											}
											else
											{
												flag20 = false;
											}
										}
									}
								}
							}
						}
						if (flag15 && Main.tile[num263, num264].wall > 0 && (!Main.tile[num263, num264].active() || num263 != Player.tileTargetX || num264 != Player.tileTargetY || (!Main.tileHammer[(int)Main.tile[num263, num264].type] && !this.poundRelease)) && this.toolTime == 0 && this.itemAnimation > 0 && this.controlUseItem && item.hammer > 0)
						{
							bool flag21 = true;
							if (!Main.wallHouse[(int)Main.tile[num263, num264].wall])
							{
								flag21 = false;
								for (int num273 = num263 - 1; num273 < num263 + 2; num273++)
								{
									for (int num274 = num264 - 1; num274 < num264 + 2; num274++)
									{
										if (Main.tile[num273, num274].wall == 0 || Main.wallHouse[(int)Main.tile[num273, num274].wall])
										{
											flag21 = true;
											break;
										}
									}
								}
							}
							if (flag21)
							{
								int tileId = this.hitTile.HitObject(num263, num264, 2);
								num241 = (int)((float)item.hammer * 1.5f);
								if (this.hitTile.AddDamage(tileId, num241, true) >= 100)
								{
									this.hitTile.Clear(tileId);
									WorldGen.KillWall(num263, num264, false);
									if (Main.netMode == 1)
									{
										NetMessage.SendData(17, -1, -1, null, 2, (float)num263, (float)num264, 0f, 0, 0, 0);
									}
								}
								else
								{
									WorldGen.KillWall(num263, num264, true);
									if (Main.netMode == 1)
									{
										NetMessage.SendData(17, -1, -1, null, 2, (float)num263, (float)num264, 1f, 0, 0, 0);
									}
								}
								if (num241 != 0)
								{
									this.hitTile.Prune();
								}
								this.itemTime = item.useTime / 2;
							}
						}
					}
				}
				if (Main.myPlayer == this.whoAmI && item.type == 1326 && this.itemAnimation > 0 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					Vector2 vector31;
					vector31.X = (float)Main.mouseX + Main.screenPosition.X;
					if (this.gravDir == 1f)
					{
						vector31.Y = (float)Main.mouseY + Main.screenPosition.Y - (float)this.height;
					}
					else
					{
						vector31.Y = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY;
					}
					vector31.X -= (float)(this.width / 2);
					if (vector31.X > 50f && vector31.X < (float)(Main.maxTilesX * 16 - 50) && vector31.Y > 50f && vector31.Y < (float)(Main.maxTilesY * 16 - 50))
					{
						int num275 = (int)(vector31.X / 16f);
						int num276 = (int)(vector31.Y / 16f);
						if ((Main.tile[num275, num276].wall != 87 || (double)num276 <= Main.worldSurface || NPC.downedPlantBoss) && !Collision.SolidCollision(vector31, this.width, this.height))
						{
							this.Teleport(vector31, 1, 0);
							NetMessage.SendData(65, -1, -1, null, 0, (float)this.whoAmI, vector31.X, vector31.Y, 1, 0, 0);
							if (this.chaosState)
							{
								this.statLife -= this.statLifeMax2 / 7;
								PlayerDeathReason damageSource = PlayerDeathReason.ByOther(13);
								if (Main.rand.Next(2) == 0)
								{
									damageSource = PlayerDeathReason.ByOther(this.Male ? 14 : 15);
								}
								if (this.statLife <= 0)
								{
									this.KillMe(damageSource, 1.0, 0, false);
								}
								this.lifeRegenCount = 0;
								this.lifeRegenTime = 0;
							}
							this.AddBuff(88, 360, true);
						}
					}
				}
				if (item.type == 29 && this.itemAnimation > 0 && this.statLifeMax < 400 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					this.statLifeMax += 20;
					this.statLifeMax2 += 20;
					this.statLife += 20;
					if (Main.myPlayer == this.whoAmI)
					{
						this.HealEffect(20, true);
					}
					AchievementsHelper.HandleSpecialEvent(this, 0);
				}
				if (item.type == 1291 && this.itemAnimation > 0 && this.statLifeMax >= 400 && this.statLifeMax < 500 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					this.statLifeMax += 5;
					this.statLifeMax2 += 5;
					this.statLife += 5;
					if (Main.myPlayer == this.whoAmI)
					{
						this.HealEffect(5, true);
					}
					AchievementsHelper.HandleSpecialEvent(this, 2);
				}
				if (item.type == 109 && this.itemAnimation > 0 && this.statManaMax < 200 && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					this.statManaMax += 20;
					this.statManaMax2 += 20;
					this.statMana += 20;
					if (Main.myPlayer == this.whoAmI)
					{
						this.ManaEffect(20);
					}
					AchievementsHelper.HandleSpecialEvent(this, 1);
				}
				if (item.type == 3335 && this.itemAnimation > 0 && !this.extraAccessory && Main.expertMode && this.itemTime == 0)
				{
					this.itemTime = item.useTime;
					this.extraAccessory = true;
					NetMessage.SendData(4, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
				}
				this.PlaceThing();
			}
			if (item.type == 3542)
			{
				Vector2 vector32 = Main.OffsetsPlayerOnhand[this.bodyFrame.Y / 56] * 2f;
				if (this.direction != 1)
				{
					vector32.X = (float)this.bodyFrame.Width - vector32.X;
				}
				if (this.gravDir != 1f)
				{
					vector32.Y = (float)this.bodyFrame.Height - vector32.Y;
				}
				vector32 -= new Vector2((float)(this.bodyFrame.Width - this.width), (float)(this.bodyFrame.Height - 42)) / 2f;
				Vector2 position = this.RotatedRelativePoint(this.position + vector32, true) - this.velocity;
				for (int num277 = 0; num277 < 4; num277++)
				{
					Dust dust = Main.dust[Dust.NewDust(base.Center, 0, 0, 242, (float)(this.direction * 2), 0f, 150, default(Color), 1.3f)];
					dust.position = position;
					dust.velocity *= 0f;
					dust.noGravity = true;
					dust.fadeIn = 1f;
					dust.velocity += this.velocity;
					if (Main.rand.Next(2) == 0)
					{
						dust.position += Utils.RandomVector2(Main.rand, -4f, 4f);
						dust.scale += Main.rand.NextFloat();
						if (Main.rand.Next(2) == 0)
						{
							dust.customData = this;
						}
					}
				}
			}
			if (((item.damage >= 0 && item.type > 0 && !item.noMelee) || item.type == 1450 || item.type == 1991 || item.type == 3183 || item.type == 3542 || item.type == 3779) && this.itemAnimation > 0)
			{
				bool flag22 = false;
				Rectangle rectangle = new Rectangle((int)this.itemLocation.X, (int)this.itemLocation.Y, 32, 32);
				if (!Main.dedServ)
				{
					rectangle = new Rectangle((int)this.itemLocation.X, (int)this.itemLocation.Y, Main.itemTexture[item.type].Width, Main.itemTexture[item.type].Height);
				}
				rectangle.Width = (int)((float)rectangle.Width * item.scale);
				rectangle.Height = (int)((float)rectangle.Height * item.scale);
				if (this.direction == -1)
				{
					rectangle.X -= rectangle.Width;
				}
				if (this.gravDir == 1f)
				{
					rectangle.Y -= rectangle.Height;
				}
				if (item.useStyle == 1)
				{
					if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.333)
					{
						if (this.direction == -1)
						{
							rectangle.X -= (int)((double)rectangle.Width * 1.4 - (double)rectangle.Width);
						}
						rectangle.Width = (int)((double)rectangle.Width * 1.4);
						rectangle.Y += (int)((double)rectangle.Height * 0.5 * (double)this.gravDir);
						rectangle.Height = (int)((double)rectangle.Height * 1.1);
					}
					else if ((double)this.itemAnimation >= (double)this.itemAnimationMax * 0.666)
					{
						if (this.direction == 1)
						{
							rectangle.X -= (int)((double)rectangle.Width * 1.2);
						}
						rectangle.Width *= 2;
						rectangle.Y -= (int)(((double)rectangle.Height * 1.4 - (double)rectangle.Height) * (double)this.gravDir);
						rectangle.Height = (int)((double)rectangle.Height * 1.4);
					}
				}
				else if (item.useStyle == 3)
				{
					if ((double)this.itemAnimation > (double)this.itemAnimationMax * 0.666)
					{
						flag22 = true;
					}
					else
					{
						if (this.direction == -1)
						{
							rectangle.X -= (int)((double)rectangle.Width * 1.4 - (double)rectangle.Width);
						}
						rectangle.Width = (int)((double)rectangle.Width * 1.4);
						rectangle.Y += (int)((double)rectangle.Height * 0.6);
						rectangle.Height = (int)((double)rectangle.Height * 0.6);
					}
				}
				float arg_D13E_0 = this.gravDir;
				if (item.type == 1450 && Main.rand.Next(3) == 0)
				{
					int num278 = -1;
					float x = (float)(rectangle.X + Main.rand.Next(rectangle.Width));
					float y5 = (float)(rectangle.Y + Main.rand.Next(rectangle.Height));
					if (Main.rand.Next(500) == 0)
					{
						num278 = Gore.NewGore(new Vector2(x, y5), default(Vector2), 415, (float)Main.rand.Next(51, 101) * 0.01f);
					}
					else if (Main.rand.Next(250) == 0)
					{
						num278 = Gore.NewGore(new Vector2(x, y5), default(Vector2), 414, (float)Main.rand.Next(51, 101) * 0.01f);
					}
					else if (Main.rand.Next(80) == 0)
					{
						num278 = Gore.NewGore(new Vector2(x, y5), default(Vector2), 413, (float)Main.rand.Next(51, 101) * 0.01f);
					}
					else if (Main.rand.Next(10) == 0)
					{
						num278 = Gore.NewGore(new Vector2(x, y5), default(Vector2), 412, (float)Main.rand.Next(51, 101) * 0.01f);
					}
					else if (Main.rand.Next(3) == 0)
					{
						num278 = Gore.NewGore(new Vector2(x, y5), default(Vector2), 411, (float)Main.rand.Next(51, 101) * 0.01f);
					}
					if (num278 >= 0)
					{
						Gore expr_D371_cp_0_cp_0 = Main.gore[num278];
						expr_D371_cp_0_cp_0.velocity.X = expr_D371_cp_0_cp_0.velocity.X + (float)(this.direction * 2);
						Gore expr_D394_cp_0_cp_0 = Main.gore[num278];
						expr_D394_cp_0_cp_0.velocity.Y = expr_D394_cp_0_cp_0.velocity.Y * 0.3f;
					}
				}
				if (item.type == 3542)
				{
					flag22 = true;
				}
				if (item.type == 3779)
				{
					flag22 = true;
					Vector2 vector33 = this.itemLocation + new Vector2((float)(this.direction * 30), -8f);
					int arg_D3FC_0 = this.itemAnimation;
					int arg_D3FB_0 = this.itemAnimationMax - 2;
					Vector2 value9 = vector33 - this.position;
					for (float num279 = 0f; num279 < 1f; num279 += 0.2f)
					{
						Vector2 position2 = Vector2.Lerp(this.oldPosition + value9 + new Vector2(0f, this.gfxOffY), vector33, num279);
						Dust expr_D4A6 = Main.dust[Dust.NewDust(vector33 - Vector2.One * 8f, 16, 16, 27, 0f, -2f, 0, default(Color), 1f)];
						expr_D4A6.noGravity = true;
						expr_D4A6.position = position2;
						expr_D4A6.velocity = new Vector2(0f, -this.gravDir * 2f);
						expr_D4A6.scale = 1.2f;
						expr_D4A6.alpha = 200;
					}
				}
				if (!flag22)
				{
					if (item.type == 989 && Main.rand.Next(5) == 0)
					{
						int num280 = Main.rand.Next(3);
						if (num280 == 0)
						{
							num280 = 15;
						}
						else if (num280 == 1)
						{
							num280 = 57;
						}
						else
						{
							num280 = 58;
						}
						int num281 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, num280, (float)(this.direction * 2), 0f, 150, default(Color), 1.3f);
						Main.dust[num281].velocity *= 0.2f;
					}
					if (item.type == 2880 && Main.rand.Next(2) == 0)
					{
						int type5 = Utils.SelectRandom<int>(Main.rand, new int[]
						{
							226,
							229
						});
						int num282 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, type5, (float)(this.direction * 2), 0f, 150, default(Color), 1f);
						Main.dust[num282].velocity *= 0.2f;
						Main.dust[num282].noGravity = true;
					}
					if ((item.type == 44 || item.type == 45 || item.type == 46 || item.type == 103 || item.type == 104) && Main.rand.Next(15) == 0)
					{
						Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 14, (float)(this.direction * 2), 0f, 150, default(Color), 1.3f);
					}
					if (item.type == 273 || item.type == 675)
					{
						if (Main.rand.Next(5) == 0)
						{
							Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 14, (float)(this.direction * 2), 0f, 150, default(Color), 1.4f);
						}
						int num283 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 27, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 1.2f);
						Main.dust[num283].noGravity = true;
						Dust expr_D8A5_cp_0_cp_0 = Main.dust[num283];
						expr_D8A5_cp_0_cp_0.velocity.X = expr_D8A5_cp_0_cp_0.velocity.X / 2f;
						Dust expr_D8C4_cp_0_cp_0 = Main.dust[num283];
						expr_D8C4_cp_0_cp_0.velocity.Y = expr_D8C4_cp_0_cp_0.velocity.Y / 2f;
					}
					if (item.type == 723 && Main.rand.Next(2) == 0)
					{
						int num284 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 64, 0f, 0f, 150, default(Color), 1.2f);
						Main.dust[num284].noGravity = true;
					}
					if (item.type == 65)
					{
						if (Main.rand.Next(5) == 0)
						{
							Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 58, 0f, 0f, 150, default(Color), 1.2f);
						}
						if (Main.rand.Next(10) == 0)
						{
							Gore.NewGore(new Vector2((float)rectangle.X, (float)rectangle.Y), default(Vector2), Main.rand.Next(16, 18), 1f);
						}
					}
					if (item.type == 3065)
					{
						int num285 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 58, 0f, 0f, 150, default(Color), 1.2f);
						Main.dust[num285].velocity *= 0.5f;
						if (Main.rand.Next(8) == 0)
						{
							int num286 = Gore.NewGore(new Vector2((float)rectangle.Center.X, (float)rectangle.Center.Y), default(Vector2), 16, 1f);
							Main.gore[num286].velocity *= 0.5f;
							Main.gore[num286].velocity += new Vector2((float)this.direction, 0f);
						}
					}
					if (item.type == 190)
					{
						int num287 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 40, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 0, default(Color), 1.2f);
						Main.dust[num287].noGravity = true;
					}
					else if (item.type == 213)
					{
						int num288 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 3, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 0, default(Color), 1.2f);
						Main.dust[num288].noGravity = true;
					}
					if (item.type == 121)
					{
						for (int num289 = 0; num289 < 2; num289++)
						{
							int num290 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 6, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 2.5f);
							Main.dust[num290].noGravity = true;
							Dust expr_DD45_cp_0_cp_0 = Main.dust[num290];
							expr_DD45_cp_0_cp_0.velocity.X = expr_DD45_cp_0_cp_0.velocity.X * 2f;
							Dust expr_DD64_cp_0_cp_0 = Main.dust[num290];
							expr_DD64_cp_0_cp_0.velocity.Y = expr_DD64_cp_0_cp_0.velocity.Y * 2f;
						}
					}
					if (item.type == 122 || item.type == 217)
					{
						int num291 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 6, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 1.9f);
						Main.dust[num291].noGravity = true;
					}
					if (item.type == 155)
					{
						int num292 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 172, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 0.9f);
						Main.dust[num292].noGravity = true;
						Main.dust[num292].velocity *= 0.1f;
					}
					if (item.type == 676 && Main.rand.Next(3) == 0)
					{
						int num293 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 67, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 90, default(Color), 1.5f);
						Main.dust[num293].noGravity = true;
						Main.dust[num293].velocity *= 0.2f;
					}
					if (item.type == 3063)
					{
						int num294 = Dust.NewDust(rectangle.TopLeft(), rectangle.Width, rectangle.Height, 66, 0f, 0f, 150, Color.Transparent, 0.85f);
						Main.dust[num294].color = Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f);
						Main.dust[num294].noGravity = true;
						Main.dust[num294].velocity /= 2f;
					}
					if (item.type == 3823)
					{
						Dust expr_E0E5 = Dust.NewDustDirect(rectangle.TopLeft(), rectangle.Width, rectangle.Height, 6, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, Color.Transparent, 0.7f);
						expr_E0E5.noGravity = true;
						expr_E0E5.velocity *= 2f;
						expr_E0E5.fadeIn = 0.9f;
					}
					if (item.type == 724 && Main.rand.Next(5) == 0)
					{
						int num295 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 67, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 90, default(Color), 1.5f);
						Main.dust[num295].noGravity = true;
						Main.dust[num295].velocity *= 0.2f;
					}
					if (item.type >= 795 && item.type <= 802 && Main.rand.Next(3) == 0)
					{
						int num296 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 115, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 140, default(Color), 1.5f);
						Main.dust[num296].noGravity = true;
						Main.dust[num296].velocity *= 0.25f;
					}
					if (item.type == 367 || item.type == 368 || item.type == 674)
					{
						if (Main.rand.Next(3) == 0)
						{
							int num297 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 57, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 1.1f);
							Main.dust[num297].noGravity = true;
							Dust expr_E3A5_cp_0_cp_0 = Main.dust[num297];
							expr_E3A5_cp_0_cp_0.velocity.X = expr_E3A5_cp_0_cp_0.velocity.X / 2f;
							Dust expr_E3C4_cp_0_cp_0 = Main.dust[num297];
							expr_E3C4_cp_0_cp_0.velocity.Y = expr_E3C4_cp_0_cp_0.velocity.Y / 2f;
							Dust expr_E3E3_cp_0_cp_0 = Main.dust[num297];
							expr_E3E3_cp_0_cp_0.velocity.X = expr_E3E3_cp_0_cp_0.velocity.X + (float)(this.direction * 2);
						}
						if (Main.rand.Next(4) == 0)
						{
							int num297 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 43, 0f, 0f, 254, default(Color), 0.3f);
							Main.dust[num297].velocity *= 0f;
						}
					}
					if ((item.type >= 198 && item.type <= 203) || (item.type >= 3764 && item.type <= 3769))
					{
						float num298 = 0.5f;
						float num299 = 0.5f;
						float num300 = 0.5f;
						if (item.type == 198 || item.type == 3764)
						{
							num298 *= 0.1f;
							num299 *= 0.5f;
							num300 *= 1.2f;
						}
						else if (item.type == 199 || item.type == 3765)
						{
							num298 *= 1f;
							num299 *= 0.2f;
							num300 *= 0.1f;
						}
						else if (item.type == 200 || item.type == 3766)
						{
							num298 *= 0.1f;
							num299 *= 1f;
							num300 *= 0.2f;
						}
						else if (item.type == 201 || item.type == 3767)
						{
							num298 *= 0.8f;
							num299 *= 0.1f;
							num300 *= 1f;
						}
						else if (item.type == 202 || item.type == 3768)
						{
							num298 *= 0.8f;
							num299 *= 0.9f;
							num300 *= 1f;
						}
						else if (item.type == 203 || item.type == 3769)
						{
							num298 *= 0.9f;
							num299 *= 0.9f;
							num300 *= 0.1f;
						}
						Lighting.AddLight((int)((this.itemLocation.X + 6f + this.velocity.X) / 16f), (int)((this.itemLocation.Y - 14f) / 16f), num298, num299, num300);
					}
					if (this.frostBurn && item.melee && !item.noMelee && !item.noUseGraphic && Main.rand.Next(2) == 0)
					{
						int num301 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 135, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 2.5f);
						Main.dust[num301].noGravity = true;
						Main.dust[num301].velocity *= 0.7f;
						Dust expr_E825_cp_0_cp_0 = Main.dust[num301];
						expr_E825_cp_0_cp_0.velocity.Y = expr_E825_cp_0_cp_0.velocity.Y - 0.5f;
					}
					if (item.melee && !item.noMelee && !item.noUseGraphic && this.meleeEnchant > 0)
					{
						if (this.meleeEnchant == 1)
						{
							if (Main.rand.Next(3) == 0)
							{
								int num302 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 171, 0f, 0f, 100, default(Color), 1f);
								Main.dust[num302].noGravity = true;
								Main.dust[num302].fadeIn = 1.5f;
								Main.dust[num302].velocity *= 0.25f;
							}
						}
						else if (this.meleeEnchant == 2)
						{
							if (Main.rand.Next(2) == 0)
							{
								int num303 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 75, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 2.5f);
								Main.dust[num303].noGravity = true;
								Main.dust[num303].velocity *= 0.7f;
								Dust expr_EA05_cp_0_cp_0 = Main.dust[num303];
								expr_EA05_cp_0_cp_0.velocity.Y = expr_EA05_cp_0_cp_0.velocity.Y - 0.5f;
							}
						}
						else if (this.meleeEnchant == 3)
						{
							if (Main.rand.Next(2) == 0)
							{
								int num304 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 6, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 2.5f);
								Main.dust[num304].noGravity = true;
								Main.dust[num304].velocity *= 0.7f;
								Dust expr_EAF4_cp_0_cp_0 = Main.dust[num304];
								expr_EAF4_cp_0_cp_0.velocity.Y = expr_EAF4_cp_0_cp_0.velocity.Y - 0.5f;
							}
						}
						else if (this.meleeEnchant == 4)
						{
							if (Main.rand.Next(2) == 0)
							{
								int num305 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 57, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 1.1f);
								Main.dust[num305].noGravity = true;
								Dust expr_EBCA_cp_0_cp_0 = Main.dust[num305];
								expr_EBCA_cp_0_cp_0.velocity.X = expr_EBCA_cp_0_cp_0.velocity.X / 2f;
								Dust expr_EBE9_cp_0_cp_0 = Main.dust[num305];
								expr_EBE9_cp_0_cp_0.velocity.Y = expr_EBE9_cp_0_cp_0.velocity.Y / 2f;
							}
						}
						else if (this.meleeEnchant == 5)
						{
							if (Main.rand.Next(2) == 0)
							{
								int num306 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 169, 0f, 0f, 100, default(Color), 1f);
								Dust expr_EC87_cp_0_cp_0 = Main.dust[num306];
								expr_EC87_cp_0_cp_0.velocity.X = expr_EC87_cp_0_cp_0.velocity.X + (float)this.direction;
								Dust expr_ECA8_cp_0_cp_0 = Main.dust[num306];
								expr_ECA8_cp_0_cp_0.velocity.Y = expr_ECA8_cp_0_cp_0.velocity.Y + 0.2f;
								Main.dust[num306].noGravity = true;
							}
						}
						else if (this.meleeEnchant == 6)
						{
							if (Main.rand.Next(2) == 0)
							{
								int num307 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 135, 0f, 0f, 100, default(Color), 1f);
								Dust expr_ED58_cp_0_cp_0 = Main.dust[num307];
								expr_ED58_cp_0_cp_0.velocity.X = expr_ED58_cp_0_cp_0.velocity.X + (float)this.direction;
								Dust expr_ED79_cp_0_cp_0 = Main.dust[num307];
								expr_ED79_cp_0_cp_0.velocity.Y = expr_ED79_cp_0_cp_0.velocity.Y + 0.2f;
								Main.dust[num307].noGravity = true;
							}
						}
						else if (this.meleeEnchant == 7)
						{
							if (Main.rand.Next(20) == 0)
							{
								int type6 = Main.rand.Next(139, 143);
								int num308 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, type6, this.velocity.X, this.velocity.Y, 0, default(Color), 1.2f);
								Dust expr_EE50_cp_0_cp_0 = Main.dust[num308];
								expr_EE50_cp_0_cp_0.velocity.X = expr_EE50_cp_0_cp_0.velocity.X * (1f + (float)Main.rand.Next(-50, 51) * 0.01f);
								Dust expr_EE85_cp_0_cp_0 = Main.dust[num308];
								expr_EE85_cp_0_cp_0.velocity.Y = expr_EE85_cp_0_cp_0.velocity.Y * (1f + (float)Main.rand.Next(-50, 51) * 0.01f);
								Dust expr_EEBA_cp_0_cp_0 = Main.dust[num308];
								expr_EEBA_cp_0_cp_0.velocity.X = expr_EEBA_cp_0_cp_0.velocity.X + (float)Main.rand.Next(-50, 51) * 0.05f;
								Dust expr_EEE9_cp_0_cp_0 = Main.dust[num308];
								expr_EEE9_cp_0_cp_0.velocity.Y = expr_EEE9_cp_0_cp_0.velocity.Y + (float)Main.rand.Next(-50, 51) * 0.05f;
								Main.dust[num308].scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
							}
							if (Main.rand.Next(40) == 0)
							{
								int type7 = Main.rand.Next(276, 283);
								int num309 = Gore.NewGore(new Vector2((float)rectangle.X, (float)rectangle.Y), this.velocity, type7, 1f);
								Gore expr_EFAF_cp_0_cp_0 = Main.gore[num309];
								expr_EFAF_cp_0_cp_0.velocity.X = expr_EFAF_cp_0_cp_0.velocity.X * (1f + (float)Main.rand.Next(-50, 51) * 0.01f);
								Gore expr_EFE4_cp_0_cp_0 = Main.gore[num309];
								expr_EFE4_cp_0_cp_0.velocity.Y = expr_EFE4_cp_0_cp_0.velocity.Y * (1f + (float)Main.rand.Next(-50, 51) * 0.01f);
								Main.gore[num309].scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
								Gore expr_F04C_cp_0_cp_0 = Main.gore[num309];
								expr_F04C_cp_0_cp_0.velocity.X = expr_F04C_cp_0_cp_0.velocity.X + (float)Main.rand.Next(-50, 51) * 0.05f;
								Gore expr_F07B_cp_0_cp_0 = Main.gore[num309];
								expr_F07B_cp_0_cp_0.velocity.Y = expr_F07B_cp_0_cp_0.velocity.Y + (float)Main.rand.Next(-50, 51) * 0.05f;
							}
						}
						else if (this.meleeEnchant == 8 && Main.rand.Next(4) == 0)
						{
							int num310 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 46, 0f, 0f, 100, default(Color), 1f);
							Main.dust[num310].noGravity = true;
							Main.dust[num310].fadeIn = 1.5f;
							Main.dust[num310].velocity *= 0.25f;
						}
					}
					if (this.magmaStone && item.melee && !item.noMelee && !item.noUseGraphic && Main.rand.Next(3) != 0)
					{
						int num311 = Dust.NewDust(new Vector2((float)rectangle.X, (float)rectangle.Y), rectangle.Width, rectangle.Height, 6, this.velocity.X * 0.2f + (float)(this.direction * 3), this.velocity.Y * 0.2f, 100, default(Color), 2.5f);
						Main.dust[num311].noGravity = true;
						Dust expr_F239_cp_0_cp_0 = Main.dust[num311];
						expr_F239_cp_0_cp_0.velocity.X = expr_F239_cp_0_cp_0.velocity.X * 2f;
						Dust expr_F258_cp_0_cp_0 = Main.dust[num311];
						expr_F258_cp_0_cp_0.velocity.Y = expr_F258_cp_0_cp_0.velocity.Y * 2f;
					}
					if (Main.myPlayer == i && (item.type == 1991 || item.type == 3183))
					{
						for (int num312 = 0; num312 < 200; num312++)
						{
							if (Main.npc[num312].active && Main.npc[num312].catchItem > 0)
							{
								Rectangle value10 = new Rectangle((int)Main.npc[num312].position.X, (int)Main.npc[num312].position.Y, Main.npc[num312].width, Main.npc[num312].height);
								if (rectangle.Intersects(value10) && (item.type == 3183 || Main.npc[num312].noTileCollide || this.CanHit(Main.npc[num312])))
								{
									NPC.CatchNPC(num312, i);
								}
							}
						}
					}
					if (Main.myPlayer == i && (item.damage > 0 || item.type == 3183))
					{
						int num313 = item.damage;
						if (item.melee)
						{
							num313 = (int)((float)item.damage * this.meleeDamage);
						}
						if (item.ranged)
						{
							num313 = (int)((float)item.damage * this.rangedDamage);
						}
						if (item.magic)
						{
							num313 = (int)((float)item.damage * this.magicDamage);
						}
						if (item.summon)
						{
							num313 = (int)((float)item.damage * this.minionDamage);
						}
						if (item.thrown)
						{
							num313 = (int)((float)item.damage * this.thrownDamage);
						}
						float num314 = item.knockBack;
						float num315 = 1f;
						if (this.kbGlove)
						{
							num315 += 1f;
						}
						if (this.kbBuff)
						{
							num315 += 0.5f;
						}
						num314 *= num315;
						if (this.inventory[this.selectedItem].type == 3106)
						{
							num314 += num314 * (1f - this.stealth);
						}
						List<ushort> list2 = null;
						int num80 = item.type;
						if (num80 == 213)
						{
							list2 = new List<ushort>(new ushort[]
							{
								3,
								24,
								52,
								61,
								62,
								71,
								73,
								74,
								82,
								83,
								84,
								110,
								113,
								115,
								184,
								205,
								201
							});
						}
						int arg_F581_0 = rectangle.X / 16;
						int num316 = (rectangle.X + rectangle.Width) / 16 + 1;
						int num317 = rectangle.Y / 16;
						int num318 = (rectangle.Y + rectangle.Height) / 16 + 1;
						for (int num319 = arg_F581_0; num319 < num316; num319++)
						{
							for (int num320 = num317; num320 < num318; num320++)
							{
								if (Main.tile[num319, num320] != null && Main.tileCut[(int)Main.tile[num319, num320].type] && (list2 == null || !list2.Contains(Main.tile[num319, num320].type)) && WorldGen.CanCutTile(num319, num320, TileCuttingContext.AttackMelee))
								{
									if (item.type == 1786)
									{
										int type8 = (int)Main.tile[num319, num320].type;
										WorldGen.KillTile(num319, num320, false, false, false);
										if (!Main.tile[num319, num320].active())
										{
											int num321 = 0;
											if (type8 == 3 || type8 == 24 || type8 == 61 || type8 == 110 || type8 == 201)
											{
												num321 = Main.rand.Next(1, 3);
											}
											if (type8 == 73 || type8 == 74 || type8 == 113)
											{
												num321 = Main.rand.Next(2, 5);
											}
											if (num321 > 0)
											{
												int number = Item.NewItem(num319 * 16, num320 * 16, 16, 16, 1727, num321, false, 0, false, false);
												if (Main.netMode == 1)
												{
													NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
												}
											}
										}
										if (Main.netMode == 1)
										{
											NetMessage.SendData(17, -1, -1, null, 0, (float)num319, (float)num320, 0f, 0, 0, 0);
										}
									}
									else
									{
										WorldGen.KillTile(num319, num320, false, false, false);
										if (Main.netMode == 1)
										{
											NetMessage.SendData(17, -1, -1, null, 0, (float)num319, (float)num320, 0f, 0, 0, 0);
										}
									}
								}
							}
						}
						if (item.type != 3183)
						{
							for (int num322 = 0; num322 < 200; num322++)
							{
								if (Main.npc[num322].active && Main.npc[num322].immune[i] == 0 && this.attackCD == 0)
								{
									if (!Main.npc[num322].dontTakeDamage)
									{
										if (!Main.npc[num322].friendly || (Main.npc[num322].type == 22 && this.killGuide) || (Main.npc[num322].type == 54 && this.killClothier))
										{
											Rectangle value11 = new Rectangle((int)Main.npc[num322].position.X, (int)Main.npc[num322].position.Y, Main.npc[num322].width, Main.npc[num322].height);
											if (rectangle.Intersects(value11) && (Main.npc[num322].noTileCollide || this.CanHit(Main.npc[num322])))
											{
												bool flag23 = false;
												if (item.melee && Main.rand.Next(1, 101) <= this.meleeCrit)
												{
													flag23 = true;
												}
												if (item.ranged && Main.rand.Next(1, 101) <= this.rangedCrit)
												{
													flag23 = true;
												}
												if (item.magic && Main.rand.Next(1, 101) <= this.magicCrit)
												{
													flag23 = true;
												}
												if (item.thrown && Main.rand.Next(1, 101) <= this.thrownCrit)
												{
													flag23 = true;
												}
												int num323 = Item.NPCtoBanner(Main.npc[num322].BannerID());
												if (num323 > 0 && this.NPCBannerBuff[num323])
												{
													if (Main.expertMode)
													{
														num313 = (int)((float)num313 * ItemID.Sets.BannerStrength[Item.BannerToItem(num323)].ExpertDamageDealt);
													}
													else
													{
														num313 = (int)((float)num313 * ItemID.Sets.BannerStrength[Item.BannerToItem(num323)].NormalDamageDealt);
													}
												}
												if (this.parryDamageBuff && item.melee)
												{
													num313 *= 5;
													this.parryDamageBuff = false;
													this.ClearBuff(198);
												}
												int num324 = Main.DamageVar((float)num313);
												this.StatusNPC(item.type, num322);
												this.OnHit(Main.npc[num322].Center.X, Main.npc[num322].Center.Y, Main.npc[num322]);
												if (this.armorPenetration > 0)
												{
													num324 += Main.npc[num322].checkArmorPenetration(this.armorPenetration);
												}
												int num325 = (int)Main.npc[num322].StrikeNPC(num324, num314, this.direction, flag23, false, false);
												if (this.inventory[this.selectedItem].type == 3211)
												{
													Vector2 vector34 = new Vector2((float)(this.direction * 100 + Main.rand.Next(-25, 26)), (float)Main.rand.Next(-75, 76));
													vector34.Normalize();
													vector34 *= (float)Main.rand.Next(30, 41) * 0.1f;
													Vector2 vector35 = new Vector2((float)(rectangle.X + Main.rand.Next(rectangle.Width)), (float)(rectangle.Y + Main.rand.Next(rectangle.Height)));
													vector35 = (vector35 + Main.npc[num322].Center * 2f) / 3f;
													Projectile.NewProjectile(vector35.X, vector35.Y, vector34.X, vector34.Y, 524, (int)((double)num313 * 0.7), num314 * 0.7f, this.whoAmI, 0f, 0f);
												}
												bool flag24 = !Main.npc[num322].immortal;
												if (this.beetleOffense & flag24)
												{
													this.beetleCounter += (float)num325;
													this.beetleCountdown = 0;
												}
												if (item.type == 1826 && (Main.npc[num322].value > 0f || (Main.npc[num322].damage > 0 && !Main.npc[num322].friendly)))
												{
													this.pumpkinSword(num322, (int)((double)num313 * 1.5), num314);
												}
												if (this.meleeEnchant == 7)
												{
													Projectile.NewProjectile(Main.npc[num322].Center.X, Main.npc[num322].Center.Y, Main.npc[num322].velocity.X, Main.npc[num322].velocity.Y, 289, 0, 0f, this.whoAmI, 0f, 0f);
												}
												if (this.inventory[this.selectedItem].type == 3106)
												{
													this.stealth = 1f;
													if (Main.netMode == 1)
													{
														NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
													}
												}
												if (item.type == 1123 & flag24)
												{
													int num326 = Main.rand.Next(1, 4);
													if (this.strongBees && Main.rand.Next(3) == 0)
													{
														num326++;
													}
													for (int num327 = 0; num327 < num326; num327++)
													{
														float num328 = (float)(this.direction * 2) + (float)Main.rand.Next(-35, 36) * 0.02f;
														float num329 = (float)Main.rand.Next(-35, 36) * 0.02f;
														num328 *= 0.2f;
														num329 *= 0.2f;
														Projectile.NewProjectile((float)(rectangle.X + rectangle.Width / 2), (float)(rectangle.Y + rectangle.Height / 2), num328, num329, this.beeType(), this.beeDamage(num324 / 3), this.beeKB(0f), i, 0f, 0f);
													}
												}
												if (Main.npc[num322].value > 0f && this.coins && Main.rand.Next(5) == 0)
												{
													int type9 = 71;
													if (Main.rand.Next(10) == 0)
													{
														type9 = 72;
													}
													if (Main.rand.Next(100) == 0)
													{
														type9 = 73;
													}
													int num330 = Item.NewItem((int)Main.npc[num322].position.X, (int)Main.npc[num322].position.Y, Main.npc[num322].width, Main.npc[num322].height, type9, 1, false, 0, false, false);
													Main.item[num330].stack = Main.rand.Next(1, 11);
													Main.item[num330].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
													Main.item[num330].velocity.X = (float)Main.rand.Next(10, 31) * 0.2f * (float)this.direction;
													if (Main.netMode == 1)
													{
														NetMessage.SendData(21, -1, -1, null, num330, 0f, 0f, 0f, 0, 0, 0);
													}
												}
												int num331 = Item.NPCtoBanner(Main.npc[num322].BannerID());
												if (num331 >= 0)
												{
													this.lastCreatureHit = num331;
												}
												if (Main.netMode != 0)
												{
													if (flag23)
													{
														NetMessage.SendData(28, -1, -1, null, num322, (float)num324, num314, (float)this.direction, 1, 0, 0);
													}
													else
													{
														NetMessage.SendData(28, -1, -1, null, num322, (float)num324, num314, (float)this.direction, 0, 0, 0);
													}
												}
												if (this.accDreamCatcher)
												{
													this.addDPS(num324);
												}
												Main.npc[num322].immune[i] = this.itemAnimation;
												this.attackCD = (int)((double)this.itemAnimationMax * 0.33);
											}
										}
									}
									else if (Main.npc[num322].type == 63 || Main.npc[num322].type == 64 || Main.npc[num322].type == 103 || Main.npc[num322].type == 242)
									{
										Rectangle value12 = new Rectangle((int)Main.npc[num322].position.X, (int)Main.npc[num322].position.Y, Main.npc[num322].width, Main.npc[num322].height);
										if (rectangle.Intersects(value12) && (Main.npc[num322].noTileCollide || this.CanHit(Main.npc[num322])))
										{
											this.Hurt(PlayerDeathReason.LegacyDefault(), (int)((double)Main.npc[num322].damage * 1.3), -this.direction, false, false, false, -1);
											Main.npc[num322].immune[i] = this.itemAnimation;
											this.attackCD = (int)((double)this.itemAnimationMax * 0.33);
										}
									}
								}
							}
							if (this.hostile)
							{
								for (int num332 = 0; num332 < 255; num332++)
								{
									if (num332 != i && Main.player[num332].active && Main.player[num332].hostile && !Main.player[num332].immune && !Main.player[num332].dead && (Main.player[i].team == 0 || Main.player[i].team != Main.player[num332].team))
									{
										Rectangle value13 = new Rectangle((int)Main.player[num332].position.X, (int)Main.player[num332].position.Y, Main.player[num332].width, Main.player[num332].height);
										if (rectangle.Intersects(value13) && this.CanHit(Main.player[num332]))
										{
											bool flag25 = false;
											if (Main.rand.Next(1, 101) <= 10)
											{
												flag25 = true;
											}
											int num333 = Main.DamageVar((float)num313);
											this.StatusPvP(item.type, num332);
											this.OnHit(Main.player[num332].Center.X, Main.player[num332].Center.Y, Main.player[num332]);
											PlayerDeathReason playerDeathReason = PlayerDeathReason.ByPlayer(this.whoAmI);
											int num334 = (int)Main.player[num332].Hurt(playerDeathReason, num333, this.direction, true, false, flag25, -1);
											if (this.inventory[this.selectedItem].type == 3211)
											{
												Vector2 vector36 = new Vector2((float)(this.direction * 100 + Main.rand.Next(-25, 26)), (float)Main.rand.Next(-75, 76));
												vector36.Normalize();
												vector36 *= (float)Main.rand.Next(30, 41) * 0.1f;
												Vector2 vector37 = new Vector2((float)(rectangle.X + Main.rand.Next(rectangle.Width)), (float)(rectangle.Y + Main.rand.Next(rectangle.Height)));
												vector37 = (vector37 + Main.player[num332].Center * 2f) / 3f;
												Projectile.NewProjectile(vector37.X, vector37.Y, vector36.X, vector36.Y, 524, (int)((double)num313 * 0.7), num314 * 0.7f, this.whoAmI, 0f, 0f);
											}
											if (this.beetleOffense)
											{
												this.beetleCounter += (float)num334;
												this.beetleCountdown = 0;
											}
											if (this.meleeEnchant == 7)
											{
												Projectile.NewProjectile(Main.player[num332].Center.X, Main.player[num332].Center.Y, Main.player[num332].velocity.X, Main.player[num332].velocity.Y, 289, 0, 0f, this.whoAmI, 0f, 0f);
											}
											if (item.type == 1123)
											{
												int num335 = Main.rand.Next(1, 4);
												if (this.strongBees && Main.rand.Next(3) == 0)
												{
													num335++;
												}
												for (int num336 = 0; num336 < num335; num336++)
												{
													float num337 = (float)(this.direction * 2) + (float)Main.rand.Next(-35, 36) * 0.02f;
													float num338 = (float)Main.rand.Next(-35, 36) * 0.02f;
													num337 *= 0.2f;
													num338 *= 0.2f;
													Projectile.NewProjectile((float)(rectangle.X + rectangle.Width / 2), (float)(rectangle.Y + rectangle.Height / 2), num337, num338, this.beeType(), this.beeDamage(num333 / 3), this.beeKB(0f), i, 0f, 0f);
												}
											}
											if (this.inventory[this.selectedItem].type == 3106)
											{
												this.stealth = 1f;
												if (Main.netMode == 1)
												{
													NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
												}
											}
											if (item.type == 1826 && Main.npc[num332].value > 0f)
											{
												this.pumpkinSword(num332, (int)((double)num313 * 1.5), num314);
											}
											if (Main.netMode != 0)
											{
												NetMessage.SendPlayerHurt(num332, playerDeathReason, num333, this.direction, flag25, true, -1, -1, -1);
											}
											this.attackCD = (int)((double)this.itemAnimationMax * 0.33);
										}
									}
								}
							}
							if (item.type == 787 && (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.1) || this.itemAnimation == (int)((double)this.itemAnimationMax * 0.3) || this.itemAnimation == (int)((double)this.itemAnimationMax * 0.5) || this.itemAnimation == (int)((double)this.itemAnimationMax * 0.7) || this.itemAnimation == (int)((double)this.itemAnimationMax * 0.9)))
							{
								float num339 = 0f;
								float num340 = 0f;
								float num341 = 0f;
								float num342 = 0f;
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.9))
								{
									num339 = -7f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.7))
								{
									num339 = -6f;
									num340 = 2f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.5))
								{
									num339 = -4f;
									num340 = 4f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.3))
								{
									num339 = -2f;
									num340 = 6f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.1))
								{
									num340 = 7f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.7))
								{
									num342 = 26f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.3))
								{
									num342 -= 4f;
									num341 -= 20f;
								}
								if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.1))
								{
									num341 += 6f;
								}
								if (this.direction == -1)
								{
									if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.9))
									{
										num342 -= 8f;
									}
									if (this.itemAnimation == (int)((double)this.itemAnimationMax * 0.7))
									{
										num342 -= 6f;
									}
								}
								num339 *= 1.5f;
								num340 *= 1.5f;
								num342 *= (float)this.direction;
								num341 *= this.gravDir;
								Projectile.NewProjectile((float)(rectangle.X + rectangle.Width / 2) + num342, (float)(rectangle.Y + rectangle.Height / 2) + num341, (float)this.direction * num340, num339 * this.gravDir, 131, num313 / 2, 0f, i, 0f, 0f);
							}
						}
					}
				}
			}
			if (this.itemTime == 0 && this.itemAnimation > 0)
			{
				if (item.hairDye >= 0)
				{
					this.itemTime = item.useTime;
					if (this.whoAmI == Main.myPlayer)
					{
						this.hairDye = (byte)item.hairDye;
						NetMessage.SendData(4, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					}
				}
				if (item.healLife > 0)
				{
					this.statLife += item.healLife;
					this.itemTime = item.useTime;
					if (Main.myPlayer == this.whoAmI)
					{
						this.HealEffect(item.healLife, true);
					}
				}
				if (item.healMana > 0)
				{
					this.statMana += item.healMana;
					this.itemTime = item.useTime;
					if (Main.myPlayer == this.whoAmI)
					{
						this.AddBuff(94, Player.manaSickTime, true);
						this.ManaEffect(item.healMana);
					}
				}
				if (item.buffType > 0)
				{
					if (this.whoAmI == Main.myPlayer && item.buffType != 90 && item.buffType != 27)
					{
						this.AddBuff(item.buffType, item.buffTime, true);
					}
					this.itemTime = item.useTime;
				}
				if (item.type == 678)
				{
					this.itemTime = item.useTime;
					if (this.whoAmI == Main.myPlayer)
					{
						this.AddBuff(20, 216000, true);
						this.AddBuff(22, 216000, true);
						this.AddBuff(23, 216000, true);
						this.AddBuff(24, 216000, true);
						this.AddBuff(30, 216000, true);
						this.AddBuff(31, 216000, true);
						this.AddBuff(32, 216000, true);
						this.AddBuff(33, 216000, true);
						this.AddBuff(35, 216000, true);
						this.AddBuff(36, 216000, true);
						this.AddBuff(68, 216000, true);
					}
				}
			}
			if (this.whoAmI == Main.myPlayer)
			{
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 361 && Main.CanStartInvasion(1, true))
				{
					this.itemTime = item.useTime;
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					if (Main.netMode != 1)
					{
						if (Main.invasionType == 0)
						{
							Main.invasionDelay = 0;
							Main.StartInvasion(1);
						}
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 602 && Main.CanStartInvasion(2, true))
				{
					this.itemTime = item.useTime;
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					if (Main.netMode != 1)
					{
						if (Main.invasionType == 0)
						{
							Main.invasionDelay = 0;
							Main.StartInvasion(2);
						}
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -2f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 1315 && Main.CanStartInvasion(3, true))
				{
					this.itemTime = item.useTime;
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					if (Main.netMode != 1)
					{
						if (Main.invasionType == 0)
						{
							Main.invasionDelay = 0;
							Main.StartInvasion(3);
						}
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -3f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 1844 && !Main.dayTime && !Main.pumpkinMoon && !Main.snowMoon && !DD2Event.Ongoing)
				{
					this.itemTime = item.useTime;
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					if (Main.netMode != 1)
					{
						Main.NewText(Lang.misc[31].Value, 50, 255, 130, false);
						Main.startPumpkinMoon();
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -4f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 2767 && Main.dayTime && !Main.eclipse)
				{
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					this.itemTime = item.useTime;
					if (Main.netMode == 0)
					{
						Main.eclipse = true;
						Main.NewText(Lang.misc[20].Value, 50, 255, 130, false);
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -6f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 3601 && NPC.downedGolemBoss && Main.hardMode && !NPC.AnyDanger() && !NPC.AnyoneNearCultists())
				{
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					this.itemTime = item.useTime;
					if (Main.netMode == 0)
					{
						WorldGen.StartImpendingDoom();
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -8f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.type == 1958 && !Main.dayTime && !Main.pumpkinMoon && !Main.snowMoon && !DD2Event.Ongoing)
				{
					this.itemTime = item.useTime;
					Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
					if (Main.netMode != 1)
					{
						Main.NewText(Lang.misc[34].Value, 50, 255, 130, false);
						Main.startSnowMoon();
					}
					else
					{
						NetMessage.SendData(61, -1, -1, null, this.whoAmI, -5f, 0f, 0f, 0, 0, 0);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && item.makeNPC > 0 && this.controlUseItem && this.position.X / 16f - (float)Player.tileRangeX - (float)item.tileBoost <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)item.tileBoost - 1f >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)item.tileBoost <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)item.tileBoost - 2f >= (float)Player.tileTargetY)
				{
					int num343 = Main.mouseX + (int)Main.screenPosition.X;
					int num344 = Main.mouseY + (int)Main.screenPosition.Y;
					this.itemTime = item.useTime;
					int arg_1157E_0 = num343 / 16;
					int j2 = num344 / 16;
					if (!WorldGen.SolidTile(arg_1157E_0, j2))
					{
						NPC.ReleaseNPC(num343, num344, (int)item.makeNPC, item.placeStyle, this.whoAmI);
					}
				}
				if (this.itemTime == 0 && this.itemAnimation > 0 && (item.type == 43 || item.type == 70 || item.type == 544 || item.type == 556 || item.type == 557 || item.type == 560 || item.type == 1133 || item.type == 1331) && this.SummonItemCheck())
				{
					if (item.type == 560)
					{
						this.itemTime = item.useTime;
						Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
						if (Main.netMode != 1)
						{
							NPC.SpawnOnPlayer(i, 50);
						}
						else
						{
							NetMessage.SendData(61, -1, -1, null, this.whoAmI, 50f, 0f, 0f, 0, 0, 0);
						}
					}
					else if (item.type == 43)
					{
						if (!Main.dayTime)
						{
							this.itemTime = item.useTime;
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(i, 4);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 4f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (item.type == 70)
					{
						if (this.ZoneCorrupt)
						{
							this.itemTime = item.useTime;
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(i, 13);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 13f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (item.type == 544)
					{
						if (!Main.dayTime)
						{
							this.itemTime = item.useTime;
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(i, 125);
								NPC.SpawnOnPlayer(i, 126);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 125f, 0f, 0f, 0, 0, 0);
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 126f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (item.type == 556)
					{
						if (!Main.dayTime)
						{
							this.itemTime = item.useTime;
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(i, 134);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 134f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (item.type == 557)
					{
						if (!Main.dayTime)
						{
							this.itemTime = item.useTime;
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(i, 127);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 127f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (item.type == 1133)
					{
						this.itemTime = item.useTime;
						Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
						if (Main.netMode != 1)
						{
							NPC.SpawnOnPlayer(i, 222);
						}
						else
						{
							NetMessage.SendData(61, -1, -1, null, this.whoAmI, 222f, 0f, 0f, 0, 0, 0);
						}
					}
					else if (item.type == 1331 && this.ZoneCrimson)
					{
						this.itemTime = item.useTime;
						Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
						if (Main.netMode != 1)
						{
							NPC.SpawnOnPlayer(i, 266);
						}
						else
						{
							NetMessage.SendData(61, -1, -1, null, this.whoAmI, 266f, 0f, 0f, 0, 0, 0);
						}
					}
				}
			}
			if ((item.type == 50 || item.type == 3124 || item.type == 3199) && this.itemAnimation > 0)
			{
				if (Main.rand.Next(2) == 0)
				{
					Dust.NewDust(this.position, this.width, this.height, 15, 0f, 0f, 150, default(Color), 1.1f);
				}
				if (this.itemTime == 0)
				{
					this.itemTime = item.useTime;
				}
				else if (this.itemTime == item.useTime / 2)
				{
					for (int num345 = 0; num345 < 70; num345++)
					{
						Dust.NewDust(this.position, this.width, this.height, 15, this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 150, default(Color), 1.5f);
					}
					this.grappling[0] = -1;
					this.grapCount = 0;
					for (int num346 = 0; num346 < 1000; num346++)
					{
						if (Main.projectile[num346].active && Main.projectile[num346].owner == i && Main.projectile[num346].aiStyle == 7)
						{
							Main.projectile[num346].Kill();
						}
					}
					this.Spawn();
					for (int num347 = 0; num347 < 70; num347++)
					{
						Dust.NewDust(this.position, this.width, this.height, 15, 0f, 0f, 150, default(Color), 1.5f);
					}
				}
			}
			if (item.type == 2350 && this.itemAnimation > 0)
			{
				if (this.itemTime == 0)
				{
					this.itemTime = item.useTime;
				}
				else if (this.itemTime == 2)
				{
					for (int num348 = 0; num348 < 70; num348++)
					{
						Main.dust[Dust.NewDust(this.position, this.width, this.height, 15, this.velocity.X * 0.2f, this.velocity.Y * 0.2f, 150, Color.Cyan, 1.2f)].velocity *= 0.5f;
					}
					this.grappling[0] = -1;
					this.grapCount = 0;
					for (int num349 = 0; num349 < 1000; num349++)
					{
						if (Main.projectile[num349].active && Main.projectile[num349].owner == i && Main.projectile[num349].aiStyle == 7)
						{
							Main.projectile[num349].Kill();
						}
					}
					bool flag26 = this.immune;
					int num350 = this.immuneTime;
					this.Spawn();
					this.immune = flag26;
					this.immuneTime = num350;
					for (int num351 = 0; num351 < 70; num351++)
					{
						Main.dust[Dust.NewDust(this.position, this.width, this.height, 15, 0f, 0f, 150, Color.Cyan, 1.2f)].velocity *= 0.5f;
					}
					if (item.stack > 0)
					{
						item.stack--;
					}
				}
			}
			if (item.type == 2351 && this.itemAnimation > 0)
			{
				if (this.itemTime == 0)
				{
					this.itemTime = item.useTime;
				}
				else if (this.itemTime == 2)
				{
					if (Main.netMode == 0)
					{
						this.TeleportationPotion();
					}
					else if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
					{
						NetMessage.SendData(73, -1, -1, null, 0, 0f, 0f, 0f, 0, 0, 0);
					}
					if (item.stack > 0)
					{
						item.stack--;
					}
				}
			}
			if (item.type == 2756 && this.itemAnimation > 0)
			{
				if (this.itemTime == 0)
				{
					this.itemTime = item.useTime;
				}
				else if (this.itemTime == 2)
				{
					if (this.whoAmI == Main.myPlayer)
					{
						this.Male = !this.Male;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(4, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
						}
					}
					if (item.stack > 0)
					{
						item.stack--;
					}
				}
				else
				{
					float num352 = (float)item.useTime;
					num352 = (num352 - (float)this.itemTime) / num352;
					float arg_12004_0 = 15f;
					float num353 = 44f;
					float num354 = 9.424778f;
					Vector2 vector38 = new Vector2(arg_12004_0, 0f).RotatedBy((double)(num354 * num352), default(Vector2));
					vector38.X *= (float)this.direction;
					for (int num355 = 0; num355 < 2; num355++)
					{
						int type10 = 221;
						if (num355 == 1)
						{
							vector38.X *= -1f;
							type10 = 219;
						}
						Vector2 vector39 = new Vector2(vector38.X, num353 * (1f - num352) - num353 + (float)(this.height / 2));
						vector39 += base.Center;
						int num356 = Dust.NewDust(vector39, 0, 0, type10, 0f, 0f, 100, default(Color), 1f);
						Main.dust[num356].position = vector39;
						Main.dust[num356].noGravity = true;
						Main.dust[num356].velocity = Vector2.Zero;
						Main.dust[num356].scale = 1.3f;
						Main.dust[num356].customData = this;
					}
				}
			}
			if (i == Main.myPlayer)
			{
				if (this.itemTime == (int)((float)item.useTime * this.tileSpeed) && item.tileWand > 0)
				{
					int tileWand2 = item.tileWand;
					int num357 = 0;
					while (num357 < 58)
					{
						if (tileWand2 == this.inventory[num357].type && this.inventory[num357].stack > 0)
						{
							this.inventory[num357].stack--;
							if (this.inventory[num357].stack <= 0)
							{
								this.inventory[num357] = new Item();
								break;
							}
							break;
						}
						else
						{
							num357++;
						}
					}
				}
				int num358;
				if (item.createTile >= 0)
				{
					num358 = (int)((float)item.useTime * this.tileSpeed);
				}
				else if (item.createWall > 0)
				{
					num358 = (int)((float)item.useTime * this.wallSpeed);
				}
				else
				{
					num358 = item.useTime;
				}
				if (this.itemTime == num358 && item.consumable)
				{
					bool flag27 = true;
					if (item.type == 2350 || item.type == 2351)
					{
						flag27 = false;
					}
					if (item.type == 2756)
					{
						flag27 = false;
					}
					if (item.ranged)
					{
						if (this.ammoCost80 && Main.rand.Next(5) == 0)
						{
							flag27 = false;
						}
						if (this.ammoCost75 && Main.rand.Next(4) == 0)
						{
							flag27 = false;
						}
					}
					if (item.thrown)
					{
						if (this.thrownCost50 && Main.rand.Next(100) < 50)
						{
							flag27 = false;
						}
						if (this.thrownCost33 && Main.rand.Next(100) < 33)
						{
							flag27 = false;
						}
					}
					if (item.type >= 71 && item.type <= 74)
					{
						flag27 = true;
					}
					if (flag27)
					{
						if (item.stack > 0)
						{
							item.stack--;
						}
						if (item.stack <= 0)
						{
							this.itemTime = this.itemAnimation;
							Main.blockMouse = true;
						}
					}
				}
				if (item.stack <= 0 && this.itemAnimation == 0)
				{
					this.inventory[this.selectedItem] = new Item();
				}
				if (this.selectedItem == 58 && this.itemAnimation != 0)
				{
					Main.mouseItem = item.Clone();
				}
			}
		}

		// Token: 0x060003B4 RID: 948 RVA: 0x00259BEC File Offset: 0x00257DEC
		private void ItemCheckWrapped(int i)
		{
			LockOnHelper.SetUP();
			int stack = this.inventory[this.selectedItem].stack;
			if (Main.ignoreErrors)
			{
				try
				{
					this.ItemCheck(i);
					goto IL_32;
				}
				catch
				{
					goto IL_32;
				}
			}
			this.ItemCheck(i);
			IL_32:
			if (stack != this.inventory[this.selectedItem].stack)
			{
				Recipe.FindRecipes();
			}
			LockOnHelper.SetDOWN();
		}

		// Token: 0x060003EE RID: 1006 RVA: 0x0027F118 File Offset: 0x0027D318
		private void ItemCheck_ApplyPetBuffs(Item sItem)
		{
			if (this.whoAmI == Main.myPlayer && sItem.type == 603 && Main.cEd)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 669)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 115)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3060)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3628)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3062)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3577)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 425)
			{
				int num = Main.rand.Next(3);
				if (num == 0)
				{
					num = 27;
				}
				if (num == 1)
				{
					num = 101;
				}
				if (num == 2)
				{
					num = 102;
				}
				for (int i = 0; i < 22; i++)
				{
					if (this.buffType[i] == 27 || this.buffType[i] == 101 || this.buffType[i] == 102)
					{
						this.DelBuff(i);
						i--;
					}
				}
				this.AddBuff(num, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 753)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 994)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1169)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1170)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1171)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1172)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1180)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1181)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1182)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1183)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1242)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1157)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1309)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1311)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1837)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1312)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1798)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1799)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1802)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1810)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1927)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 1959)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2364)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2365)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3043)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2420)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2535)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2551)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2584)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2587)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2621)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 2749)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3249)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3474)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI == Main.myPlayer && sItem.type == 3531)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
			if (this.whoAmI != Main.myPlayer)
			{
				return;
			}
			int type = sItem.type;
			if (type - 3855 <= 2)
			{
				this.AddBuff(sItem.buffType, 3600, true);
			}
		}

		// Token: 0x060003B1 RID: 945 RVA: 0x00259720 File Offset: 0x00257920
		public void ItemCheck_ManageRightClickFeatures()
		{
			bool flag = this.selectedItem != 58 && this.controlUseTile && !this.tileInteractionHappened && this.releaseUseItem && !this.controlUseItem && !this.mouseInterface && !CaptureManager.Instance.Active && !Main.HoveringOverAnNPC && !Main.SmartInteractShowingGenuine;
			if (flag && this.altFunctionUse == 0 && this.inventory[this.selectedItem].type == 3384)
			{
				this.altFunctionUse = 1;
				this.controlUseItem = true;
			}
			if (flag && this.altFunctionUse == 0 && this.inventory[this.selectedItem].type == 3858)
			{
				this.altFunctionUse = 1;
				this.controlUseItem = true;
			}
			if (flag && this.altFunctionUse == 0 && this.inventory[this.selectedItem].type == 3852 && this.itemAnimation == 0 && this.CheckMana(20, true, false))
			{
				this.altFunctionUse = 1;
				this.controlUseItem = true;
			}
			if (flag && this.altFunctionUse == 0 && this.inventory[this.selectedItem].shoot > 0 && ProjectileID.Sets.TurretFeature[this.inventory[this.selectedItem].shoot])
			{
				this.altFunctionUse = 1;
				this.controlUseItem = true;
			}
			if (flag && this.altFunctionUse == 0 && this.inventory[this.selectedItem].shoot > 0 && ProjectileID.Sets.MinionTargettingFeature[this.inventory[this.selectedItem].shoot])
			{
				this.altFunctionUse = 1;
				this.controlUseItem = true;
			}
			if (!this.controlUseItem && this.altFunctionUse == 1)
			{
				this.altFunctionUse = 0;
			}
			this.ItemCheck_ManageRightClickFeatures_ShieldRaise(flag);
		}

		// Token: 0x060003B2 RID: 946 RVA: 0x002598D8 File Offset: 0x00257AD8
		public void ItemCheck_ManageRightClickFeatures_ShieldRaise(bool theGeneralCheck)
		{
			bool flag = false;
			if (theGeneralCheck && this.inventory[this.selectedItem].type == 3823 && this.hasRaisableShield && !this.mount.Active && (this.itemAnimation == 0 || PlayerInput.Triggers.JustPressed.MouseRight))
			{
				flag = true;
			}
			if (this.shield_parry_cooldown > 0)
			{
				this.shield_parry_cooldown--;
				if (this.shield_parry_cooldown == 0)
				{
					Main.PlaySound(25, -1, -1, 1, 1f, 0f);
					for (int i = 0; i < 10; i++)
					{
						int num = Dust.NewDust(base.Center + new Vector2((float)(this.direction * 6 + ((this.direction == -1) ? -10 : 0)), -14f), 10, 16, 45, 0f, 0f, 255, new Color(255, 100, 0, 127), (float)Main.rand.Next(10, 16) * 0.1f);
						Main.dust[num].noLight = true;
						Main.dust[num].noGravity = true;
						Main.dust[num].velocity *= 0.5f;
					}
				}
			}
			if (this.shieldParryTimeLeft > 0)
			{
				int num2 = this.shieldParryTimeLeft + 1;
				this.shieldParryTimeLeft = num2;
				if (num2 > 20)
				{
					this.shieldParryTimeLeft = 0;
				}
			}
			if (flag != this.shieldRaised)
			{
				this.shieldRaised = flag;
				if (this.shieldRaised)
				{
					if (this.shield_parry_cooldown == 0)
					{
						this.shieldParryTimeLeft = 1;
					}
					this.itemAnimation = 0;
					this.itemTime = 0;
					this.reuseDelay = 0;
				}
				else
				{
					this.shield_parry_cooldown = 15;
					this.shieldParryTimeLeft = 0;
					if (this.attackCD < 20)
					{
						this.attackCD = 20;
					}
				}
			}
			bool arg_1C7_0 = this.shieldRaised;
		}

		// Token: 0x060003F7 RID: 1015 RVA: 0x00280AC5 File Offset: 0x0027ECC5
		public bool ItemFitsItemFrame(Item i)
		{
			return i.stack > 0;
		}

		// Token: 0x060003F5 RID: 1013 RVA: 0x00280800 File Offset: 0x0027EA00
		public bool ItemFitsWeaponRack(Item i)
		{
			bool flag = false;
			if (i.fishingPole > 0)
			{
				flag = true;
			}
			int netID = i.netID;
			if (netID == 905 || netID == 1326)
			{
				flag = true;
			}
			return (i.damage > 0 | flag) && i.useStyle > 0 && i.stack > 0;
		}

		// Token: 0x060003D4 RID: 980 RVA: 0x00265F48 File Offset: 0x00264148
		public bool ItemSpace(Item newItem)
		{
			if (newItem.uniqueStack && this.HasItem(newItem.type))
			{
				return false;
			}
			if (newItem.type == 58 || newItem.type == 184 || newItem.type == 1734 || newItem.type == 1735 || newItem.type == 1867 || newItem.type == 1868)
			{
				return true;
			}
			if (ItemID.Sets.NebulaPickup[newItem.type])
			{
				return true;
			}
			int num = 50;
			if (newItem.type == 71 || newItem.type == 72 || newItem.type == 73 || newItem.type == 74)
			{
				num = 54;
			}
			for (int i = 0; i < num; i++)
			{
				if (this.inventory[i].type == 0)
				{
					return true;
				}
			}
			for (int j = 0; j < num; j++)
			{
				if (this.inventory[j].type > 0 && this.inventory[j].stack < this.inventory[j].maxStack && newItem.IsTheSameAs(this.inventory[j]))
				{
					return true;
				}
			}
			if (newItem.ammo > 0 && !newItem.notAmmo)
			{
				if (newItem.type != 75 && newItem.type != 169 && newItem.type != 23 && newItem.type != 408 && newItem.type != 370 && newItem.type != 1246)
				{
					for (int k = 54; k < 58; k++)
					{
						if (this.inventory[k].type == 0)
						{
							return true;
						}
					}
				}
				for (int l = 54; l < 58; l++)
				{
					if (this.inventory[l].type > 0 && this.inventory[l].stack < this.inventory[l].maxStack && newItem.IsTheSameAs(this.inventory[l]))
					{
						return true;
					}
				}
			}
			for (int m = 54; m < 58; m++)
			{
				if (this.inventory[m].type > 0 && this.inventory[m].stack < this.inventory[m].maxStack && newItem.IsTheSameAs(this.inventory[m]))
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06000393 RID: 915 RVA: 0x0024734C File Offset: 0x0024554C
		public void JumpMovement()
		{
			if (this.mount.Active && this.mount.Type == 3 && this.wetSlime == 0 && this.velocity.Y > 0f)
			{
				Rectangle rect = this.getRect();
				rect.Offset(0, this.height - 1);
				rect.Height = 2;
				rect.Inflate(12, 6);
				for (int i = 0; i < 200; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.active && !nPC.dontTakeDamage && !nPC.friendly && nPC.immune[this.whoAmI] == 0)
					{
						Rectangle rect2 = nPC.getRect();
						if (rect.Intersects(rect2) && (nPC.noTileCollide || Collision.CanHit(this.position, this.width, this.height, nPC.position, nPC.width, nPC.height)))
						{
							float num = 40f * this.minionDamage;
							float knockback = 5f;
							int direction = this.direction;
							if (this.velocity.X < 0f)
							{
								direction = -1;
							}
							if (this.velocity.X > 0f)
							{
								direction = 1;
							}
							if (this.whoAmI == Main.myPlayer)
							{
								this.ApplyDamageToNPC(nPC, (int)num, knockback, direction, false);
							}
							nPC.immune[this.whoAmI] = 10;
							this.velocity.Y = -10f;
							this.immune = true;
							this.immuneNoBlink = true;
							this.immuneTime = 6;
							break;
						}
					}
				}
			}
			if (this.controlJump)
			{
				bool flag = false;
				if (this.mount.Active && this.mount.Type == 3 && this.wetSlime > 0)
				{
					flag = true;
				}
				if (this.jump > 0)
				{
					if (this.velocity.Y == 0f)
					{
						this.jump = 0;
					}
					else
					{
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						if (this.merman && (!this.mount.Active || !this.mount.Cart))
						{
							if (this.swimTime <= 10)
							{
								this.swimTime = 30;
							}
						}
						else
						{
							this.jump--;
						}
					}
				}
				else if ((((this.sliding || this.velocity.Y == 0f) | flag) || this.jumpAgainCloud || this.jumpAgainSandstorm || this.jumpAgainBlizzard || this.jumpAgainFart || this.jumpAgainSail || this.jumpAgainUnicorn || (this.wet && this.accFlipper && (!this.mount.Active || !this.mount.Cart))) && (this.releaseJump || (this.autoJump && (this.velocity.Y == 0f || this.sliding))))
				{
					if (this.sliding || this.velocity.Y == 0f)
					{
						this.justJumped = true;
					}
					bool flag2 = false;
					if (this.wet && this.accFlipper)
					{
						if (this.swimTime == 0)
						{
							this.swimTime = 30;
						}
						flag2 = true;
					}
					bool flag3 = false;
					bool flag4 = false;
					bool flag5 = false;
					bool flag6 = false;
					bool flag7 = false;
					if (!flag)
					{
						if (this.jumpAgainUnicorn)
						{
							flag7 = true;
							this.jumpAgainUnicorn = false;
						}
						else if (this.jumpAgainSandstorm)
						{
							flag3 = true;
							this.jumpAgainSandstorm = false;
						}
						else if (this.jumpAgainBlizzard)
						{
							flag4 = true;
							this.jumpAgainBlizzard = false;
						}
						else if (this.jumpAgainFart)
						{
							this.jumpAgainFart = false;
							flag5 = true;
						}
						else if (this.jumpAgainSail)
						{
							this.jumpAgainSail = false;
							flag6 = true;
						}
						else
						{
							this.jumpAgainCloud = false;
						}
					}
					this.canRocket = false;
					this.rocketRelease = false;
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpCloud)
					{
						this.jumpAgainCloud = true;
					}
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpSandstorm)
					{
						this.jumpAgainSandstorm = true;
					}
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpBlizzard)
					{
						this.jumpAgainBlizzard = true;
					}
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpFart)
					{
						this.jumpAgainFart = true;
					}
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpSail)
					{
						this.jumpAgainSail = true;
					}
					if ((this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped)) && this.doubleJumpUnicorn)
					{
						this.jumpAgainUnicorn = true;
					}
					if (((this.velocity.Y == 0f | flag2) || this.sliding) | flag)
					{
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = Player.jumpHeight;
						if (this.sliding)
						{
							this.velocity.X = (float)(3 * -(float)this.slideDir);
						}
					}
					else if (flag3)
					{
						this.dJumpEffectSandstorm = true;
						int arg_5C0_0 = this.height;
						float arg_5CD_0 = this.gravDir;
						Main.PlaySound(16, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = Player.jumpHeight * 3;
					}
					else if (flag4)
					{
						this.dJumpEffectBlizzard = true;
						int arg_634_0 = this.height;
						float arg_641_0 = this.gravDir;
						Main.PlaySound(16, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = (int)((double)Player.jumpHeight * 1.5);
					}
					else if (flag6)
					{
						this.dJumpEffectSail = true;
						int num2 = this.height;
						if (this.gravDir == -1f)
						{
							num2 = 0;
						}
						Main.PlaySound(16, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = (int)((double)Player.jumpHeight * 1.25);
						for (int j = 0; j < 30; j++)
						{
							int num3 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)num2), this.width, 12, 253, this.velocity.X * 0.3f, this.velocity.Y * 0.3f, 100, default(Color), 1.5f);
							if (j % 2 == 0)
							{
								Dust expr_7A7_cp_0_cp_0 = Main.dust[num3];
								expr_7A7_cp_0_cp_0.velocity.X = expr_7A7_cp_0_cp_0.velocity.X + (float)Main.rand.Next(30, 71) * 0.1f;
							}
							else
							{
								Dust expr_7D4_cp_0_cp_0 = Main.dust[num3];
								expr_7D4_cp_0_cp_0.velocity.X = expr_7D4_cp_0_cp_0.velocity.X - (float)Main.rand.Next(30, 71) * 0.1f;
							}
							Dust expr_7FF_cp_0_cp_0 = Main.dust[num3];
							expr_7FF_cp_0_cp_0.velocity.Y = expr_7FF_cp_0_cp_0.velocity.Y + (float)Main.rand.Next(-10, 31) * 0.1f;
							Main.dust[num3].noGravity = true;
							Main.dust[num3].scale += (float)Main.rand.Next(-10, 41) * 0.01f;
							Main.dust[num3].velocity *= Main.dust[num3].scale * 0.7f;
							Vector2 value = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
							value.Normalize();
							value *= (float)Main.rand.Next(81) * 0.1f;
						}
					}
					else if (flag5)
					{
						this.dJumpEffectFart = true;
						int num4 = this.height;
						if (this.gravDir == -1f)
						{
							num4 = 0;
						}
						Main.PlaySound(SoundID.Item16, this.position);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = Player.jumpHeight * 2;
						for (int k = 0; k < 10; k++)
						{
							int num5 = Dust.NewDust(new Vector2(this.position.X - 34f, this.position.Y + (float)num4 - 16f), 102, 32, 188, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
							Main.dust[num5].velocity.X = Main.dust[num5].velocity.X * 0.5f - this.velocity.X * 0.1f;
							Main.dust[num5].velocity.Y = Main.dust[num5].velocity.Y * 0.5f - this.velocity.Y * 0.3f;
						}
						int num6 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 16f, this.position.Y + (float)num4 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(435, 438), 1f);
						Main.gore[num6].velocity.X = Main.gore[num6].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num6].velocity.Y = Main.gore[num6].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
						num6 = Gore.NewGore(new Vector2(this.position.X - 36f, this.position.Y + (float)num4 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(435, 438), 1f);
						Main.gore[num6].velocity.X = Main.gore[num6].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num6].velocity.Y = Main.gore[num6].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
						num6 = Gore.NewGore(new Vector2(this.position.X + (float)this.width + 4f, this.position.Y + (float)num4 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(435, 438), 1f);
						Main.gore[num6].velocity.X = Main.gore[num6].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num6].velocity.Y = Main.gore[num6].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
					}
					else if (flag7)
					{
						this.dJumpEffectUnicorn = true;
						int arg_CFB_0 = this.height;
						float arg_D08_0 = this.gravDir;
						Main.PlaySound(16, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = Player.jumpHeight * 2;
						Vector2 center = base.Center;
						Vector2 value2 = new Vector2(50f, 20f);
						float num7 = 6.28318548f * Main.rand.NextFloat();
						for (int l = 0; l < 5; l++)
						{
							for (float num8 = 0f; num8 < 14f; num8 += 1f)
							{
								Dust arg_E16_0 = Main.dust[Dust.NewDust(center, 0, 0, Utils.SelectRandom<int>(Main.rand, new int[]
								{
									176,
									177,
									179
								}), 0f, 0f, 0, default(Color), 1f)];
								Vector2 vector = Vector2.UnitY.RotatedBy((double)(num8 * 6.28318548f / 14f + num7), default(Vector2));
								vector *= 0.2f * (float)l;
								arg_E16_0.position = center + vector * value2;
								arg_E16_0.velocity = vector + new Vector2(0f, this.gravDir * 4f);
								arg_E16_0.noGravity = true;
								arg_E16_0.scale = 1f + Main.rand.NextFloat() * 0.8f;
								arg_E16_0.fadeIn = Main.rand.NextFloat() * 2f;
								arg_E16_0.shader = GameShaders.Armor.GetSecondaryShader(this.cMount, this);
							}
						}
					}
					else
					{
						this.dJumpEffectCloud = true;
						int num9 = this.height;
						if (this.gravDir == -1f)
						{
							num9 = 0;
						}
						Main.PlaySound(16, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						this.velocity.Y = -Player.jumpSpeed * this.gravDir;
						this.jump = (int)((double)Player.jumpHeight * 0.75);
						for (int m = 0; m < 10; m++)
						{
							int num10 = Dust.NewDust(new Vector2(this.position.X - 34f, this.position.Y + (float)num9 - 16f), 102, 32, 16, -this.velocity.X * 0.5f, this.velocity.Y * 0.5f, 100, default(Color), 1.5f);
							Main.dust[num10].velocity.X = Main.dust[num10].velocity.X * 0.5f - this.velocity.X * 0.1f;
							Main.dust[num10].velocity.Y = Main.dust[num10].velocity.Y * 0.5f - this.velocity.Y * 0.3f;
						}
						int num11 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 16f, this.position.Y + (float)num9 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(11, 14), 1f);
						Main.gore[num11].velocity.X = Main.gore[num11].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num11].velocity.Y = Main.gore[num11].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
						num11 = Gore.NewGore(new Vector2(this.position.X - 36f, this.position.Y + (float)num9 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(11, 14), 1f);
						Main.gore[num11].velocity.X = Main.gore[num11].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num11].velocity.Y = Main.gore[num11].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
						num11 = Gore.NewGore(new Vector2(this.position.X + (float)this.width + 4f, this.position.Y + (float)num9 - 16f), new Vector2(-this.velocity.X, -this.velocity.Y), Main.rand.Next(11, 14), 1f);
						Main.gore[num11].velocity.X = Main.gore[num11].velocity.X * 0.1f - this.velocity.X * 0.1f;
						Main.gore[num11].velocity.Y = Main.gore[num11].velocity.Y * 0.1f - this.velocity.Y * 0.05f;
					}
				}
				this.releaseJump = false;
				return;
			}
			this.jump = 0;
			this.releaseJump = true;
			this.rocketRelease = true;
		}

		// Token: 0x06000417 RID: 1047 RVA: 0x00285458 File Offset: 0x00283658
		public void KeyDoubleTap(int keyDir)
		{
			int num = 0;
			if (Main.ReversedUpDownArmorSetBonuses)
			{
				num = 1;
			}
			if (keyDir == num)
			{
				if (this.setVortex && !this.mount.Active)
				{
					this.vortexStealthActive = !this.vortexStealthActive;
				}
				if (this.setStardust)
				{
					this.MinionRestTargetAim();
				}
				if (this.setForbidden)
				{
					this.MinionRestTargetAim();
					if (!this.setForbiddenCooldownLocked)
					{
						this.CommandForbiddenStorm();
					}
				}
			}
		}

		// Token: 0x0600041A RID: 1050 RVA: 0x002858A8 File Offset: 0x00283AA8
		public void KeyHoldDown(int keyDir, int holdTime)
		{
			int num = 0;
			if (Main.ReversedUpDownArmorSetBonuses)
			{
				num = 1;
			}
			if (keyDir == num)
			{
				if (this.setStardust && holdTime >= 60)
				{
					this.MinionRestTargetPoint = Vector2.Zero;
				}
				if (this.setForbidden && holdTime >= 60)
				{
					this.MinionRestTargetPoint = Vector2.Zero;
				}
			}
		}

		// Token: 0x060003D2 RID: 978 RVA: 0x0026570C File Offset: 0x0026390C
		public void KillMe(PlayerDeathReason damageSource, double dmg, int hitDirection, bool pvp = false)
		{
			if (this.dead)
			{
				return;
			}
			if (pvp)
			{
				this.pvpDeath = true;
			}
			if (this.trapDebuffSource)
			{
				AchievementsHelper.HandleSpecialEvent(this, 4);
			}
			this.lastDeathPostion = base.Center;
			this.lastDeathTime = DateTime.Now;
			this.showLastDeath = true;
			bool flag;
			int coinsOwned = (int)Utils.CoinsCount(out flag, this.inventory, new int[0]);
			if (Main.myPlayer == this.whoAmI)
			{
				this.lostCoins = coinsOwned;
				this.lostCoinString = Main.ValueToCoins(this.lostCoins);
			}
			if (Main.myPlayer == this.whoAmI)
			{
				Main.mapFullscreen = false;
			}
			if (Main.myPlayer == this.whoAmI)
			{
				this.trashItem.SetDefaults(0, false);
				if (this.difficulty == 0)
				{
					for (int i = 0; i < 59; i++)
					{
						if (this.inventory[i].stack > 0 && ((this.inventory[i].type >= 1522 && this.inventory[i].type <= 1527) || this.inventory[i].type == 3643))
						{
							int num = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, this.inventory[i].type, 1, false, 0, false, false);
							Main.item[num].netDefaults(this.inventory[i].netID);
							Main.item[num].Prefix((int)this.inventory[i].prefix);
							Main.item[num].stack = this.inventory[i].stack;
							Main.item[num].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
							Main.item[num].velocity.X = (float)Main.rand.Next(-20, 21) * 0.2f;
							Main.item[num].noGrabDelay = 100;
							Main.item[num].favorited = false;
							Main.item[num].newAndShiny = false;
							if (Main.netMode == 1)
							{
								NetMessage.SendData(21, -1, -1, null, num, 0f, 0f, 0f, 0, 0, 0);
							}
							this.inventory[i].SetDefaults(0, false);
						}
					}
				}
				else if (this.difficulty == 1)
				{
					this.DropItems();
				}
				else if (this.difficulty == 2)
				{
					this.DropItems();
					this.KillMeForGood();
				}
			}
			Main.PlaySound(5, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
			this.headVelocity.Y = (float)Main.rand.Next(-40, -10) * 0.1f;
			this.bodyVelocity.Y = (float)Main.rand.Next(-40, -10) * 0.1f;
			this.legVelocity.Y = (float)Main.rand.Next(-40, -10) * 0.1f;
			this.headVelocity.X = (float)Main.rand.Next(-20, 21) * 0.1f + (float)(2 * hitDirection);
			this.bodyVelocity.X = (float)Main.rand.Next(-20, 21) * 0.1f + (float)(2 * hitDirection);
			this.legVelocity.X = (float)Main.rand.Next(-20, 21) * 0.1f + (float)(2 * hitDirection);
			if (this.stoned)
			{
				this.headPosition = Vector2.Zero;
				this.bodyPosition = Vector2.Zero;
				this.legPosition = Vector2.Zero;
			}
			for (int j = 0; j < 100; j++)
			{
				if (this.stoned)
				{
					Dust.NewDust(this.position, this.width, this.height, 1, (float)(2 * hitDirection), -2f, 0, default(Color), 1f);
				}
				else if (this.frostArmor)
				{
					int num2 = Dust.NewDust(this.position, this.width, this.height, 135, (float)(2 * hitDirection), -2f, 0, default(Color), 1f);
					Main.dust[num2].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
				else if (this.boneArmor)
				{
					int num3 = Dust.NewDust(this.position, this.width, this.height, 26, (float)(2 * hitDirection), -2f, 0, default(Color), 1f);
					Main.dust[num3].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
				else
				{
					Dust.NewDust(this.position, this.width, this.height, 5, (float)(2 * hitDirection), -2f, 0, default(Color), 1f);
				}
			}
			this.mount.Dismount(this);
			this.dead = true;
			this.respawnTimer = 600;
			bool flag2 = false;
			if (Main.netMode != 0 && !pvp)
			{
				for (int k = 0; k < 200; k++)
				{
					if (Main.npc[k].active && (Main.npc[k].boss || Main.npc[k].type == 13 || Main.npc[k].type == 14 || Main.npc[k].type == 15) && Math.Abs(base.Center.X - Main.npc[k].Center.X) + Math.Abs(base.Center.Y - Main.npc[k].Center.Y) < 4000f)
					{
						flag2 = true;
						break;
					}
				}
			}
			if (flag2)
			{
				this.respawnTimer += 600;
			}
			if (Main.expertMode)
			{
				this.respawnTimer = (int)((double)this.respawnTimer * 1.5);
			}
			this.immuneAlpha = 0;
			this.palladiumRegen = false;
			this.iceBarrier = false;
			this.crystalLeaf = false;
			NetworkText deathText = damageSource.GetDeathText(this.name);
			if (Main.netMode == 2)
			{
				NetMessage.BroadcastChatMessage(deathText, new Color(225, 25, 25), -1);
			}
			else if (Main.netMode == 0)
			{
				Main.NewText(deathText.ToString(), 225, 25, 25, false);
			}
			if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
			{
				NetMessage.SendPlayerDeath(this.whoAmI, damageSource, (int)dmg, hitDirection, pvp, -1, -1);
			}
			if (this.whoAmI == Main.myPlayer && this.difficulty == 0)
			{
				if (!pvp)
				{
					this.DropCoins();
				}
				else
				{
					this.lostCoins = 0;
					this.lostCoinString = Main.ValueToCoins(this.lostCoins);
				}
			}
			this.DropTombstone(coinsOwned, deathText, hitDirection);
			if (this.whoAmI == Main.myPlayer)
			{
				try
				{
					WorldGen.saveToonWhilePlaying();
				}
				catch
				{
				}
			}
		}

		// Token: 0x060003D0 RID: 976 RVA: 0x002656A4 File Offset: 0x002638A4
		public void KillMeForGood()
		{
			bool isCloudSave = Main.ActivePlayerFileData.IsCloudSave;
			if (FileUtilities.Exists(Main.playerPathName, isCloudSave))
			{
				FileUtilities.Delete(Main.playerPathName, isCloudSave);
			}
			if (FileUtilities.Exists(Main.playerPathName + ".bak", isCloudSave))
			{
				FileUtilities.Delete(Main.playerPathName + ".bak", isCloudSave);
			}
			Main.ActivePlayerFileData = new PlayerFileData();
		}

		// Token: 0x060003D1 RID: 977 RVA: 0x00029F71 File Offset: 0x00028171
		public void KillMeOld(double dmg, int hitDirection, bool pvp = false, string deathText = " was slain...")
		{
		}

		// Token: 0x060003BB RID: 955 RVA: 0x0025C674 File Offset: 0x0025A874
		private void LaunchMinecartHook(int myX, int myY)
		{
			Vector2 vector = new Vector2((float)Main.mouseX + Main.screenPosition.X, (float)Main.mouseY + Main.screenPosition.Y);
			vector = new Vector2((float)(myX * 16 + 8), (float)(myY * 16 + 8));
			if (this.direction > 0)
			{
				this.minecartLeft = false;
			}
			else
			{
				this.minecartLeft = true;
			}
			this.grappling[0] = -1;
			this.grapCount = 0;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].owner == this.whoAmI && Main.projectile[i].aiStyle == 7)
				{
					Main.projectile[i].Kill();
				}
			}
			Projectile.NewProjectile(vector.X, vector.Y, 0f, 0f, 403, 0, 0f, this.whoAmI, 0f, 0f);
		}

		// Token: 0x06000408 RID: 1032 RVA: 0x00282750 File Offset: 0x00280950
		public static PlayerFileData LoadPlayer(string playerPath, bool cloudSave)
		{
			PlayerFileData playerFileData = new PlayerFileData(playerPath, cloudSave);
			if (cloudSave && SocialAPI.Cloud == null)
			{
				return playerFileData;
			}
			if (Main.rand == null)
			{
				Main.rand = new UnifiedRandom((int)DateTime.Now.Ticks);
			}
			Player player = new Player();
			try
			{
				RijndaelManaged rijndaelManaged = new RijndaelManaged();
				rijndaelManaged.Padding = PaddingMode.None;
				PlayerFileData result;
				using (MemoryStream memoryStream = new MemoryStream(FileUtilities.ReadAllBytes(playerPath, cloudSave)))
				{
					using (CryptoStream cryptoStream = new CryptoStream(memoryStream, rijndaelManaged.CreateDecryptor(Player.ENCRYPTION_KEY, Player.ENCRYPTION_KEY), CryptoStreamMode.Read))
					{
						using (BinaryReader binaryReader = new BinaryReader(cryptoStream))
						{
							int num = binaryReader.ReadInt32();
							if (num >= 135)
							{
								playerFileData.Metadata = FileMetadata.Read(binaryReader, FileType.Player);
							}
							else
							{
								playerFileData.Metadata = FileMetadata.FromCurrentSettings(FileType.Player);
							}
							if (num > 194)
							{
								player.loadStatus = 1;
								player.name = binaryReader.ReadString();
								playerFileData.Player = player;
								result = playerFileData;
								return result;
							}
							player.name = binaryReader.ReadString();
							if (num >= 10)
							{
								if (num >= 17)
								{
									player.difficulty = binaryReader.ReadByte();
								}
								else if (binaryReader.ReadBoolean())
								{
									player.difficulty = 2;
								}
							}
							if (num >= 138)
							{
								playerFileData.SetPlayTime(new TimeSpan(binaryReader.ReadInt64()));
							}
							else
							{
								playerFileData.SetPlayTime(TimeSpan.Zero);
							}
							player.hair = binaryReader.ReadInt32();
							if (num >= 82)
							{
								player.hairDye = binaryReader.ReadByte();
							}
							if (num >= 124)
							{
								BitsByte bitsByte = binaryReader.ReadByte();
								for (int i = 0; i < 8; i++)
								{
									player.hideVisual[i] = bitsByte[i];
								}
								bitsByte = binaryReader.ReadByte();
								for (int j = 0; j < 2; j++)
								{
									player.hideVisual[j + 8] = bitsByte[j];
								}
							}
							else if (num >= 83)
							{
								BitsByte bitsByte2 = binaryReader.ReadByte();
								for (int k = 0; k < 8; k++)
								{
									player.hideVisual[k] = bitsByte2[k];
								}
							}
							if (num >= 119)
							{
								player.hideMisc = binaryReader.ReadByte();
							}
							if (num <= 17)
							{
								if (player.hair == 5 || player.hair == 6 || player.hair == 9 || player.hair == 11)
								{
									player.Male = false;
								}
								else
								{
									player.Male = true;
								}
							}
							else if (num < 107)
							{
								player.Male = binaryReader.ReadBoolean();
							}
							else
							{
								player.skinVariant = (int)binaryReader.ReadByte();
							}
							if (num < 161 && player.skinVariant == 7)
							{
								player.skinVariant = 9;
							}
							player.statLife = binaryReader.ReadInt32();
							player.statLifeMax = binaryReader.ReadInt32();
							if (player.statLifeMax > 500)
							{
								player.statLifeMax = 500;
							}
							player.statMana = binaryReader.ReadInt32();
							player.statManaMax = binaryReader.ReadInt32();
							if (player.statManaMax > 200)
							{
								player.statManaMax = 200;
							}
							if (player.statMana > 400)
							{
								player.statMana = 400;
							}
							if (num >= 125)
							{
								player.extraAccessory = binaryReader.ReadBoolean();
							}
							if (num >= 182)
							{
								player.downedDD2EventAnyDifficulty = binaryReader.ReadBoolean();
							}
							if (num >= 128)
							{
								player.taxMoney = binaryReader.ReadInt32();
							}
							player.hairColor = binaryReader.ReadRGB();
							player.skinColor = binaryReader.ReadRGB();
							player.eyeColor = binaryReader.ReadRGB();
							player.shirtColor = binaryReader.ReadRGB();
							player.underShirtColor = binaryReader.ReadRGB();
							player.pantsColor = binaryReader.ReadRGB();
							player.shoeColor = binaryReader.ReadRGB();
							Main.player[Main.myPlayer].shirtColor = player.shirtColor;
							Main.player[Main.myPlayer].pantsColor = player.pantsColor;
							Main.player[Main.myPlayer].hairColor = player.hairColor;
							if (num >= 38)
							{
								if (num < 124)
								{
									int num2 = 11;
									if (num >= 81)
									{
										num2 = 16;
									}
									for (int l = 0; l < num2; l++)
									{
										int num3 = l;
										if (num3 >= 8)
										{
											num3 += 2;
										}
										player.armor[num3].netDefaults(binaryReader.ReadInt32());
										player.armor[num3].Prefix((int)binaryReader.ReadByte());
									}
								}
								else
								{
									int num4 = 20;
									for (int m = 0; m < num4; m++)
									{
										player.armor[m].netDefaults(binaryReader.ReadInt32());
										player.armor[m].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 47)
								{
									int num5 = 3;
									if (num >= 81)
									{
										num5 = 8;
									}
									if (num >= 124)
									{
										num5 = 10;
									}
									for (int n = 0; n < num5; n++)
									{
										int num6 = n;
										player.dye[num6].netDefaults(binaryReader.ReadInt32());
										player.dye[num6].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 58)
								{
									for (int num7 = 0; num7 < 58; num7++)
									{
										int num8 = binaryReader.ReadInt32();
										if (num8 >= 3930)
										{
											player.inventory[num7].netDefaults(0);
											binaryReader.ReadInt32();
											binaryReader.ReadByte();
											if (num >= 114)
											{
												binaryReader.ReadBoolean();
											}
										}
										else
										{
											player.inventory[num7].netDefaults(num8);
											player.inventory[num7].stack = binaryReader.ReadInt32();
											player.inventory[num7].Prefix((int)binaryReader.ReadByte());
											if (num >= 114)
											{
												player.inventory[num7].favorited = binaryReader.ReadBoolean();
											}
										}
									}
								}
								else
								{
									for (int num9 = 0; num9 < 48; num9++)
									{
										int num10 = binaryReader.ReadInt32();
										if (num10 >= 3930)
										{
											player.inventory[num9].netDefaults(0);
											binaryReader.ReadInt32();
											binaryReader.ReadByte();
										}
										else
										{
											player.inventory[num9].netDefaults(num10);
											player.inventory[num9].stack = binaryReader.ReadInt32();
											player.inventory[num9].Prefix((int)binaryReader.ReadByte());
										}
									}
								}
								if (num >= 117)
								{
									if (num < 136)
									{
										for (int num11 = 0; num11 < 5; num11++)
										{
											if (num11 != 1)
											{
												int num12 = binaryReader.ReadInt32();
												if (num12 >= 3930)
												{
													player.miscEquips[num11].netDefaults(0);
													binaryReader.ReadByte();
												}
												else
												{
													player.miscEquips[num11].netDefaults(num12);
													player.miscEquips[num11].Prefix((int)binaryReader.ReadByte());
												}
												num12 = binaryReader.ReadInt32();
												if (num12 >= 3930)
												{
													player.miscDyes[num11].netDefaults(0);
													binaryReader.ReadByte();
												}
												else
												{
													player.miscDyes[num11].netDefaults(num12);
													player.miscDyes[num11].Prefix((int)binaryReader.ReadByte());
												}
											}
										}
									}
									else
									{
										for (int num13 = 0; num13 < 5; num13++)
										{
											int num14 = binaryReader.ReadInt32();
											if (num14 >= 3930)
											{
												player.miscEquips[num13].netDefaults(0);
												binaryReader.ReadByte();
											}
											else
											{
												player.miscEquips[num13].netDefaults(num14);
												player.miscEquips[num13].Prefix((int)binaryReader.ReadByte());
											}
											num14 = binaryReader.ReadInt32();
											if (num14 >= 3930)
											{
												player.miscDyes[num13].netDefaults(0);
												binaryReader.ReadByte();
											}
											else
											{
												player.miscDyes[num13].netDefaults(num14);
												player.miscDyes[num13].Prefix((int)binaryReader.ReadByte());
											}
										}
									}
								}
								if (num >= 58)
								{
									for (int num15 = 0; num15 < 40; num15++)
									{
										player.bank.item[num15].netDefaults(binaryReader.ReadInt32());
										player.bank.item[num15].stack = binaryReader.ReadInt32();
										player.bank.item[num15].Prefix((int)binaryReader.ReadByte());
									}
									for (int num16 = 0; num16 < 40; num16++)
									{
										player.bank2.item[num16].netDefaults(binaryReader.ReadInt32());
										player.bank2.item[num16].stack = binaryReader.ReadInt32();
										player.bank2.item[num16].Prefix((int)binaryReader.ReadByte());
									}
								}
								else
								{
									for (int num17 = 0; num17 < 20; num17++)
									{
										player.bank.item[num17].netDefaults(binaryReader.ReadInt32());
										player.bank.item[num17].stack = binaryReader.ReadInt32();
										player.bank.item[num17].Prefix((int)binaryReader.ReadByte());
									}
									for (int num18 = 0; num18 < 20; num18++)
									{
										player.bank2.item[num18].netDefaults(binaryReader.ReadInt32());
										player.bank2.item[num18].stack = binaryReader.ReadInt32();
										player.bank2.item[num18].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 182)
								{
									for (int num19 = 0; num19 < 40; num19++)
									{
										player.bank3.item[num19].netDefaults(binaryReader.ReadInt32());
										player.bank3.item[num19].stack = binaryReader.ReadInt32();
										player.bank3.item[num19].Prefix((int)binaryReader.ReadByte());
									}
								}
							}
							else
							{
								for (int num20 = 0; num20 < 8; num20++)
								{
									player.armor[num20].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
									if (num >= 36)
									{
										player.armor[num20].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 6)
								{
									for (int num21 = 8; num21 < 11; num21++)
									{
										player.armor[num21].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
										if (num >= 36)
										{
											player.armor[num21].Prefix((int)binaryReader.ReadByte());
										}
									}
								}
								for (int num22 = 0; num22 < 44; num22++)
								{
									player.inventory[num22].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
									player.inventory[num22].stack = binaryReader.ReadInt32();
									if (num >= 36)
									{
										player.inventory[num22].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 15)
								{
									for (int num23 = 44; num23 < 48; num23++)
									{
										player.inventory[num23].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
										player.inventory[num23].stack = binaryReader.ReadInt32();
										if (num >= 36)
										{
											player.inventory[num23].Prefix((int)binaryReader.ReadByte());
										}
									}
								}
								for (int num24 = 0; num24 < 20; num24++)
								{
									player.bank.item[num24].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
									player.bank.item[num24].stack = binaryReader.ReadInt32();
									if (num >= 36)
									{
										player.bank.item[num24].Prefix((int)binaryReader.ReadByte());
									}
								}
								if (num >= 20)
								{
									for (int num25 = 0; num25 < 20; num25++)
									{
										player.bank2.item[num25].SetDefaults((int)ItemID.FromLegacyName(binaryReader.ReadString(), num), false);
										player.bank2.item[num25].stack = binaryReader.ReadInt32();
										if (num >= 36)
										{
											player.bank2.item[num25].Prefix((int)binaryReader.ReadByte());
										}
									}
								}
							}
							if (num < 58)
							{
								for (int num26 = 40; num26 < 48; num26++)
								{
									player.inventory[num26 + 10] = player.inventory[num26].Clone();
									player.inventory[num26].SetDefaults(0, false);
								}
							}
							if (num >= 11)
							{
								int num27 = 22;
								if (num < 74)
								{
									num27 = 10;
								}
								for (int num28 = 0; num28 < num27; num28++)
								{
									player.buffType[num28] = binaryReader.ReadInt32();
									player.buffTime[num28] = binaryReader.ReadInt32();
									if (player.buffType[num28] == 0)
									{
										num28--;
										num27--;
									}
								}
							}
							for (int num29 = 0; num29 < 200; num29++)
							{
								int num30 = binaryReader.ReadInt32();
								if (num30 == -1)
								{
									break;
								}
								player.spX[num29] = num30;
								player.spY[num29] = binaryReader.ReadInt32();
								player.spI[num29] = binaryReader.ReadInt32();
								player.spN[num29] = binaryReader.ReadString();
							}
							if (num >= 16)
							{
								player.hbLocked = binaryReader.ReadBoolean();
							}
							if (num >= 115)
							{
								int num31 = 13;
								for (int num32 = 0; num32 < num31; num32++)
								{
									player.hideInfo[num32] = binaryReader.ReadBoolean();
								}
							}
							if (num >= 98)
							{
								player.anglerQuestsFinished = binaryReader.ReadInt32();
							}
							if (num >= 162)
							{
								for (int num33 = 0; num33 < 4; num33++)
								{
									player.DpadRadial.Bindings[num33] = binaryReader.ReadInt32();
								}
							}
							if (num >= 164)
							{
								int num34 = 8;
								if (num >= 167)
								{
									num34 = 10;
								}
								for (int num35 = 0; num35 < num34; num35++)
								{
									player.builderAccStatus[num35] = binaryReader.ReadInt32();
								}
							}
							if (num >= 181)
							{
								player.bartenderQuestLog = binaryReader.ReadInt32();
							}
							player.skinVariant = (int)MathHelper.Clamp((float)player.skinVariant, 0f, 9f);
							for (int num36 = 3; num36 < 8 + player.extraAccessorySlots; num36++)
							{
								int type = player.armor[num36].type;
								if (type == 908)
								{
									player.lavaMax += 420;
								}
								if (type == 906)
								{
									player.lavaMax += 420;
								}
								if (player.wingsLogic == 0 && player.armor[num36].wingSlot >= 0)
								{
									player.wingsLogic = (int)player.armor[num36].wingSlot;
								}
								if (type == 158 || type == 396 || type == 1250 || type == 1251 || type == 1252)
								{
									player.noFallDmg = true;
								}
								player.lavaTime = player.lavaMax;
							}
						}
					}
				}
				player.PlayerFrame();
				player.loadStatus = 0;
				playerFileData.Player = player;
				result = playerFileData;
				return result;
			}
			catch
			{
			}
			Player player2 = new Player();
			player2.loadStatus = 2;
			if (player.name != "")
			{
				player2.name = player.name;
			}
			else
			{
				string[] array = playerPath.Split(new char[]
				{
					Path.DirectorySeparatorChar
				});
				player.name = array[array.Length - 1].Split(new char[]
				{
					'.'
				})[0];
			}
			playerFileData.Player = player2;
			return playerFileData;
		}

		// Token: 0x060003B7 RID: 951 RVA: 0x0025A1A4 File Offset: 0x002583A4
		private void LookForTileInteractions()
		{
			if (!Main.mapFullscreen)
			{
				int smartInteractX = Player.tileTargetX;
				int smartInteractY = Player.tileTargetY;
				if (Main.SmartInteractShowingGenuine && Main.SmartInteractNPC == -1)
				{
					smartInteractX = Main.SmartInteractX;
					smartInteractY = Main.SmartInteractY;
				}
				bool flag = this.controlUseTile;
				if (PlayerInput.UsingGamepad && Main.HoveringOverAnNPC)
				{
					flag = false;
				}
				if (this.releaseUseTile)
				{
					this.tileInteractionHappened = false;
				}
				this.tileInteractAttempted = flag;
				if (this.position.X / 16f - (float)Player.tileRangeX <= (float)smartInteractX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX - 1f >= (float)smartInteractX && this.position.Y / 16f - (float)Player.tileRangeY <= (float)smartInteractY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY - 2f >= (float)smartInteractY)
				{
					this.TileInteractionsCheckLongDistance(Player.tileTargetX, Player.tileTargetY);
					this.TileInteractionsCheck(smartInteractX, smartInteractY);
					return;
				}
				this.TileInteractionsCheckLongDistance(smartInteractX, smartInteractY);
			}
		}

		// Token: 0x060003A8 RID: 936 RVA: 0x0024DFE8 File Offset: 0x0024C1E8
		private void MakeFloorDust(bool Falling, int type)
		{
			if (type == 147 || type == 25 || type == 53 || type == 189 || type == 0 || type == 123 || type == 57 || type == 112 || type == 116 || type == 196 || type == 193 || type == 195 || type == 197 || type == 199 || type == 229 || type == 371)
			{
				int num = 1;
				if (Falling)
				{
					num = 20;
				}
				for (int i = 0; i < num; i++)
				{
					bool flag = true;
					int num2 = 76;
					if (type == 53)
					{
						num2 = 32;
					}
					if (type == 189)
					{
						num2 = 16;
					}
					if (type == 0)
					{
						num2 = 0;
					}
					if (type == 123)
					{
						num2 = 53;
					}
					if (type == 57)
					{
						num2 = 36;
					}
					if (type == 112)
					{
						num2 = 14;
					}
					if (type == 116)
					{
						num2 = 51;
					}
					if (type == 196)
					{
						num2 = 108;
					}
					if (type == 193)
					{
						num2 = 4;
					}
					if (type == 195 || type == 199)
					{
						num2 = 5;
					}
					if (type == 197)
					{
						num2 = 4;
					}
					if (type == 229)
					{
						num2 = 153;
					}
					if (type == 371)
					{
						num2 = 243;
					}
					if (type == 25)
					{
						num2 = 37;
					}
					if (num2 == 32 && Main.rand.Next(2) == 0)
					{
						flag = false;
					}
					if (num2 == 14 && Main.rand.Next(2) == 0)
					{
						flag = false;
					}
					if (num2 == 51 && Main.rand.Next(2) == 0)
					{
						flag = false;
					}
					if (num2 == 36 && Main.rand.Next(2) == 0)
					{
						flag = false;
					}
					if (num2 == 0 && Main.rand.Next(3) != 0)
					{
						flag = false;
					}
					if (num2 == 53 && Main.rand.Next(3) != 0)
					{
						flag = false;
					}
					Color newColor = default(Color);
					if (type == 193)
					{
						newColor = new Color(30, 100, 255, 100);
					}
					if (type == 197)
					{
						newColor = new Color(97, 200, 255, 100);
					}
					if (!Falling)
					{
						float num3 = Math.Abs(this.velocity.X) / 3f;
						if ((float)Main.rand.Next(100) > num3 * 100f)
						{
							flag = false;
						}
					}
					if (flag)
					{
						float num4 = this.velocity.X;
						if (num4 > 6f)
						{
							num4 = 6f;
						}
						if (num4 < -6f)
						{
							num4 = -6f;
						}
						if (this.velocity.X != 0f | Falling)
						{
							int num5 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height - 2f), this.width, 6, num2, 0f, 0f, 50, newColor, 1f);
							if (this.gravDir == -1f)
							{
								Dust expr_2AF_cp_0_cp_0 = Main.dust[num5];
								expr_2AF_cp_0_cp_0.position.Y = expr_2AF_cp_0_cp_0.position.Y - (float)(this.height + 4);
							}
							if (num2 == 76)
							{
								Main.dust[num5].scale += (float)Main.rand.Next(3) * 0.1f;
								Main.dust[num5].noLight = true;
							}
							if (num2 == 16 || num2 == 108 || num2 == 153)
							{
								Main.dust[num5].scale += (float)Main.rand.Next(6) * 0.1f;
							}
							if (num2 == 37)
							{
								Main.dust[num5].scale += 0.25f;
								Main.dust[num5].alpha = 50;
							}
							if (num2 == 5)
							{
								Main.dust[num5].scale += (float)Main.rand.Next(2, 8) * 0.1f;
							}
							Main.dust[num5].noGravity = true;
							if (num > 1)
							{
								Dust expr_3AC_cp_0_cp_0 = Main.dust[num5];
								expr_3AC_cp_0_cp_0.velocity.X = expr_3AC_cp_0_cp_0.velocity.X * 1.2f;
								Dust expr_3C7_cp_0_cp_0 = Main.dust[num5];
								expr_3C7_cp_0_cp_0.velocity.Y = expr_3C7_cp_0_cp_0.velocity.Y * 0.8f;
								Dust expr_3E2_cp_0_cp_0 = Main.dust[num5];
								expr_3E2_cp_0_cp_0.velocity.Y = expr_3E2_cp_0_cp_0.velocity.Y - 1f;
								Main.dust[num5].velocity *= 0.8f;
								Main.dust[num5].scale += (float)Main.rand.Next(3) * 0.1f;
								Main.dust[num5].velocity.X = (Main.dust[num5].position.X - (this.position.X + (float)(this.width / 2))) * 0.2f;
								if (Main.dust[num5].velocity.Y > 0f)
								{
									Dust expr_499_cp_0_cp_0 = Main.dust[num5];
									expr_499_cp_0_cp_0.velocity.Y = expr_499_cp_0_cp_0.velocity.Y * -1f;
								}
								Dust expr_4B4_cp_0_cp_0 = Main.dust[num5];
								expr_4B4_cp_0_cp_0.velocity.X = expr_4B4_cp_0_cp_0.velocity.X + num4 * 0.3f;
							}
							else
							{
								Main.dust[num5].velocity *= 0.2f;
							}
							Dust expr_4F1_cp_0_cp_0 = Main.dust[num5];
							expr_4F1_cp_0_cp_0.position.X = expr_4F1_cp_0_cp_0.position.X - num4 * 1f;
							if (this.gravDir == -1f)
							{
								Dust expr_51C_cp_0_cp_0 = Main.dust[num5];
								expr_51C_cp_0_cp_0.velocity.Y = expr_51C_cp_0_cp_0.velocity.Y * -1f;
							}
						}
					}
				}
			}
		}

		// Token: 0x0600034E RID: 846 RVA: 0x00226260 File Offset: 0x00224460
		public void ManaEffect(int manaAmount)
		{
			CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.HealMana, manaAmount, false, false);
			if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
			{
				NetMessage.SendData(43, -1, -1, null, this.whoAmI, (float)manaAmount, 0f, 0f, 0, 0, 0);
			}
		}

		// Token: 0x0600037D RID: 893 RVA: 0x0023B340 File Offset: 0x00239540
		public void ManageSpecialBiomeVisuals(string biomeName, bool inZone, Vector2 activationSource = default(Vector2))
		{
			if (SkyManager.Instance[biomeName] != null && inZone != SkyManager.Instance[biomeName].IsActive())
			{
				if (inZone)
				{
					SkyManager.Instance.Activate(biomeName, activationSource, new object[0]);
				}
				else
				{
					SkyManager.Instance.Deactivate(biomeName, new object[0]);
				}
			}
			if (inZone != Filters.Scene[biomeName].IsActive())
			{
				if (inZone)
				{
					Filters.Scene.Activate(biomeName, activationSource, new object[0]);
				}
				else
				{
					Filters.Scene[biomeName].Deactivate(new object[0]);
				}
			}
			else if (inZone)
			{
				Filters.Scene[biomeName].GetShader().UseTargetPosition(activationSource);
			}
			if (Overlays.Scene[biomeName] != null && inZone != (Overlays.Scene[biomeName].Mode != OverlayMode.Inactive))
			{
				if (inZone)
				{
					Overlays.Scene.Activate(biomeName, activationSource, new object[0]);
					return;
				}
				Overlays.Scene[biomeName].Deactivate(new object[0]);
			}
		}

		// Token: 0x0600041B RID: 1051 RVA: 0x002858F4 File Offset: 0x00283AF4
		public void MinionNPCTargetAim()
		{
			Vector2 mouseWorld = Main.MouseWorld;
			int num = -1;
			for (int i = 0; i < 200; i++)
			{
				if (Main.npc[i].CanBeChasedBy(this, false) && (num == -1 || Main.npc[i].Hitbox.Distance(mouseWorld) < Main.npc[num].Hitbox.Distance(mouseWorld)))
				{
					num = i;
				}
			}
			if (this.MinionAttackTargetNPC == num)
			{
				this.MinionAttackTargetNPC = -1;
				return;
			}
			this.MinionAttackTargetNPC = num;
		}

		// Token: 0x0600041C RID: 1052 RVA: 0x00285970 File Offset: 0x00283B70
		public void MinionRestTargetAim()
		{
			Vector2 expr_05 = Main.MouseWorld;
			float y = expr_05.Y;
			int num = (int)expr_05.X / 16;
			int num2 = (int)y / 16;
			int num3 = 0;
			if (Main.tile[num, num2].nactive() && Main.tileSolid[(int)Main.tile[num, num2].type] && !Main.tileSolidTop[(int)Main.tile[num, num2].type])
			{
				int num4 = 0;
				int num5 = 0;
				while (num5 > -20 && num2 + num5 > 1)
				{
					int num6 = num2 + num5;
					if (!Main.tile[num, num6].nactive() || !Main.tileSolid[(int)Main.tile[num, num6].type] || Main.tileSolidTop[(int)Main.tile[num, num6].type])
					{
						num4 = num5;
						break;
					}
					num4 = num5;
					num5--;
				}
				int num7 = 0;
				int num8 = 0;
				while (num8 < 20 && num2 + num8 < Main.maxTilesY)
				{
					int num9 = num2 + num8;
					if (!Main.tile[num, num9].nactive() || !Main.tileSolid[(int)Main.tile[num, num9].type] || Main.tileSolidTop[(int)Main.tile[num, num9].type])
					{
						num7 = num8;
						break;
					}
					num7 = num8;
					num8++;
				}
				if (num7 > -num4)
				{
					num3 = num4 - 2;
				}
				else
				{
					num3 = num7 + 3;
				}
			}
			int num10 = num2 + num3;
			bool flag = false;
			for (int i = num10; i < num10 + 5; i++)
			{
				if (WorldGen.SolidTileAllowBottomSlope(num, i))
				{
					flag = true;
				}
			}
			while (!flag)
			{
				num10++;
				for (int j = num10; j < num10 + 5; j++)
				{
					if (WorldGen.SolidTileAllowBottomSlope(num, j))
					{
						flag = true;
					}
				}
			}
			Vector2 vector = new Vector2((float)(num * 16 + 8), (float)(num10 * 16));
			if (base.Distance(vector) <= 1000f)
			{
				this.MinionRestTargetPoint = vector;
			}
		}

		// Token: 0x06000399 RID: 921 RVA: 0x0024B0F8 File Offset: 0x002492F8
		public void MoonLeechRope()
		{
			int num = -1;
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].type == 456 && Main.projectile[i].ai[1] == (float)this.whoAmI)
				{
					num = i;
					break;
				}
			}
			if (num == -1)
			{
				return;
			}
			if (Main.projectile[num].ai[0] < 0f)
			{
				return;
			}
			Projectile projectile = Main.projectile[num];
			Vector2 value = new Vector2(0f, 216f);
			Vector2 value2 = Main.npc[(int)Math.Abs(projectile.ai[0]) - 1].Center - base.Center + value;
			if (value2.Length() > 200f)
			{
				Vector2 value3 = Vector2.Normalize(value2);
				this.position += value3 * (value2.Length() - 200f);
			}
		}

		// Token: 0x0600041E RID: 1054 RVA: 0x00285DBC File Offset: 0x00283FBC
		public void NebulaLevelup(int type)
		{
			if (this.whoAmI == Main.myPlayer)
			{
				int time = 480;
				for (int i = 0; i < 22; i++)
				{
					if (this.buffType[i] >= type && this.buffType[i] < type + 3)
					{
						this.DelBuff(i);
					}
				}
				if (type == 173)
				{
					this.nebulaLevelLife = (int)MathHelper.Clamp((float)(this.nebulaLevelLife + 1), 0f, 3f);
					this.AddBuff(type + this.nebulaLevelLife - 1, time, true);
					return;
				}
				if (type == 176)
				{
					this.nebulaLevelMana = (int)MathHelper.Clamp((float)(this.nebulaLevelMana + 1), 0f, 3f);
					this.AddBuff(type + this.nebulaLevelMana - 1, time, true);
					return;
				}
				if (type != 179)
				{
					return;
				}
				this.nebulaLevelDamage = (int)MathHelper.Clamp((float)(this.nebulaLevelDamage + 1), 0f, 3f);
				this.AddBuff(type + this.nebulaLevelDamage - 1, time, true);
			}
		}

		// Token: 0x060003CD RID: 973 RVA: 0x00264154 File Offset: 0x00262354
		public void NinjaDodge()
		{
			this.immune = true;
			this.immuneTime = 80;
			if (this.longInvince)
			{
				this.immuneTime += 40;
			}
			for (int i = 0; i < this.hurtCooldowns.Length; i++)
			{
				this.hurtCooldowns[i] = this.immuneTime;
			}
			for (int j = 0; j < 100; j++)
			{
				int num = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 31, 0f, 0f, 100, default(Color), 2f);
				Dust expr_A9_cp_0_cp_0 = Main.dust[num];
				expr_A9_cp_0_cp_0.position.X = expr_A9_cp_0_cp_0.position.X + (float)Main.rand.Next(-20, 21);
				Dust expr_CD_cp_0_cp_0 = Main.dust[num];
				expr_CD_cp_0_cp_0.position.Y = expr_CD_cp_0_cp_0.position.Y + (float)Main.rand.Next(-20, 21);
				Main.dust[num].velocity *= 0.4f;
				Main.dust[num].scale *= 1f + (float)Main.rand.Next(40) * 0.01f;
				Main.dust[num].shader = GameShaders.Armor.GetSecondaryShader(this.cWaist, this);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num].scale *= 1f + (float)Main.rand.Next(40) * 0.01f;
					Main.dust[num].noGravity = true;
				}
			}
			int num2 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64), 1f);
			Main.gore[num2].scale = 1.5f;
			Main.gore[num2].velocity.X = (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity.Y = (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity *= 0.4f;
			num2 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64), 1f);
			Main.gore[num2].scale = 1.5f;
			Main.gore[num2].velocity.X = 1.5f + (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity.Y = 1.5f + (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity *= 0.4f;
			num2 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64), 1f);
			Main.gore[num2].scale = 1.5f;
			Main.gore[num2].velocity.X = -1.5f - (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity.Y = 1.5f + (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity *= 0.4f;
			num2 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64), 1f);
			Main.gore[num2].scale = 1.5f;
			Main.gore[num2].velocity.X = 1.5f + (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity.Y = -1.5f - (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity *= 0.4f;
			num2 = Gore.NewGore(new Vector2(this.position.X + (float)(this.width / 2) - 24f, this.position.Y + (float)(this.height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64), 1f);
			Main.gore[num2].scale = 1.5f;
			Main.gore[num2].velocity.X = -1.5f - (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity.Y = -1.5f - (float)Main.rand.Next(-50, 51) * 0.01f;
			Main.gore[num2].velocity *= 0.4f;
			if (this.whoAmI == Main.myPlayer)
			{
				NetMessage.SendData(62, -1, -1, null, this.whoAmI, 1f, 0f, 0f, 0, 0, 0);
			}
		}

		// Token: 0x060003B6 RID: 950 RVA: 0x00259D60 File Offset: 0x00257F60
		private void OldInput()
		{
			bool flag = false;
			bool flag2 = false;
			Keys[] pressedKeys = Main.keyState.GetPressedKeys();
			for (int i = 0; i < pressedKeys.Length; i++)
			{
				if (pressedKeys[i] == Keys.LeftShift || pressedKeys[i] == Keys.RightShift)
				{
					flag = true;
				}
				else if (pressedKeys[i] == Keys.LeftAlt || pressedKeys[i] == Keys.RightAlt)
				{
					flag2 = true;
				}
			}
			if (Main.blockKey != Keys.None.ToString())
			{
				bool flag3 = false;
				for (int j = 0; j < pressedKeys.Length; j++)
				{
					if (pressedKeys[j].ToString() == Main.blockKey)
					{
						pressedKeys[j] = Keys.None;
						flag3 = true;
					}
				}
				if (!flag3)
				{
					Main.blockKey = Keys.None.ToString();
				}
			}
			for (int k = 0; k < pressedKeys.Length; k++)
			{
				string a = string.Concat(pressedKeys[k]);
				if (pressedKeys[k] != Keys.Tab || !((flag && SocialAPI.Mode == SocialMode.Steam) | flag2))
				{
					if (a == Main.cUp)
					{
						this.controlUp = true;
					}
					if (a == Main.cLeft)
					{
						this.controlLeft = true;
					}
					if (a == Main.cDown)
					{
						this.controlDown = true;
					}
					if (a == Main.cRight)
					{
						this.controlRight = true;
					}
					if (a == Main.cJump)
					{
						this.controlJump = true;
					}
					if (a == Main.cThrowItem)
					{
						this.controlThrow = true;
					}
					if (a == Main.cInv)
					{
						this.controlInv = true;
					}
					if (a == Main.cBuff)
					{
						this.QuickBuff();
					}
					if (a == Main.cHeal)
					{
						this.controlQuickHeal = true;
					}
					if (a == Main.cMana)
					{
						this.controlQuickMana = true;
					}
					if (a == Main.cHook)
					{
						this.controlHook = true;
					}
					if (a == Main.cTorch)
					{
						this.controlTorch = true;
					}
					if (a == Main.cSmart)
					{
						this.controlSmart = true;
					}
					if (a == Main.cMount)
					{
						this.controlMount = true;
					}
					if (Main.mapEnabled)
					{
						if (a == Main.cMapZoomIn)
						{
							this.mapZoomIn = true;
						}
						if (a == Main.cMapZoomOut)
						{
							this.mapZoomOut = true;
						}
						if (a == Main.cMapAlphaUp)
						{
							this.mapAlphaUp = true;
						}
						if (a == Main.cMapAlphaDown)
						{
							this.mapAlphaDown = true;
						}
						if (a == Main.cMapFull)
						{
							this.mapFullScreen = true;
						}
						if (a == Main.cMapStyle)
						{
							this.mapStyle = true;
						}
					}
				}
			}
			if (Main.gamePad)
			{
				GamePadState state = GamePad.GetState(PlayerIndex.One);
				if (state.DPad.Up == ButtonState.Pressed)
				{
					this.controlUp = true;
				}
				if (state.DPad.Down == ButtonState.Pressed)
				{
					this.controlDown = true;
				}
				if (state.DPad.Left == ButtonState.Pressed)
				{
					this.controlLeft = true;
				}
				if (state.DPad.Right == ButtonState.Pressed)
				{
					this.controlRight = true;
				}
				if (state.Triggers.Left > 0f)
				{
					this.controlJump = true;
				}
				if (state.Triggers.Right > 0f)
				{
					this.controlUseItem = true;
				}
				Main.mouseX = (int)((float)(Main.screenWidth / 2) + state.ThumbSticks.Right.X * (float)Player.tileRangeX * 16f);
				Main.mouseY = (int)((float)(Main.screenHeight / 2) - state.ThumbSticks.Right.Y * (float)Player.tileRangeX * 16f);
				if (state.ThumbSticks.Right.X == 0f)
				{
					Main.mouseX = Main.screenWidth / 2 + this.direction * 2;
				}
			}
			if (Main.mouseLeft)
			{
				if (!Main.blockMouse && !this.mouseInterface)
				{
					this.controlUseItem = true;
				}
			}
			else
			{
				Main.blockMouse = false;
			}
			if (Main.mouseRight && !this.mouseInterface && !Main.blockMouse)
			{
				this.controlUseTile = true;
			}
		}

		// Token: 0x06000363 RID: 867 RVA: 0x00229098 File Offset: 0x00227298
		private void OldInputGhost()
		{
			Keys[] pressedKeys = Main.keyState.GetPressedKeys();
			if (Main.blockKey != Keys.None.ToString())
			{
				bool flag = false;
				for (int i = 0; i < pressedKeys.Length; i++)
				{
					if (pressedKeys[i].ToString() == Main.blockKey)
					{
						pressedKeys[i] = Keys.None;
						flag = true;
					}
				}
				if (!flag)
				{
					Main.blockKey = Keys.None.ToString();
				}
			}
			for (int j = 0; j < pressedKeys.Length; j++)
			{
				string expr_84 = string.Concat(pressedKeys[j]);
				if (expr_84 == Main.cUp)
				{
					this.controlUp = true;
				}
				if (expr_84 == Main.cLeft)
				{
					this.controlLeft = true;
				}
				if (expr_84 == Main.cDown)
				{
					this.controlDown = true;
				}
				if (expr_84 == Main.cRight)
				{
					this.controlRight = true;
				}
				if (expr_84 == Main.cJump)
				{
					this.controlJump = true;
				}
			}
		}

		// Token: 0x06000364 RID: 868 RVA: 0x0022919C File Offset: 0x0022739C
		public void OnHit(float x, float y, Entity victim)
		{
			if (Main.myPlayer != this.whoAmI)
			{
				return;
			}
			if (this.onHitDodge && this.shadowDodgeTimer == 0 && Main.rand.Next(4) == 0)
			{
				if (!this.shadowDodge)
				{
					this.shadowDodgeTimer = 1800;
				}
				this.AddBuff(59, 1800, true);
			}
			if (this.onHitRegen)
			{
				this.AddBuff(58, 300, true);
			}
			if (this.stardustMinion && victim is NPC)
			{
				for (int i = 0; i < 1000; i++)
				{
					Projectile projectile = Main.projectile[i];
					if (projectile.active && projectile.owner == this.whoAmI && projectile.type == 613 && projectile.localAI[1] <= 0f && Main.rand.Next(2) == 0)
					{
						Vector2 vector = new Vector2(x, y) - projectile.Center;
						if (vector.Length() > 0f)
						{
							vector.Normalize();
						}
						vector *= 20f;
						Projectile.NewProjectile(projectile.Center.X, projectile.Center.Y, vector.X, vector.Y, 614, projectile.damage / 3, 0f, projectile.owner, 0f, (float)victim.whoAmI);
						projectile.localAI[1] = (float)(30 + Main.rand.Next(4) * 10);
					}
				}
			}
			if (this.onHitPetal && this.petalTimer == 0)
			{
				this.petalTimer = 20;
				float arg_1B2_0 = this.position.X + (float)(this.width / 2);
				int arg_1C6_0 = this.direction;
				float num = Main.screenPosition.X;
				if (arg_1C6_0 < 0)
				{
					num += (float)Main.screenWidth;
				}
				float num2 = Main.screenPosition.Y;
				num2 += (float)Main.rand.Next(Main.screenHeight);
				Vector2 vector2 = new Vector2(num, num2);
				float num3 = x - vector2.X;
				float num4 = y - vector2.Y;
				num3 += (float)Main.rand.Next(-50, 51) * 0.1f;
				num4 += (float)Main.rand.Next(-50, 51) * 0.1f;
				float arg_25C_0 = (float)24;
				float num5 = (float)Math.Sqrt((double)(num3 * num3 + num4 * num4));
				num5 = arg_25C_0 / num5;
				num3 *= num5;
				num4 *= num5;
				Projectile.NewProjectile(num, num2, num3, num4, 221, 36, 0f, this.whoAmI, 0f, 0f);
			}
			if (this.crystalLeaf && this.petalTimer == 0)
			{
				int arg_2C1_0 = this.inventory[this.selectedItem].type;
				for (int j = 0; j < 1000; j++)
				{
					if (Main.projectile[j].owner == this.whoAmI && Main.projectile[j].type == 226)
					{
						this.petalTimer = 50;
						float arg_379_0 = 12f;
						Vector2 vector3 = new Vector2(Main.projectile[j].position.X + (float)this.width * 0.5f, Main.projectile[j].position.Y + (float)this.height * 0.5f);
						float num6 = x - vector3.X;
						float num7 = y - vector3.Y;
						float num8 = (float)Math.Sqrt((double)(num6 * num6 + num7 * num7));
						num8 = arg_379_0 / num8;
						num6 *= num8;
						num7 *= num8;
						Projectile.NewProjectile(Main.projectile[j].Center.X - 4f, Main.projectile[j].Center.Y, num6, num7, 227, Player.crystalLeafDamage, (float)Player.crystalLeafKB, this.whoAmI, 0f, 0f);
						return;
					}
				}
			}
		}

		// Token: 0x06000367 RID: 871 RVA: 0x0022A2C8 File Offset: 0x002284C8
		public void OpenBossBag(int type)
		{
			if (type == 3318)
			{
				if (Main.rand.Next(2) == 0)
				{
					this.QuickSpawnItem(2430, 1);
				}
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2493, 1);
				}
				int num = Main.rand.Next(256, 259);
				int num2;
				for (num2 = Main.rand.Next(256, 259); num2 == num; num2 = Main.rand.Next(256, 259))
				{
				}
				this.QuickSpawnItem(num, 1);
				this.QuickSpawnItem(num2, 1);
				if (Main.rand.Next(2) == 0)
				{
					this.QuickSpawnItem(2610, 1);
				}
				else
				{
					this.QuickSpawnItem(2585, 1);
				}
				this.QuickSpawnItem(998, 1);
				this.QuickSpawnItem(3090, 1);
			}
			else if (type == 3319)
			{
				if (this.difficulty == 2)
				{
					this.QuickSpawnItem(3763, 1);
				}
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2112, 1);
				}
				if (Main.rand.Next(30) == 0)
				{
					this.QuickSpawnItem(1299, 1);
				}
				if (WorldGen.crimson)
				{
					int num3 = Main.rand.Next(20) + 10;
					num3 += Main.rand.Next(20) + 10;
					num3 += Main.rand.Next(20) + 10;
					this.QuickSpawnItem(880, num3);
					num3 = Main.rand.Next(3) + 1;
					this.QuickSpawnItem(2171, num3);
				}
				else
				{
					int num4 = Main.rand.Next(20) + 10;
					num4 += Main.rand.Next(20) + 10;
					num4 += Main.rand.Next(20) + 10;
					this.QuickSpawnItem(56, num4);
					num4 = Main.rand.Next(3) + 1;
					this.QuickSpawnItem(59, num4);
					num4 = Main.rand.Next(30) + 20;
					this.QuickSpawnItem(47, num4);
				}
				this.QuickSpawnItem(3097, 1);
			}
			else if (type == 3320)
			{
				int num5 = Main.rand.Next(15, 30);
				num5 += Main.rand.Next(15, 31);
				this.QuickSpawnItem(56, num5);
				num5 = Main.rand.Next(10, 20);
				this.QuickSpawnItem(86, num5);
				if (Main.rand.Next(20) == 0)
				{
					this.QuickSpawnItem(994, 1);
				}
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2111, 1);
				}
				this.QuickSpawnItem(3224, 1);
			}
			else if (type == 3321)
			{
				int num6 = Main.rand.Next(20, 46);
				num6 += Main.rand.Next(20, 46);
				this.QuickSpawnItem(880, num6);
				num6 = Main.rand.Next(10, 20);
				this.QuickSpawnItem(1329, num6);
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2104, 1);
				}
				if (Main.rand.Next(20) == 0)
				{
					this.QuickSpawnItem(3060, 1);
				}
				this.QuickSpawnItem(3223, 1);
			}
			else if (type == 3322)
			{
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2108, 1);
				}
				int num7 = Main.rand.Next(3);
				if (num7 == 0)
				{
					num7 = 1121;
				}
				else if (num7 == 1)
				{
					num7 = 1123;
				}
				else if (num7 == 2)
				{
					num7 = 2888;
				}
				this.QuickSpawnItem(num7, 1);
				this.QuickSpawnItem(3333, 1);
				if (Main.rand.Next(3) == 0)
				{
					this.QuickSpawnItem(1132, 1);
				}
				if (Main.rand.Next(9) == 0)
				{
					this.QuickSpawnItem(1170, 1);
				}
				if (Main.rand.Next(9) == 0)
				{
					this.QuickSpawnItem(2502, 1);
				}
				this.QuickSpawnItem(1129, 1);
				this.QuickSpawnItem(Main.rand.Next(842, 845), 1);
				this.QuickSpawnItem(1130, Main.rand.Next(10, 30));
				this.QuickSpawnItem(2431, Main.rand.Next(17, 30));
			}
			else if (type == 3323)
			{
				this.QuickSpawnItem(3245, 1);
				int num8 = Main.rand.Next(3);
				if (num8 == 0)
				{
					this.QuickSpawnItem(1281, 1);
				}
				else if (num8 == 1)
				{
					this.QuickSpawnItem(1273, 1);
				}
				else
				{
					this.QuickSpawnItem(1313, 1);
				}
			}
			else if (type == 3324)
			{
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2105, 1);
				}
				this.QuickSpawnItem(367, 1);
				if (!this.extraAccessory)
				{
					this.QuickSpawnItem(3335, 1);
				}
				int num9 = Main.rand.Next(4);
				if (num9 == 3)
				{
					num9 = 2998;
				}
				else
				{
					num9 = 489 + num9;
				}
				this.QuickSpawnItem(num9, 1);
				int num10 = Main.rand.Next(3);
				if (num10 == 0)
				{
					this.QuickSpawnItem(514, 1);
				}
				else if (num10 == 1)
				{
					this.QuickSpawnItem(426, 1);
				}
				else if (num10 == 2)
				{
					this.QuickSpawnItem(434, 1);
				}
			}
			else if (type == 3325)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2113, 1);
				}
				this.QuickSpawnItem(548, Main.rand.Next(25, 41));
				this.QuickSpawnItem(1225, Main.rand.Next(20, 36));
				this.QuickSpawnItem(3355, 1);
			}
			else if (type == 3326)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2106, 1);
				}
				this.QuickSpawnItem(549, Main.rand.Next(25, 41));
				this.QuickSpawnItem(1225, Main.rand.Next(20, 36));
				this.QuickSpawnItem(3354, 1);
			}
			else if (type == 3327)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2107, 1);
				}
				this.QuickSpawnItem(547, Main.rand.Next(25, 41));
				this.QuickSpawnItem(1225, Main.rand.Next(20, 36));
				this.QuickSpawnItem(3356, 1);
			}
			else if (type == 3328)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2109, 1);
				}
				this.QuickSpawnItem(1141, 1);
				this.QuickSpawnItem(3336, 1);
				if (Main.rand.Next(15) == 0)
				{
					this.QuickSpawnItem(1182, 1);
				}
				if (Main.rand.Next(20) == 0)
				{
					this.QuickSpawnItem(1305, 1);
				}
				if (Main.rand.Next(2) == 0)
				{
					this.QuickSpawnItem(1157, 1);
				}
				if (Main.rand.Next(10) == 0)
				{
					this.QuickSpawnItem(3021, 1);
				}
				int num11 = Main.rand.Next(7);
				if (num11 == 0)
				{
					this.QuickSpawnItem(758, 1);
					this.QuickSpawnItem(771, Main.rand.Next(50, 150));
				}
				else if (num11 == 1)
				{
					this.QuickSpawnItem(1255, 1);
				}
				else if (num11 == 2)
				{
					this.QuickSpawnItem(788, 1);
				}
				else if (num11 == 3)
				{
					this.QuickSpawnItem(1178, 1);
				}
				else if (num11 == 4)
				{
					this.QuickSpawnItem(1259, 1);
				}
				else if (num11 == 5)
				{
					this.QuickSpawnItem(1155, 1);
				}
				else if (num11 == 6)
				{
					this.QuickSpawnItem(3018, 1);
				}
			}
			else if (type == 3329)
			{
				this.TryGettingDevArmor();
				this.QuickSpawnItem(3337, 1);
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2110, 1);
				}
				int num12 = Main.rand.Next(8);
				if (num12 == 0)
				{
					this.QuickSpawnItem(1258, 1);
					this.QuickSpawnItem(1261, Main.rand.Next(60, 100));
				}
				else if (num12 == 1)
				{
					this.QuickSpawnItem(1122, 1);
				}
				else if (num12 == 2)
				{
					this.QuickSpawnItem(899, 1);
				}
				else if (num12 == 3)
				{
					this.QuickSpawnItem(1248, 1);
				}
				else if (num12 == 4)
				{
					this.QuickSpawnItem(1294, 1);
				}
				else if (num12 == 5)
				{
					this.QuickSpawnItem(1295, 1);
				}
				else if (num12 == 6)
				{
					this.QuickSpawnItem(1296, 1);
				}
				else if (num12 == 7)
				{
					this.QuickSpawnItem(1297, 1);
				}
				this.QuickSpawnItem(2218, Main.rand.Next(18, 24));
			}
			else if (type == 3330)
			{
				this.TryGettingDevArmor();
				this.QuickSpawnItem(3367, 1);
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(2588, 1);
				}
				if (Main.rand.Next(10) == 0)
				{
					this.QuickSpawnItem(2609, 1);
				}
				int num13 = Main.rand.Next(5);
				if (num13 == 0)
				{
					this.QuickSpawnItem(2611, 1);
				}
				else if (num13 == 1)
				{
					this.QuickSpawnItem(2624, 1);
				}
				else if (num13 == 2)
				{
					this.QuickSpawnItem(2622, 1);
				}
				else if (num13 == 3)
				{
					this.QuickSpawnItem(2621, 1);
				}
				else if (num13 == 4)
				{
					this.QuickSpawnItem(2623, 1);
				}
			}
			else if (type == 3331)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(3372, 1);
				}
			}
			else if (type == 3860)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(3863, 1);
				}
				int num14 = Main.rand.Next(4);
				if (num14 == 0)
				{
					this.QuickSpawnItem(3859, 1);
				}
				else if (num14 == 1)
				{
					this.QuickSpawnItem(3827, 1);
				}
				else if (num14 == 2)
				{
					this.QuickSpawnItem(3870, 1);
				}
				else
				{
					this.QuickSpawnItem(3858, 1);
				}
				if (Main.rand.Next(4) == 0)
				{
					this.QuickSpawnItem(3883, 1);
				}
				this.QuickSpawnItem(3817, Main.rand.Next(30, 50));
			}
			else if (type == 3332)
			{
				this.TryGettingDevArmor();
				if (Main.rand.Next(7) == 0)
				{
					this.QuickSpawnItem(3373, 1);
				}
				if (!this.HasItem(3384))
				{
					this.QuickSpawnItem(3384, 1);
				}
				this.QuickSpawnItem(3460, Main.rand.Next(90, 111));
				this.QuickSpawnItem(1131, 1);
				this.QuickSpawnItem(3577, 1);
				int item = Utils.SelectRandom<int>(Main.rand, new int[]
				{
					3063,
					3389,
					3065,
					1553,
					3546,
					3541,
					3570,
					3571,
					3569
				});
				this.QuickSpawnItem(item, 1);
			}
			int num15 = -1;
			if (type == 3318)
			{
				num15 = 50;
			}
			if (type == 3319)
			{
				num15 = 4;
			}
			if (type == 3320)
			{
				num15 = 13;
			}
			if (type == 3321)
			{
				num15 = 266;
			}
			if (type == 3322)
			{
				num15 = 222;
			}
			if (type == 3323)
			{
				num15 = 35;
			}
			if (type == 3324)
			{
				num15 = 113;
			}
			if (type == 3325)
			{
				num15 = 134;
			}
			if (type == 3326)
			{
				num15 = 125;
			}
			if (type == 3327)
			{
				num15 = 127;
			}
			if (type == 3328)
			{
				num15 = 262;
			}
			if (type == 3329)
			{
				num15 = 245;
			}
			if (type == 3330)
			{
				num15 = 370;
			}
			if (type == 3331)
			{
				num15 = 439;
			}
			if (type == 3332)
			{
				num15 = 398;
			}
			if (type == 3860)
			{
				num15 = 551;
			}
			if (type == 3861)
			{
				num15 = 576;
			}
			if (type == 3862)
			{
				num15 = 564;
			}
			if (num15 > 0)
			{
				NPC expr_C79 = new NPC();
				expr_C79.SetDefaults(num15, -1f);
				float num16 = expr_C79.value;
				num16 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
				if (Main.rand.Next(5) == 0)
				{
					num16 *= 1f + (float)Main.rand.Next(5, 11) * 0.01f;
				}
				if (Main.rand.Next(10) == 0)
				{
					num16 *= 1f + (float)Main.rand.Next(10, 21) * 0.01f;
				}
				if (Main.rand.Next(15) == 0)
				{
					num16 *= 1f + (float)Main.rand.Next(15, 31) * 0.01f;
				}
				if (Main.rand.Next(20) == 0)
				{
					num16 *= 1f + (float)Main.rand.Next(20, 41) * 0.01f;
				}
				while ((int)num16 > 0)
				{
					if (num16 > 1000000f)
					{
						int num17 = (int)(num16 / 1000000f);
						num16 -= (float)(1000000 * num17);
						this.QuickSpawnItem(74, num17);
					}
					else if (num16 > 10000f)
					{
						int num18 = (int)(num16 / 10000f);
						num16 -= (float)(10000 * num18);
						this.QuickSpawnItem(73, num18);
					}
					else if (num16 > 100f)
					{
						int num19 = (int)(num16 / 100f);
						num16 -= (float)(100 * num19);
						this.QuickSpawnItem(72, num19);
					}
					else
					{
						int num20 = (int)num16;
						if (num20 < 1)
						{
							num20 = 1;
						}
						num16 -= (float)num20;
						this.QuickSpawnItem(71, num20);
					}
				}
			}
		}

		// Token: 0x06000369 RID: 873 RVA: 0x0022B42C File Offset: 0x0022962C
		public void openCrate(int type)
		{
			int num = type - 2334;
			if (type >= 3203)
			{
				num = type - 3203 + 3;
			}
			if (num == 0)
			{
				bool flag = true;
				while (flag)
				{
					if ((Main.hardMode & flag) && Main.rand.Next(200) == 0)
					{
						int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3064, 1, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (flag && Main.rand.Next(40) == 0)
					{
						int type2 = 3200;
						int stack = 1;
						int number2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type2, stack, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number2, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (flag && Main.rand.Next(40) == 0)
					{
						int type3 = 3201;
						int stack2 = 1;
						int number3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type3, stack2, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number3, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if ((Main.hardMode & flag) && Main.rand.Next(25) == 0)
					{
						int type4 = 2424;
						int stack3 = 1;
						int number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type4, stack3, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (Main.rand.Next(45) == 0)
					{
						int num2 = Main.rand.Next(5);
						if (num2 == 0)
						{
							num2 = 285;
						}
						else if (num2 == 1)
						{
							num2 = 953;
						}
						else if (num2 == 2)
						{
							num2 = 946;
						}
						else if (num2 == 3)
						{
							num2 = 3068;
						}
						else if (num2 == 4)
						{
							num2 = 3084;
						}
						int number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num2, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if ((!Main.hardMode & flag) && Main.rand.Next(50) == 0)
					{
						int type5 = 997;
						int stack4 = 1;
						int number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type5, stack4, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (Main.rand.Next(7) == 0)
					{
						int type6;
						int stack5;
						if (Main.rand.Next(3) == 0)
						{
							type6 = 73;
							stack5 = Main.rand.Next(1, 6);
						}
						else
						{
							type6 = 72;
							stack5 = Main.rand.Next(20, 91);
						}
						int number7 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type6, stack5, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number7, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (Main.rand.Next(7) == 0)
					{
						int num3 = Main.rand.Next(8);
						if (num3 == 0)
						{
							num3 = 12;
						}
						else if (num3 == 1)
						{
							num3 = 11;
						}
						else if (num3 == 2)
						{
							num3 = 14;
						}
						else if (num3 == 3)
						{
							num3 = 13;
						}
						else if (num3 == 4)
						{
							num3 = 699;
						}
						else if (num3 == 5)
						{
							num3 = 700;
						}
						else if (num3 == 6)
						{
							num3 = 701;
						}
						else if (num3 == 7)
						{
							num3 = 702;
						}
						if (Main.hardMode && Main.rand.Next(2) == 0)
						{
							num3 = Main.rand.Next(6);
							if (num3 == 0)
							{
								num3 = 364;
							}
							else if (num3 == 1)
							{
								num3 = 365;
							}
							else if (num3 == 2)
							{
								num3 = 366;
							}
							else if (num3 == 3)
							{
								num3 = 1104;
							}
							else if (num3 == 4)
							{
								num3 = 1105;
							}
							else if (num3 == 5)
							{
								num3 = 1106;
							}
						}
						int stack6 = Main.rand.Next(8, 21);
						int number8 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num3, stack6, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number8, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (Main.rand.Next(8) == 0)
					{
						int num4 = Main.rand.Next(8);
						if (num4 == 0)
						{
							num4 = 20;
						}
						else if (num4 == 1)
						{
							num4 = 22;
						}
						else if (num4 == 2)
						{
							num4 = 21;
						}
						else if (num4 == 3)
						{
							num4 = 19;
						}
						else if (num4 == 4)
						{
							num4 = 703;
						}
						else if (num4 == 5)
						{
							num4 = 704;
						}
						else if (num4 == 6)
						{
							num4 = 705;
						}
						else if (num4 == 7)
						{
							num4 = 706;
						}
						int num5 = Main.rand.Next(2, 8);
						if (Main.hardMode && Main.rand.Next(2) == 0)
						{
							num4 = Main.rand.Next(6);
							if (num4 == 0)
							{
								num4 = 381;
							}
							else if (num4 == 1)
							{
								num4 = 382;
							}
							else if (num4 == 2)
							{
								num4 = 391;
							}
							else if (num4 == 3)
							{
								num4 = 1184;
							}
							else if (num4 == 4)
							{
								num4 = 1191;
							}
							else if (num4 == 5)
							{
								num4 = 1198;
							}
							num5 -= Main.rand.Next(2);
						}
						int number9 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num4, num5, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number9, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
					if (Main.rand.Next(7) == 0)
					{
						int num6 = Main.rand.Next(10);
						if (num6 == 0)
						{
							num6 = 288;
						}
						else if (num6 == 1)
						{
							num6 = 290;
						}
						else if (num6 == 2)
						{
							num6 = 292;
						}
						else if (num6 == 3)
						{
							num6 = 299;
						}
						else if (num6 == 4)
						{
							num6 = 298;
						}
						else if (num6 == 5)
						{
							num6 = 304;
						}
						else if (num6 == 6)
						{
							num6 = 291;
						}
						else if (num6 == 7)
						{
							num6 = 2322;
						}
						else if (num6 == 8)
						{
							num6 = 2323;
						}
						else if (num6 == 9)
						{
							num6 = 2329;
						}
						int stack7 = Main.rand.Next(1, 4);
						int number10 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num6, stack7, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number10, 1f, 0f, 0f, 0, 0, 0);
						}
						flag = false;
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					int num7 = Main.rand.Next(2);
					if (num7 == 0)
					{
						num7 = 28;
					}
					else if (num7 == 1)
					{
						num7 = 110;
					}
					int stack8 = Main.rand.Next(5, 16);
					int number11 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num7, stack8, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number11, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					int type7;
					if (Main.rand.Next(3) == 0)
					{
						type7 = 2675;
					}
					else
					{
						type7 = 2674;
					}
					int stack9 = Main.rand.Next(1, 5);
					int number12 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type7, stack9, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number12, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
			}
			else if (num == 1)
			{
				bool flag2 = true;
				while (flag2)
				{
					if ((Main.hardMode & flag2) && Main.rand.Next(60) == 0)
					{
						int number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3064, 1, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (flag2 && Main.rand.Next(25) == 0)
					{
						int type8 = 2501;
						int stack10 = 1;
						int number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type8, stack10, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (flag2 && Main.rand.Next(20) == 0)
					{
						int type9 = 2587;
						int stack11 = 1;
						int number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type9, stack11, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (flag2 && Main.rand.Next(15) == 0)
					{
						int type10 = 2608;
						int stack12 = 1;
						int number16 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type10, stack12, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number16, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (flag2 && Main.rand.Next(20) == 0)
					{
						int type11 = 3200;
						int stack13 = 1;
						int number17 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type11, stack13, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number17, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (flag2 && Main.rand.Next(20) == 0)
					{
						int type12 = 3201;
						int stack14 = 1;
						int number18 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type12, stack14, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number18, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (Main.rand.Next(4) == 0)
					{
						int type13 = 73;
						int stack15 = Main.rand.Next(5, 11);
						int number19 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type13, stack15, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number19, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num8 = Main.rand.Next(8);
						if (num8 == 0)
						{
							num8 = 20;
						}
						else if (num8 == 1)
						{
							num8 = 22;
						}
						else if (num8 == 2)
						{
							num8 = 21;
						}
						else if (num8 == 3)
						{
							num8 = 19;
						}
						else if (num8 == 4)
						{
							num8 = 703;
						}
						else if (num8 == 5)
						{
							num8 = 704;
						}
						else if (num8 == 6)
						{
							num8 = 705;
						}
						else if (num8 == 7)
						{
							num8 = 706;
						}
						int num9 = Main.rand.Next(6, 15);
						if (Main.hardMode && Main.rand.Next(3) != 0)
						{
							num8 = Main.rand.Next(6);
							if (num8 == 0)
							{
								num8 = 381;
							}
							else if (num8 == 1)
							{
								num8 = 382;
							}
							else if (num8 == 2)
							{
								num8 = 391;
							}
							else if (num8 == 3)
							{
								num8 = 1184;
							}
							else if (num8 == 4)
							{
								num8 = 1191;
							}
							else if (num8 == 5)
							{
								num8 = 1198;
							}
							num9 -= Main.rand.Next(2);
						}
						int number20 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num8, num9, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number20, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num10 = Main.rand.Next(8);
						if (num10 == 0)
						{
							num10 = 288;
						}
						else if (num10 == 1)
						{
							num10 = 296;
						}
						else if (num10 == 2)
						{
							num10 = 304;
						}
						else if (num10 == 3)
						{
							num10 = 305;
						}
						else if (num10 == 4)
						{
							num10 = 2322;
						}
						else if (num10 == 5)
						{
							num10 = 2323;
						}
						else if (num10 == 6)
						{
							num10 = 2324;
						}
						else if (num10 == 7)
						{
							num10 = 2327;
						}
						int stack16 = Main.rand.Next(2, 5);
						int number21 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num10, stack16, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number21, 1f, 0f, 0f, 0, 0, 0);
						}
						flag2 = false;
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int type14 = Main.rand.Next(188, 190);
					int stack17 = Main.rand.Next(5, 16);
					int number22 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type14, stack17, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number22, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int type15;
					if (Main.rand.Next(3) == 0)
					{
						type15 = 2676;
					}
					else
					{
						type15 = 2675;
					}
					int stack18 = Main.rand.Next(2, 5);
					int number23 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type15, stack18, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number23, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
			}
			else if (num == 2)
			{
				bool flag3 = true;
				while (flag3)
				{
					if ((Main.hardMode & flag3) && Main.rand.Next(20) == 0)
					{
						int number24 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3064, 1, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number24, 1f, 0f, 0f, 0, 0, 0);
						}
						flag3 = false;
					}
					if (flag3 && Main.rand.Next(10) == 0)
					{
						int type16 = 2491;
						int stack19 = 1;
						int number25 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type16, stack19, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number25, 1f, 0f, 0f, 0, 0, 0);
						}
						flag3 = false;
					}
					if (Main.rand.Next(3) == 0)
					{
						int type17 = 73;
						int stack20 = Main.rand.Next(8, 21);
						int number26 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type17, stack20, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number26, 1f, 0f, 0f, 0, 0, 0);
						}
						flag3 = false;
					}
					if (Main.rand.Next(3) == 0)
					{
						int num11 = Main.rand.Next(4);
						if (num11 == 0)
						{
							num11 = 21;
						}
						else if (num11 == 1)
						{
							num11 = 19;
						}
						else if (num11 == 2)
						{
							num11 = 705;
						}
						else if (num11 == 3)
						{
							num11 = 706;
						}
						if (Main.hardMode && Main.rand.Next(3) != 0)
						{
							num11 = Main.rand.Next(4);
							if (num11 == 0)
							{
								num11 = 382;
							}
							else if (num11 == 1)
							{
								num11 = 391;
							}
							else if (num11 == 2)
							{
								num11 = 1191;
							}
							else if (num11 == 3)
							{
								num11 = 1198;
							}
						}
						int stack21 = Main.rand.Next(15, 31);
						int number27 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num11, stack21, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number27, 1f, 0f, 0f, 0, 0, 0);
						}
						flag3 = false;
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					int num12 = Main.rand.Next(5);
					if (num12 == 0)
					{
						num12 = 288;
					}
					else if (num12 == 1)
					{
						num12 = 296;
					}
					else if (num12 == 2)
					{
						num12 = 305;
					}
					else if (num12 == 3)
					{
						num12 = 2322;
					}
					else if (num12 == 4)
					{
						num12 = 2323;
					}
					int stack22 = Main.rand.Next(2, 6);
					int number28 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num12, stack22, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number28, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int type18 = Main.rand.Next(499, 501);
					int stack23 = Main.rand.Next(5, 21);
					int number29 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type18, stack23, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number29, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(3) != 0)
				{
					int type19 = 2676;
					int stack24 = Main.rand.Next(3, 8);
					int number30 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type19, stack24, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number30, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
			}
			else
			{
				int maxValue = 6;
				bool flag4 = true;
				while (flag4)
				{
					if (num == 3 && flag4 && Main.rand.Next(maxValue) == 0)
					{
						int num13 = Main.rand.Next(5);
						if (num13 == 0)
						{
							num13 = 162;
						}
						else if (num13 == 1)
						{
							num13 = 111;
						}
						else if (num13 == 2)
						{
							num13 = 96;
						}
						else if (num13 == 3)
						{
							num13 = 115;
						}
						else
						{
							num13 = 64;
						}
						int number31 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num13, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number31, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (num == 4 && flag4 && Main.rand.Next(maxValue) == 0)
					{
						int num14 = Main.rand.Next(5);
						if (num14 == 0)
						{
							num14 = 800;
						}
						else if (num14 == 1)
						{
							num14 = 802;
						}
						else if (num14 == 2)
						{
							num14 = 1256;
						}
						else if (num14 == 3)
						{
							num14 = 1290;
						}
						else
						{
							num14 = 3062;
						}
						int number32 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num14, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number32, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (num == 5 && flag4 && Main.rand.Next(maxValue) == 0)
					{
						int type20 = 3085;
						int number33 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type20, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number33, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (num == 6 && flag4 && Main.rand.Next(maxValue) == 0)
					{
						int num15 = Main.rand.Next(3);
						if (num15 == 0)
						{
							num15 = 158;
						}
						else if (num15 == 1)
						{
							num15 = 65;
						}
						else
						{
							num15 = 159;
						}
						int number34 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num15, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number34, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (num == 8 && flag4 && Main.rand.Next(maxValue) == 0)
					{
						int num16 = Main.rand.Next(5);
						if (num16 == 0)
						{
							num16 = 212;
						}
						else if (num16 == 1)
						{
							num16 = 964;
						}
						else if (num16 == 2)
						{
							num16 = 211;
						}
						else if (num16 == 3)
						{
							num16 = 213;
						}
						else
						{
							num16 = 2292;
						}
						int number35 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num16, 1, false, -1, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number35, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (Main.rand.Next(4) == 0)
					{
						int type21 = 73;
						int stack25 = Main.rand.Next(5, 13);
						int number36 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type21, stack25, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number36, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num17 = Main.rand.Next(6);
						if (num17 == 0)
						{
							num17 = 22;
						}
						else if (num17 == 1)
						{
							num17 = 21;
						}
						else if (num17 == 2)
						{
							num17 = 19;
						}
						else if (num17 == 3)
						{
							num17 = 704;
						}
						else if (num17 == 4)
						{
							num17 = 705;
						}
						else if (num17 == 5)
						{
							num17 = 706;
						}
						int num18 = Main.rand.Next(10, 21);
						if (Main.hardMode && Main.rand.Next(3) != 0)
						{
							num17 = Main.rand.Next(6);
							if (num17 == 0)
							{
								num17 = 381;
							}
							else if (num17 == 1)
							{
								num17 = 382;
							}
							else if (num17 == 2)
							{
								num17 = 391;
							}
							else if (num17 == 3)
							{
								num17 = 1184;
							}
							else if (num17 == 4)
							{
								num17 = 1191;
							}
							else if (num17 == 5)
							{
								num17 = 1198;
							}
							num18 -= Main.rand.Next(3);
						}
						int number37 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num17, num18, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number37, 1f, 0f, 0f, 0, 0, 0);
						}
						flag4 = false;
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					int num19 = Main.rand.Next(6);
					if (num19 == 0)
					{
						num19 = 288;
					}
					else if (num19 == 1)
					{
						num19 = 296;
					}
					else if (num19 == 2)
					{
						num19 = 304;
					}
					else if (num19 == 3)
					{
						num19 = 305;
					}
					else if (num19 == 4)
					{
						num19 = 2322;
					}
					else if (num19 == 5)
					{
						num19 = 2323;
					}
					int stack26 = Main.rand.Next(2, 5);
					int number38 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num19, stack26, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number38, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int type22 = Main.rand.Next(188, 190);
					int stack27 = Main.rand.Next(5, 18);
					int number39 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type22, stack27, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number39, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					int type23;
					if (Main.rand.Next(2) == 0)
					{
						type23 = 2676;
					}
					else
					{
						type23 = 2675;
					}
					int stack28 = Main.rand.Next(2, 7);
					int number40 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type23, stack28, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number40, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (num == 3 || num == 4 || num == 7)
				{
					if (Main.hardMode && Main.rand.Next(2) == 0)
					{
						int type24 = 521;
						if (num == 7)
						{
							type24 = 520;
						}
						int stack29 = Main.rand.Next(2, 6);
						int number41 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type24, stack29, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number41, 1f, 0f, 0f, 0, 0, 0);
						}
					}
					if (Main.hardMode && Main.rand.Next(2) == 0)
					{
						int type25 = 522;
						int stack30 = Main.rand.Next(2, 6);
						if (num == 4)
						{
							type25 = 1332;
						}
						else if (num == 7)
						{
							type25 = 502;
							stack30 = Main.rand.Next(4, 11);
						}
						int number42 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type25, stack30, false, 0, false, false);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number42, 1f, 0f, 0f, 0, 0, 0);
						}
					}
				}
			}
		}

		// Token: 0x0600036E RID: 878 RVA: 0x0022D6D0 File Offset: 0x0022B8D0
		public void openGoodieBag()
		{
			if (Main.rand.Next(150) == 0)
			{
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1810, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1800, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number2, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(4) == 0)
			{
				int number3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1809, Main.rand.Next(10, 41), false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number3, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(10) == 0)
			{
				int number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(1846, 1851), 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else
			{
				int num = Main.rand.Next(19);
				if (num == 0)
				{
					int number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1749, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
					}
					number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1750, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
					}
					number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1751, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 1)
				{
					int number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1746, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
					}
					number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1747, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
					}
					number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1748, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 2)
				{
					int number7 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1752, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number7, 1f, 0f, 0f, 0, 0, 0);
					}
					number7 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1753, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number7, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 3)
				{
					int number8 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1767, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number8, 1f, 0f, 0f, 0, 0, 0);
					}
					number8 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1768, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number8, 1f, 0f, 0f, 0, 0, 0);
					}
					number8 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1769, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number8, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 4)
				{
					int number9 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1770, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number9, 1f, 0f, 0f, 0, 0, 0);
					}
					number9 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1771, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number9, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 5)
				{
					int number10 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1772, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number10, 1f, 0f, 0f, 0, 0, 0);
					}
					number10 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1773, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number10, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 6)
				{
					int number11 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1754, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number11, 1f, 0f, 0f, 0, 0, 0);
					}
					number11 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1755, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number11, 1f, 0f, 0f, 0, 0, 0);
					}
					number11 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1756, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number11, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 7)
				{
					int number12 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1757, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number12, 1f, 0f, 0f, 0, 0, 0);
					}
					number12 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1758, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number12, 1f, 0f, 0f, 0, 0, 0);
					}
					number12 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1759, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number12, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 8)
				{
					int number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1760, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
					}
					number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1761, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
					}
					number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1762, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 9)
				{
					int number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1763, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
					}
					number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1764, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
					}
					number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1765, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 10)
				{
					int number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1766, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
					}
					number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1775, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
					}
					number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1776, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 11)
				{
					int number16 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1777, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number16, 1f, 0f, 0f, 0, 0, 0);
					}
					number16 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1778, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number16, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 12)
				{
					int number17 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1779, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number17, 1f, 0f, 0f, 0, 0, 0);
					}
					number17 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1780, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number17, 1f, 0f, 0f, 0, 0, 0);
					}
					number17 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1781, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number17, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 13)
				{
					int number18 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1819, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number18, 1f, 0f, 0f, 0, 0, 0);
					}
					number18 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1820, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number18, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 14)
				{
					int number19 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1821, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number19, 1f, 0f, 0f, 0, 0, 0);
					}
					number19 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1822, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number19, 1f, 0f, 0f, 0, 0, 0);
					}
					number19 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1823, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number19, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 15)
				{
					int number20 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1824, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number20, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 16)
				{
					int number21 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1838, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number21, 1f, 0f, 0f, 0, 0, 0);
					}
					number21 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1839, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number21, 1f, 0f, 0f, 0, 0, 0);
					}
					number21 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1840, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number21, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 17)
				{
					int number22 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1841, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number22, 1f, 0f, 0f, 0, 0, 0);
					}
					number22 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1842, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number22, 1f, 0f, 0f, 0, 0, 0);
					}
					number22 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1843, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number22, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 18)
				{
					int number23 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1851, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number23, 1f, 0f, 0f, 0, 0, 0);
					}
					number23 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1852, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number23, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
		}

		// Token: 0x0600036D RID: 877 RVA: 0x0022D574 File Offset: 0x0022B774
		public void openHerbBag()
		{
			int num = Main.rand.Next(2, 5);
			if (Main.rand.Next(3) == 0)
			{
				num++;
			}
			for (int i = 0; i < num; i++)
			{
				int num2 = Main.rand.Next(14);
				if (num2 == 0)
				{
					num2 = 313;
				}
				if (num2 == 1)
				{
					num2 = 314;
				}
				if (num2 == 2)
				{
					num2 = 315;
				}
				if (num2 == 3)
				{
					num2 = 317;
				}
				if (num2 == 4)
				{
					num2 = 316;
				}
				if (num2 == 5)
				{
					num2 = 318;
				}
				if (num2 == 6)
				{
					num2 = 2358;
				}
				if (num2 == 7)
				{
					num2 = 307;
				}
				if (num2 == 8)
				{
					num2 = 308;
				}
				if (num2 == 9)
				{
					num2 = 309;
				}
				if (num2 == 10)
				{
					num2 = 311;
				}
				if (num2 == 11)
				{
					num2 = 310;
				}
				if (num2 == 12)
				{
					num2 = 312;
				}
				if (num2 == 13)
				{
					num2 = 2357;
				}
				int num3 = Main.rand.Next(2, 5);
				if (Main.rand.Next(3) == 0)
				{
					num3 += Main.rand.Next(1, 5);
				}
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num2, num3, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
				}
			}
		}

		// Token: 0x0600036C RID: 876 RVA: 0x0022D1D4 File Offset: 0x0022B3D4
		public void openLockBox()
		{
			bool flag = true;
			while (flag)
			{
				flag = false;
				int num = Main.rand.Next(7);
				int type;
				if (num == 1)
				{
					type = 329;
				}
				else if (num == 2)
				{
					type = 155;
				}
				else if (num == 3)
				{
					type = 156;
				}
				else if (num == 4)
				{
					type = 157;
				}
				else if (num == 5)
				{
					type = 163;
				}
				else if (num == 6)
				{
					type = 113;
				}
				else
				{
					type = 164;
				}
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type, 1, false, -1, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
				}
				if (Main.rand.Next(3) == 0)
				{
					flag = false;
					int num2 = Main.rand.Next(1, 4);
					if (Main.rand.Next(2) == 0)
					{
						num2 += Main.rand.Next(2);
					}
					if (Main.rand.Next(3) == 0)
					{
						num2 += Main.rand.Next(3);
					}
					if (Main.rand.Next(4) == 0)
					{
						num2 += Main.rand.Next(3);
					}
					if (Main.rand.Next(5) == 0)
					{
						num2 += Main.rand.Next(1, 3);
					}
					int number2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 73, num2, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number2, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					flag = false;
					int number3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 72, Main.rand.Next(10, 100), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number3, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					flag = false;
					int number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 188, Main.rand.Next(2, 6), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					flag = false;
					int num3 = Main.rand.Next(9);
					if (num3 == 0)
					{
						num3 = 296;
					}
					else if (num3 == 1)
					{
						num3 = 2346;
					}
					else if (num3 == 2)
					{
						num3 = 305;
					}
					else if (num3 == 3)
					{
						num3 = 2323;
					}
					else if (num3 == 4)
					{
						num3 = 292;
					}
					else if (num3 == 5)
					{
						num3 = 294;
					}
					else if (num3 == 6)
					{
						num3 = 288;
					}
					else if (Main.netMode == 1)
					{
						num3 = 2997;
					}
					else
					{
						num3 = 2350;
					}
					int number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num3, Main.rand.Next(1, 4), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
		}

		// Token: 0x06000365 RID: 869 RVA: 0x0022959C File Offset: 0x0022779C
		public void openPresent()
		{
			if (Main.rand.Next(15) == 0 && Main.hardMode)
			{
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 602, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(30) == 0)
			{
				int number2 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1922, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number2, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(400) == 0)
			{
				int number3 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1927, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number3, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1870, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
				}
				number4 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 97, Main.rand.Next(30, 61), false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number4, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number5 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1909, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number5, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number6 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1917, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number6, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number7 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1915, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number7, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number8 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1918, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number8, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(150) == 0)
			{
				int number9 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1921, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number9, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(300) == 0)
			{
				int number10 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1923, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number10, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(40) == 0)
			{
				int number11 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1907, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number11, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(10) == 0)
			{
				int number12 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1908, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number12, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(15) == 0)
			{
				int num = Main.rand.Next(5);
				if (num == 0)
				{
					int number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1932, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
					}
					number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1933, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
					}
					number13 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1934, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number13, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 1)
				{
					int number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1935, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
					}
					number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1936, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
					}
					number14 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1937, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number14, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 2)
				{
					int number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1940, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
					}
					number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1941, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
					}
					number15 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1942, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number15, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 3)
				{
					int number16 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1938, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number16, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num == 4)
				{
					int number17 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1939, 1, false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number17, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
			}
			else if (Main.rand.Next(7) == 0)
			{
				int num2 = Main.rand.Next(3);
				if (num2 == 0)
				{
					num2 = 1911;
				}
				if (num2 == 1)
				{
					num2 = 1919;
				}
				if (num2 == 2)
				{
					num2 = 1920;
				}
				int number18 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num2, 1, false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number18, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(8) == 0)
			{
				int number19 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1912, Main.rand.Next(1, 4), false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number19, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else if (Main.rand.Next(9) == 0)
			{
				int number20 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1913, Main.rand.Next(20, 41), false, 0, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number20, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else
			{
				int num3 = Main.rand.Next(3);
				if (num3 == 0)
				{
					int number21 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1872, Main.rand.Next(20, 50), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number21, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else if (num3 == 1)
				{
					int number22 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 586, Main.rand.Next(20, 50), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number22, 1f, 0f, 0f, 0, 0, 0);
						return;
					}
				}
				else
				{
					int number23 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 591, Main.rand.Next(20, 50), false, 0, false, false);
					if (Main.netMode == 1)
					{
						NetMessage.SendData(21, -1, -1, null, number23, 1f, 0f, 0f, 0, 0, 0);
					}
				}
			}
		}

		// Token: 0x060003E4 RID: 996 RVA: 0x0026C470 File Offset: 0x0026A670
		private void PayDD2CrystalsBeforeUse(Item item)
		{
			int requiredDD2CrystalsToUse = this.GetRequiredDD2CrystalsToUse(item);
			for (int i = 0; i < requiredDD2CrystalsToUse; i++)
			{
				this.ConsumeItem(3822, true);
			}
		}

		// Token: 0x060003F3 RID: 1011 RVA: 0x0027FC18 File Offset: 0x0027DE18
		public void PickAmmo(Item sItem, ref int shoot, ref float speed, ref bool canShoot, ref int Damage, ref float KnockBack, bool dontConsume = false)
		{
			Item item = new Item();
			bool flag = false;
			for (int i = 54; i < 58; i++)
			{
				if (this.inventory[i].ammo == sItem.useAmmo && this.inventory[i].stack > 0)
				{
					item = this.inventory[i];
					canShoot = true;
					flag = true;
					break;
				}
			}
			if (!flag)
			{
				for (int j = 0; j < 54; j++)
				{
					if (this.inventory[j].ammo == sItem.useAmmo && this.inventory[j].stack > 0)
					{
						item = this.inventory[j];
						canShoot = true;
						break;
					}
				}
			}
			if (canShoot)
			{
				if (sItem.type == 1946)
				{
					shoot = 338 + item.type - 771;
				}
				else if (sItem.useAmmo == AmmoID.Rocket)
				{
					shoot += item.shoot;
				}
				else if (sItem.useAmmo == 780)
				{
					shoot += item.shoot;
				}
				else if (item.shoot > 0)
				{
					shoot = item.shoot;
				}
				if (sItem.type == 3019 && shoot == 1)
				{
					shoot = 485;
				}
				if (sItem.type == 3052)
				{
					shoot = 495;
				}
				if (sItem.type == 3245 && shoot == 21)
				{
					shoot = 532;
				}
				if (shoot == 42)
				{
					if (item.type == 370)
					{
						shoot = 65;
						Damage += 5;
					}
					else if (item.type == 408)
					{
						shoot = 68;
						Damage += 5;
					}
					else if (item.type == 1246)
					{
						shoot = 354;
						Damage += 5;
					}
				}
				if (this.inventory[this.selectedItem].type == 2888 && shoot == 1)
				{
					shoot = 469;
				}
				if (this.magicQuiver && (sItem.useAmmo == AmmoID.Arrow || sItem.useAmmo == AmmoID.Stake))
				{
					KnockBack = (float)((int)((double)KnockBack * 1.1));
					speed *= 1.1f;
				}
				speed += item.shootSpeed;
				if (item.ranged)
				{
					if (item.damage > 0)
					{
						Damage += (int)((float)item.damage * this.rangedDamage);
					}
				}
				else
				{
					Damage += item.damage;
				}
				if (sItem.useAmmo == AmmoID.Arrow && this.archery)
				{
					if (speed < 20f)
					{
						speed *= 1.2f;
						if (speed > 20f)
						{
							speed = 20f;
						}
					}
					Damage = (int)((double)((float)Damage) * 1.2);
				}
				KnockBack += item.knockBack;
				bool flag2 = dontConsume;
				if (sItem.type == 3245)
				{
					if (Main.rand.Next(3) == 0)
					{
						flag2 = true;
					}
					else if (this.thrownCost33 && Main.rand.Next(100) < 33)
					{
						flag2 = true;
					}
					else if (this.thrownCost50 && Main.rand.Next(100) < 50)
					{
						flag2 = true;
					}
				}
				if (sItem.type == 3475 && Main.rand.Next(3) != 0)
				{
					flag2 = true;
				}
				if (sItem.type == 3540 && Main.rand.Next(3) != 0)
				{
					flag2 = true;
				}
				if (this.magicQuiver && sItem.useAmmo == AmmoID.Arrow && Main.rand.Next(5) == 0)
				{
					flag2 = true;
				}
				if (this.ammoBox && Main.rand.Next(5) == 0)
				{
					flag2 = true;
				}
				if (this.ammoPotion && Main.rand.Next(5) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 1782 && Main.rand.Next(3) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 98 && Main.rand.Next(3) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 2270 && Main.rand.Next(2) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 533 && Main.rand.Next(2) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 1929 && Main.rand.Next(2) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 1553 && Main.rand.Next(2) == 0)
				{
					flag2 = true;
				}
				if (sItem.type == 434 && this.itemAnimation < sItem.useAnimation - 2)
				{
					flag2 = true;
				}
				if (this.ammoCost80 && Main.rand.Next(5) == 0)
				{
					flag2 = true;
				}
				if (this.ammoCost75 && Main.rand.Next(4) == 0)
				{
					flag2 = true;
				}
				if (shoot == 85 && this.itemAnimation < this.itemAnimationMax - 6)
				{
					flag2 = true;
				}
				if ((shoot == 145 || shoot == 146 || shoot == 147 || shoot == 148 || shoot == 149) && this.itemAnimation < this.itemAnimationMax - 5)
				{
					flag2 = true;
				}
				if (!flag2 && item.consumable)
				{
					item.stack--;
					if (item.stack <= 0)
					{
						item.active = false;
						item.TurnToAir();
					}
				}
			}
		}

		// Token: 0x060003F4 RID: 1012 RVA: 0x00280130 File Offset: 0x0027E330
		public void PickTile(int x, int y, int pickPower)
		{
			int num = 0;
			int tileId = this.hitTile.HitObject(x, y, 1);
			Tile tile = Main.tile[x, y];
			if (Main.tileNoFail[(int)tile.type])
			{
				num = 100;
			}
			if (Main.tileDungeon[(int)tile.type] || tile.type == 25 || tile.type == 58 || tile.type == 117 || tile.type == 203)
			{
				num += pickPower / 2;
			}
			else if (tile.type == 48 || tile.type == 232)
			{
				num += pickPower / 4;
			}
			else if (tile.type == 226)
			{
				num += pickPower / 4;
			}
			else if (tile.type == 107 || tile.type == 221)
			{
				num += pickPower / 2;
			}
			else if (tile.type == 108 || tile.type == 222)
			{
				num += pickPower / 3;
			}
			else if (tile.type == 111 || tile.type == 223)
			{
				num += pickPower / 4;
			}
			else if (tile.type == 211)
			{
				num += pickPower / 5;
			}
			else
			{
				num += pickPower;
			}
			if (tile.type == 211 && pickPower < 200)
			{
				num = 0;
			}
			if ((tile.type == 25 || tile.type == 203) && pickPower < 65)
			{
				num = 0;
			}
			else if (tile.type == 117 && pickPower < 65)
			{
				num = 0;
			}
			else if (tile.type == 37 && pickPower < 50)
			{
				num = 0;
			}
			else if (tile.type == 404 && pickPower < 65)
			{
				num = 0;
			}
			else if ((tile.type == 22 || tile.type == 204) && (double)y > Main.worldSurface && pickPower < 55)
			{
				num = 0;
			}
			else if (tile.type == 56 && pickPower < 65)
			{
				num = 0;
			}
			else if (tile.type == 58 && pickPower < 65)
			{
				num = 0;
			}
			else if ((tile.type == 226 || tile.type == 237) && pickPower < 210)
			{
				num = 0;
			}
			else if (Main.tileDungeon[(int)tile.type] && pickPower < 65)
			{
				if ((double)x < (double)Main.maxTilesX * 0.35 || (double)x > (double)Main.maxTilesX * 0.65)
				{
					num = 0;
				}
			}
			else if (tile.type == 107 && pickPower < 100)
			{
				num = 0;
			}
			else if (tile.type == 108 && pickPower < 110)
			{
				num = 0;
			}
			else if (tile.type == 111 && pickPower < 150)
			{
				num = 0;
			}
			else if (tile.type == 221 && pickPower < 100)
			{
				num = 0;
			}
			else if (tile.type == 222 && pickPower < 110)
			{
				num = 0;
			}
			else if (tile.type == 223 && pickPower < 150)
			{
				num = 0;
			}
			if (tile.type == 147 || tile.type == 0 || tile.type == 40 || tile.type == 53 || tile.type == 57 || tile.type == 59 || tile.type == 123 || tile.type == 224 || tile.type == 397)
			{
				num += pickPower;
			}
			if (tile.type == 165 || Main.tileRope[(int)tile.type] || tile.type == 199 || Main.tileMoss[(int)tile.type])
			{
				num = 100;
			}
			if (this.hitTile.AddDamage(tileId, num, false) >= 100 && (tile.type == 2 || tile.type == 23 || tile.type == 60 || tile.type == 70 || tile.type == 109 || tile.type == 199 || Main.tileMoss[(int)tile.type]))
			{
				num = 0;
			}
			if (tile.type == 128 || tile.type == 269)
			{
				if (tile.frameX == 18 || tile.frameX == 54)
				{
					x--;
					tile = Main.tile[x, y];
					this.hitTile.UpdatePosition(tileId, x, y);
				}
				if (tile.frameX >= 100)
				{
					num = 0;
					Main.blockMouse = true;
				}
			}
			if (tile.type == 334)
			{
				if (tile.frameY == 0)
				{
					y++;
					tile = Main.tile[x, y];
					this.hitTile.UpdatePosition(tileId, x, y);
				}
				if (tile.frameY == 36)
				{
					y--;
					tile = Main.tile[x, y];
					this.hitTile.UpdatePosition(tileId, x, y);
				}
				int i = (int)tile.frameX;
				bool flag = i >= 5000;
				bool flag2 = false;
				if (!flag)
				{
					int num2 = i / 18;
					num2 %= 3;
					x -= num2;
					tile = Main.tile[x, y];
					if (tile.frameX >= 5000)
					{
						flag = true;
					}
				}
				if (flag)
				{
					i = (int)tile.frameX;
					int num3 = 0;
					while (i >= 5000)
					{
						i -= 5000;
						num3++;
					}
					if (num3 != 0)
					{
						flag2 = true;
					}
				}
				if (flag2)
				{
					num = 0;
					Main.blockMouse = true;
				}
			}
			if (!WorldGen.CanKillTile(x, y))
			{
				num = 0;
			}
			if (this.hitTile.AddDamage(tileId, num, true) >= 100)
			{
				AchievementsHelper.CurrentlyMining = true;
				this.hitTile.Clear(tileId);
				if (Main.netMode == 1 && Main.tileContainer[(int)Main.tile[x, y].type])
				{
					WorldGen.KillTile(x, y, true, false, false);
					NetMessage.SendData(17, -1, -1, null, 0, (float)x, (float)y, 1f, 0, 0, 0);
					if (Main.tile[x, y].type == 21)
					{
						NetMessage.SendData(34, -1, -1, null, 1, (float)x, (float)y, 0f, 0, 0, 0);
					}
					if (Main.tile[x, y].type == 467)
					{
						NetMessage.SendData(34, -1, -1, null, 5, (float)x, (float)y, 0f, 0, 0, 0);
					}
					if (Main.tile[x, y].type == 88)
					{
						NetMessage.SendData(34, -1, -1, null, 3, (float)x, (float)y, 0f, 0, 0, 0);
					}
				}
				else
				{
					int num4 = y;
					bool arg_647_0 = Main.tile[x, num4].active();
					WorldGen.KillTile(x, num4, false, false, false);
					if (arg_647_0 && !Main.tile[x, num4].active())
					{
						AchievementsHelper.HandleMining();
					}
					if (Main.netMode == 1)
					{
						NetMessage.SendData(17, -1, -1, null, 0, (float)x, (float)num4, 0f, 0, 0, 0);
					}
				}
				AchievementsHelper.CurrentlyMining = false;
			}
			else
			{
				WorldGen.KillTile(x, y, true, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(17, -1, -1, null, 0, (float)x, (float)y, 1f, 0, 0, 0);
				}
			}
			if (num != 0)
			{
				this.hitTile.Prune();
			}
		}

		// Token: 0x060003F8 RID: 1016 RVA: 0x00280AD0 File Offset: 0x0027ECD0
		public void PlaceItemInFrame(int x, int y)
		{
			if (Main.tile[x, y].frameX % 36 != 0)
			{
				x--;
			}
			if (Main.tile[x, y].frameY % 36 != 0)
			{
				y--;
			}
			int num = TEItemFrame.Find(x, y);
			if (num == -1)
			{
				return;
			}
			if (((TEItemFrame)TileEntity.ByID[num]).item.stack > 0)
			{
				WorldGen.KillTile(x, y, true, false, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)y, 1f, 0, 0, 0);
				}
			}
			if (Main.netMode == 1)
			{
				NetMessage.SendData(89, -1, -1, null, x, (float)y, (float)this.selectedItem, (float)this.whoAmI, 0, 0, 0);
			}
			else
			{
				TEItemFrame.TryPlacing(x, y, this.inventory[this.selectedItem].netID, (int)this.inventory[this.selectedItem].prefix, this.inventory[this.selectedItem].stack);
			}
			this.inventory[this.selectedItem].stack--;
			if (this.inventory[this.selectedItem].stack <= 0)
			{
				this.inventory[this.selectedItem].SetDefaults(0, false);
				Main.mouseItem.SetDefaults(0, false);
			}
			if (this.selectedItem == 58)
			{
				Main.mouseItem = this.inventory[this.selectedItem].Clone();
			}
			this.releaseUseItem = false;
			this.mouseInterface = true;
		}

		// Token: 0x060003D8 RID: 984 RVA: 0x00266A64 File Offset: 0x00264C64
		public void PlaceThing()
		{
			if ((this.inventory[this.selectedItem].type == 1071 || this.inventory[this.selectedItem].type == 1543) && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
			{
				int num = Player.tileTargetX;
				int num2 = Player.tileTargetY;
				if (Main.tile[num, num2] != null && Main.tile[num, num2].active())
				{
					this.showItemIcon = true;
					if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
					{
						int num3 = -1;
						int num4 = -1;
						for (int i = 0; i < 58; i++)
						{
							if (this.inventory[i].stack > 0 && this.inventory[i].paint > 0)
							{
								num3 = (int)this.inventory[i].paint;
								num4 = i;
								break;
							}
						}
						if (num3 > 0 && (int)Main.tile[num, num2].color() != num3 && WorldGen.paintTile(num, num2, (byte)num3, true))
						{
							int num5 = num4;
							this.inventory[num5].stack--;
							if (this.inventory[num5].stack <= 0)
							{
								this.inventory[num5].SetDefaults(0, false);
							}
							this.itemTime = this.inventory[this.selectedItem].useTime;
						}
					}
				}
			}
			if ((this.inventory[this.selectedItem].type == 1072 || this.inventory[this.selectedItem].type == 1544) && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
			{
				int num6 = Player.tileTargetX;
				int num7 = Player.tileTargetY;
				if (Main.tile[num6, num7] != null && Main.tile[num6, num7].wall > 0)
				{
					this.showItemIcon = true;
					if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
					{
						int num8 = -1;
						int num9 = -1;
						for (int j = 0; j < 58; j++)
						{
							if (this.inventory[j].stack > 0 && this.inventory[j].paint > 0)
							{
								num8 = (int)this.inventory[j].paint;
								num9 = j;
								break;
							}
						}
						if (num8 > 0 && (int)Main.tile[num6, num7].wallColor() != num8 && WorldGen.paintWall(num6, num7, (byte)num8, true))
						{
							int num10 = num9;
							this.inventory[num10].stack--;
							if (this.inventory[num10].stack <= 0)
							{
								this.inventory[num10].SetDefaults(0, false);
							}
							this.itemTime = this.inventory[this.selectedItem].useTime;
						}
					}
				}
			}
			if ((this.inventory[this.selectedItem].type == 1100 || this.inventory[this.selectedItem].type == 1545) && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
			{
				int num11 = Player.tileTargetX;
				int num12 = Player.tileTargetY;
				if (Main.tile[num11, num12] != null && ((Main.tile[num11, num12].wallColor() > 0 && Main.tile[num11, num12].wall > 0) || (Main.tile[num11, num12].color() > 0 && Main.tile[num11, num12].active())))
				{
					this.showItemIcon = true;
					if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
					{
						if (Main.tile[num11, num12].color() > 0 && Main.tile[num11, num12].active() && WorldGen.paintTile(num11, num12, 0, true))
						{
							this.itemTime = this.inventory[this.selectedItem].useTime;
						}
						else if (Main.tile[num11, num12].wallColor() > 0 && Main.tile[num11, num12].wall > 0 && WorldGen.paintWall(num11, num12, 0, true))
						{
							this.itemTime = this.inventory[this.selectedItem].useTime;
						}
					}
				}
			}
			if ((this.inventory[this.selectedItem].type == 929 || this.inventory[this.selectedItem].type == 1338 || this.inventory[this.selectedItem].type == 1345) && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
			{
				int num13 = Player.tileTargetX;
				int num14 = Player.tileTargetY;
				if (Main.tile[num13, num14].active() && Main.tile[num13, num14].type == 209)
				{
					this.ShootFromCannon(num13, num14);
				}
			}
			if (this.inventory[this.selectedItem].type >= 1874 && this.inventory[this.selectedItem].type <= 1905 && Main.tile[Player.tileTargetX, Player.tileTargetY].active() && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 171 && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY && this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
			{
				int num15 = this.inventory[this.selectedItem].type;
				if (num15 >= 1874 && num15 <= 1877)
				{
					num15 -= 1873;
					if (WorldGen.checkXmasTreeDrop(Player.tileTargetX, Player.tileTargetY, 0) != num15)
					{
						this.itemTime = this.inventory[this.selectedItem].useTime;
						WorldGen.dropXmasTree(Player.tileTargetX, Player.tileTargetY, 0);
						WorldGen.setXmasTree(Player.tileTargetX, Player.tileTargetY, 0, num15);
						int num16 = Player.tileTargetX;
						int num17 = Player.tileTargetY;
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].frameX < 10)
						{
							num16 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameX;
							num17 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameY;
						}
						NetMessage.SendTileSquare(-1, num16, num17, 1, TileChangeType.None);
					}
				}
				else if (num15 >= 1878 && num15 <= 1883)
				{
					num15 -= 1877;
					if (WorldGen.checkXmasTreeDrop(Player.tileTargetX, Player.tileTargetY, 1) != num15)
					{
						this.itemTime = this.inventory[this.selectedItem].useTime;
						WorldGen.dropXmasTree(Player.tileTargetX, Player.tileTargetY, 1);
						WorldGen.setXmasTree(Player.tileTargetX, Player.tileTargetY, 1, num15);
						int num18 = Player.tileTargetX;
						int num19 = Player.tileTargetY;
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].frameX < 10)
						{
							num18 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameX;
							num19 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameY;
						}
						NetMessage.SendTileSquare(-1, num18, num19, 1, TileChangeType.None);
					}
				}
				else if (num15 >= 1884 && num15 <= 1894)
				{
					num15 -= 1883;
					if (WorldGen.checkXmasTreeDrop(Player.tileTargetX, Player.tileTargetY, 2) != num15)
					{
						this.itemTime = this.inventory[this.selectedItem].useTime;
						WorldGen.dropXmasTree(Player.tileTargetX, Player.tileTargetY, 2);
						WorldGen.setXmasTree(Player.tileTargetX, Player.tileTargetY, 2, num15);
						int num20 = Player.tileTargetX;
						int num21 = Player.tileTargetY;
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].frameX < 10)
						{
							num20 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameX;
							num21 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameY;
						}
						NetMessage.SendTileSquare(-1, num20, num21, 1, TileChangeType.None);
					}
				}
				else if (num15 >= 1895 && num15 <= 1905)
				{
					num15 -= 1894;
					if (WorldGen.checkXmasTreeDrop(Player.tileTargetX, Player.tileTargetY, 3) != num15)
					{
						this.itemTime = this.inventory[this.selectedItem].useTime;
						WorldGen.dropXmasTree(Player.tileTargetX, Player.tileTargetY, 3);
						WorldGen.setXmasTree(Player.tileTargetX, Player.tileTargetY, 3, num15);
						int num22 = Player.tileTargetX;
						int num23 = Player.tileTargetY;
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].frameX < 10)
						{
							num22 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameX;
							num23 -= (int)Main.tile[Player.tileTargetX, Player.tileTargetY].frameY;
						}
						NetMessage.SendTileSquare(-1, num22, num23, 1, TileChangeType.None);
					}
				}
			}
			if (ItemID.Sets.ExtractinatorMode[this.inventory[this.selectedItem].type] >= 0 && Main.tile[Player.tileTargetX, Player.tileTargetY].active() && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 219)
			{
				if (this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY && this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
				{
					this.itemTime = this.inventory[this.selectedItem].useTime;
					Main.PlaySound(7, -1, -1, 1, 1f, 0f);
					Player.ExtractinatorUse(ItemID.Sets.ExtractinatorMode[this.inventory[this.selectedItem].type]);
				}
			}
			else if (!this.noBuilding && this.inventory[this.selectedItem].createTile >= 0 && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f + (float)this.blockRange >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost - (float)this.blockRange <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f + (float)this.blockRange >= (float)Player.tileTargetY)
			{
				this.showItemIcon = true;
				bool flag = false;
				if (Main.tile[Player.tileTargetX, Player.tileTargetY].liquid > 0 && Main.tile[Player.tileTargetX, Player.tileTargetY].lava())
				{
					if (Main.tileSolid[this.inventory[this.selectedItem].createTile])
					{
						flag = true;
					}
					else if (!TileObjectData.CheckLiquidPlacement(this.inventory[this.selectedItem].createTile, this.inventory[this.selectedItem].placeStyle, Main.tile[Player.tileTargetX, Player.tileTargetY]))
					{
						flag = true;
					}
				}
				bool flag2 = true;
				if (PlayerInput.UsingGamepad && this.inventory[this.selectedItem].createTile == 4 && Main.SmartCursorEnabled && !Main.SmartCursorShowing)
				{
					flag2 = false;
				}
				if (this.inventory[this.selectedItem].tileWand > 0)
				{
					int tileWand = this.inventory[this.selectedItem].tileWand;
					flag2 = false;
					for (int k = 0; k < 58; k++)
					{
						if (tileWand == this.inventory[k].type && this.inventory[k].stack > 0)
						{
							flag2 = true;
							break;
						}
					}
				}
				if (Main.tileRope[this.inventory[this.selectedItem].createTile] && flag2 && Main.tile[Player.tileTargetX, Player.tileTargetY].active() && Main.tileRope[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
				{
					int num24 = Player.tileTargetY;
					int num25 = Player.tileTargetX;
					int arg_1375_0 = this.inventory[this.selectedItem].createTile;
					while (Main.tile[num25, num24].active() && Main.tileRope[(int)Main.tile[num25, num24].type] && num24 < Main.maxTilesX - 5 && Main.tile[num25, num24 + 2] != null && !Main.tile[num25, num24 + 1].lava())
					{
						num24++;
						if (Main.tile[num25, num24] == null)
						{
							flag2 = false;
							num24 = Player.tileTargetY;
						}
					}
					if (!Main.tile[num25, num24].active())
					{
						Player.tileTargetY = num24;
					}
				}
				if (flag2 && ((!Main.tile[Player.tileTargetX, Player.tileTargetY].active() && !flag) || (Main.tileCut[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] || (Main.tile[Player.tileTargetX, Player.tileTargetY].type >= 373 && Main.tile[Player.tileTargetX, Player.tileTargetY].type <= 375)) || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 461 || this.inventory[this.selectedItem].createTile == 199 || this.inventory[this.selectedItem].createTile == 23 || this.inventory[this.selectedItem].createTile == 2 || this.inventory[this.selectedItem].createTile == 109 || this.inventory[this.selectedItem].createTile == 60 || this.inventory[this.selectedItem].createTile == 70 || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type]) && this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
				{
					bool flag3 = false;
					bool flag4 = false;
					TileObject tileObject = default(TileObject);
					if (TileObjectData.CustomPlace(this.inventory[this.selectedItem].createTile, this.inventory[this.selectedItem].placeStyle) && this.inventory[this.selectedItem].createTile != 82)
					{
						flag4 = true;
						flag3 = TileObject.CanPlace(Player.tileTargetX, Player.tileTargetY, (int)((ushort)this.inventory[this.selectedItem].createTile), this.inventory[this.selectedItem].placeStyle, this.direction, out tileObject, false);
						int num26 = 0;
						int num27 = 0;
						int x = 0;
						int y = 0;
						int type = tileObject.type;
						if (type != 138)
						{
							if (type == 235)
							{
								num26 = 48;
								num27 = 16;
								x = tileObject.xCoord * 16;
								y = tileObject.yCoord * 16;
							}
						}
						else
						{
							num26 = 32;
							num27 = 32;
							x = tileObject.xCoord * 16;
							y = tileObject.yCoord * 16;
						}
						if (num26 != 0 && num27 != 0)
						{
							Rectangle value = new Rectangle(x, y, num26, num27);
							for (int l = 0; l < 255; l++)
							{
								Player player = Main.player[l];
								if (player.active && !player.dead && player.Hitbox.Intersects(value))
								{
									flag3 = false;
									break;
								}
							}
						}
						if (tileObject.type == 454)
						{
							for (int m = -2; m < 2; m++)
							{
								Tile tile = Main.tile[Player.tileTargetX + m, Player.tileTargetY];
								if (tile.active() && tile.type == 454)
								{
									flag3 = false;
								}
							}
						}
						if (tileObject.type == 254)
						{
							for (int n = -1; n < 1; n++)
							{
								for (int num28 = -1; num28 < 1; num28++)
								{
									if (!WorldGen.CanCutTile(Player.tileTargetX + num28, Player.tileTargetY + n, TileCuttingContext.TilePlacement))
									{
										flag3 = false;
									}
								}
							}
						}
					}
					else
					{
						if (this.inventory[this.selectedItem].type == 213)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY].type == 0 || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 1)
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 23 || this.inventory[this.selectedItem].createTile == 2 || this.inventory[this.selectedItem].createTile == 109 || this.inventory[this.selectedItem].createTile == 199)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY].nactive() && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 0)
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 227)
						{
							flag3 = true;
						}
						else if (this.inventory[this.selectedItem].createTile >= 373 && this.inventory[this.selectedItem].createTile <= 375)
						{
							int num29 = Player.tileTargetX;
							int num30 = Player.tileTargetY - 1;
							if (Main.tile[num29, num30].nactive() && Main.tileSolid[(int)Main.tile[num29, num30].type] && !Main.tileSolidTop[(int)Main.tile[num29, num30].type])
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 461)
						{
							int num31 = Player.tileTargetX;
							int num32 = Player.tileTargetY - 1;
							if (Main.tile[num31, num32].nactive() && Main.tileSolid[(int)Main.tile[num31, num32].type] && !Main.tileSolidTop[(int)Main.tile[num31, num32].type])
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 60 || this.inventory[this.selectedItem].createTile == 70)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY].nactive() && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 59)
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 4 || this.inventory[this.selectedItem].createTile == 136)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY].wall > 0)
							{
								flag3 = true;
							}
							else
							{
								if (!WorldGen.SolidTileNoAttach(Player.tileTargetX, Player.tileTargetY + 1) && !WorldGen.SolidTileNoAttach(Player.tileTargetX - 1, Player.tileTargetY) && !WorldGen.SolidTileNoAttach(Player.tileTargetX + 1, Player.tileTargetY))
								{
									if (!WorldGen.SolidTileNoAttach(Player.tileTargetX, Player.tileTargetY + 1) && (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].halfBrick() || Main.tile[Player.tileTargetX, Player.tileTargetY + 1].slope() != 0))
									{
										if (!TileID.Sets.Platforms[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type])
										{
											WorldGen.SlopeTile(Player.tileTargetX, Player.tileTargetY + 1, 0);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)(Player.tileTargetY + 1), 0f, 0, 0, 0);
											}
										}
									}
									else if (!WorldGen.SolidTileNoAttach(Player.tileTargetX, Player.tileTargetY + 1) && !WorldGen.SolidTileNoAttach(Player.tileTargetX - 1, Player.tileTargetY) && (Main.tile[Player.tileTargetX - 1, Player.tileTargetY].halfBrick() || Main.tile[Player.tileTargetX - 1, Player.tileTargetY].slope() != 0))
									{
										if (!TileID.Sets.Platforms[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type])
										{
											WorldGen.SlopeTile(Player.tileTargetX - 1, Player.tileTargetY, 0);
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 14, (float)(Player.tileTargetX - 1), (float)Player.tileTargetY, 0f, 0, 0, 0);
											}
										}
									}
									else if (!WorldGen.SolidTileNoAttach(Player.tileTargetX, Player.tileTargetY + 1) && !WorldGen.SolidTileNoAttach(Player.tileTargetX - 1, Player.tileTargetY) && !WorldGen.SolidTileNoAttach(Player.tileTargetX + 1, Player.tileTargetY) && (Main.tile[Player.tileTargetX + 1, Player.tileTargetY].halfBrick() || Main.tile[Player.tileTargetX + 1, Player.tileTargetY].slope() != 0) && TileID.Sets.Platforms[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type])
									{
										WorldGen.SlopeTile(Player.tileTargetX + 1, Player.tileTargetY, 0);
										if (Main.netMode == 1)
										{
											NetMessage.SendData(17, -1, -1, null, 14, (float)(Player.tileTargetX + 1), (float)Player.tileTargetY, 0f, 0, 0, 0);
										}
									}
								}
								int num33 = (int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type;
								if (Main.tile[Player.tileTargetX, Player.tileTargetY].halfBrick())
								{
									num33 = -1;
								}
								int num34 = (int)Main.tile[Player.tileTargetX - 1, Player.tileTargetY].type;
								int num35 = (int)Main.tile[Player.tileTargetX + 1, Player.tileTargetY].type;
								int num36 = (int)Main.tile[Player.tileTargetX - 1, Player.tileTargetY - 1].type;
								int num37 = (int)Main.tile[Player.tileTargetX + 1, Player.tileTargetY - 1].type;
								int num38 = (int)Main.tile[Player.tileTargetX - 1, Player.tileTargetY - 1].type;
								int num39 = (int)Main.tile[Player.tileTargetX + 1, Player.tileTargetY + 1].type;
								if (!Main.tile[Player.tileTargetX, Player.tileTargetY + 1].nactive())
								{
									num33 = -1;
								}
								if (!Main.tile[Player.tileTargetX - 1, Player.tileTargetY].nactive())
								{
									num34 = -1;
								}
								if (!Main.tile[Player.tileTargetX + 1, Player.tileTargetY].nactive())
								{
									num35 = -1;
								}
								if (!Main.tile[Player.tileTargetX - 1, Player.tileTargetY - 1].nactive())
								{
									num36 = -1;
								}
								if (!Main.tile[Player.tileTargetX + 1, Player.tileTargetY - 1].nactive())
								{
									num37 = -1;
								}
								if (!Main.tile[Player.tileTargetX - 1, Player.tileTargetY + 1].nactive())
								{
									num38 = -1;
								}
								if (!Main.tile[Player.tileTargetX + 1, Player.tileTargetY + 1].nactive())
								{
									num39 = -1;
								}
								if (num33 >= 0 && Main.tileSolid[num33] && (!Main.tileNoAttach[num33] || (num33 >= 0 && TileID.Sets.Platforms[num33])))
								{
									flag3 = true;
								}
								else if ((num34 >= 0 && Main.tileSolid[num34] && !Main.tileNoAttach[num34]) || (num34 == 5 && num36 == 5 && num38 == 5) || num34 == 124)
								{
									flag3 = true;
								}
								else if ((num35 >= 0 && Main.tileSolid[num35] && !Main.tileNoAttach[num35]) || (num35 == 5 && num37 == 5 && num39 == 5) || num35 == 124)
								{
									flag3 = true;
								}
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 78 || this.inventory[this.selectedItem].createTile == 98 || this.inventory[this.selectedItem].createTile == 100 || this.inventory[this.selectedItem].createTile == 173 || this.inventory[this.selectedItem].createTile == 174 || this.inventory[this.selectedItem].createTile == 324)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].nactive() && (Main.tileSolid[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type] || Main.tileTable[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type]))
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 419)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].active() && (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type == 419 || (this.inventory[this.selectedItem].placeStyle != 2 && Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type == 420)))
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 13 || this.inventory[this.selectedItem].createTile == 29 || this.inventory[this.selectedItem].createTile == 33 || this.inventory[this.selectedItem].createTile == 49 || this.inventory[this.selectedItem].createTile == 50 || this.inventory[this.selectedItem].createTile == 103)
						{
							if (Main.tile[Player.tileTargetX, Player.tileTargetY + 1].nactive() && Main.tileTable[(int)Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type])
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 275 || this.inventory[this.selectedItem].createTile == 276 || this.inventory[this.selectedItem].createTile == 277)
						{
							flag3 = true;
						}
						else if (this.inventory[this.selectedItem].createTile == 51 || this.inventory[this.selectedItem].createTile == 330 || this.inventory[this.selectedItem].createTile == 331 || this.inventory[this.selectedItem].createTile == 332 || this.inventory[this.selectedItem].createTile == 333 || this.inventory[this.selectedItem].createTile == 336 || this.inventory[this.selectedItem].createTile == 340 || this.inventory[this.selectedItem].createTile == 342 || this.inventory[this.selectedItem].createTile == 341 || this.inventory[this.selectedItem].createTile == 343 || this.inventory[this.selectedItem].createTile == 344 || this.inventory[this.selectedItem].createTile == 379 || this.inventory[this.selectedItem].createTile == 351)
						{
							if (Main.tile[Player.tileTargetX + 1, Player.tileTargetY].active() || Main.tile[Player.tileTargetX + 1, Player.tileTargetY].wall > 0 || Main.tile[Player.tileTargetX - 1, Player.tileTargetY].active() || Main.tile[Player.tileTargetX - 1, Player.tileTargetY].wall > 0 || Main.tile[Player.tileTargetX, Player.tileTargetY + 1].active() || Main.tile[Player.tileTargetX, Player.tileTargetY + 1].wall > 0 || Main.tile[Player.tileTargetX, Player.tileTargetY - 1].active() || Main.tile[Player.tileTargetX, Player.tileTargetY - 1].wall > 0)
							{
								flag3 = true;
							}
						}
						else if (this.inventory[this.selectedItem].createTile == 314)
						{
							for (int num40 = Player.tileTargetX - 1; num40 <= Player.tileTargetX + 1; num40++)
							{
								for (int num41 = Player.tileTargetY - 1; num41 <= Player.tileTargetY + 1; num41++)
								{
									Tile tile2 = Main.tile[num40, num41];
									if (tile2.active() || tile2.wall > 0)
									{
										flag3 = true;
										break;
									}
								}
							}
						}
						else
						{
							Tile tile3 = Main.tile[Player.tileTargetX - 1, Player.tileTargetY];
							Tile tile4 = Main.tile[Player.tileTargetX + 1, Player.tileTargetY];
							Tile tile5 = Main.tile[Player.tileTargetX, Player.tileTargetY - 1];
							Tile tile6 = Main.tile[Player.tileTargetX, Player.tileTargetY + 1];
							if ((tile4.active() && (Main.tileSolid[(int)tile4.type] || Main.tileRope[(int)tile4.type] || tile4.type == 314)) || (tile4.wall > 0 || (tile3.active() && (Main.tileSolid[(int)tile3.type] || Main.tileRope[(int)tile3.type] || tile3.type == 314))) || (tile3.wall > 0 || (tile6.active() && (Main.tileSolid[(int)tile6.type] || tile6.type == 124 || Main.tileRope[(int)tile6.type] || tile6.type == 314))) || (tile6.wall > 0 || (tile5.active() && (Main.tileSolid[(int)tile5.type] || tile5.type == 124 || Main.tileRope[(int)tile5.type] || tile5.type == 314))) || tile5.wall > 0)
							{
								flag3 = true;
							}
						}
						if (this.inventory[this.selectedItem].type == 213 && Main.tile[Player.tileTargetX, Player.tileTargetY].active())
						{
							int num42 = Player.tileTargetX;
							int num43 = Player.tileTargetY;
							if (Main.tile[num42, num43].type == 3 || Main.tile[num42, num43].type == 73 || Main.tile[num42, num43].type == 84)
							{
								WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, false, false, false);
								if (!Main.tile[Player.tileTargetX, Player.tileTargetY].active() && Main.netMode == 1)
								{
									NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
								}
							}
							else if (Main.tile[num42, num43].type == 83)
							{
								bool flag5 = false;
								short expr_2817 = (short)(Main.tile[num42, num43].frameX / 18);
								if (expr_2817 == 0 && Main.dayTime)
								{
									flag5 = true;
								}
								if (expr_2817 == 1 && !Main.dayTime)
								{
									flag5 = true;
								}
								if (expr_2817 == 3 && !Main.dayTime && (Main.bloodMoon || Main.moonPhase == 0))
								{
									flag5 = true;
								}
								if (expr_2817 == 4 && (Main.raining || Main.cloudAlpha > 0f))
								{
									flag5 = true;
								}
								if (expr_2817 == 5 && !Main.raining && Main.dayTime && Main.time > 40500.0)
								{
									flag5 = true;
								}
								if (flag5)
								{
									WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, false, false, false);
									NetMessage.SendData(17, -1, -1, null, 0, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
								}
							}
						}
						if (Main.tileAlch[this.inventory[this.selectedItem].createTile])
						{
							flag3 = true;
						}
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].active() && (Main.tileCut[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type] || (Main.tile[Player.tileTargetX, Player.tileTargetY].type >= 373 && Main.tile[Player.tileTargetX, Player.tileTargetY].type <= 375) || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 461))
						{
							if ((int)Main.tile[Player.tileTargetX, Player.tileTargetY].type != this.inventory[this.selectedItem].createTile)
							{
								if ((Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type != 78 && Main.tile[Player.tileTargetX, Player.tileTargetY + 1].type != 380) || ((Main.tile[Player.tileTargetX, Player.tileTargetY].type == 3 || Main.tile[Player.tileTargetX, Player.tileTargetY].type == 73) && Main.tileAlch[this.inventory[this.selectedItem].createTile]))
								{
									WorldGen.KillTile(Player.tileTargetX, Player.tileTargetY, false, false, false);
									if (!Main.tile[Player.tileTargetX, Player.tileTargetY].active() && Main.netMode == 1)
									{
										NetMessage.SendData(17, -1, -1, null, 4, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
									}
								}
								else
								{
									flag3 = false;
								}
							}
							else
							{
								flag3 = false;
							}
						}
						if (!flag3 && this.inventory[this.selectedItem].createTile >= 0 && TileID.Sets.Platforms[this.inventory[this.selectedItem].createTile])
						{
							for (int num44 = Player.tileTargetX - 1; num44 <= Player.tileTargetX + 1; num44++)
							{
								for (int num45 = Player.tileTargetY - 1; num45 <= Player.tileTargetY + 1; num45++)
								{
									if (Main.tile[num44, num45].active())
									{
										flag3 = true;
										break;
									}
								}
							}
						}
					}
					if (flag3)
					{
						int num46 = this.inventory[this.selectedItem].placeStyle;
						if (!flag4)
						{
							if (this.inventory[this.selectedItem].createTile == 36)
							{
								num46 = Main.rand.Next(7);
							}
							if (this.inventory[this.selectedItem].createTile == 212 && this.direction > 0)
							{
								num46 = 1;
							}
							if (this.inventory[this.selectedItem].createTile == 141)
							{
								num46 = Main.rand.Next(2);
							}
							if (this.inventory[this.selectedItem].createTile == 128 || this.inventory[this.selectedItem].createTile == 269 || this.inventory[this.selectedItem].createTile == 334)
							{
								if (this.direction < 0)
								{
									num46 = -1;
								}
								else
								{
									num46 = 1;
								}
							}
							if (this.inventory[this.selectedItem].createTile == 241 && this.inventory[this.selectedItem].placeStyle == 0)
							{
								num46 = Main.rand.Next(0, 9);
							}
							if (this.inventory[this.selectedItem].createTile == 35 && this.inventory[this.selectedItem].placeStyle == 0)
							{
								num46 = Main.rand.Next(9);
							}
						}
						if (this.inventory[this.selectedItem].createTile == 314 && num46 == 2 && this.direction == 1)
						{
							num46++;
						}
						int[,] array = null;
						if (this.autoPaint || this.autoActuator)
						{
							array = new int[11, 11];
							for (int num47 = 0; num47 < 11; num47++)
							{
								for (int num48 = 0; num48 < 11; num48++)
								{
									int num49 = Player.tileTargetX - 5 + num47;
									int num50 = Player.tileTargetY - 5 + num48;
									if (Main.tile[num49, num50].active())
									{
										array[num47, num48] = (int)Main.tile[num49, num50].type;
									}
									else
									{
										array[num47, num48] = -1;
									}
								}
							}
						}
						bool forced = false;
						bool flag6;
						if (flag4)
						{
							flag6 = TileObject.Place(tileObject);
							WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, true);
							Main.PlaySound(0, Player.tileTargetX * 16, Player.tileTargetY * 16, 1, 1f, 0f);
						}
						else
						{
							flag6 = WorldGen.PlaceTile(Player.tileTargetX, Player.tileTargetY, this.inventory[this.selectedItem].createTile, false, forced, this.whoAmI, num46);
						}
						if (this.inventory[this.selectedItem].type == 213 && !flag6 && Main.tile[Player.tileTargetX, Player.tileTargetY].type == 1 && Main.tile[Player.tileTargetX, Player.tileTargetY].active())
						{
							int num51 = 0;
							int num52 = 0;
							Point point = base.Center.ToTileCoordinates();
							Dictionary<ushort, int> dictionary = new Dictionary<ushort, int>();
							WorldUtils.Gen(new Point(point.X - 25, point.Y - 25), new Shapes.Rectangle(50, 50), new Actions.TileScanner(new ushort[]
							{
								182,
								180,
								179,
								183,
								181,
								381
							}).Output(dictionary));
							foreach (KeyValuePair<ushort, int> current in dictionary)
							{
								if (current.Value > num52)
								{
									num52 = current.Value;
									num51 = (int)current.Key;
								}
							}
							if (num52 == 0)
							{
								num51 = Utils.SelectRandom<int>(Main.rand, new int[]
								{
									182,
									180,
									179,
									183,
									181
								});
							}
							if (num51 != 0)
							{
								Main.tile[Player.tileTargetX, Player.tileTargetY].type = (ushort)num51;
								WorldGen.SquareTileFrame(Player.tileTargetX, Player.tileTargetY, true);
								NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 1, TileChangeType.None);
								flag6 = true;
							}
						}
						if (flag6)
						{
							this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.tileSpeed);
							if (flag4)
							{
								TileObjectData.CallPostPlacementPlayerHook(Player.tileTargetX, Player.tileTargetY, this.inventory[this.selectedItem].createTile, num46, this.direction, tileObject);
								if (Main.netMode == 1 && !Main.tileContainer[this.inventory[this.selectedItem].createTile] && this.inventory[this.selectedItem].createTile != 423)
								{
									NetMessage.SendObjectPlacment(-1, Player.tileTargetX, Player.tileTargetY, tileObject.type, tileObject.style, tileObject.alternate, tileObject.random, this.direction);
								}
							}
							else
							{
								NetMessage.SendData(17, -1, -1, null, 1, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)this.inventory[this.selectedItem].createTile, num46, 0, 0);
								if (this.inventory[this.selectedItem].createTile == 15)
								{
									if (this.direction == 1)
									{
										Tile expr_308F = Main.tile[Player.tileTargetX, Player.tileTargetY];
										expr_308F.frameX += 18;
										Tile expr_30B4 = Main.tile[Player.tileTargetX, Player.tileTargetY - 1];
										expr_30B4.frameX += 18;
									}
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, Player.tileTargetX - 1, Player.tileTargetY - 1, 3, TileChangeType.None);
									}
								}
								else if ((this.inventory[this.selectedItem].createTile == 79 || this.inventory[this.selectedItem].createTile == 90) && Main.netMode == 1)
								{
									NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 5, TileChangeType.None);
								}
							}
							if (this.inventory[this.selectedItem].createTile == 137)
							{
								if (this.direction == 1)
								{
									Tile expr_315F = Main.tile[Player.tileTargetX, Player.tileTargetY];
									expr_315F.frameX += 18;
								}
								if (Main.netMode == 1)
								{
									NetMessage.SendTileSquare(-1, Player.tileTargetX, Player.tileTargetY, 1, TileChangeType.None);
								}
							}
							if (this.inventory[this.selectedItem].createTile == 419)
							{
								if (Main.netMode == 1)
								{
									NetMessage.SendData(17, -1, -1, null, 18, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
								}
								else
								{
									Wiring.PokeLogicGate(Player.tileTargetX, Player.tileTargetY);
								}
							}
							if (this.inventory[this.selectedItem].createTile >= 0 && TileID.Sets.Platforms[this.inventory[this.selectedItem].createTile] && Main.SmartCursorEnabled)
							{
								int num53 = Player.tileTargetX;
								int num54 = Player.tileTargetY;
								int num55 = -1;
								int num56 = 0;
								int num57 = 0;
								bool flag7 = true;
								for (int num58 = -1; num58 < 2; num58++)
								{
									for (int num59 = -1; num59 < 2; num59++)
									{
										if ((num58 != 0 || num59 != 0) && TileID.Sets.Platforms[(int)Main.tile[num53 + num58, num54 + num59].type])
										{
											flag7 = false;
										}
									}
								}
								if (!flag7)
								{
									Tile tile7 = Main.tile[num53 - 1, num54 - 1];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 2)
									{
										num56++;
									}
									tile7 = Main.tile[num53 - 1, num54 + 1];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 1)
									{
										num57++;
									}
									tile7 = Main.tile[num53 + 1, num54 - 1];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 1)
									{
										num57++;
									}
									tile7 = Main.tile[num53 + 1, num54 + 1];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 2)
									{
										num56++;
									}
									tile7 = Main.tile[num53 - 1, num54];
									if (WorldGen.SolidTile(tile7))
									{
										num56++;
										if (TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() == 0)
										{
											num56++;
										}
									}
									tile7 = Main.tile[num53 + 1, num54];
									if (WorldGen.SolidTile(tile7))
									{
										num57++;
										if (TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() == 0)
										{
											num57++;
										}
									}
									if (num56 > num57)
									{
										num55 = 1;
									}
									else if (num57 > num56)
									{
										num55 = 2;
									}
									tile7 = Main.tile[num53 - 1, num54];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type])
									{
										num55 = 0;
									}
									tile7 = Main.tile[num53 + 1, num54];
									if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type])
									{
										num55 = 0;
									}
									if (num55 != -1)
									{
										WorldGen.SlopeTile(num53, num54, num55);
										int num60 = (int)Main.tile[num53, num54].slope();
										if (Main.netMode == 1)
										{
											NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num60, 0, 0, 0);
										}
										int num61;
										int num62;
										if (num55 == 1)
										{
											num61 = -1;
											num62 = -1;
										}
										else
										{
											num61 = 1;
											num62 = -1;
										}
										tile7 = Main.tile[num53 + num61, num54 + num62];
										if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() == 0 && (!Main.tile[num53 + num61 + num61, num54 + num62].active() || !TileID.Sets.Platforms[(int)Main.tile[num53 + num61 + num61, num54 + num62].type] || !Main.tile[num53 + num61 + num61, num54 + num62].halfBrick()))
										{
											WorldGen.SlopeTile(num53 + num61, num54 + num62, num55);
											num60 = (int)tile7.slope();
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 14, (float)(num53 + num61), (float)(num54 + num62), (float)num60, 0, 0, 0);
											}
										}
										if (num55 == 1)
										{
											num61 = 1;
											num62 = 1;
										}
										else
										{
											num61 = -1;
											num62 = 1;
										}
										tile7 = Main.tile[num53 + num61, num54 + num62];
										if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() == 0 && WorldGen.PlatformProperSides(num53 + num61, num54 + num62, true) <= 0)
										{
											WorldGen.SlopeTile(num53 + num61, num54 + num62, num55);
											num60 = (int)tile7.slope();
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 14, (float)(num53 + num61), (float)(num54 + num62), (float)num60, 0, 0, 0);
											}
										}
									}
									else
									{
										int num61 = -1;
										tile7 = Main.tile[num53 + num61, num54];
										if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 0)
										{
											int num63 = (tile7.slope() == 1).ToDirectionInt() * num61;
											num55 = (int)((num63 == -1) ? 0 : tile7.slope());
											bool flag8 = true;
											if (Main.tile[num53 + num61 * 2, num54 + num63].active() && TileID.Sets.Platforms[(int)Main.tile[num53 + num61 * 2, num54].type] && num55 == (int)Main.tile[num53 + num61 * 2, num54 + num63].slope())
											{
												flag8 = false;
											}
											if (Main.tile[num53, num54 - num63].active() && TileID.Sets.Platforms[(int)Main.tile[num53, num54 - num63].type] && tile7.slope() == Main.tile[num53, num54 - num63].slope())
											{
												flag8 = false;
											}
											if (flag8)
											{
												WorldGen.SlopeTile(num53 + num61, num54, num55);
												int num64 = (int)tile7.slope();
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 14, (float)(num53 + num61), (float)num54, (float)num64, 0, 0, 0);
												}
											}
										}
										num61 = 1;
										int num62 = 0;
										tile7 = Main.tile[num53 + num61, num54 + num62];
										if (tile7.active() && TileID.Sets.Platforms[(int)tile7.type] && tile7.slope() != 0)
										{
											int num65 = (tile7.slope() == 1).ToDirectionInt() * num61;
											num55 = (int)((num65 == -1) ? 0 : tile7.slope());
											bool flag9 = true;
											if (Main.tile[num53 + num61 * 2, num54 + num65].active() && TileID.Sets.Platforms[(int)Main.tile[num53 + num61 * 2, num54].type] && num55 == (int)Main.tile[num53 + num61 * 2, num54 + num65].slope())
											{
												flag9 = false;
											}
											if (Main.tile[num53, num54 - num65].active() && TileID.Sets.Platforms[(int)Main.tile[num53, num54 - num65].type] && tile7.slope() == Main.tile[num53, num54 - num65].slope())
											{
												flag9 = false;
											}
											if (flag9)
											{
												WorldGen.SlopeTile(num53 + num61, num54, num55);
												int num64 = (int)tile7.slope();
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 14, (float)(num53 + num61), (float)num54, (float)num64, 0, 0, 0);
												}
											}
										}
										if (num56 == num57 && WorldGen.PlatformProperSides(num53, num54, false) == 0)
										{
											tile7 = Main.tile[num53, num54 + 1];
											if (tile7.active() && !tile7.halfBrick() && tile7.slope() == 0 && Main.tileSolid[(int)tile7.type])
											{
												num55 = ((this.direction == 1) ? 2 : 1);
												WorldGen.SlopeTile(num53, num54, num55);
												int num64 = (int)Main.tile[num53, num54].slope();
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 14, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)num64, 0, 0, 0);
												}
											}
										}
									}
								}
							}
							if (Main.tileSolid[this.inventory[this.selectedItem].createTile] && (this.inventory[this.selectedItem].createTile < 0 || !TileID.Sets.Platforms[this.inventory[this.selectedItem].createTile]))
							{
								int num66 = Player.tileTargetX;
								int num67 = Player.tileTargetY + 1;
								if (Main.tile[num66, num67] != null && !TileID.Sets.Platforms[(int)Main.tile[num66, num67].type] && (Main.tile[num66, num67].topSlope() || Main.tile[num66, num67].halfBrick()))
								{
									WorldGen.SlopeTile(num66, num67, 0);
									if (Main.netMode == 1)
									{
										NetMessage.SendData(17, -1, -1, null, 14, (float)num66, (float)num67, 0f, 0, 0, 0);
									}
								}
								num66 = Player.tileTargetX;
								num67 = Player.tileTargetY - 1;
								if (Main.tile[num66, num67] != null && !TileID.Sets.Platforms[(int)Main.tile[num66, num67].type] && Main.tile[num66, num67].bottomSlope())
								{
									WorldGen.SlopeTile(num66, num67, 0);
									if (Main.netMode == 1)
									{
										NetMessage.SendData(17, -1, -1, null, 14, (float)num66, (float)num67, 0f, 0, 0, 0);
									}
								}
							}
							if (Main.tileSolid[this.inventory[this.selectedItem].createTile])
							{
								for (int num68 = Player.tileTargetX - 1; num68 <= Player.tileTargetX + 1; num68++)
								{
									for (int num69 = Player.tileTargetY - 1; num69 <= Player.tileTargetY + 1; num69++)
									{
										if (Main.tile[num68, num69].active() && this.inventory[this.selectedItem].createTile != (int)Main.tile[num68, num69].type && (Main.tile[num68, num69].type == 2 || Main.tile[num68, num69].type == 23 || Main.tile[num68, num69].type == 60 || Main.tile[num68, num69].type == 70 || Main.tile[num68, num69].type == 109 || Main.tile[num68, num69].type == 199))
										{
											bool flag10 = true;
											for (int num70 = num68 - 1; num70 <= num68 + 1; num70++)
											{
												for (int num71 = num69 - 1; num71 <= num69 + 1; num71++)
												{
													if (!WorldGen.SolidTile(num70, num71))
													{
														flag10 = false;
													}
												}
											}
											if (flag10)
											{
												WorldGen.KillTile(num68, num69, true, false, false);
												if (Main.netMode == 1)
												{
													NetMessage.SendData(17, -1, -1, null, 0, (float)num68, (float)num69, 1f, 0, 0, 0);
												}
											}
										}
									}
								}
							}
							if (this.autoPaint || this.autoActuator)
							{
								int num72 = 0;
								int num73 = 0;
								int num74 = 11;
								int num75 = 11;
								if (!Main.tileFrameImportant[(int)Main.tile[Player.tileTargetX, Player.tileTargetY].type])
								{
									num73 = (num72 = 5);
									num75 = (num74 = 6);
								}
								for (int num76 = num72; num76 < num74; num76++)
								{
									for (int num77 = num73; num77 < num75; num77++)
									{
										int num78 = Player.tileTargetX - 5 + num76;
										int num79 = Player.tileTargetY - 5 + num77;
										if ((Main.tile[num78, num79].active() || array[num76, num77] != -1) && (!Main.tile[num78, num79].active() || (array[num76, num77] != (int)Main.tile[num78, num79].type && (int)Main.tile[num78, num79].type == this.inventory[this.selectedItem].createTile)))
										{
											if (this.autoPaint && this.builderAccStatus[3] == 0)
											{
												int num80 = -1;
												int num81 = -1;
												for (int num82 = 0; num82 < 58; num82++)
												{
													if (this.inventory[num82].stack > 0 && this.inventory[num82].paint > 0)
													{
														num80 = (int)this.inventory[num82].paint;
														num81 = num82;
														break;
													}
												}
												if (num80 > 0 && (int)Main.tile[num78, num79].color() != num80 && WorldGen.paintTile(num78, num79, (byte)num80, true))
												{
													int num83 = num81;
													this.inventory[num83].stack--;
													if (this.inventory[num83].stack <= 0)
													{
														this.inventory[num83].SetDefaults(0, false);
													}
													this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.tileSpeed);
												}
											}
											if (this.autoActuator && this.builderAccStatus[2] == 0)
											{
												bool flag11 = Main.tileSolid[(int)Main.tile[num78, num79].type] && !TileID.Sets.NotReallySolid[(int)Main.tile[num78, num79].type];
												ushort type2 = Main.tile[num78, num79].type;
												if (type2 == 314 || type2 - 386 <= 3)
												{
													flag11 = false;
												}
												if (flag11)
												{
													int num84 = this.FindItem(849);
													if (num84 > -1 && WorldGen.PlaceActuator(num78, num79))
													{
														NetMessage.SendData(17, -1, -1, null, 8, (float)num78, (float)num79, 0f, 0, 0, 0);
														this.inventory[num84].stack--;
														if (this.inventory[num84].stack <= 0)
														{
															this.inventory[num84].SetDefaults(0, false);
														}
														this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.tileSpeed);
													}
												}
											}
										}
									}
								}
							}
							if (PlayerInput.UsingGamepad && ItemID.Sets.SingleUseInGamepad[this.inventory[this.selectedItem].type] && Main.myPlayer == this.whoAmI && !Main.SmartCursorEnabled)
							{
								Main.blockMouse = true;
							}
						}
					}
				}
			}
			if (this.inventory[this.selectedItem].createWall >= 0 && this.position.X / 16f - (float)Player.tileRangeX - (float)this.inventory[this.selectedItem].tileBoost <= (float)Player.tileTargetX && (this.position.X + (float)this.width) / 16f + (float)Player.tileRangeX + (float)this.inventory[this.selectedItem].tileBoost - 1f >= (float)Player.tileTargetX && this.position.Y / 16f - (float)Player.tileRangeY - (float)this.inventory[this.selectedItem].tileBoost <= (float)Player.tileTargetY && (this.position.Y + (float)this.height) / 16f + (float)Player.tileRangeY + (float)this.inventory[this.selectedItem].tileBoost - 2f >= (float)Player.tileTargetY)
			{
				this.showItemIcon = true;
				if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem && (Main.tile[Player.tileTargetX + 1, Player.tileTargetY].active() || Main.tile[Player.tileTargetX + 1, Player.tileTargetY].wall > 0 || Main.tile[Player.tileTargetX - 1, Player.tileTargetY].active() || Main.tile[Player.tileTargetX - 1, Player.tileTargetY].wall > 0 || Main.tile[Player.tileTargetX, Player.tileTargetY + 1].active() || Main.tile[Player.tileTargetX, Player.tileTargetY + 1].wall > 0 || Main.tile[Player.tileTargetX, Player.tileTargetY - 1].active() || Main.tile[Player.tileTargetX, Player.tileTargetY - 1].wall > 0) && (int)Main.tile[Player.tileTargetX, Player.tileTargetY].wall != this.inventory[this.selectedItem].createWall)
				{
					if (Player.SmartCursorSettings.SmartWallReplacement && Main.tile[Player.tileTargetX, Player.tileTargetY].wall != 0 && WorldGen.NearFriendlyWall(Player.tileTargetX, Player.tileTargetY))
					{
						WorldGen.KillWall(Player.tileTargetX, Player.tileTargetY, false);
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].wall == 0 && Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 2, (float)Player.tileTargetX, (float)Player.tileTargetY, 0f, 0, 0, 0);
						}
						if (this.inventory[this.selectedItem].consumable)
						{
							this.inventory[this.selectedItem].stack++;
						}
						this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.wallSpeed);
						return;
					}
					WorldGen.PlaceWall(Player.tileTargetX, Player.tileTargetY, this.inventory[this.selectedItem].createWall, false);
					if ((int)Main.tile[Player.tileTargetX, Player.tileTargetY].wall == this.inventory[this.selectedItem].createWall)
					{
						this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.wallSpeed);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 3, (float)Player.tileTargetX, (float)Player.tileTargetY, (float)this.inventory[this.selectedItem].createWall, 0, 0, 0);
						}
						if (this.inventory[this.selectedItem].stack > 1)
						{
							int createWall = this.inventory[this.selectedItem].createWall;
							for (int num85 = 0; num85 < 4; num85++)
							{
								int num86 = Player.tileTargetX;
								int num87 = Player.tileTargetY;
								if (num85 == 0)
								{
									num86--;
								}
								if (num85 == 1)
								{
									num86++;
								}
								if (num85 == 2)
								{
									num87--;
								}
								if (num85 == 3)
								{
									num87++;
								}
								if (Main.tile[num86, num87].wall == 0)
								{
									int num88 = 0;
									for (int num89 = 0; num89 < 4; num89++)
									{
										int num90 = num86;
										int num91 = num87;
										if (num89 == 0)
										{
											num90--;
										}
										if (num89 == 1)
										{
											num90++;
										}
										if (num89 == 2)
										{
											num91--;
										}
										if (num89 == 3)
										{
											num91++;
										}
										if ((int)Main.tile[num90, num91].wall == createWall)
										{
											num88++;
										}
									}
									if (num88 == 4)
									{
										WorldGen.PlaceWall(num86, num87, createWall, false);
										if ((int)Main.tile[num86, num87].wall == createWall)
										{
											this.inventory[this.selectedItem].stack--;
											if (this.inventory[this.selectedItem].stack == 0)
											{
												this.inventory[this.selectedItem].SetDefaults(0, false);
											}
											if (Main.netMode == 1)
											{
												NetMessage.SendData(17, -1, -1, null, 3, (float)num86, (float)num87, (float)createWall, 0, 0, 0);
											}
											if (this.autoPaint && this.builderAccStatus[3] == 0)
											{
												int num92 = num86;
												int num93 = num87;
												int num94 = -1;
												int num95 = -1;
												for (int num96 = 0; num96 < 58; num96++)
												{
													if (this.inventory[num96].stack > 0 && this.inventory[num96].paint > 0)
													{
														num94 = (int)this.inventory[num96].paint;
														num95 = num96;
														break;
													}
												}
												if (num94 > 0 && (int)Main.tile[num92, num93].wallColor() != num94 && WorldGen.paintWall(num92, num93, (byte)num94, true))
												{
													int num97 = num95;
													this.inventory[num97].stack--;
													if (this.inventory[num97].stack <= 0)
													{
														this.inventory[num97].SetDefaults(0, false);
													}
													this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.wallSpeed);
												}
											}
										}
									}
								}
							}
						}
						if (this.autoPaint && this.builderAccStatus[3] == 0)
						{
							int num98 = Player.tileTargetX;
							int num99 = Player.tileTargetY;
							int num100 = -1;
							int num101 = -1;
							for (int num102 = 0; num102 < 58; num102++)
							{
								if (this.inventory[num102].stack > 0 && this.inventory[num102].paint > 0)
								{
									num100 = (int)this.inventory[num102].paint;
									num101 = num102;
									break;
								}
							}
							if (num100 > 0 && (int)Main.tile[num98, num99].wallColor() != num100 && WorldGen.paintWall(num98, num99, (byte)num100, true))
							{
								int num103 = num101;
								this.inventory[num103].stack--;
								if (this.inventory[num103].stack <= 0)
								{
									this.inventory[num103].SetDefaults(0, false);
								}
								this.itemTime = (int)((float)this.inventory[this.selectedItem].useTime * this.wallSpeed);
							}
						}
					}
				}
			}
		}

		// Token: 0x060003F6 RID: 1014 RVA: 0x00280854 File Offset: 0x0027EA54
		public void PlaceWeapon(int x, int y)
		{
			if (!Main.tile[x, y].active() || Main.tile[x, y].type != 334)
			{
				return;
			}
			int num = (int)Main.tile[x, y].frameY;
			int i = 1;
			num /= 18;
			while (i > num)
			{
				y++;
				num = (int)Main.tile[x, y].frameY;
				num /= 18;
			}
			while (i < num)
			{
				y--;
				num = (int)Main.tile[x, y].frameY;
				num /= 18;
			}
			int j = (int)Main.tile[x, y].frameX;
			int num2 = 0;
			while (j >= 5000)
			{
				j -= 5000;
				num2++;
			}
			if (num2 != 0)
			{
				j = (num2 - 1) * 18;
			}
			bool flag = false;
			if (j >= 54)
			{
				j -= 54;
				flag = true;
			}
			x -= j / 18;
			int k = (int)Main.tile[x, y].frameX;
			WorldGen.KillTile(x, y, true, false, false);
			if (Main.netMode == 1)
			{
				NetMessage.SendData(17, -1, -1, null, 0, (float)x, (float)y, 1f, 0, 0, 0);
			}
			if (Main.netMode == 1)
			{
				NetMessage.SendData(17, -1, -1, null, 0, (float)(x + 1), (float)y, 1f, 0, 0, 0);
			}
			while (k >= 5000)
			{
				k -= 5000;
			}
			Main.blockMouse = true;
			int num3 = 5000;
			int num4 = 10000;
			if (flag)
			{
				num3 = 20000;
				num4 = 25000;
			}
			Main.tile[x, y].frameX = (short)(this.inventory[this.selectedItem].netID + num3 + 100);
			Main.tile[x + 1, y].frameX = (short)((int)this.inventory[this.selectedItem].prefix + num4);
			if (Main.netMode == 1)
			{
				NetMessage.SendTileSquare(-1, x, y, 1, TileChangeType.None);
			}
			if (Main.netMode == 1)
			{
				NetMessage.SendTileSquare(-1, x + 1, y, 1, TileChangeType.None);
			}
			this.inventory[this.selectedItem].stack--;
			if (this.inventory[this.selectedItem].stack <= 0)
			{
				this.inventory[this.selectedItem].SetDefaults(0, false);
				Main.mouseItem.SetDefaults(0, false);
			}
			if (this.selectedItem == 58)
			{
				Main.mouseItem = this.inventory[this.selectedItem].Clone();
			}
			this.releaseUseItem = false;
			this.mouseInterface = true;
		}

		// Token: 0x060003C7 RID: 967 RVA: 0x00260994 File Offset: 0x0025EB94
		public void PlayerFrame()
		{
			if (this.swimTime > 0)
			{
				this.swimTime--;
				if (!this.wet)
				{
					this.swimTime = 0;
				}
			}
			this.head = this.armor[0].headSlot;
			this.body = this.armor[1].bodySlot;
			this.legs = this.armor[2].legSlot;
			for (int i = 3; i < 8 + this.extraAccessorySlots; i++)
			{
				if (this.armor[i].shieldSlot == 5 && this.eocDash > 0 && this.shield == -1)
				{
					this.shield = this.armor[i].shieldSlot;
				}
				if (this.shieldRaised && this.shield == -1 && this.armor[i].shieldSlot != -1)
				{
					this.shield = this.armor[i].shieldSlot;
				}
				if ((this.shield <= 0 || this.armor[i].frontSlot < 1 || this.armor[i].frontSlot > 4) && (this.front < 1 || this.front > 4 || this.armor[i].shieldSlot <= 0))
				{
					if (this.armor[i].wingSlot > 0)
					{
						if (this.hideVisual[i] && (this.velocity.Y == 0f || this.mount.Active))
						{
							goto IL_35A;
						}
						this.wings = (int)this.armor[i].wingSlot;
					}
					if (!this.hideVisual[i])
					{
						if (this.armor[i].stringColor > 0)
						{
							this.stringColor = this.armor[i].stringColor;
						}
						if (this.armor[i].handOnSlot > 0)
						{
							this.handon = this.armor[i].handOnSlot;
						}
						if (this.armor[i].handOffSlot > 0)
						{
							this.handoff = this.armor[i].handOffSlot;
						}
						if (this.armor[i].backSlot > 0)
						{
							this.back = this.armor[i].backSlot;
							this.front = -1;
						}
						if (this.armor[i].frontSlot > 0)
						{
							this.front = this.armor[i].frontSlot;
						}
						if (this.armor[i].shoeSlot > 0)
						{
							this.shoe = this.armor[i].shoeSlot;
						}
						if (this.armor[i].waistSlot > 0)
						{
							this.waist = this.armor[i].waistSlot;
						}
						if (this.armor[i].shieldSlot > 0)
						{
							this.shield = this.armor[i].shieldSlot;
						}
						if (this.armor[i].neckSlot > 0)
						{
							this.neck = this.armor[i].neckSlot;
						}
						if (this.armor[i].faceSlot > 0)
						{
							this.face = this.armor[i].faceSlot;
						}
						if (this.armor[i].balloonSlot > 0)
						{
							this.balloon = this.armor[i].balloonSlot;
						}
						if (this.armor[i].type == 3580)
						{
							this.yoraiz0rEye = i - 2;
						}
						if (this.armor[i].type == 3581)
						{
							this.yoraiz0rDarkness = true;
						}
						if (this.armor[i].type == 3929)
						{
							this.leinforsHair = true;
						}
					}
				}
				IL_35A:;
			}
			for (int j = 13; j < 18 + this.extraAccessorySlots; j++)
			{
				if (this.armor[j].stringColor > 0)
				{
					this.stringColor = this.armor[j].stringColor;
				}
				if (this.armor[j].handOnSlot > 0)
				{
					this.handon = this.armor[j].handOnSlot;
				}
				if (this.armor[j].handOffSlot > 0)
				{
					this.handoff = this.armor[j].handOffSlot;
				}
				if (this.armor[j].backSlot > 0)
				{
					this.back = this.armor[j].backSlot;
					this.front = -1;
				}
				if (this.armor[j].frontSlot > 0)
				{
					this.front = this.armor[j].frontSlot;
				}
				if (this.armor[j].shoeSlot > 0)
				{
					this.shoe = this.armor[j].shoeSlot;
				}
				if (this.armor[j].waistSlot > 0)
				{
					this.waist = this.armor[j].waistSlot;
				}
				if (this.armor[j].shieldSlot > 0)
				{
					this.shield = this.armor[j].shieldSlot;
				}
				if (this.armor[j].neckSlot > 0)
				{
					this.neck = this.armor[j].neckSlot;
				}
				if (this.armor[j].faceSlot > 0)
				{
					this.face = this.armor[j].faceSlot;
				}
				if (this.armor[j].balloonSlot > 0)
				{
					this.balloon = this.armor[j].balloonSlot;
				}
				if (this.armor[j].wingSlot > 0)
				{
					this.wings = (int)this.armor[j].wingSlot;
				}
				if (this.armor[j].type == 3580)
				{
					this.yoraiz0rEye = j - 2;
				}
				if (this.armor[j].type == 3581)
				{
					this.yoraiz0rDarkness = true;
				}
				if (this.armor[j].type == 3929)
				{
					this.leinforsHair = true;
				}
			}
			if (this.armor[10].headSlot >= 0)
			{
				this.head = this.armor[10].headSlot;
			}
			if (this.armor[11].bodySlot >= 0)
			{
				this.body = this.armor[11].bodySlot;
			}
			if (this.armor[12].legSlot >= 0)
			{
				this.legs = this.armor[12].legSlot;
			}
			this.wearsRobe = false;
			bool flag = false;
			int num = Player.SetMatch(1, this.body, this.Male, ref this.wearsRobe);
			if (num != -1)
			{
				this.legs = num;
			}
			num = Player.SetMatch(2, this.legs, this.Male, ref flag);
			if (num != -1)
			{
				this.legs = num;
			}
			num = Player.SetMatch(0, this.head, this.Male, ref flag);
			if (num != -1)
			{
				this.head = num;
			}
			if (this.body == 93)
			{
				this.shield = 0;
				this.handoff = 0;
			}
			if (this.body == 206 && this.back == -1)
			{
				this.back = 12;
			}
			if (this.body == 207 && this.back == -1)
			{
				this.back = 13;
			}
			if (this.body == 205 && this.back == -1)
			{
				this.back = 11;
			}
			if (this.legs == 67)
			{
				this.shoe = 0;
			}
			if (this.legs == 140)
			{
				this.shoe = 0;
			}
			if ((this.wereWolf || this.forceWerewolf) && !this.hideWolf)
			{
				this.legs = 20;
				this.body = 21;
				this.head = 38;
			}
			bool flag2 = this.wet && !this.lavaWet && (!this.mount.Active || this.mount.Type != 3);
			if (this.merman || this.forceMerman)
			{
				if (!this.hideMerman)
				{
					this.head = 39;
					this.legs = 21;
					this.body = 22;
				}
				if (flag2)
				{
					this.wings = 0;
				}
			}
			this.socialShadowRocketBoots = false;
			this.socialIgnoreLight = false;
			this.socialGhost = false;
			this.armorEffectDrawShadow = false;
			this.armorEffectDrawShadowSubtle = false;
			this.armorEffectDrawOutlines = false;
			this.armorEffectDrawShadowLokis = false;
			this.armorEffectDrawShadowBasilisk = false;
			this.armorEffectDrawOutlinesForbidden = false;
			this.armorEffectDrawShadowEOCShield = false;
			if (this.head == 101 && this.body == 66 && this.legs == 55)
			{
				this.socialGhost = true;
			}
			if (this.head == 156 && this.body == 66 && this.legs == 55)
			{
				this.socialGhost = true;
			}
			this.SetArmorEffectVisuals(this);
			this.hermesStepSound.SoundType = 17;
			this.hermesStepSound.SoundStyle = -1;
			this.hermesStepSound.IntendedCooldown = 9;
			if (this.head == 99 && this.body == 65 && this.legs == 54)
			{
				this.turtleArmor = true;
			}
			if (this.head == 162 && this.body == 170 && this.legs == 105)
			{
				this.spiderArmor = true;
			}
			if ((this.head == 75 || this.head == 7) && this.body == 7 && this.legs == 7)
			{
				this.boneArmor = true;
			}
			if (this.legs == 140)
			{
				this.hermesStepSound.SoundType = 2;
				this.hermesStepSound.SoundStyle = 24;
				this.hermesStepSound.IntendedCooldown = 6;
			}
			if (this.wings > 0)
			{
				this.back = -1;
				this.front = -1;
			}
			if (this.head > 0 && this.face != 7)
			{
				this.face = -1;
			}
			if (this.webbed || this.frozen || this.stoned)
			{
				return;
			}
			if (Main.gamePaused && !Main.gameMenu)
			{
				return;
			}
			if (((this.body == 68 && this.legs == 57 && this.head == 106) || (this.body == 74 && this.legs == 63 && this.head == 106)) && Main.rand.Next(10) == 0)
			{
				int num2 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 43, 0f, 0f, 100, new Color(255, 0, 255), 0.3f);
				Main.dust[num2].fadeIn = 0.8f;
				Main.dust[num2].noGravity = true;
				Main.dust[num2].velocity *= 2f;
				Main.dust[num2].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.wings == 27)
			{
				float num3 = 0.4f * this.stealth;
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, num3, num3 * 0.9f, num3 * 0.2f);
			}
			if (this.head == 5 && this.body == 5 && this.legs == 5)
			{
				this.socialShadowRocketBoots = true;
			}
			if (this.head == 5 && this.body == 5 && this.legs == 5 && Main.rand.Next(10) == 0)
			{
				int num4 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 14, 0f, 0f, 200, default(Color), 1.2f);
				Main.dust[num4].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.head == 76 && this.body == 49 && this.legs == 45)
			{
				this.socialShadowRocketBoots = true;
			}
			if (this.head == 74 && this.body == 48 && this.legs == 44)
			{
				this.socialShadowRocketBoots = true;
			}
			if (this.head == 74 && this.body == 48 && this.legs == 44 && Main.rand.Next(10) == 0)
			{
				int num5 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 14, 0f, 0f, 200, default(Color), 1.2f);
				Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.head == 57 && this.body == 37 && this.legs == 35)
			{
				int maxValue = 10;
				if (Math.Abs(this.velocity.X) + Math.Abs(this.velocity.Y) > 1f)
				{
					maxValue = 2;
				}
				if (Main.rand.Next(maxValue) == 0)
				{
					int num6 = Dust.NewDust(new Vector2(this.position.X, this.position.Y), this.width, this.height, 115, 0f, 0f, 140, default(Color), 0.75f);
					Main.dust[num6].noGravity = true;
					Main.dust[num6].fadeIn = 1.5f;
					Main.dust[num6].velocity *= 0.3f;
					Main.dust[num6].velocity += this.velocity * 0.2f;
					Main.dust[num6].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
			}
			if (this.head == 6 && this.body == 6 && this.legs == 6 && Math.Abs(this.velocity.X) + Math.Abs(this.velocity.Y) > 1f && !this.rocketFrame)
			{
				for (int k = 0; k < 2; k++)
				{
					int num7 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 6, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num7].noGravity = true;
					Main.dust[num7].noLight = true;
					Dust expr_ED7_cp_0_cp_0 = Main.dust[num7];
					expr_ED7_cp_0_cp_0.velocity.X = expr_ED7_cp_0_cp_0.velocity.X - this.velocity.X * 0.5f;
					Dust expr_EFE_cp_0_cp_0 = Main.dust[num7];
					expr_EFE_cp_0_cp_0.velocity.Y = expr_EFE_cp_0_cp_0.velocity.Y - this.velocity.Y * 0.5f;
					Main.dust[num7].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
			}
			if (this.head == 8 && this.body == 8 && this.legs == 8 && Math.Abs(this.velocity.X) + Math.Abs(this.velocity.Y) > 1f)
			{
				int num8 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 40, 0f, 0f, 50, default(Color), 1.4f);
				Main.dust[num8].noGravity = true;
				Main.dust[num8].velocity.X = this.velocity.X * 0.25f;
				Main.dust[num8].velocity.Y = this.velocity.Y * 0.25f;
				Main.dust[num8].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.head == 9 && this.body == 9 && this.legs == 9 && Math.Abs(this.velocity.X) + Math.Abs(this.velocity.Y) > 1f && !this.rocketFrame)
			{
				for (int l = 0; l < 2; l++)
				{
					int num9 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 6, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num9].noGravity = true;
					Main.dust[num9].noLight = true;
					Dust expr_117C_cp_0_cp_0 = Main.dust[num9];
					expr_117C_cp_0_cp_0.velocity.X = expr_117C_cp_0_cp_0.velocity.X - this.velocity.X * 0.5f;
					Dust expr_11A3_cp_0_cp_0 = Main.dust[num9];
					expr_11A3_cp_0_cp_0.velocity.Y = expr_11A3_cp_0_cp_0.velocity.Y - this.velocity.Y * 0.5f;
					Main.dust[num9].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
			}
			if (this.body == 18 && this.legs == 17 && (this.head == 32 || this.head == 33 || this.head == 34) && Main.rand.Next(10) == 0)
			{
				int num10 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 43, 0f, 0f, 100, default(Color), 0.3f);
				Main.dust[num10].fadeIn = 0.8f;
				Main.dust[num10].velocity *= 0f;
				Main.dust[num10].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.body == 24 && this.legs == 23 && (this.head == 42 || this.head == 43 || this.head == 41) && this.velocity.X != 0f && this.velocity.Y != 0f && Main.rand.Next(10) == 0)
			{
				int num11 = Dust.NewDust(new Vector2(this.position.X - this.velocity.X * 2f, this.position.Y - 2f - this.velocity.Y * 2f), this.width, this.height, 43, 0f, 0f, 100, default(Color), 0.3f);
				Main.dust[num11].fadeIn = 0.8f;
				Main.dust[num11].velocity *= 0f;
				Main.dust[num11].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
			}
			if (this.body == 36 && this.head == 56 && this.velocity.X != 0f && this.velocity.Y == 0f)
			{
				for (int m = 0; m < 2; m++)
				{
					int num12 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)((this.gravDir == 1f) ? (this.height - 2) : -4)), this.width, 6, 106, 0f, 0f, 100, default(Color), 0.1f);
					Main.dust[num12].fadeIn = 1f;
					Main.dust[num12].noGravity = true;
					Main.dust[num12].velocity *= 0.2f;
					Main.dust[num12].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
				}
			}
			if (this.body == 27 && this.head == 46 && this.legs == 26)
			{
				this.frostArmor = true;
				if (this.velocity.X != 0f && this.velocity.Y == 0f && this.miscCounter % 2 == 0)
				{
					for (int n = 0; n < 2; n++)
					{
						int num13;
						if (n == 0)
						{
							num13 = Dust.NewDust(new Vector2(this.position.X, this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
						}
						else
						{
							num13 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2), this.position.Y + (float)this.height + this.gfxOffY), this.width / 2, 6, 76, 0f, 0f, 0, default(Color), 1.35f);
						}
						Main.dust[num13].scale *= 1f + (float)Main.rand.Next(20, 40) * 0.01f;
						Main.dust[num13].noGravity = true;
						Main.dust[num13].noLight = true;
						Main.dust[num13].velocity *= 0.001f;
						Dust expr_16E3_cp_0_cp_0 = Main.dust[num13];
						expr_16E3_cp_0_cp_0.velocity.Y = expr_16E3_cp_0_cp_0.velocity.Y - 0.003f;
						Main.dust[num13].shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
					}
				}
			}
			if (this.mount.Active)
			{
				this.legFrameCounter = 0.0;
				this.legFrame.Y = this.legFrame.Height * 6;
				if (this.velocity.Y != 0f)
				{
					if (this.mount.FlyTime > 0 && this.jump == 0 && this.controlJump && !this.mount.CanHover)
					{
						if (this.mount.Type == 0)
						{
							if (this.direction > 0)
							{
								if (Main.rand.Next(4) == 0)
								{
									int num14 = Dust.NewDust(new Vector2(base.Center.X - 22f, this.position.Y + (float)this.height - 6f), 20, 10, 64, this.velocity.X * 0.25f, this.velocity.Y * 0.25f, 255, default(Color), 1f);
									Main.dust[num14].velocity *= 0.1f;
									Main.dust[num14].noLight = true;
								}
								if (Main.rand.Next(4) == 0)
								{
									int num15 = Dust.NewDust(new Vector2(base.Center.X + 12f, this.position.Y + (float)this.height - 6f), 20, 10, 64, this.velocity.X * 0.25f, this.velocity.Y * 0.25f, 255, default(Color), 1f);
									Main.dust[num15].velocity *= 0.1f;
									Main.dust[num15].noLight = true;
								}
							}
							else
							{
								if (Main.rand.Next(4) == 0)
								{
									int num16 = Dust.NewDust(new Vector2(base.Center.X - 32f, this.position.Y + (float)this.height - 6f), 20, 10, 64, this.velocity.X * 0.25f, this.velocity.Y * 0.25f, 255, default(Color), 1f);
									Main.dust[num16].velocity *= 0.1f;
									Main.dust[num16].noLight = true;
								}
								if (Main.rand.Next(4) == 0)
								{
									int num17 = Dust.NewDust(new Vector2(base.Center.X + 2f, this.position.Y + (float)this.height - 6f), 20, 10, 64, this.velocity.X * 0.25f, this.velocity.Y * 0.25f, 255, default(Color), 1f);
									Main.dust[num17].velocity *= 0.1f;
									Main.dust[num17].noLight = true;
								}
							}
						}
						this.mount.UpdateFrame(this, 3, this.velocity);
					}
					else if (this.wet)
					{
						this.mount.UpdateFrame(this, 4, this.velocity);
					}
					else
					{
						this.mount.UpdateFrame(this, 2, this.velocity);
					}
				}
				else if (this.velocity.X == 0f || ((this.slippy || this.slippy2 || this.windPushed) && !this.controlLeft && !this.controlRight))
				{
					this.mount.UpdateFrame(this, 0, this.velocity);
				}
				else
				{
					this.mount.UpdateFrame(this, 1, this.velocity);
				}
			}
			else if (this.legs == 140)
			{
				this.legFrameCounter = 0.0;
				this.legFrame.Y = this.legFrame.Height * (this.velocity.Y != 0f).ToInt();
				if (this.wings == 22 || this.wings == 28)
				{
					this.legFrame.Y = 0;
				}
			}
			else if (this.swimTime > 0)
			{
				this.legFrameCounter += 2.0;
				while (this.legFrameCounter > 8.0)
				{
					this.legFrameCounter -= 8.0;
					this.legFrame.Y = this.legFrame.Y + this.legFrame.Height;
				}
				if (this.legFrame.Y < this.legFrame.Height * 7)
				{
					this.legFrame.Y = this.legFrame.Height * 19;
				}
				else if (this.legFrame.Y > this.legFrame.Height * 19)
				{
					this.legFrame.Y = this.legFrame.Height * 7;
				}
			}
			else if (this.velocity.Y != 0f || this.grappling[0] > -1)
			{
				this.legFrameCounter = 0.0;
				this.legFrame.Y = this.legFrame.Height * 5;
				if (this.wings == 22 || this.wings == 28)
				{
					this.legFrame.Y = 0;
				}
			}
			else if (this.velocity.X != 0f)
			{
				if ((this.slippy || this.slippy2 || this.windPushed) && !this.controlLeft && !this.controlRight)
				{
					this.legFrameCounter = 0.0;
					Rectangle arg_1D3B_0 = this.legFrame;
					this.legFrame.Y = 0;
				}
				else
				{
					this.legFrameCounter += (double)Math.Abs(this.velocity.X) * 1.3;
					while (this.legFrameCounter > 8.0)
					{
						this.legFrameCounter -= 8.0;
						this.legFrame.Y = this.legFrame.Y + this.legFrame.Height;
					}
					if (this.legFrame.Y < this.legFrame.Height * 7)
					{
						this.legFrame.Y = this.legFrame.Height * 19;
					}
					else if (this.legFrame.Y > this.legFrame.Height * 19)
					{
						this.legFrame.Y = this.legFrame.Height * 7;
					}
				}
			}
			else
			{
				this.legFrameCounter = 0.0;
				Rectangle arg_1E37_0 = this.legFrame;
				this.legFrame.Y = 0;
			}
			if (this.carpetFrame >= 0)
			{
				this.legFrameCounter = 0.0;
				Rectangle arg_1E62_0 = this.legFrame;
				this.legFrame.Y = 0;
			}
			if (this.sandStorm)
			{
				if (this.miscCounter % 4 == 0 && this.itemAnimation == 0)
				{
					this.ChangeDir(this.direction * -1);
					if (this.inventory[this.selectedItem].holdStyle == 2)
					{
						if (this.inventory[this.selectedItem].type == 946)
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f - (float)(16 * this.direction);
						}
						if (this.inventory[this.selectedItem].type == 186)
						{
							this.itemLocation.X = this.position.X + (float)this.width * 0.5f + (float)(6 * this.direction);
							this.itemRotation = 0.79f * (float)(-(float)this.direction);
						}
					}
				}
				this.legFrameCounter = 0.0;
				Rectangle arg_1F70_0 = this.legFrame;
				this.legFrame.Y = 0;
			}
			if (this.itemAnimation > 0 && this.inventory[this.selectedItem].useStyle != 10)
			{
				if (this.inventory[this.selectedItem].useStyle == 1 || this.inventory[this.selectedItem].type == 0)
				{
					if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.333)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						return;
					}
					if ((double)this.itemAnimation < (double)this.itemAnimationMax * 0.666)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 2;
						return;
					}
					this.bodyFrame.Y = this.bodyFrame.Height;
					return;
				}
				else if (this.inventory[this.selectedItem].useStyle == 2)
				{
					if ((double)this.itemAnimation > (double)this.itemAnimationMax * 0.5)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						return;
					}
					this.bodyFrame.Y = this.bodyFrame.Height * 2;
					return;
				}
				else if (this.inventory[this.selectedItem].useStyle == 3)
				{
					if ((double)this.itemAnimation > (double)this.itemAnimationMax * 0.666)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						return;
					}
					this.bodyFrame.Y = this.bodyFrame.Height * 3;
					return;
				}
				else
				{
					if (this.inventory[this.selectedItem].useStyle == 4)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 2;
						return;
					}
					if (this.inventory[this.selectedItem].useStyle == 5)
					{
						if (this.inventory[this.selectedItem].type == 281 || this.inventory[this.selectedItem].type == 986)
						{
							this.bodyFrame.Y = this.bodyFrame.Height * 2;
							return;
						}
						float arg_21BB_0 = this.itemRotation * (float)this.direction;
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						if ((double)arg_21BB_0 < -0.75)
						{
							this.bodyFrame.Y = this.bodyFrame.Height * 2;
							if (this.gravDir == -1f)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 4;
							}
						}
						if ((double)arg_21BB_0 > 0.6)
						{
							this.bodyFrame.Y = this.bodyFrame.Height * 4;
							if (this.gravDir == -1f)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 2;
								return;
							}
						}
					}
				}
			}
			else
			{
				if (this.mount.Active)
				{
					this.bodyFrameCounter = 0.0;
					this.bodyFrame.Y = this.bodyFrame.Height * this.mount.BodyFrame;
					return;
				}
				if (this.pulley)
				{
					if (this.pulleyDir == 2)
					{
						this.bodyFrame.Y = this.bodyFrame.Height;
						return;
					}
					this.bodyFrame.Y = this.bodyFrame.Height * 2;
					return;
				}
				else
				{
					if (this.inventory[this.selectedItem].holdStyle == 1 && (!this.wet || !this.inventory[this.selectedItem].noWet))
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						return;
					}
					if (this.inventory[this.selectedItem].holdStyle == 2 && (!this.wet || !this.inventory[this.selectedItem].noWet))
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 2;
						return;
					}
					if (this.inventory[this.selectedItem].holdStyle == 3)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 3;
						return;
					}
					if (this.shieldRaised)
					{
						this.bodyFrame.Y = this.bodyFrame.Height * 10;
						return;
					}
					if (this.grappling[0] >= 0)
					{
						this.sandStorm = false;
						this.dJumpEffectCloud = false;
						this.dJumpEffectSandstorm = false;
						this.dJumpEffectBlizzard = false;
						this.dJumpEffectFart = false;
						this.dJumpEffectSail = false;
						this.dJumpEffectUnicorn = false;
						Vector2 vector = new Vector2(this.position.X + (float)this.width * 0.5f, this.position.Y + (float)this.height * 0.5f);
						float num18 = 0f;
						float num19 = 0f;
						for (int num20 = 0; num20 < this.grapCount; num20++)
						{
							num18 += Main.projectile[this.grappling[num20]].position.X + (float)(Main.projectile[this.grappling[num20]].width / 2);
							num19 += Main.projectile[this.grappling[num20]].position.Y + (float)(Main.projectile[this.grappling[num20]].height / 2);
						}
						num18 /= (float)this.grapCount;
						num19 /= (float)this.grapCount;
						num18 -= vector.X;
						num19 -= vector.Y;
						if (num19 < 0f && Math.Abs(num19) > Math.Abs(num18))
						{
							this.bodyFrame.Y = this.bodyFrame.Height * 2;
							if (this.gravDir == -1f)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 4;
								return;
							}
						}
						else
						{
							if (num19 <= 0f || Math.Abs(num19) <= Math.Abs(num18))
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 3;
								return;
							}
							this.bodyFrame.Y = this.bodyFrame.Height * 4;
							if (this.gravDir == -1f)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 2;
								return;
							}
						}
					}
					else if (this.swimTime > 0)
					{
						if (this.swimTime > 20)
						{
							Rectangle arg_25DC_0 = this.bodyFrame;
							this.bodyFrame.Y = 0;
							return;
						}
						if (this.swimTime > 10)
						{
							this.bodyFrame.Y = this.bodyFrame.Height * 5;
							return;
						}
						Rectangle arg_2613_0 = this.bodyFrame;
						this.bodyFrame.Y = 0;
						return;
					}
					else
					{
						if (this.velocity.Y != 0f)
						{
							if (this.sliding)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 3;
							}
							else if (this.sandStorm || this.carpetFrame >= 0)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 6;
							}
							else if (this.eocDash > 0)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 6;
							}
							else if (this.wings > 0)
							{
								if (this.wings == 22 || this.wings == 28)
								{
									this.bodyFrame.Y = 0;
								}
								else if (this.velocity.Y > 0f)
								{
									if (this.controlJump)
									{
										this.bodyFrame.Y = this.bodyFrame.Height * 6;
									}
									else
									{
										this.bodyFrame.Y = this.bodyFrame.Height * 5;
									}
								}
								else
								{
									this.bodyFrame.Y = this.bodyFrame.Height * 6;
								}
							}
							else
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 5;
							}
							this.bodyFrameCounter = 0.0;
							return;
						}
						if (this.velocity.X != 0f)
						{
							if (this.legs != 140)
							{
								this.bodyFrameCounter += (double)Math.Abs(this.velocity.X) * 1.5;
								this.bodyFrame.Y = this.legFrame.Y;
								return;
							}
							this.bodyFrameCounter += (double)(Math.Abs(this.velocity.X) * 0.5f);
							while (this.bodyFrameCounter > 8.0)
							{
								this.bodyFrameCounter -= 8.0;
								this.bodyFrame.Y = this.bodyFrame.Y + this.bodyFrame.Height;
							}
							if (this.bodyFrame.Y < this.bodyFrame.Height * 7)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 19;
								return;
							}
							if (this.bodyFrame.Y > this.bodyFrame.Height * 19)
							{
								this.bodyFrame.Y = this.bodyFrame.Height * 7;
								return;
							}
						}
						else
						{
							this.bodyFrameCounter = 0.0;
							Rectangle arg_28B8_0 = this.bodyFrame;
							this.bodyFrame.Y = 0;
						}
					}
				}
			}
		}

		// Token: 0x060003DD RID: 989 RVA: 0x0026BD68 File Offset: 0x00269F68
		private void pumpkinSword(int i, int dmg, float kb)
		{
			int logicCheckScreenHeight = Main.LogicCheckScreenHeight;
			int logicCheckScreenWidth = Main.LogicCheckScreenWidth;
			int num = Main.rand.Next(100, 300);
			int num2 = Main.rand.Next(100, 300);
			if (Main.rand.Next(2) == 0)
			{
				num -= logicCheckScreenWidth / 2 + num;
			}
			else
			{
				num += logicCheckScreenWidth / 2 - num;
			}
			if (Main.rand.Next(2) == 0)
			{
				num2 -= logicCheckScreenHeight / 2 + num2;
			}
			else
			{
				num2 += logicCheckScreenHeight / 2 - num2;
			}
			num += (int)this.position.X;
			num2 += (int)this.position.Y;
			float arg_E8_0 = 8f;
			Vector2 vector = new Vector2((float)num, (float)num2);
			float num3 = Main.npc[i].position.X - vector.X;
			float num4 = Main.npc[i].position.Y - vector.Y;
			float num5 = (float)Math.Sqrt((double)(num3 * num3 + num4 * num4));
			num5 = arg_E8_0 / num5;
			num3 *= num5;
			num4 *= num5;
			Projectile.NewProjectile((float)num, (float)num2, num3, num4, 321, dmg, kb, this.whoAmI, (float)i, 0f);
		}

		// Token: 0x060003B0 RID: 944 RVA: 0x00259538 File Offset: 0x00257738
		private void PurgeDD2EnergyCrystals()
		{
			if (this.trashItem.type == 3822)
			{
				this.trashItem.TurnToAir();
			}
			for (int i = 0; i < 58; i++)
			{
				Item item = this.inventory[i];
				if (item.stack > 0 && item.type == 3822)
				{
					item.TurnToAir();
				}
			}
			if (this.chest == -2)
			{
				Chest chest = this.bank;
				for (int j = 0; j < 40; j++)
				{
					if (chest.item[j].stack > 0 && chest.item[j].type == 3822)
					{
						chest.item[j].TurnToAir();
					}
				}
			}
			if (this.chest == -4)
			{
				Chest chest2 = this.bank3;
				for (int k = 0; k < 40; k++)
				{
					if (chest2.item[k].stack > 0 && chest2.item[k].type == 3822)
					{
						chest2.item[k].TurnToAir();
					}
				}
			}
			if (this.chest == -3)
			{
				Chest chest3 = this.bank2;
				for (int l = 0; l < 40; l++)
				{
					if (chest3.item[l].stack > 0 && chest3.item[l].type == 3822)
					{
						chest3.item[l].TurnToAir();
					}
				}
			}
			if (this.chest > -1)
			{
				Chest chest4 = Main.chest[this.chest];
				for (int m = 0; m < 40; m++)
				{
					if (chest4.item[m].stack > 0 && chest4.item[m].type == 3822)
					{
						chest4.item[m].TurnToAir();
						if (Main.netMode == 1)
						{
							NetMessage.SendData(32, -1, -1, null, this.chest, (float)m, 0f, 0f, 0, 0, 0);
						}
					}
				}
			}
		}

		// Token: 0x060003DE RID: 990 RVA: 0x0026BE90 File Offset: 0x0026A090
		public void PutItemInInventory(int type, int selItem = -1)
		{
			for (int i = 0; i < 58; i++)
			{
				Item item = this.inventory[i];
				if (item.stack > 0 && item.type == type && item.stack < item.maxStack)
				{
					item.stack++;
					return;
				}
			}
			if (selItem >= 0 && (this.inventory[selItem].type == 0 || this.inventory[selItem].stack <= 0))
			{
				this.inventory[selItem].SetDefaults(type, false);
				return;
			}
			Item item2 = new Item();
			item2.SetDefaults(type, false);
			if (this.GetItem(this.whoAmI, item2, false, false).stack > 0)
			{
				int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, type, 1, false, 0, true, false);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
					return;
				}
			}
			else
			{
				item2.position.X = base.Center.X - (float)(item2.width / 2);
				item2.position.Y = base.Center.Y - (float)(item2.height / 2);
				item2.active = true;
				ItemText.NewText(item2, 0, false, false);
			}
		}

		// Token: 0x0600035C RID: 860 RVA: 0x00227568 File Offset: 0x00225768
		public void QuickBuff()
		{
			if (this.noItems)
			{
				return;
			}
			LegacySoundStyle legacySoundStyle = null;
			for (int i = 0; i < 58; i++)
			{
				if (this.CountBuffs() == 22)
				{
					return;
				}
				if (this.inventory[i].stack > 0 && this.inventory[i].type > 0 && this.inventory[i].buffType > 0 && !this.inventory[i].summon && this.inventory[i].buffType != 90)
				{
					int num = this.inventory[i].buffType;
					bool flag = true;
					for (int j = 0; j < 22; j++)
					{
						if (num == 27 && (this.buffType[j] == num || this.buffType[j] == 101 || this.buffType[j] == 102))
						{
							flag = false;
							break;
						}
						if (this.buffType[j] == num)
						{
							flag = false;
							break;
						}
						if (Main.meleeBuff[num] && Main.meleeBuff[this.buffType[j]])
						{
							flag = false;
							break;
						}
					}
					if (Main.lightPet[this.inventory[i].buffType] || Main.vanityPet[this.inventory[i].buffType])
					{
						for (int k = 0; k < 22; k++)
						{
							if (Main.lightPet[this.buffType[k]] && Main.lightPet[this.inventory[i].buffType])
							{
								flag = false;
							}
							if (Main.vanityPet[this.buffType[k]] && Main.vanityPet[this.inventory[i].buffType])
							{
								flag = false;
							}
						}
					}
					if (this.inventory[i].mana > 0 & flag)
					{
						if (this.statMana >= (int)((float)this.inventory[i].mana * this.manaCost))
						{
							this.manaRegenDelay = (int)this.maxRegenDelay;
							this.statMana -= (int)((float)this.inventory[i].mana * this.manaCost);
						}
						else
						{
							flag = false;
						}
					}
					if (this.whoAmI == Main.myPlayer && this.inventory[i].type == 603 && !Main.cEd)
					{
						flag = false;
					}
					if (num == 27)
					{
						num = Main.rand.Next(3);
						if (num == 0)
						{
							num = 27;
						}
						if (num == 1)
						{
							num = 101;
						}
						if (num == 2)
						{
							num = 102;
						}
					}
					if (flag)
					{
						legacySoundStyle = this.inventory[i].UseSound;
						int num2 = this.inventory[i].buffTime;
						if (num2 == 0)
						{
							num2 = 3600;
						}
						this.AddBuff(num, num2, true);
						if (this.inventory[i].consumable)
						{
							this.inventory[i].stack--;
							if (this.inventory[i].stack <= 0)
							{
								this.inventory[i].TurnToAir();
							}
						}
					}
				}
			}
			if (legacySoundStyle != null)
			{
				Main.PlaySound(legacySoundStyle, this.position);
				Recipe.FindRecipes();
			}
		}

		// Token: 0x0600035F RID: 863 RVA: 0x00227D14 File Offset: 0x00225F14
		public void QuickGrapple()
		{
			if (this.frozen || this.tongued || this.webbed || this.stoned)
			{
				return;
			}
			if (PlayerInput.GrappleAndInteractAreShared)
			{
				if (Main.HoveringOverAnNPC)
				{
					return;
				}
				if (Main.SmartInteractShowingGenuine || Main.SmartInteractShowingFake)
				{
					return;
				}
				if (this._quickGrappleCooldown > 0 && !Main.mapFullscreen)
				{
					return;
				}
				if (WiresUI.Settings.DrawToolModeUI)
				{
					return;
				}
				bool arg_68_0 = this.controlUseTile;
				bool flag = this.releaseUseTile;
				if (!arg_68_0 && !flag)
				{
					return;
				}
				Tile tileSafely = Framing.GetTileSafely(Player.tileTargetX, Player.tileTargetY);
				if (tileSafely.active() && (tileSafely.type == 4 || tileSafely.type == 33 || tileSafely.type == 372 || tileSafely.type == 174 || tileSafely.type == 49))
				{
					return;
				}
				if (this.inventory[this.selectedItem].type == 3384)
				{
					return;
				}
			}
			if (this.mount.Active)
			{
				this.mount.Dismount(this);
			}
			if (this.noItems)
			{
				return;
			}
			Item item = null;
			if (item == null && Main.projHook[this.miscEquips[4].shoot])
			{
				item = this.miscEquips[4];
			}
			if (item == null)
			{
				for (int i = 0; i < 58; i++)
				{
					if (Main.projHook[this.inventory[i].shoot])
					{
						item = this.inventory[i];
						break;
					}
				}
			}
			if (item == null)
			{
				return;
			}
			if (item.shoot == 73)
			{
				int num = 0;
				for (int j = 0; j < 1000; j++)
				{
					if (Main.projectile[j].active && Main.projectile[j].owner == Main.myPlayer && (Main.projectile[j].type == 73 || Main.projectile[j].type == 74))
					{
						num++;
					}
				}
				if (num > 1)
				{
					item = null;
				}
			}
			else if (item.shoot == 165)
			{
				int num2 = 0;
				for (int k = 0; k < 1000; k++)
				{
					if (Main.projectile[k].active && Main.projectile[k].owner == Main.myPlayer && Main.projectile[k].type == 165)
					{
						num2++;
					}
				}
				if (num2 > 8)
				{
					item = null;
				}
			}
			else if (item.shoot == 372)
			{
				int num3 = 0;
				for (int l = 0; l < 1000; l++)
				{
					if (Main.projectile[l].active && Main.projectile[l].owner == Main.myPlayer && Main.projectile[l].type == 372)
					{
						num3++;
					}
				}
				if (num3 > 2)
				{
					item = null;
				}
			}
			else if (item.shoot == 652)
			{
				int num4 = 0;
				for (int m = 0; m < 1000; m++)
				{
					if (Main.projectile[m].active && Main.projectile[m].owner == Main.myPlayer && Main.projectile[m].type == 652)
					{
						num4++;
					}
				}
				if (num4 > 1)
				{
					item = null;
				}
			}
			else if (item.type == 3572)
			{
				int num5 = 0;
				bool flag2 = false;
				for (int n = 0; n < 1000; n++)
				{
					if (Main.projectile[n].active && Main.projectile[n].owner == Main.myPlayer && Main.projectile[n].type >= 646 && Main.projectile[n].type <= 649)
					{
						num5++;
						if (Main.projectile[n].ai[0] == 2f)
						{
							flag2 = true;
						}
					}
				}
				if (num5 > 4 || (!flag2 && num5 > 3))
				{
					item = null;
				}
			}
			else
			{
				for (int num6 = 0; num6 < 1000; num6++)
				{
					if (Main.projectile[num6].active && Main.projectile[num6].owner == Main.myPlayer && Main.projectile[num6].type == item.shoot && Main.projectile[num6].ai[0] != 2f)
					{
						item = null;
						break;
					}
				}
			}
			if (item != null)
			{
				Main.PlaySound(item.UseSound, this.position);
				if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
				{
					NetMessage.SendData(51, -1, -1, null, this.whoAmI, 2f, 0f, 0f, 0, 0, 0);
				}
				int num7 = item.shoot;
				float shootSpeed = item.shootSpeed;
				int damage = item.damage;
				float knockBack = item.knockBack;
				if (num7 == 13 || num7 == 32 || num7 == 315 || (num7 >= 230 && num7 <= 235) || num7 == 331)
				{
					this.grappling[0] = -1;
					this.grapCount = 0;
					for (int num8 = 0; num8 < 1000; num8++)
					{
						if (Main.projectile[num8].active && Main.projectile[num8].owner == this.whoAmI)
						{
							if (Main.projectile[num8].type == 13)
							{
								Main.projectile[num8].Kill();
							}
							if (Main.projectile[num8].type == 331)
							{
								Main.projectile[num8].Kill();
							}
							if (Main.projectile[num8].type == 315)
							{
								Main.projectile[num8].Kill();
							}
							if (Main.projectile[num8].type >= 230 && Main.projectile[num8].type <= 235)
							{
								Main.projectile[num8].Kill();
							}
						}
					}
				}
				if (num7 == 256)
				{
					int num9 = 0;
					int num10 = -1;
					int num11 = 100000;
					for (int num12 = 0; num12 < 1000; num12++)
					{
						if (Main.projectile[num12].active && Main.projectile[num12].owner == this.whoAmI && Main.projectile[num12].type == 256)
						{
							num9++;
							if (Main.projectile[num12].timeLeft < num11)
							{
								num10 = num12;
								num11 = Main.projectile[num12].timeLeft;
							}
						}
					}
					if (num9 > 1)
					{
						Main.projectile[num10].Kill();
					}
				}
				if (num7 == 652)
				{
					int num13 = 0;
					int num14 = -1;
					int num15 = 100000;
					for (int num16 = 0; num16 < 1000; num16++)
					{
						if (Main.projectile[num16].active && Main.projectile[num16].owner == this.whoAmI && Main.projectile[num16].type == 652)
						{
							num13++;
							if (Main.projectile[num16].timeLeft < num15)
							{
								num14 = num16;
								num15 = Main.projectile[num16].timeLeft;
							}
						}
					}
					if (num13 > 1)
					{
						Main.projectile[num14].Kill();
					}
				}
				if (num7 == 73)
				{
					for (int num17 = 0; num17 < 1000; num17++)
					{
						if (Main.projectile[num17].active && Main.projectile[num17].owner == this.whoAmI && Main.projectile[num17].type == 73)
						{
							num7 = 74;
						}
					}
				}
				if (item.type == 3572)
				{
					int num18 = -1;
					int num19 = -1;
					for (int num20 = 0; num20 < 1000; num20++)
					{
						Projectile projectile = Main.projectile[num20];
						if (projectile.active && projectile.owner == this.whoAmI && projectile.type >= 646 && projectile.type <= 649 && (num19 == -1 || num19 < projectile.timeLeft))
						{
							num18 = projectile.type;
							num19 = projectile.timeLeft;
						}
					}
					if (num18 != -1)
					{
						switch (num18)
						{
							case 646:
								num7 = 647;
								goto IL_818;
							case 647:
								num7 = 648;
								goto IL_818;
							case 648:
								num7 = 649;
								goto IL_818;
							case 649:
								break;
							default:
								goto IL_818;
						}
					}
					num7 = 646;
				}
				IL_818:
				Vector2 vector = new Vector2(this.position.X + (float)this.width * 0.5f, this.position.Y + (float)this.height * 0.5f);
				float num21 = (float)Main.mouseX + Main.screenPosition.X - vector.X;
				float num22 = (float)Main.mouseY + Main.screenPosition.Y - vector.Y;
				if (this.gravDir == -1f)
				{
					num22 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector.Y;
				}
				float num23 = (float)Math.Sqrt((double)(num21 * num21 + num22 * num22));
				if ((float.IsNaN(num21) && float.IsNaN(num22)) || (num21 == 0f && num22 == 0f))
				{
					num21 = (float)this.direction;
					num22 = 0f;
					num23 = shootSpeed;
				}
				else
				{
					num23 = shootSpeed / num23;
				}
				num21 *= num23;
				num22 *= num23;
				Projectile.NewProjectile(vector.X, vector.Y, num21, num22, num7, damage, knockBack, this.whoAmI, 0f, 0f);
			}
		}

		// Token: 0x06000358 RID: 856 RVA: 0x002270F4 File Offset: 0x002252F4
		public void QuickHeal()
		{
			if (this.noItems)
			{
				return;
			}
			if (this.statLife == this.statLifeMax2 || this.potionDelay > 0)
			{
				return;
			}
			Item item = this.QuickHeal_GetItemToUse();
			if (item == null)
			{
				return;
			}
			Main.PlaySound(item.UseSound, this.position);
			if (item.potion)
			{
				if (item.type == 227)
				{
					this.potionDelay = this.restorationDelayTime;
					this.AddBuff(21, this.potionDelay, true);
				}
				else
				{
					this.potionDelay = this.potionDelayTime;
					this.AddBuff(21, this.potionDelay, true);
				}
			}
			this.statLife += item.healLife;
			this.statMana += item.healMana;
			if (this.statLife > this.statLifeMax2)
			{
				this.statLife = this.statLifeMax2;
			}
			if (this.statMana > this.statManaMax2)
			{
				this.statMana = this.statManaMax2;
			}
			if (item.healLife > 0 && Main.myPlayer == this.whoAmI)
			{
				this.HealEffect(item.healLife, true);
			}
			if (item.healMana > 0)
			{
				this.AddBuff(94, Player.manaSickTime, true);
				if (Main.myPlayer == this.whoAmI)
				{
					this.ManaEffect(item.healMana);
				}
			}
			item.stack--;
			if (item.stack <= 0)
			{
				item.TurnToAir();
			}
			Recipe.FindRecipes();
		}

		// Token: 0x06000359 RID: 857 RVA: 0x0022725C File Offset: 0x0022545C
		public Item QuickHeal_GetItemToUse()
		{
			int num = this.statLifeMax2 - this.statLife;
			Item result = null;
			int num2 = -this.statLifeMax2;
			for (int i = 0; i < 58; i++)
			{
				Item item = this.inventory[i];
				if (item.stack > 0 && item.type > 0 && item.potion && item.healLife > 0)
				{
					int num3 = item.healLife - num;
					if (num2 < 0)
					{
						if (num3 > num2)
						{
							result = item;
							num2 = num3;
						}
					}
					else if (num3 < num2 && num3 >= 0)
					{
						result = item;
						num2 = num3;
					}
				}
			}
			return result;
		}

		// Token: 0x0600035A RID: 858 RVA: 0x002272EC File Offset: 0x002254EC
		public void QuickMana()
		{
			if (this.noItems)
			{
				return;
			}
			if (this.statMana == this.statManaMax2)
			{
				return;
			}
			for (int i = 0; i < 58; i++)
			{
				if (this.inventory[i].stack > 0 && this.inventory[i].type > 0 && this.inventory[i].healMana > 0 && (this.potionDelay == 0 || !this.inventory[i].potion))
				{
					Main.PlaySound(this.inventory[i].UseSound, this.position);
					if (this.inventory[i].potion)
					{
						if (this.inventory[i].type == 227)
						{
							this.potionDelay = this.restorationDelayTime;
							this.AddBuff(21, this.potionDelay, true);
						}
						else
						{
							this.potionDelay = this.potionDelayTime;
							this.AddBuff(21, this.potionDelay, true);
						}
					}
					this.statLife += this.inventory[i].healLife;
					this.statMana += this.inventory[i].healMana;
					if (this.statLife > this.statLifeMax2)
					{
						this.statLife = this.statLifeMax2;
					}
					if (this.statMana > this.statManaMax2)
					{
						this.statMana = this.statManaMax2;
					}
					if (this.inventory[i].healLife > 0 && Main.myPlayer == this.whoAmI)
					{
						this.HealEffect(this.inventory[i].healLife, true);
					}
					if (this.inventory[i].healMana > 0)
					{
						this.AddBuff(94, Player.manaSickTime, true);
						if (Main.myPlayer == this.whoAmI)
						{
							this.ManaEffect(this.inventory[i].healMana);
						}
					}
					this.inventory[i].stack--;
					if (this.inventory[i].stack <= 0)
					{
						this.inventory[i].TurnToAir();
					}
					Recipe.FindRecipes();
					return;
				}
			}
		}

		// Token: 0x0600035B RID: 859 RVA: 0x002274FC File Offset: 0x002256FC
		public Item QuickMana_GetItemToUse()
		{
			for (int i = 0; i < 58; i++)
			{
				if (this.inventory[i].stack > 0 && this.inventory[i].type > 0 && this.inventory[i].healMana > 0 && (this.potionDelay == 0 || !this.inventory[i].potion))
				{
					return this.inventory[i];
				}
			}
			return null;
		}

		// Token: 0x0600035D RID: 861 RVA: 0x00227848 File Offset: 0x00225A48
		public void QuickMount()
		{
			if (this.mount.Active)
			{
				this.mount.Dismount(this);
				return;
			}
			if (this.frozen || this.tongued || this.webbed || this.stoned || this.gravDir == -1f)
			{
				return;
			}
			if (this.noItems)
			{
				return;
			}
			Item item = this.QuickMount_GetItemToUse();
			if (item != null && item.mountType != -1 && this.mount.CanMount(item.mountType, this))
			{
				bool flag = false;
				List<Point> tilesIn = Collision.GetTilesIn(base.TopLeft - new Vector2(24f), base.BottomRight + new Vector2(24f));
				if (tilesIn.Count > 0)
				{
					Point? point = null;
					Rectangle arg_CD_0 = base.Hitbox;
					for (int i = 0; i < tilesIn.Count; i++)
					{
						Point point2 = tilesIn[i];
						Tile tileSafely = Framing.GetTileSafely(point2.X, point2.Y);
						if (tileSafely.active() && tileSafely.type == 314)
						{
							Vector2 vector = tilesIn[i].ToVector2() * 16f + new Vector2(8f);
							if (!point.HasValue || (base.Distance(vector) < base.Distance(point.Value.ToVector2() * 16f + new Vector2(8f)) && Collision.CanHitLine(base.Center, 0, 0, vector, 0, 0)))
							{
								point = new Point?(tilesIn[i]);
							}
						}
					}
					if (point.HasValue)
					{
						this.LaunchMinecartHook(point.Value.X, point.Value.Y);
						flag = true;
					}
				}
				if (!flag)
				{
					this.mount.SetMount(item.mountType, this, false);
					if (item.UseSound != null)
					{
						Main.PlaySound(item.UseSound, base.Center);
						return;
					}
				}
			}
			else
			{
				int num = 0;
				int arg_2A4_0 = (int)(this.position.X / 16f) - Player.tileRangeX - num + 1;
				int num2 = (int)((this.position.X + (float)this.width) / 16f) + Player.tileRangeX + num - 1;
				int num3 = (int)(this.position.Y / 16f) - Player.tileRangeY - num + 1;
				int num4 = (int)((this.position.Y + (float)this.height) / 16f) + Player.tileRangeY + num - 2;
				float arg_2E2_0 = (float)Utils.Clamp<int>(arg_2A4_0, 10, Main.maxTilesX - 10);
				num2 = Utils.Clamp<int>(num2, 10, Main.maxTilesX - 10);
				num3 = Utils.Clamp<int>(num3, 10, Main.maxTilesY - 10);
				num4 = Utils.Clamp<int>(num4, 10, Main.maxTilesY - 10);
				List<Point> tilesIn2 = Collision.GetTilesIn(new Vector2(arg_2E2_0, (float)num3) * 16f, new Vector2((float)(num2 + 1), (float)(num4 + 1)) * 16f);
				if (tilesIn2.Count > 0)
				{
					Point? point3 = null;
					Rectangle arg_330_0 = base.Hitbox;
					for (int j = 0; j < tilesIn2.Count; j++)
					{
						Point point4 = tilesIn2[j];
						Tile tileSafely2 = Framing.GetTileSafely(point4.X, point4.Y);
						if (tileSafely2.active() && tileSafely2.type == 314)
						{
							Vector2 vector2 = tilesIn2[j].ToVector2() * 16f + new Vector2(8f);
							if (!point3.HasValue || (base.Distance(vector2) < base.Distance(point3.Value.ToVector2() * 16f + new Vector2(8f)) && Collision.CanHitLine(base.Center, 0, 0, vector2, 0, 0)))
							{
								point3 = new Point?(tilesIn2[j]);
							}
						}
					}
					if (point3.HasValue)
					{
						this.LaunchMinecartHook(point3.Value.X, point3.Value.Y);
					}
				}
			}
		}

		// Token: 0x0600035E RID: 862 RVA: 0x00227C90 File Offset: 0x00225E90
		public Item QuickMount_GetItemToUse()
		{
			Item item = null;
			if (item == null && this.miscEquips[3].mountType != -1 && !MountID.Sets.Cart[this.miscEquips[3].mountType])
			{
				item = this.miscEquips[3];
			}
			if (item == null)
			{
				for (int i = 0; i < 58; i++)
				{
					if (this.inventory[i].mountType != -1 && !MountID.Sets.Cart[this.inventory[i].mountType])
					{
						item = this.inventory[i];
						break;
					}
				}
			}
			return item;
		}

		// Token: 0x06000366 RID: 870 RVA: 0x0022A264 File Offset: 0x00228464
		public void QuickSpawnItem(int item, int stack = 1)
		{
			int number = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, item, stack, false, -1, false, false);
			if (Main.netMode == 1)
			{
				NetMessage.SendData(21, -1, -1, null, number, 1f, 0f, 0f, 0, 0, 0);
			}
		}

		// Token: 0x0600039F RID: 927 RVA: 0x0024CF88 File Offset: 0x0024B188
		public void QuickStackAllChests()
		{
			if (this.IsStackingItems())
			{
				return;
			}
			if (Main.netMode == 1)
			{
				for (int i = 10; i < 50; i++)
				{
					if (this.inventory[i].type > 0 && this.inventory[i].stack > 0 && !this.inventory[i].favorited && (this.inventory[i].type < 71 || this.inventory[i].type > 74))
					{
						NetMessage.SendData(5, -1, -1, null, this.whoAmI, (float)i, (float)this.inventory[i].prefix, 0f, 0, 0, 0);
						NetMessage.SendData(85, -1, -1, null, i, 0f, 0f, 0f, 0, 0, 0);
						this.inventoryChestStack[i] = true;
					}
				}
				return;
			}
			bool flag = false;
			for (int j = 10; j < 50; j++)
			{
				if (this.inventory[j].type > 0 && this.inventory[j].stack > 0 && !this.inventory[j].favorited)
				{
					int type = this.inventory[j].type;
					int stack = this.inventory[j].stack;
					this.inventory[j] = Chest.PutItemInNearbyChest(this.inventory[j], base.Center);
					if (this.inventory[j].type != type || this.inventory[j].stack != stack)
					{
						flag = true;
					}
				}
			}
			if (flag)
			{
				Main.PlaySound(7, -1, -1, 1, 1f, 0f);
			}
		}

		// Token: 0x06000405 RID: 1029 RVA: 0x00281C98 File Offset: 0x0027FE98
		public void RemoveSpawn()
		{
			this.SpawnX = -1;
			this.SpawnY = -1;
			int num = 0;
			while (num < 200 && this.spN[num] != null)
			{
				if (this.spN[num] == Main.worldName && this.spI[num] == Main.worldID)
				{
					for (int i = num; i < 199; i++)
					{
						this.spN[i] = this.spN[i + 1];
						this.spI[i] = this.spI[i + 1];
						this.spX[i] = this.spX[i + 1];
						this.spY[i] = this.spY[i + 1];
					}
					this.spN[199] = null;
					this.spI[199] = 0;
					this.spX[199] = 0;
					this.spY[199] = 0;
					return;
				}
				num++;
			}
		}

		// Token: 0x06000389 RID: 905 RVA: 0x00243888 File Offset: 0x00241A88
		public void ResetEffects()
		{
			if (this.extraAccessory && (Main.expertMode || Main.gameMenu))
			{
				this.extraAccessorySlots = 1;
			}
			else
			{
				this.extraAccessorySlots = 0;
			}
			this.arcticDivingGear = false;
			this.noBuilding = false;
			this.strongBees = false;
			this.armorPenetration = 0;
			this.shroomiteStealth = false;
			this.statDefense = 0;
			this.accWatch = 0;
			this.accCompass = 0;
			this.accDepthMeter = 0;
			this.accDivingHelm = false;
			this.lifeRegen = 0;
			this.manaCost = 1f;
			this.meleeSpeed = 1f;
			this.meleeDamage = 1f;
			this.rangedDamage = 1f;
			this.thrownDamage = 1f;
			this.magicDamage = 1f;
			this.minionDamage = 1f;
			this.meleeCrit = 4;
			this.rangedCrit = 4;
			this.magicCrit = 4;
			this.thrownCrit = 4;
			this.thrownVelocity = 1f;
			this.minionKB = 0f;
			this.moveSpeed = 1f;
			this.boneArmor = false;
			this.honey = false;
			this.frostArmor = false;
			this.rocketBoots = 0;
			this.fireWalk = false;
			this.noKnockback = false;
			this.jumpBoost = false;
			this.noFallDmg = false;
			this.accFlipper = false;
			this.spawnMax = false;
			this.spaceGun = false;
			this.killGuide = false;
			this.killClothier = false;
			this.lavaImmune = false;
			this.gills = false;
			this.slowFall = false;
			this.findTreasure = false;
			this.invis = false;
			this.nightVision = false;
			this.enemySpawns = false;
			this.thorns = 0f;
			this.aggro = 0;
			this.waterWalk = false;
			this.waterWalk2 = false;
			this.detectCreature = false;
			this.gravControl = false;
			this.bee = false;
			this.gravControl2 = false;
			this.statLifeMax2 = this.statLifeMax;
			this.statManaMax2 = this.statManaMax;
			this.ammoCost80 = false;
			this.ammoCost75 = false;
			this.thrownCost50 = false;
			this.thrownCost33 = false;
			this.manaRegenBuff = false;
			this.arrowDamage = 1f;
			this.bulletDamage = 1f;
			this.rocketDamage = 1f;
			this.yoraiz0rEye = 0;
			this.yoraiz0rDarkness = false;
			this.leinforsHair = false;
			this.suspiciouslookingTentacle = false;
			this.crimsonHeart = false;
			this.lightOrb = false;
			this.blueFairy = false;
			this.redFairy = false;
			this.greenFairy = false;
			this.wisp = false;
			this.bunny = false;
			this.turtle = false;
			this.eater = false;
			this.skeletron = false;
			this.hornet = false;
			this.zephyrfish = false;
			this.tiki = false;
			this.lizard = false;
			this.parrot = false;
			this.sapling = false;
			this.cSapling = false;
			this.truffle = false;
			this.yoyoGlove = false;
			this.counterWeight = 0;
			this.stringColor = 0;
			this.yoyoString = false;
			this.shadowDodge = false;
			this.palladiumRegen = false;
			this.chaosState = false;
			this.onHitDodge = false;
			this.onHitRegen = false;
			this.onHitPetal = false;
			this.iceBarrier = false;
			this.maxMinions = 1;
			this.maxTurrets = 1;
			this.ammoBox = false;
			this.ammoPotion = false;
			this.penguin = false;
			this.sporeSac = false;
			this.shinyStone = false;
			this.dd2Accessory = false;
			this.magicLantern = false;
			this.rabid = false;
			this.sunflower = false;
			this.wellFed = false;
			this.inferno = false;
			this.manaMagnet = false;
			this.lifeMagnet = false;
			this.lifeForce = false;
			this.dangerSense = false;
			this.endurance = 0f;
			this.calmed = false;
			this.beetleOrbs = 0;
			this.beetleBuff = false;
			this.miniMinotaur = false;
			this.goldRing = false;
			this.solarShields = 0;
			this.GoingDownWithGrapple = false;
			this.fishingSkill = 0;
			this.cratePotion = false;
			this.sonarPotion = false;
			this.accTackleBox = false;
			this.accFishingLine = false;
			this.accFishFinder = false;
			this.accWeatherRadio = false;
			this.accThirdEye = false;
			this.InfoAccMechShowWires = false;
			this.accJarOfSouls = false;
			this.accCalendar = false;
			this.accStopwatch = false;
			this.accOreFinder = false;
			this.accCritterGuide = false;
			this.accDreamCatcher = false;
			this.wallSpeed = 1f;
			this.tileSpeed = 1f;
			this.autoPaint = false;
			this.autoActuator = false;
			this.petFlagDD2Gato = false;
			this.petFlagDD2Dragon = false;
			this.petFlagDD2Ghost = false;
			this.companionCube = false;
			this.babyFaceMonster = false;
			this.manaSick = false;
			this.puppy = false;
			this.grinch = false;
			this.blackCat = false;
			this.spider = false;
			this.squashling = false;
			this.magicCuffs = false;
			this.coldDash = false;
			this.sailDash = false;
			this.cordage = false;
			this.magicQuiver = false;
			this.magmaStone = false;
			this.hasRaisableShield = false;
			this.lavaRose = false;
			this.eyeSpring = false;
			this.snowman = false;
			this.scope = false;
			this.panic = false;
			this.brainOfConfusion = false;
			this.dino = false;
			this.crystalLeaf = false;
			this.pygmy = false;
			this.raven = false;
			this.slime = false;
			this.hornetMinion = false;
			this.impMinion = false;
			this.twinsMinion = false;
			this.spiderMinion = false;
			this.pirateMinion = false;
			this.sharknadoMinion = false;
			this.stardustMinion = false;
			this.stardustGuardian = false;
			this.stardustDragon = false;
			this.UFOMinion = false;
			this.DeadlySphereMinion = false;
			this.chilled = false;
			this.dazed = false;
			this.frozen = false;
			this.stoned = false;
			this.webbed = false;
			this.ichor = false;
			this.manaRegenBonus = 0;
			this.manaRegenDelayBonus = 0;
			this.carpet = false;
			this.iceSkate = false;
			this.dash = 0;
			this.spikedBoots = 0;
			this.blackBelt = false;
			this.lavaMax = 0;
			this.archery = false;
			this.poisoned = false;
			this.venom = false;
			this.blind = false;
			this.blackout = false;
			this.onFire = false;
			this.dripping = false;
			this.drippingSlime = false;
			this.burned = false;
			this.suffocating = false;
			this.onFire2 = false;
			this.onFrostBurn = false;
			this.frostBurn = false;
			this.noItems = false;
			this.blockRange = 0;
			this.pickSpeed = 1f;
			this.wereWolf = false;
			this.rulerGrid = false;
			this.rulerLine = false;
			this.bleed = false;
			this.confused = false;
			this.witheredArmor = false;
			this.witheredWeapon = false;
			this.parryDamageBuff = false;
			this.slowOgreSpit = false;
			this.wings = 0;
			this.wingsLogic = 0;
			this.wingTimeMax = 0;
			this.brokenArmor = false;
			this.silence = false;
			this.slow = false;
			this.gross = false;
			this.tongued = false;
			this.kbGlove = false;
			this.kbBuff = false;
			this.starCloak = false;
			this.longInvince = false;
			this.pStone = false;
			this.manaFlower = false;
			this.crimsonRegen = false;
			this.ghostHeal = false;
			this.ghostHurt = false;
			this.turtleArmor = false;
			this.turtleThorns = false;
			this.spiderArmor = false;
			this.loveStruck = false;
			this.stinky = false;
			this.dryadWard = false;
			this.resistCold = false;
			this.electrified = false;
			this.moonLeech = false;
			this.headcovered = false;
			this.vortexDebuff = false;
			this.windPushed = false;
			this.ballistaPanic = false;
			this.setVortex = (this.setNebula = (this.setStardust = false));
			this.setForbidden = false;
			this.setHuntressT3 = false;
			this.setSquireT3 = false;
			this.setMonkT3 = false;
			this.setApprenticeT3 = false;
			this.setHuntressT2 = false;
			this.setSquireT2 = false;
			this.setMonkT2 = false;
			this.setApprenticeT2 = false;
			this.setForbiddenCooldownLocked = false;
			this.nebulaLevelDamage = (this.nebulaLevelLife = (this.nebulaLevelMana = 0));
			this.ignoreWater = false;
			this.meleeEnchant = 0;
			this.discount = false;
			this.coins = false;
			this.doubleJumpSail = false;
			this.doubleJumpSandstorm = false;
			this.doubleJumpBlizzard = false;
			this.doubleJumpFart = false;
			this.doubleJumpUnicorn = false;
			this.defendedByPaladin = false;
			this.hasPaladinShield = false;
			this.autoJump = false;
			this.justJumped = false;
			this.jumpSpeedBoost = 0f;
			this.extraFall = 0;
			if (this.phantasmTime > 0)
			{
				this.phantasmTime--;
			}
			if (this.wireOperationsCooldown > 0)
			{
				this.wireOperationsCooldown--;
			}
			if (this.releaseUseItem)
			{
				this.ActuationRodLock = false;
			}
			for (int i = 0; i < this.npcTypeNoAggro.Length; i++)
			{
				this.npcTypeNoAggro[i] = false;
			}
			for (int j = 0; j < this.ownedProjectileCounts.Length; j++)
			{
				this.ownedProjectileCounts[j] = 0;
			}
			if (this.whoAmI == Main.myPlayer)
			{
				Player.tileRangeX = 5;
				Player.tileRangeY = 4;
			}
			this.mount.CheckMountBuff(this);
		}

		// Token: 0x0600030E RID: 782 RVA: 0x00225D54 File Offset: 0x00223F54
		public Vector2 RotatedRelativePoint(Vector2 pos, bool rotateForward = true)
		{
			Vector2 value = this.position + this.fullRotationOrigin;
			Matrix matrix = Matrix.CreateRotationZ(this.fullRotation * (float)rotateForward.ToInt());
			pos -= this.position + this.fullRotationOrigin;
			pos = Vector2.Transform(pos, matrix);
			return pos + value;
		}

		// Token: 0x0600030D RID: 781 RVA: 0x00225D24 File Offset: 0x00223F24
		public void RotateRelativePoint(ref float x, ref float y)
		{
			Vector2 vector = this.RotatedRelativePoint(new Vector2(x, y), true);
			x = vector.X;
			y = vector.Y;
		}

		// Token: 0x06000407 RID: 1031 RVA: 0x00281EF8 File Offset: 0x002800F8
		public static void SavePlayer(PlayerFileData playerFile, bool skipMapSave = false)
		{
			Main.Achievements.Save();
			string path = playerFile.Path;
			Player player = playerFile.Player;
			bool isCloudSave = playerFile.IsCloudSave;
			if (!skipMapSave && !string.IsNullOrEmpty(Main.playerPathName))
			{
				try
				{
					if (Main.mapEnabled)
					{
						Main.Map.Save();
					}
				}
				catch
				{
				}
				try
				{
					if (!isCloudSave)
					{
						Directory.CreateDirectory(Main.PlayerPath);
					}
				}
				catch
				{
				}
			}
			if (Main.ServerSideCharacter)
			{
				return;
			}
			if (path == null || path == "")
			{
				return;
			}
			if (FileUtilities.Exists(path, isCloudSave))
			{
				FileUtilities.Copy(path, path + ".bak", isCloudSave, true);
			}
			RijndaelManaged rijndaelManaged = new RijndaelManaged();
			using (Stream stream = isCloudSave ? (Stream)new MemoryStream(2000) : new FileStream(path, FileMode.Create))
			{
				using (CryptoStream cryptoStream = new CryptoStream(stream, rijndaelManaged.CreateEncryptor(Player.ENCRYPTION_KEY, Player.ENCRYPTION_KEY), CryptoStreamMode.Write))
				{
					using (BinaryWriter binaryWriter = new BinaryWriter(cryptoStream))
					{
						binaryWriter.Write(194);
						playerFile.Metadata.Write(binaryWriter);
						binaryWriter.Write(player.name);
						binaryWriter.Write(player.difficulty);
						binaryWriter.Write(playerFile.GetPlayTime().Ticks);
						binaryWriter.Write(player.hair);
						binaryWriter.Write(player.hairDye);
						BitsByte bb = 0;
						for (int i = 0; i < 8; i++)
						{
							bb[i] = player.hideVisual[i];
						}
						binaryWriter.Write(bb);
						bb = 0;
						for (int j = 0; j < 2; j++)
						{
							bb[j] = player.hideVisual[j + 8];
						}
						binaryWriter.Write(bb);
						binaryWriter.Write(player.hideMisc);
						binaryWriter.Write((byte)player.skinVariant);
						binaryWriter.Write(player.statLife);
						binaryWriter.Write(player.statLifeMax);
						binaryWriter.Write(player.statMana);
						binaryWriter.Write(player.statManaMax);
						binaryWriter.Write(player.extraAccessory);
						binaryWriter.Write(player.downedDD2EventAnyDifficulty);
						binaryWriter.Write(player.taxMoney);
						binaryWriter.Write(player.hairColor.R);
						binaryWriter.Write(player.hairColor.G);
						binaryWriter.Write(player.hairColor.B);
						binaryWriter.Write(player.skinColor.R);
						binaryWriter.Write(player.skinColor.G);
						binaryWriter.Write(player.skinColor.B);
						binaryWriter.Write(player.eyeColor.R);
						binaryWriter.Write(player.eyeColor.G);
						binaryWriter.Write(player.eyeColor.B);
						binaryWriter.Write(player.shirtColor.R);
						binaryWriter.Write(player.shirtColor.G);
						binaryWriter.Write(player.shirtColor.B);
						binaryWriter.Write(player.underShirtColor.R);
						binaryWriter.Write(player.underShirtColor.G);
						binaryWriter.Write(player.underShirtColor.B);
						binaryWriter.Write(player.pantsColor.R);
						binaryWriter.Write(player.pantsColor.G);
						binaryWriter.Write(player.pantsColor.B);
						binaryWriter.Write(player.shoeColor.R);
						binaryWriter.Write(player.shoeColor.G);
						binaryWriter.Write(player.shoeColor.B);
						for (int k = 0; k < player.armor.Length; k++)
						{
							binaryWriter.Write(player.armor[k].netID);
							binaryWriter.Write(player.armor[k].prefix);
						}
						for (int l = 0; l < player.dye.Length; l++)
						{
							binaryWriter.Write(player.dye[l].netID);
							binaryWriter.Write(player.dye[l].prefix);
						}
						for (int m = 0; m < 58; m++)
						{
							binaryWriter.Write(player.inventory[m].netID);
							binaryWriter.Write(player.inventory[m].stack);
							binaryWriter.Write(player.inventory[m].prefix);
							binaryWriter.Write(player.inventory[m].favorited);
						}
						for (int n = 0; n < player.miscEquips.Length; n++)
						{
							binaryWriter.Write(player.miscEquips[n].netID);
							binaryWriter.Write(player.miscEquips[n].prefix);
							binaryWriter.Write(player.miscDyes[n].netID);
							binaryWriter.Write(player.miscDyes[n].prefix);
						}
						for (int num = 0; num < 40; num++)
						{
							binaryWriter.Write(player.bank.item[num].netID);
							binaryWriter.Write(player.bank.item[num].stack);
							binaryWriter.Write(player.bank.item[num].prefix);
						}
						for (int num2 = 0; num2 < 40; num2++)
						{
							binaryWriter.Write(player.bank2.item[num2].netID);
							binaryWriter.Write(player.bank2.item[num2].stack);
							binaryWriter.Write(player.bank2.item[num2].prefix);
						}
						for (int num3 = 0; num3 < 40; num3++)
						{
							binaryWriter.Write(player.bank3.item[num3].netID);
							binaryWriter.Write(player.bank3.item[num3].stack);
							binaryWriter.Write(player.bank3.item[num3].prefix);
						}
						for (int num4 = 0; num4 < 22; num4++)
						{
							if (Main.buffNoSave[player.buffType[num4]])
							{
								binaryWriter.Write(0);
								binaryWriter.Write(0);
							}
							else
							{
								binaryWriter.Write(player.buffType[num4]);
								binaryWriter.Write(player.buffTime[num4]);
							}
						}
						for (int num5 = 0; num5 < 200; num5++)
						{
							if (player.spN[num5] == null)
							{
								binaryWriter.Write(-1);
								break;
							}
							binaryWriter.Write(player.spX[num5]);
							binaryWriter.Write(player.spY[num5]);
							binaryWriter.Write(player.spI[num5]);
							binaryWriter.Write(player.spN[num5]);
						}
						binaryWriter.Write(player.hbLocked);
						for (int num6 = 0; num6 < player.hideInfo.Length; num6++)
						{
							binaryWriter.Write(player.hideInfo[num6]);
						}
						binaryWriter.Write(player.anglerQuestsFinished);
						for (int num7 = 0; num7 < player.DpadRadial.Bindings.Length; num7++)
						{
							binaryWriter.Write(player.DpadRadial.Bindings[num7]);
						}
						for (int num8 = 0; num8 < player.builderAccStatus.Length; num8++)
						{
							binaryWriter.Write(player.builderAccStatus[num8]);
						}
						binaryWriter.Write(player.bartenderQuestLog);
						binaryWriter.Flush();
						cryptoStream.FlushFinalBlock();
						stream.Flush();
						if (isCloudSave && SocialAPI.Cloud != null)
						{
							SocialAPI.Cloud.Write(playerFile.Path, ((MemoryStream)stream).ToArray());
						}
					}
				}
			}
		}

		// Token: 0x060003B5 RID: 949 RVA: 0x00259C5C File Offset: 0x00257E5C
		public void ScrollHotbar(int Offset)
		{
			while (Offset > 9)
			{
				Offset -= 10;
			}
			while (Offset < 0)
			{
				Offset += 10;
			}
			this.selectedItem += Offset;
			if (Offset != 0)
			{
				Main.PlaySound(12, -1, -1, 1, 1f, 0f);
				int num = this.selectedItem - Offset;
				this.DpadRadial.ChangeSelection(-1);
				this.CircularRadial.ChangeSelection(-1);
				this.selectedItem = num + Offset;
				this.nonTorch = -1;
			}
			if (this.changeItem >= 0)
			{
				if (this.selectedItem != this.changeItem)
				{
					Main.PlaySound(12, -1, -1, 1, 1f, 0f);
				}
				this.selectedItem = this.changeItem;
				this.changeItem = -1;
			}
			if (this.itemAnimation == 0 && this.selectedItem != 58)
			{
				while (this.selectedItem > 9)
				{
					this.selectedItem -= 10;
				}
				while (this.selectedItem < 0)
				{
					this.selectedItem += 10;
				}
			}
		}

		// Token: 0x060003C2 RID: 962 RVA: 0x0025F13C File Offset: 0x0025D33C
		public bool SellItem(int price, int stack)
		{
			if (price <= 0)
			{
				return false;
			}
			Item[] array = new Item[58];
			for (int i = 0; i < 58; i++)
			{
				array[i] = new Item();
				array[i] = this.inventory[i].Clone();
			}
			int j = price / 5;
			if (j < 1)
			{
				j = 1;
			}
			j *= stack;
			bool flag = false;
			while (j >= 1000000)
			{
				if (flag)
				{
					break;
				}
				int num = -1;
				for (int k = 53; k >= 0; k--)
				{
					if (num == -1 && (this.inventory[k].type == 0 || this.inventory[k].stack == 0))
					{
						num = k;
					}
					while (this.inventory[k].type == 74 && this.inventory[k].stack < this.inventory[k].maxStack && j >= 1000000)
					{
						this.inventory[k].stack++;
						j -= 1000000;
						this.DoCoins(k);
						if (this.inventory[k].stack == 0 && num == -1)
						{
							num = k;
						}
					}
				}
				if (j >= 1000000)
				{
					if (num == -1)
					{
						flag = true;
					}
					else
					{
						this.inventory[num].SetDefaults(74, false);
						j -= 1000000;
					}
				}
			}
			while (j >= 10000)
			{
				if (flag)
				{
					break;
				}
				int num2 = -1;
				for (int l = 53; l >= 0; l--)
				{
					if (num2 == -1 && (this.inventory[l].type == 0 || this.inventory[l].stack == 0))
					{
						num2 = l;
					}
					while (this.inventory[l].type == 73 && this.inventory[l].stack < this.inventory[l].maxStack && j >= 10000)
					{
						this.inventory[l].stack++;
						j -= 10000;
						this.DoCoins(l);
						if (this.inventory[l].stack == 0 && num2 == -1)
						{
							num2 = l;
						}
					}
				}
				if (j >= 10000)
				{
					if (num2 == -1)
					{
						flag = true;
					}
					else
					{
						this.inventory[num2].SetDefaults(73, false);
						j -= 10000;
					}
				}
			}
			while (j >= 100)
			{
				if (flag)
				{
					break;
				}
				int num3 = -1;
				for (int m = 53; m >= 0; m--)
				{
					if (num3 == -1 && (this.inventory[m].type == 0 || this.inventory[m].stack == 0))
					{
						num3 = m;
					}
					while (this.inventory[m].type == 72 && this.inventory[m].stack < this.inventory[m].maxStack && j >= 100)
					{
						this.inventory[m].stack++;
						j -= 100;
						this.DoCoins(m);
						if (this.inventory[m].stack == 0 && num3 == -1)
						{
							num3 = m;
						}
					}
				}
				if (j >= 100)
				{
					if (num3 == -1)
					{
						flag = true;
					}
					else
					{
						this.inventory[num3].SetDefaults(72, false);
						j -= 100;
					}
				}
			}
			while (j >= 1 && !flag)
			{
				int num4 = -1;
				for (int n = 53; n >= 0; n--)
				{
					if (num4 == -1 && (this.inventory[n].type == 0 || this.inventory[n].stack == 0))
					{
						num4 = n;
					}
					while (this.inventory[n].type == 71 && this.inventory[n].stack < this.inventory[n].maxStack && j >= 1)
					{
						this.inventory[n].stack++;
						j--;
						this.DoCoins(n);
						if (this.inventory[n].stack == 0 && num4 == -1)
						{
							num4 = n;
						}
					}
				}
				if (j >= 1)
				{
					if (num4 == -1)
					{
						flag = true;
					}
					else
					{
						this.inventory[num4].SetDefaults(71, false);
						j--;
					}
				}
			}
			if (flag)
			{
				for (int num5 = 0; num5 < 58; num5++)
				{
					this.inventory[num5] = array[num5].Clone();
				}
				return false;
			}
			return true;
		}

		// Token: 0x060003C8 RID: 968 RVA: 0x00263260 File Offset: 0x00261460
		public void SetArmorEffectVisuals(Player drawPlayer)
		{
			if (drawPlayer.head == 111 && drawPlayer.body == 73 && drawPlayer.legs == 62)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.head == 134 && drawPlayer.body == 95 && drawPlayer.legs == 79)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.head == 107 && drawPlayer.body == 69 && drawPlayer.legs == 58)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 108 && drawPlayer.body == 70 && drawPlayer.legs == 59)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 109 && drawPlayer.body == 71 && drawPlayer.legs == 60)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 110 && drawPlayer.body == 72 && drawPlayer.legs == 61)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 193 && drawPlayer.body == 194 && drawPlayer.legs == 134)
			{
				this.armorEffectDrawShadowSubtle = true;
				this.armorEffectDrawShadowLokis = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.mount.Active && drawPlayer.mount.Type == 3 && drawPlayer.velocity.Y != 0f && !drawPlayer.SlimeDontHyperJump)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.mount.Active && drawPlayer.mount.Type == 10 && Math.Abs(drawPlayer.velocity.X) > drawPlayer.mount.DashSpeed - drawPlayer.mount.RunSpeed / 2f)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.mount.Active && drawPlayer.mount.Type == 14 && Math.Abs(drawPlayer.velocity.X) > drawPlayer.mount.RunSpeed / 2f)
			{
				this.armorEffectDrawShadowBasilisk = true;
			}
			if (drawPlayer.body == 67 && drawPlayer.legs == 56 && drawPlayer.head >= 103 && drawPlayer.head <= 105)
			{
				this.armorEffectDrawShadow = true;
			}
			if ((drawPlayer.head == 78 || drawPlayer.head == 79 || drawPlayer.head == 80) && drawPlayer.body == 51 && drawPlayer.legs == 47)
			{
				this.armorEffectDrawShadowSubtle = true;
			}
			if (drawPlayer.head == 200 && drawPlayer.body == 198 && drawPlayer.legs == 142)
			{
				this.armorEffectDrawShadowLokis = true;
				this.armorEffectDrawOutlinesForbidden = true;
			}
			if (drawPlayer.head == 171 && drawPlayer.body == 177 && drawPlayer.legs == 112)
			{
				this.armorEffectDrawShadow = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.head == 169 && drawPlayer.body == 175 && drawPlayer.legs == 110)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 170 && drawPlayer.body == 176 && drawPlayer.legs == 111)
			{
				this.armorEffectDrawShadowLokis = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.body == 209 && drawPlayer.legs == 159)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.eocDash > 0)
			{
				this.armorEffectDrawShadowEOCShield = true;
			}
			else if (drawPlayer.dashDelay < 0)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 5 && drawPlayer.body == 5 && drawPlayer.legs == 5)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 74 && drawPlayer.body == 48 && drawPlayer.legs == 44)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 76 && drawPlayer.body == 49 && drawPlayer.legs == 45)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 7 && drawPlayer.body == 7 && drawPlayer.legs == 7)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 22 && drawPlayer.body == 14 && drawPlayer.legs == 14)
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.dye[0].dye == 30 && drawPlayer.dye[1].dye == 30 && drawPlayer.dye[2].dye == 30 && drawPlayer.head == 4 && drawPlayer.body == 27 && drawPlayer.legs == 26)
			{
				this.armorEffectDrawShadow = true;
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.head == 189 && drawPlayer.body == 190 && drawPlayer.legs == 130)
			{
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.body == 17 && drawPlayer.legs == 16 && (drawPlayer.head == 29 || drawPlayer.head == 30 || drawPlayer.head == 31))
			{
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.body == 19 && drawPlayer.legs == 18 && (drawPlayer.head == 35 || drawPlayer.head == 36 || drawPlayer.head == 37))
			{
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.body == 24 && drawPlayer.legs == 23 && (drawPlayer.head == 41 || drawPlayer.head == 42 || drawPlayer.head == 43))
			{
				this.armorEffectDrawOutlines = true;
				this.armorEffectDrawShadow = true;
			}
			if (drawPlayer.head == 157 && drawPlayer.legs == 98 && drawPlayer.body != 105)
			{
				int arg_5A5_0 = drawPlayer.body;
			}
			if (drawPlayer.body == 36 && drawPlayer.head == 56)
			{
				this.armorEffectDrawOutlines = true;
			}
			if (drawPlayer.stoned || drawPlayer.stealth != 1f)
			{
				this.armorEffectDrawOutlines = false;
				this.armorEffectDrawShadow = false;
				this.armorEffectDrawShadowSubtle = false;
			}
		}

		// Token: 0x060003C9 RID: 969 RVA: 0x00263858 File Offset: 0x00261A58
		public static int SetMatch(int armorslot, int type, bool male, ref bool somethingSpecial)
		{
			int num = -1;
			if (armorslot == 0 && type == 201)
			{
				num = (male ? 201 : 202);
			}
			if (armorslot == 1)
			{
				if (type <= 42)
				{
					if (type <= 36)
					{
						if (type != 15)
						{
							if (type == 36)
							{
								num = 89;
							}
						}
						else
						{
							num = 88;
						}
					}
					else if (type != 41)
					{
						if (type == 42)
						{
							num = 90;
						}
					}
					else
					{
						num = 97;
					}
				}
				else if (type <= 77)
				{
					switch (type)
					{
						case 58:
							num = 91;
							break;
						case 59:
							num = 92;
							break;
						case 60:
							num = 93;
							break;
						case 61:
							num = 94;
							break;
						case 62:
							num = 95;
							break;
						case 63:
							num = 96;
							break;
						default:
							if (type == 77)
							{
								num = 121;
							}
							break;
					}
				}
				else
				{
					switch (type)
					{
						case 165:
							if (male)
							{
								num = 118;
							}
							else
							{
								num = 99;
							}
							break;
						case 166:
							if (male)
							{
								num = 119;
							}
							else
							{
								num = 100;
							}
							break;
						case 167:
							if (!male)
							{
								num = 102;
							}
							else
							{
								num = 101;
							}
							break;
						default:
							switch (type)
							{
								case 180:
									num = 115;
									break;
								case 181:
									num = 116;
									break;
								case 182:
									break;
								case 183:
									num = (male ? 136 : 123);
									break;
								default:
									if (type == 191)
									{
										num = 131;
									}
									break;
							}
							break;
					}
				}
				if (num != -1)
				{
					somethingSpecial = true;
				}
			}
			if (armorslot == 2)
			{
				if (type <= 84)
				{
					if (type != 57)
					{
						if (type != 83)
						{
							if (type == 84)
							{
								if (male)
								{
									num = 120;
								}
							}
						}
						else if (male)
						{
							num = 117;
						}
					}
					else if (male)
					{
						num = 137;
					}
				}
				else if (type <= 146)
				{
					if (type != 132)
					{
						if (type == 146)
						{
							num = (male ? 146 : 147);
						}
					}
					else if (male)
					{
						num = 135;
					}
				}
				else if (type != 154)
				{
					if (type == 158)
					{
						if (male)
						{
							num = 157;
						}
					}
				}
				else
				{
					num = (male ? 155 : 154);
				}
			}
			return num;
		}

		// Token: 0x060003CC RID: 972 RVA: 0x002640A4 File Offset: 0x002622A4
		public void ShadowDodge()
		{
			this.immune = true;
			this.immuneTime = 80;
			if (this.longInvince)
			{
				this.immuneTime += 40;
			}
			for (int i = 0; i < this.hurtCooldowns.Length; i++)
			{
				this.hurtCooldowns[i] = this.immuneTime;
			}
			if (this.whoAmI == Main.myPlayer)
			{
				for (int j = 0; j < 22; j++)
				{
					if (this.buffTime[j] > 0 && this.buffType[j] == 59)
					{
						this.DelBuff(j);
					}
				}
				NetMessage.SendData(62, -1, -1, null, this.whoAmI, 2f, 0f, 0f, 0, 0, 0);
			}
		}

		// Token: 0x060003D9 RID: 985 RVA: 0x0026B210 File Offset: 0x00269410
		private void ShootFromCannon(int x, int y)
		{
			int num = 0;
			if (Main.tile[x, y].frameX < 72)
			{
				if (this.inventory[this.selectedItem].type == 929)
				{
					num = 1;
				}
			}
			else if (Main.tile[x, y].frameX < 144)
			{
				if (this.inventory[this.selectedItem].type == 1338)
				{
					num = 2;
				}
			}
			else if (Main.tile[x, y].frameX < 288 && this.inventory[this.selectedItem].type == 1345)
			{
				num = 3;
			}
			if (num > 0)
			{
				this.showItemIcon = true;
				if (this.itemTime == 0 && this.itemAnimation > 0 && this.controlUseItem)
				{
					int i = (int)(Main.tile[x, y].frameX / 18);
					int num2 = 0;
					int num3 = 0;
					while (i >= 4)
					{
						num2++;
						i -= 4;
					}
					i = x - i;
					int j;
					for (j = (int)(Main.tile[x, y].frameY / 18); j >= 3; j -= 3)
					{
						num3++;
					}
					j = y - j;
					this.itemTime = this.inventory[this.selectedItem].useTime;
					WorldGen.ShootFromCannon(i, j, num3, num, this.inventory[this.selectedItem].damage, 8f, Main.myPlayer);
				}
			}
		}

		// Token: 0x060003A2 RID: 930 RVA: 0x0024D5B8 File Offset: 0x0024B7B8
		public void SlopeDownMovement()
		{
			this.sloping = false;
			float y = this.velocity.Y;
			Vector4 vector = Collision.WalkDownSlope(this.position, this.velocity, this.width, this.height, this.gravity * this.gravDir);
			this.position.X = vector.X;
			this.position.Y = vector.Y;
			this.velocity.X = vector.Z;
			this.velocity.Y = vector.W;
			if (this.velocity.Y != y)
			{
				this.sloping = true;
			}
		}

		// Token: 0x060003A6 RID: 934 RVA: 0x0024DC14 File Offset: 0x0024BE14
		public void SlopingCollision(bool fallThrough)
		{
			if (this.controlDown || this.grappling[0] >= 0 || this.gravDir == -1f)
			{
				this.stairFall = true;
			}
			Vector4 vector = Collision.SlopeCollision(this.position, this.velocity, this.width, this.height, this.gravity, this.stairFall);
			if (Collision.stairFall)
			{
				this.stairFall = true;
			}
			else if (!fallThrough)
			{
				this.stairFall = false;
			}
			if (Collision.stair && Math.Abs(vector.Y - this.position.Y) > 8f + Math.Abs(this.velocity.X))
			{
				this.gfxOffY -= vector.Y - this.position.Y;
				this.stepSpeed = 4f;
			}
			Vector2 arg_D1_0 = this.velocity;
			this.position.X = vector.X;
			this.position.Y = vector.Y;
			this.velocity.X = vector.Z;
			this.velocity.Y = vector.W;
			if (this.gravDir == -1f && this.velocity.Y == 0.0101f)
			{
				this.velocity.Y = 0f;
			}
		}

		// Token: 0x06000383 RID: 899 RVA: 0x0023BAF0 File Offset: 0x00239CF0
		public void SmartCursorLookup()
		{
			if (this.whoAmI != Main.myPlayer)
			{
				return;
			}
			Main.SmartCursorShowing = false;
			if (!Main.SmartCursorEnabled)
			{
				return;
			}
			Item item = this.inventory[this.selectedItem];
			Vector2 vector = Main.screenPosition + new Vector2((float)Main.mouseX, (float)Main.mouseY);
			if (this.gravDir == -1f)
			{
				vector.Y = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY;
			}
			int num = Player.tileTargetX;
			int num2 = Player.tileTargetY;
			if (num < 10)
			{
				num = 10;
			}
			if (num > Main.maxTilesX - 10)
			{
				num = Main.maxTilesX - 10;
			}
			if (num2 < 10)
			{
				num2 = 10;
			}
			if (num2 > Main.maxTilesY - 10)
			{
				num2 = Main.maxTilesY - 10;
			}
			bool flag = false;
			if (Main.tile[num, num2] == null)
			{
				return;
			}
			if (Main.tile[num, num2].active())
			{
				ushort type = Main.tile[num, num2].type;
				if (type <= 144)
				{
					if (type <= 79)
					{
						if (type <= 21)
						{
							if (type <= 11)
							{
								if (type != 4 && type - 10 > 1)
								{
									goto IL_337;
								}
							}
							else if (type != 13 && type != 21)
							{
								goto IL_337;
							}
						}
						else if (type <= 33)
						{
							if (type != 29 && type != 33)
							{
								goto IL_337;
							}
						}
						else if (type - 49 > 1 && type != 55 && type != 79)
						{
							goto IL_337;
						}
					}
					else if (type <= 104)
					{
						if (type <= 88)
						{
							if (type != 85 && type != 88)
							{
								goto IL_337;
							}
						}
						else if (type != 97 && type != 104)
						{
							goto IL_337;
						}
					}
					else if (type <= 132)
					{
						if (type != 125 && type != 132)
						{
							goto IL_337;
						}
					}
					else if (type != 136 && type != 139 && type != 144)
					{
						goto IL_337;
					}
				}
				else if (type <= 314)
				{
					if (type <= 212)
					{
						if (type <= 207)
						{
							if (type != 174 && type != 207)
							{
								goto IL_337;
							}
						}
						else if (type != 209 && type != 212)
						{
							goto IL_337;
						}
					}
					else if (type <= 219)
					{
						if (type != 216 && type != 219)
						{
							goto IL_337;
						}
					}
					else if (type != 237 && type != 287)
					{
						if (type != 314)
						{
							goto IL_337;
						}
						if (this.gravDir == 1f)
						{
							flag = true;
							goto IL_337;
						}
						goto IL_337;
					}
				}
				else if (type <= 389)
				{
					if (type <= 338)
					{
						if (type - 334 > 1 && type != 338)
						{
							goto IL_337;
						}
					}
					else if (type != 354 && type - 386 > 3)
					{
						goto IL_337;
					}
				}
				else if (type <= 425)
				{
					if (type != 411 && type != 425)
					{
						goto IL_337;
					}
				}
				else if (type != 441 && type != 463 && type - 467 > 1)
				{
					goto IL_337;
				}
				flag = true;
			}
			IL_337:
			int tileBoost = item.tileBoost;
			int num3 = 0;
			if (item.type == 1071 || item.type == 1543 || item.type == 1072 || item.type == 1544)
			{
				for (int i = 0; i < 58; i++)
				{
					if (this.inventory[i].stack > 0 && this.inventory[i].paint > 0)
					{
						num3 = (int)this.inventory[i].paint;
						break;
					}
				}
			}
			int num4 = (int)(this.position.X / 16f) - Player.tileRangeX - tileBoost + 1;
			int num5 = (int)((this.position.X + (float)this.width) / 16f) + Player.tileRangeX + tileBoost - 1;
			int num6 = (int)(this.position.Y / 16f) - Player.tileRangeY - tileBoost + 1;
			int num7 = (int)((this.position.Y + (float)this.height) / 16f) + Player.tileRangeY + tileBoost - 2;
			num4 = Utils.Clamp<int>(num4, 10, Main.maxTilesX - 10);
			num5 = Utils.Clamp<int>(num5, 10, Main.maxTilesX - 10);
			num6 = Utils.Clamp<int>(num6, 10, Main.maxTilesY - 10);
			num7 = Utils.Clamp<int>(num7, 10, Main.maxTilesY - 10);
			if (flag && num >= num4 && num <= num5 && num2 >= num6 && num2 <= num7)
			{
				return;
			}
			List<Tuple<int, int>> list = new List<Tuple<int, int>>();
			for (int j = 0; j < this.grapCount; j++)
			{
				Projectile expr_4C7 = Main.projectile[this.grappling[j]];
				int item2 = (int)expr_4C7.Center.X / 16;
				int item3 = (int)expr_4C7.Center.Y / 16;
				list.Add(new Tuple<int, int>(item2, item3));
			}
			int num8 = -1;
			int num9 = -1;
			if (!Player.SmartCursorSettings.SmartAxeAfterPickaxe)
			{
				Player.SmartCursor_Axe(item, ref vector, num4, num5, num6, num7, ref num8, ref num9);
			}
			if (item.pick > 0 && num8 == -1 && num9 == -1)
			{
				if (PlayerInput.UsingGamepad)
				{
					Vector2 arg_56E_0 = PlayerInput.Triggers.Current.GetNavigatorDirections();
					Vector2 gamepadThumbstickLeft = PlayerInput.GamepadThumbstickLeft;
					Vector2 gamepadThumbstickRight = PlayerInput.GamepadThumbstickRight;
					if (arg_56E_0 == Vector2.Zero && gamepadThumbstickLeft.Length() < 0.05f && gamepadThumbstickRight.Length() < 0.05f)
					{
						vector = base.Center + new Vector2((float)(this.direction * 1000), 0f);
					}
				}
				Vector2 vector2 = vector - base.Center;
				int num10 = Math.Sign(vector2.X);
				int num11 = Math.Sign(vector2.Y);
				if (Math.Abs(vector2.X) > Math.Abs(vector2.Y) * 3f)
				{
					num11 = 0;
					vector.Y = base.Center.Y;
				}
				if (Math.Abs(vector2.Y) > Math.Abs(vector2.X) * 3f)
				{
					num10 = 0;
					vector.X = base.Center.X;
				}
				int arg_657_0 = (int)base.Center.X / 16;
				int arg_667_0 = (int)base.Center.Y / 16;
				List<Tuple<int, int>> list2 = new List<Tuple<int, int>>();
				List<Tuple<int, int>> list3 = new List<Tuple<int, int>>();
				int num12 = 1;
				if (num11 == -1 && num10 != 0)
				{
					num12 = -1;
				}
				int num13 = (int)((this.position.X + (float)(this.width / 2) + (float)((this.width / 2 - 1) * num10)) / 16f);
				int num14 = (int)(((double)this.position.Y + 0.1) / 16.0);
				if (num12 == -1)
				{
					num14 = (int)((this.position.Y + (float)this.height - 1f) / 16f);
				}
				int num15 = this.width / 16 + ((this.width % 16 == 0) ? 0 : 1);
				int num16 = this.height / 16 + ((this.height % 16 == 0) ? 0 : 1);
				if (num10 != 0)
				{
					for (int k = 0; k < num16; k++)
					{
						if (Main.tile[num13, num14 + k * num12] == null)
						{
							return;
						}
						list2.Add(new Tuple<int, int>(num13, num14 + k * num12));
					}
				}
				if (num11 != 0)
				{
					for (int l = 0; l < num15; l++)
					{
						if (Main.tile[(int)(this.position.X / 16f) + l, num14] == null)
						{
							return;
						}
						list2.Add(new Tuple<int, int>((int)(this.position.X / 16f) + l, num14));
					}
				}
				int num17 = (int)((vector.X + (float)((this.width / 2 - 1) * num10)) / 16f);
				int num18 = (int)(((double)vector.Y + 0.1 - (double)(this.height / 2 + 1)) / 16.0);
				if (num12 == -1)
				{
					num18 = (int)((vector.Y + (float)(this.height / 2) - 1f) / 16f);
				}
				if (this.gravDir == -1f && num11 == 0)
				{
					num18++;
				}
				if (num18 < 10)
				{
					num18 = 10;
				}
				if (num18 > Main.maxTilesY - 10)
				{
					num18 = Main.maxTilesY - 10;
				}
				int num19 = this.width / 16 + ((this.width % 16 == 0) ? 0 : 1);
				int num20 = this.height / 16 + ((this.height % 16 == 0) ? 0 : 1);
				if (num10 != 0)
				{
					for (int m = 0; m < num20; m++)
					{
						if (Main.tile[num17, num18 + m * num12] == null)
						{
							return;
						}
						list3.Add(new Tuple<int, int>(num17, num18 + m * num12));
					}
				}
				if (num11 != 0)
				{
					for (int n = 0; n < num19; n++)
					{
						if (Main.tile[(int)((vector.X - (float)(this.width / 2)) / 16f) + n, num18] == null)
						{
							return;
						}
						list3.Add(new Tuple<int, int>((int)((vector.X - (float)(this.width / 2)) / 16f) + n, num18));
					}
				}
				List<Tuple<int, int>> list4 = new List<Tuple<int, int>>();
				while (list2.Count > 0)
				{
					Tuple<int, int> tuple = list2[0];
					Tuple<int, int> tuple2 = list3[0];
					Tuple<int, int> tuple3;
					if (!Collision.TupleHitLine(tuple.Item1, tuple.Item2, tuple2.Item1, tuple2.Item2, num10 * (int)this.gravDir, -num11 * (int)this.gravDir, list, out tuple3))
					{
						list2.Remove(tuple);
						list3.Remove(tuple2);
					}
					else
					{
						if (tuple3.Item1 != tuple2.Item1 || tuple3.Item2 != tuple2.Item2)
						{
							list4.Add(tuple3);
						}
						Tile tile = Main.tile[tuple3.Item1, tuple3.Item2];
						if (!tile.inActive() && tile.active() && Main.tileSolid[(int)tile.type] && !Main.tileSolidTop[(int)tile.type] && !list.Contains(tuple3))
						{
							list4.Add(tuple3);
						}
						list2.Remove(tuple);
						list3.Remove(tuple2);
					}
				}
				List<Tuple<int, int>> list5 = new List<Tuple<int, int>>();
				for (int num21 = 0; num21 < list4.Count; num21++)
				{
					if (!WorldGen.CanKillTile(list4[num21].Item1, list4[num21].Item2))
					{
						list5.Add(list4[num21]);
					}
				}
				for (int num22 = 0; num22 < list5.Count; num22++)
				{
					list4.Remove(list5[num22]);
				}
				list5.Clear();
				if (list4.Count > 0)
				{
					float num23 = -1f;
					Tuple<int, int> tuple4 = list4[0];
					for (int num24 = 0; num24 < list4.Count; num24++)
					{
						float num25 = Vector2.Distance(new Vector2((float)list4[num24].Item1, (float)list4[num24].Item2) * 16f + Vector2.One * 8f, base.Center);
						if (num23 == -1f || num25 < num23)
						{
							num23 = num25;
							tuple4 = list4[num24];
						}
					}
					if (Collision.InTileBounds(tuple4.Item1, tuple4.Item2, num4, num6, num5, num7))
					{
						num8 = tuple4.Item1;
						num9 = tuple4.Item2;
					}
				}
				list2.Clear();
				list3.Clear();
				list4.Clear();
			}
			if (Player.SmartCursorSettings.SmartAxeAfterPickaxe)
			{
				Player.SmartCursor_Axe(item, ref vector, num4, num5, num6, num7, ref num8, ref num9);
			}
			if ((item.type == 509 || item.type == 850 || item.type == 851 || item.type == 3612) && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list6 = new List<Tuple<int, int>>();
				int num26 = 0;
				if (item.type == 509)
				{
					num26 = 1;
				}
				if (item.type == 850)
				{
					num26 = 2;
				}
				if (item.type == 851)
				{
					num26 = 3;
				}
				if (item.type == 3612)
				{
					num26 = 4;
				}
				bool flag2 = false;
				if (Main.tile[num, num2].wire() && num26 == 1)
				{
					flag2 = true;
				}
				if (Main.tile[num, num2].wire2() && num26 == 2)
				{
					flag2 = true;
				}
				if (Main.tile[num, num2].wire3() && num26 == 3)
				{
					flag2 = true;
				}
				if (Main.tile[num, num2].wire4() && num26 == 4)
				{
					flag2 = true;
				}
				if (!flag2)
				{
					for (int num27 = num4; num27 <= num5; num27++)
					{
						for (int num28 = num6; num28 <= num7; num28++)
						{
							Tile tile2 = Main.tile[num27, num28];
							if ((tile2.wire() && num26 == 1) || (tile2.wire2() && num26 == 2) || (tile2.wire3() && num26 == 3) || (tile2.wire4() && num26 == 4))
							{
								if (num26 == 1)
								{
									if (!Main.tile[num27 - 1, num28].wire())
									{
										list6.Add(new Tuple<int, int>(num27 - 1, num28));
									}
									if (!Main.tile[num27 + 1, num28].wire())
									{
										list6.Add(new Tuple<int, int>(num27 + 1, num28));
									}
									if (!Main.tile[num27, num28 - 1].wire())
									{
										list6.Add(new Tuple<int, int>(num27, num28 - 1));
									}
									if (!Main.tile[num27, num28 + 1].wire())
									{
										list6.Add(new Tuple<int, int>(num27, num28 + 1));
									}
								}
								if (num26 == 2)
								{
									if (!Main.tile[num27 - 1, num28].wire2())
									{
										list6.Add(new Tuple<int, int>(num27 - 1, num28));
									}
									if (!Main.tile[num27 + 1, num28].wire2())
									{
										list6.Add(new Tuple<int, int>(num27 + 1, num28));
									}
									if (!Main.tile[num27, num28 - 1].wire2())
									{
										list6.Add(new Tuple<int, int>(num27, num28 - 1));
									}
									if (!Main.tile[num27, num28 + 1].wire2())
									{
										list6.Add(new Tuple<int, int>(num27, num28 + 1));
									}
								}
								if (num26 == 3)
								{
									if (!Main.tile[num27 - 1, num28].wire3())
									{
										list6.Add(new Tuple<int, int>(num27 - 1, num28));
									}
									if (!Main.tile[num27 + 1, num28].wire3())
									{
										list6.Add(new Tuple<int, int>(num27 + 1, num28));
									}
									if (!Main.tile[num27, num28 - 1].wire3())
									{
										list6.Add(new Tuple<int, int>(num27, num28 - 1));
									}
									if (!Main.tile[num27, num28 + 1].wire3())
									{
										list6.Add(new Tuple<int, int>(num27, num28 + 1));
									}
								}
								if (num26 == 4)
								{
									if (!Main.tile[num27 - 1, num28].wire4())
									{
										list6.Add(new Tuple<int, int>(num27 - 1, num28));
									}
									if (!Main.tile[num27 + 1, num28].wire4())
									{
										list6.Add(new Tuple<int, int>(num27 + 1, num28));
									}
									if (!Main.tile[num27, num28 - 1].wire4())
									{
										list6.Add(new Tuple<int, int>(num27, num28 - 1));
									}
									if (!Main.tile[num27, num28 + 1].wire4())
									{
										list6.Add(new Tuple<int, int>(num27, num28 + 1));
									}
								}
							}
						}
					}
				}
				if (list6.Count > 0)
				{
					float num29 = -1f;
					Tuple<int, int> tuple5 = list6[0];
					for (int num30 = 0; num30 < list6.Count; num30++)
					{
						float num31 = Vector2.Distance(new Vector2((float)list6[num30].Item1, (float)list6[num30].Item2) * 16f + Vector2.One * 8f, vector);
						if (num29 == -1f || num31 < num29)
						{
							num29 = num31;
							tuple5 = list6[num30];
						}
					}
					if (Collision.InTileBounds(tuple5.Item1, tuple5.Item2, num4, num6, num5, num7))
					{
						num8 = tuple5.Item1;
						num9 = tuple5.Item2;
					}
				}
				list6.Clear();
			}
			if (item.type == 3625 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list7 = new List<Tuple<int, int>>();
				WiresUI.Settings.MultiToolMode multiToolMode = WiresUI.Settings.ToolMode;
				WiresUI.Settings.MultiToolMode multiToolMode2 = (WiresUI.Settings.MultiToolMode)0;
				if (Main.tile[num, num2].wire())
				{
					multiToolMode2 |= WiresUI.Settings.MultiToolMode.Red;
				}
				if (Main.tile[num, num2].wire2())
				{
					multiToolMode2 |= WiresUI.Settings.MultiToolMode.Blue;
				}
				if (Main.tile[num, num2].wire3())
				{
					multiToolMode2 |= WiresUI.Settings.MultiToolMode.Green;
				}
				if (Main.tile[num, num2].wire4())
				{
					multiToolMode2 |= WiresUI.Settings.MultiToolMode.Yellow;
				}
				multiToolMode &= ~WiresUI.Settings.MultiToolMode.Cutter;
				bool arg_119A_0 = multiToolMode == multiToolMode2;
				multiToolMode = WiresUI.Settings.ToolMode;
				if (!arg_119A_0)
				{
					bool flag3 = multiToolMode.HasFlag(WiresUI.Settings.MultiToolMode.Red);
					bool flag4 = multiToolMode.HasFlag(WiresUI.Settings.MultiToolMode.Blue);
					bool flag5 = multiToolMode.HasFlag(WiresUI.Settings.MultiToolMode.Green);
					bool flag6 = multiToolMode.HasFlag(WiresUI.Settings.MultiToolMode.Yellow);
					bool flag7 = multiToolMode.HasFlag(WiresUI.Settings.MultiToolMode.Cutter);
					for (int num32 = num4; num32 <= num5; num32++)
					{
						for (int num33 = num6; num33 <= num7; num33++)
						{
							Tile tile3 = Main.tile[num32, num33];
							if (flag7)
							{
								if ((tile3.wire() & flag3) || (tile3.wire2() & flag4) || (tile3.wire3() & flag5) || (tile3.wire4() & flag6))
								{
									list7.Add(new Tuple<int, int>(num32, num33));
								}
							}
							else if ((tile3.wire() & flag3) || (tile3.wire2() & flag4) || (tile3.wire3() & flag5) || (tile3.wire4() & flag6))
							{
								if (flag3)
								{
									if (!Main.tile[num32 - 1, num33].wire())
									{
										list7.Add(new Tuple<int, int>(num32 - 1, num33));
									}
									if (!Main.tile[num32 + 1, num33].wire())
									{
										list7.Add(new Tuple<int, int>(num32 + 1, num33));
									}
									if (!Main.tile[num32, num33 - 1].wire())
									{
										list7.Add(new Tuple<int, int>(num32, num33 - 1));
									}
									if (!Main.tile[num32, num33 + 1].wire())
									{
										list7.Add(new Tuple<int, int>(num32, num33 + 1));
									}
								}
								if (flag4)
								{
									if (!Main.tile[num32 - 1, num33].wire2())
									{
										list7.Add(new Tuple<int, int>(num32 - 1, num33));
									}
									if (!Main.tile[num32 + 1, num33].wire2())
									{
										list7.Add(new Tuple<int, int>(num32 + 1, num33));
									}
									if (!Main.tile[num32, num33 - 1].wire2())
									{
										list7.Add(new Tuple<int, int>(num32, num33 - 1));
									}
									if (!Main.tile[num32, num33 + 1].wire2())
									{
										list7.Add(new Tuple<int, int>(num32, num33 + 1));
									}
								}
								if (flag5)
								{
									if (!Main.tile[num32 - 1, num33].wire3())
									{
										list7.Add(new Tuple<int, int>(num32 - 1, num33));
									}
									if (!Main.tile[num32 + 1, num33].wire3())
									{
										list7.Add(new Tuple<int, int>(num32 + 1, num33));
									}
									if (!Main.tile[num32, num33 - 1].wire3())
									{
										list7.Add(new Tuple<int, int>(num32, num33 - 1));
									}
									if (!Main.tile[num32, num33 + 1].wire3())
									{
										list7.Add(new Tuple<int, int>(num32, num33 + 1));
									}
								}
								if (flag6)
								{
									if (!Main.tile[num32 - 1, num33].wire4())
									{
										list7.Add(new Tuple<int, int>(num32 - 1, num33));
									}
									if (!Main.tile[num32 + 1, num33].wire4())
									{
										list7.Add(new Tuple<int, int>(num32 + 1, num33));
									}
									if (!Main.tile[num32, num33 - 1].wire4())
									{
										list7.Add(new Tuple<int, int>(num32, num33 - 1));
									}
									if (!Main.tile[num32, num33 + 1].wire4())
									{
										list7.Add(new Tuple<int, int>(num32, num33 + 1));
									}
								}
							}
						}
					}
				}
				if (list7.Count > 0)
				{
					float num34 = -1f;
					Tuple<int, int> tuple6 = list7[0];
					for (int num35 = 0; num35 < list7.Count; num35++)
					{
						float num36 = Vector2.Distance(new Vector2((float)list7[num35].Item1, (float)list7[num35].Item2) * 16f + Vector2.One * 8f, vector);
						if (num34 == -1f || num36 < num34)
						{
							num34 = num36;
							tuple6 = list7[num35];
						}
					}
					if (Collision.InTileBounds(tuple6.Item1, tuple6.Item2, num4, num6, num5, num7))
					{
						num8 = tuple6.Item1;
						num9 = tuple6.Item2;
					}
				}
				list7.Clear();
			}
			if (item.hammer > 0 && num8 == -1 && num9 == -1)
			{
				Vector2 vector3 = vector - base.Center;
				int num37 = Math.Sign(vector3.X);
				int num38 = Math.Sign(vector3.Y);
				if (Math.Abs(vector3.X) > Math.Abs(vector3.Y) * 3f)
				{
					num38 = 0;
					vector.Y = base.Center.Y;
				}
				if (Math.Abs(vector3.Y) > Math.Abs(vector3.X) * 3f)
				{
					num37 = 0;
					vector.X = base.Center.X;
				}
				int arg_16FF_0 = (int)base.Center.X / 16;
				int arg_170F_0 = (int)base.Center.Y / 16;
				List<Tuple<int, int>> list8 = new List<Tuple<int, int>>();
				List<Tuple<int, int>> list9 = new List<Tuple<int, int>>();
				int num39 = 1;
				if (num38 == -1 && num37 != 0)
				{
					num39 = -1;
				}
				int num40 = (int)((this.position.X + (float)(this.width / 2) + (float)((this.width / 2 - 1) * num37)) / 16f);
				int num41 = (int)(((double)this.position.Y + 0.1) / 16.0);
				if (num39 == -1)
				{
					num41 = (int)((this.position.Y + (float)this.height - 1f) / 16f);
				}
				int num42 = this.width / 16 + ((this.width % 16 == 0) ? 0 : 1);
				int num43 = this.height / 16 + ((this.height % 16 == 0) ? 0 : 1);
				if (num37 != 0)
				{
					for (int num44 = 0; num44 < num43; num44++)
					{
						if (Main.tile[num40, num41 + num44 * num39] == null)
						{
							return;
						}
						list8.Add(new Tuple<int, int>(num40, num41 + num44 * num39));
					}
				}
				if (num38 != 0)
				{
					for (int num45 = 0; num45 < num42; num45++)
					{
						if (Main.tile[(int)(this.position.X / 16f) + num45, num41] == null)
						{
							return;
						}
						list8.Add(new Tuple<int, int>((int)(this.position.X / 16f) + num45, num41));
					}
				}
				int num46 = (int)((vector.X + (float)((this.width / 2 - 1) * num37)) / 16f);
				int num47 = (int)(((double)vector.Y + 0.1 - (double)(this.height / 2 + 1)) / 16.0);
				if (num39 == -1)
				{
					num47 = (int)((vector.Y + (float)(this.height / 2) - 1f) / 16f);
				}
				if (this.gravDir == -1f && num38 == 0)
				{
					num47++;
				}
				if (num47 < 10)
				{
					num47 = 10;
				}
				if (num47 > Main.maxTilesY - 10)
				{
					num47 = Main.maxTilesY - 10;
				}
				int num48 = this.width / 16 + ((this.width % 16 == 0) ? 0 : 1);
				int num49 = this.height / 16 + ((this.height % 16 == 0) ? 0 : 1);
				if (num37 != 0)
				{
					for (int num50 = 0; num50 < num49; num50++)
					{
						if (Main.tile[num46, num47 + num50 * num39] == null)
						{
							return;
						}
						list9.Add(new Tuple<int, int>(num46, num47 + num50 * num39));
					}
				}
				if (num38 != 0)
				{
					for (int num51 = 0; num51 < num48; num51++)
					{
						if (Main.tile[(int)((vector.X - (float)(this.width / 2)) / 16f) + num51, num47] == null)
						{
							return;
						}
						list9.Add(new Tuple<int, int>((int)((vector.X - (float)(this.width / 2)) / 16f) + num51, num47));
					}
				}
				List<Tuple<int, int>> list10 = new List<Tuple<int, int>>();
				while (list8.Count > 0)
				{
					Tuple<int, int> tuple7 = list8[0];
					Tuple<int, int> tuple8 = list9[0];
					Tuple<int, int> tuple9 = Collision.TupleHitLineWall(tuple7.Item1, tuple7.Item2, tuple8.Item1, tuple8.Item2);
					if (tuple9.Item1 == -1 || tuple9.Item2 == -1)
					{
						list8.Remove(tuple7);
						list9.Remove(tuple8);
					}
					else
					{
						if (tuple9.Item1 != tuple8.Item1 || tuple9.Item2 != tuple8.Item2)
						{
							list10.Add(tuple9);
						}
						//TODO: 看看这是做什么的   //						Main.tile[tuple9.Item1, tuple9.Item2];
						if (Collision.HitWallSubstep(tuple9.Item1, tuple9.Item2))
						{
							list10.Add(tuple9);
						}
						list8.Remove(tuple7);
						list9.Remove(tuple8);
					}
				}
				if (list10.Count > 0)
				{
					float num52 = -1f;
					Tuple<int, int> tuple10 = list10[0];
					for (int num53 = 0; num53 < list10.Count; num53++)
					{
						float num54 = Vector2.Distance(new Vector2((float)list10[num53].Item1, (float)list10[num53].Item2) * 16f + Vector2.One * 8f, base.Center);
						if (num52 == -1f || num54 < num52)
						{
							num52 = num54;
							tuple10 = list10[num53];
						}
					}
					if (Collision.InTileBounds(tuple10.Item1, tuple10.Item2, num4, num6, num5, num7))
					{
						this.poundRelease = false;
						num8 = tuple10.Item1;
						num9 = tuple10.Item2;
					}
				}
				list10.Clear();
				list8.Clear();
				list9.Clear();
			}
			if (item.hammer > 0 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list11 = new List<Tuple<int, int>>();
				for (int num55 = num4; num55 <= num5; num55++)
				{
					for (int num56 = num6; num56 <= num7; num56++)
					{
						if (Main.tile[num55, num56].wall > 0 && Collision.HitWallSubstep(num55, num56))
						{
							list11.Add(new Tuple<int, int>(num55, num56));
						}
					}
				}
				if (list11.Count > 0)
				{
					float num57 = -1f;
					Tuple<int, int> tuple11 = list11[0];
					for (int num58 = 0; num58 < list11.Count; num58++)
					{
						float num59 = Vector2.Distance(new Vector2((float)list11[num58].Item1, (float)list11[num58].Item2) * 16f + Vector2.One * 8f, vector);
						if (num57 == -1f || num59 < num57)
						{
							num57 = num59;
							tuple11 = list11[num58];
						}
					}
					if (Collision.InTileBounds(tuple11.Item1, tuple11.Item2, num4, num6, num5, num7))
					{
						this.poundRelease = false;
						num8 = tuple11.Item1;
						num9 = tuple11.Item2;
					}
				}
				list11.Clear();
			}
			if (item.type == 3620 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list12 = new List<Tuple<int, int>>();
				for (int num60 = num4; num60 <= num5; num60++)
				{
					for (int num61 = num6; num61 <= num7; num61++)
					{
						Tile tile4 = Main.tile[num60, num61];
						if (tile4.active() && tile4.actuator() && (!this.ActuationRodLock || this.ActuationRodLockSetting == tile4.inActive()))
						{
							list12.Add(new Tuple<int, int>(num60, num61));
						}
					}
				}
				if (list12.Count > 0)
				{
					float num62 = -1f;
					Tuple<int, int> tuple12 = list12[0];
					for (int num63 = 0; num63 < list12.Count; num63++)
					{
						float num64 = Vector2.Distance(new Vector2((float)list12[num63].Item1, (float)list12[num63].Item2) * 16f + Vector2.One * 8f, vector);
						if (num62 == -1f || num64 < num62)
						{
							num62 = num64;
							tuple12 = list12[num63];
						}
					}
					if (Collision.InTileBounds(tuple12.Item1, tuple12.Item2, num4, num6, num5, num7))
					{
						num8 = tuple12.Item1;
						num9 = tuple12.Item2;
					}
				}
				list12.Clear();
			}
			if (item.type == 510 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list13 = new List<Tuple<int, int>>();
				for (int num65 = num4; num65 <= num5; num65++)
				{
					for (int num66 = num6; num66 <= num7; num66++)
					{
						Tile tile5 = Main.tile[num65, num66];
						if (tile5.wire() || tile5.wire2() || tile5.wire3() || tile5.wire4() || tile5.actuator())
						{
							list13.Add(new Tuple<int, int>(num65, num66));
						}
					}
				}
				if (list13.Count > 0)
				{
					float num67 = -1f;
					Tuple<int, int> tuple13 = list13[0];
					for (int num68 = 0; num68 < list13.Count; num68++)
					{
						float num69 = Vector2.Distance(new Vector2((float)list13[num68].Item1, (float)list13[num68].Item2) * 16f + Vector2.One * 8f, vector);
						if (num67 == -1f || num69 < num67)
						{
							num67 = num69;
							tuple13 = list13[num68];
						}
					}
					if (Collision.InTileBounds(tuple13.Item1, tuple13.Item2, num4, num6, num5, num7))
					{
						num8 = tuple13.Item1;
						num9 = tuple13.Item2;
					}
				}
				list13.Clear();
			}
			if (item.createTile >= 0 && TileID.Sets.Platforms[item.createTile] && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list14 = new List<Tuple<int, int>>();
				bool flag8 = false;
				if (Main.tile[num, num2].active() && TileID.Sets.Platforms[(int)Main.tile[num, num2].type])
				{
					flag8 = true;
				}
				if (!flag8)
				{
					for (int num70 = num4; num70 <= num5; num70++)
					{
						for (int num71 = num6; num71 <= num7; num71++)
						{
							Tile tile6 = Main.tile[num70, num71];
							if (tile6.active() && TileID.Sets.Platforms[(int)tile6.type])
							{
								byte expr_20A4 = tile6.slope();
								if (expr_20A4 != 2 && !Main.tile[num70 - 1, num71 - 1].active())
								{
									list14.Add(new Tuple<int, int>(num70 - 1, num71 - 1));
								}
								if (!Main.tile[num70 - 1, num71].active())
								{
									list14.Add(new Tuple<int, int>(num70 - 1, num71));
								}
								if (expr_20A4 != 1 && !Main.tile[num70 - 1, num71 + 1].active())
								{
									list14.Add(new Tuple<int, int>(num70 - 1, num71 + 1));
								}
								if (expr_20A4 != 1 && !Main.tile[num70 + 1, num71 - 1].active())
								{
									list14.Add(new Tuple<int, int>(num70 + 1, num71 - 1));
								}
								if (!Main.tile[num70 + 1, num71].active())
								{
									list14.Add(new Tuple<int, int>(num70 + 1, num71));
								}
								if (expr_20A4 != 2 && !Main.tile[num70 + 1, num71 + 1].active())
								{
									list14.Add(new Tuple<int, int>(num70 + 1, num71 + 1));
								}
							}
							if (!tile6.active())
							{
								int num72 = 0;
								int num73 = 1;
								Tile tile7 = Main.tile[num70 + num72, num71 + num73];
								if (tile7.active() && Main.tileSolid[(int)tile7.type] && !Main.tileSolidTop[(int)tile7.type])
								{
									list14.Add(new Tuple<int, int>(num70, num71));
								}
								num72 = -1;
								num73 = 0;
								tile7 = Main.tile[num70 + num72, num71 + num73];
								if (tile7.active() && Main.tileSolid[(int)tile7.type] && !Main.tileSolidTop[(int)tile7.type])
								{
									list14.Add(new Tuple<int, int>(num70, num71));
								}
								num72 = 1;
								num73 = 0;
								tile7 = Main.tile[num70 + num72, num71 + num73];
								if (tile7.active() && Main.tileSolid[(int)tile7.type] && !Main.tileSolidTop[(int)tile7.type])
								{
									list14.Add(new Tuple<int, int>(num70, num71));
								}
							}
						}
					}
				}
				if (list14.Count > 0)
				{
					float num74 = -1f;
					Tuple<int, int> tuple14 = list14[0];
					for (int num75 = 0; num75 < list14.Count; num75++)
					{
						float num76 = Vector2.Distance(new Vector2((float)list14[num75].Item1, (float)list14[num75].Item2) * 16f + Vector2.One * 8f, vector);
						if (num74 == -1f || num76 < num74)
						{
							num74 = num76;
							tuple14 = list14[num75];
						}
					}
					if (Collision.InTileBounds(tuple14.Item1, tuple14.Item2, num4, num6, num5, num7))
					{
						num8 = tuple14.Item1;
						num9 = tuple14.Item2;
					}
				}
				list14.Clear();
			}
			if ((item.type == 2340 || item.type == 2739) && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list15 = new List<Tuple<int, int>>();
				bool flag9 = false;
				if (Main.tile[num, num2].active() && Main.tile[num, num2].type == 314)
				{
					flag9 = true;
				}
				if (!flag9)
				{
					for (int num77 = num4; num77 <= num5; num77++)
					{
						for (int num78 = num6; num78 <= num7; num78++)
						{
							Tile tile8 = Main.tile[num77, num78];
							if (tile8.active() && tile8.type == 314)
							{
								bool flag10 = Main.tile[num77 + 1, num78 + 1].active() && Main.tile[num77 + 1, num78 + 1].type == 314;
								bool flag11 = Main.tile[num77 + 1, num78 - 1].active() && Main.tile[num77 + 1, num78 - 1].type == 314;
								bool flag12 = Main.tile[num77 - 1, num78 + 1].active() && Main.tile[num77 - 1, num78 + 1].type == 314;
								bool flag13 = Main.tile[num77 - 1, num78 - 1].active() && Main.tile[num77 - 1, num78 - 1].type == 314;
								if ((!Main.tile[num77 - 1, num78 - 1].active() || Main.tileCut[(int)Main.tile[num77 - 1, num78 - 1].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 - 1, num78 - 1].type]) && !(!flag10 & flag11))
								{
									list15.Add(new Tuple<int, int>(num77 - 1, num78 - 1));
								}
								if (!Main.tile[num77 - 1, num78].active() || Main.tileCut[(int)Main.tile[num77 - 1, num78].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 - 1, num78].type])
								{
									list15.Add(new Tuple<int, int>(num77 - 1, num78));
								}
								if ((!Main.tile[num77 - 1, num78 + 1].active() || Main.tileCut[(int)Main.tile[num77 - 1, num78 + 1].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 - 1, num78 + 1].type]) && !(!flag11 & flag10))
								{
									list15.Add(new Tuple<int, int>(num77 - 1, num78 + 1));
								}
								if ((!Main.tile[num77 + 1, num78 - 1].active() || Main.tileCut[(int)Main.tile[num77 + 1, num78 - 1].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 + 1, num78 - 1].type]) && !(!flag12 & flag13))
								{
									list15.Add(new Tuple<int, int>(num77 + 1, num78 - 1));
								}
								if (!Main.tile[num77 + 1, num78].active() || Main.tileCut[(int)Main.tile[num77 + 1, num78].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 + 1, num78].type])
								{
									list15.Add(new Tuple<int, int>(num77 + 1, num78));
								}
								if ((!Main.tile[num77 + 1, num78 + 1].active() || Main.tileCut[(int)Main.tile[num77 + 1, num78 + 1].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num77 + 1, num78 + 1].type]) && !(!flag13 & flag12))
								{
									list15.Add(new Tuple<int, int>(num77 + 1, num78 + 1));
								}
							}
						}
					}
				}
				if (list15.Count > 0)
				{
					float num79 = -1f;
					Tuple<int, int> tuple15 = list15[0];
					for (int num80 = 0; num80 < list15.Count; num80++)
					{
						if ((!Main.tile[list15[num80].Item1, list15[num80].Item2 - 1].active() || Main.tile[list15[num80].Item1, list15[num80].Item2 - 1].type != 314) && (!Main.tile[list15[num80].Item1, list15[num80].Item2 + 1].active() || Main.tile[list15[num80].Item1, list15[num80].Item2 + 1].type != 314))
						{
							float num81 = Vector2.Distance(new Vector2((float)list15[num80].Item1, (float)list15[num80].Item2) * 16f + Vector2.One * 8f, vector);
							if (num79 == -1f || num81 < num79)
							{
								num79 = num81;
								tuple15 = list15[num80];
							}
						}
					}
					if (Collision.InTileBounds(tuple15.Item1, tuple15.Item2, num4, num6, num5, num7) && num79 != -1f)
					{
						num8 = tuple15.Item1;
						num9 = tuple15.Item2;
					}
				}
				list15.Clear();
			}
			if (item.type == 2492 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list16 = new List<Tuple<int, int>>();
				bool flag14 = false;
				if (Main.tile[num, num2].active() && Main.tile[num, num2].type == 314)
				{
					flag14 = true;
				}
				if (!flag14)
				{
					for (int num82 = num4; num82 <= num5; num82++)
					{
						for (int num83 = num6; num83 <= num7; num83++)
						{
							Tile tile9 = Main.tile[num82, num83];
							if (tile9.active() && tile9.type == 314)
							{
								if (!Main.tile[num82 - 1, num83].active() || Main.tileCut[(int)Main.tile[num82 - 1, num83].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num82 - 1, num83].type])
								{
									list16.Add(new Tuple<int, int>(num82 - 1, num83));
								}
								if (!Main.tile[num82 + 1, num83].active() || Main.tileCut[(int)Main.tile[num82 + 1, num83].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num82 + 1, num83].type])
								{
									list16.Add(new Tuple<int, int>(num82 + 1, num83));
								}
							}
						}
					}
				}
				if (list16.Count > 0)
				{
					float num84 = -1f;
					Tuple<int, int> tuple16 = list16[0];
					for (int num85 = 0; num85 < list16.Count; num85++)
					{
						if ((!Main.tile[list16[num85].Item1, list16[num85].Item2 - 1].active() || Main.tile[list16[num85].Item1, list16[num85].Item2 - 1].type != 314) && (!Main.tile[list16[num85].Item1, list16[num85].Item2 + 1].active() || Main.tile[list16[num85].Item1, list16[num85].Item2 + 1].type != 314))
						{
							float num86 = Vector2.Distance(new Vector2((float)list16[num85].Item1, (float)list16[num85].Item2) * 16f + Vector2.One * 8f, vector);
							if (num84 == -1f || num86 < num84)
							{
								num84 = num86;
								tuple16 = list16[num85];
							}
						}
					}
					if (Collision.InTileBounds(tuple16.Item1, tuple16.Item2, num4, num6, num5, num7) && num84 != -1f)
					{
						num8 = tuple16.Item1;
						num9 = tuple16.Item2;
					}
				}
				list16.Clear();
			}
			if (item.createWall > 0 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list17 = new List<Tuple<int, int>>();
				for (int num87 = num4; num87 <= num5; num87++)
				{
					for (int num88 = num6; num88 <= num7; num88++)
					{
						Tile tile10 = Main.tile[num87, num88];
						if (tile10.wall == 0 && (!tile10.active() || !Main.tileSolid[(int)tile10.type] || Main.tileSolidTop[(int)tile10.type]) && Collision.CanHitWithCheck(this.position, this.width, this.height, new Vector2((float)num87, (float)num88) * 16f, 16, 16, new Utils.PerLinePoint(DelegateMethods.NotDoorStand)))
						{
							bool flag15 = false;
							if (Main.tile[num87 - 1, num88].active() || Main.tile[num87 - 1, num88].wall > 0)
							{
								flag15 = true;
							}
							if (Main.tile[num87 + 1, num88].active() || Main.tile[num87 + 1, num88].wall > 0)
							{
								flag15 = true;
							}
							if (Main.tile[num87, num88 - 1].active() || Main.tile[num87, num88 - 1].wall > 0)
							{
								flag15 = true;
							}
							if (Main.tile[num87, num88 + 1].active() || Main.tile[num87, num88 + 1].wall > 0)
							{
								flag15 = true;
							}
							if (WorldGen.IsOpenDoorAnchorFrame(num87, num88))
							{
								flag15 = false;
							}
							if (flag15)
							{
								list17.Add(new Tuple<int, int>(num87, num88));
							}
						}
					}
				}
				if (list17.Count > 0)
				{
					float num89 = -1f;
					Tuple<int, int> tuple17 = list17[0];
					for (int num90 = 0; num90 < list17.Count; num90++)
					{
						float num91 = Vector2.Distance(new Vector2((float)list17[num90].Item1, (float)list17[num90].Item2) * 16f + Vector2.One * 8f, vector);
						if (num89 == -1f || num91 < num89)
						{
							num89 = num91;
							tuple17 = list17[num90];
						}
					}
					if (Collision.InTileBounds(tuple17.Item1, tuple17.Item2, num4, num6, num5, num7))
					{
						num8 = tuple17.Item1;
						num9 = tuple17.Item2;
					}
				}
				list17.Clear();
			}
			if (item.createTile == 254 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list18 = new List<Tuple<int, int>>();
				for (int num92 = num4; num92 <= num5; num92++)
				{
					for (int num93 = num6; num93 <= num7; num93++)
					{
						Tile tile11 = Main.tile[num92, num93 + 1];
						Tile tile12 = Main.tile[num92 - 1, num93 + 1];
						if ((double)num93 > Main.worldSurface - 2.0)
						{
							break;
						}
						bool flag16 = true;
						if (!tile12.active() || !tile11.active())
						{
							flag16 = false;
						}
						if (tile12.slope() > 0 || tile11.slope() > 0 || tile12.halfBrick() || tile11.halfBrick())
						{
							flag16 = false;
						}
						if (tile12.type != 2 && tile12.type != 109)
						{
							flag16 = false;
						}
						if (tile11.type != 2 && tile11.type != 109)
						{
							flag16 = false;
						}
						for (int num94 = num92 - 1; num94 <= num92; num94++)
						{
							for (int num95 = num93 - 1; num95 <= num93; num95++)
							{
								if (Main.tile[num94, num95].active() && !WorldGen.CanCutTile(num94, num95, TileCuttingContext.AttackMelee))
								{
									flag16 = false;
								}
							}
						}
						if (flag16)
						{
							list18.Add(new Tuple<int, int>(num92, num93));
						}
					}
				}
				if (list18.Count > 0)
				{
					float num96 = -1f;
					Tuple<int, int> tuple18 = list18[0];
					for (int num97 = 0; num97 < list18.Count; num97++)
					{
						float num98 = Vector2.Distance(new Vector2((float)list18[num97].Item1, (float)list18[num97].Item2) * 16f + Vector2.One * 8f, vector);
						if (num96 == -1f || num98 < num96)
						{
							num96 = num98;
							tuple18 = list18[num97];
						}
					}
					if (Collision.InTileBounds(tuple18.Item1, tuple18.Item2, num4, num6, num5, num7))
					{
						num8 = tuple18.Item1;
						num9 = tuple18.Item2;
					}
				}
				list18.Clear();
			}
			if (item.createTile == 454 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list19 = new List<Tuple<int, int>>();
				for (int num99 = num4; num99 <= num5; num99++)
				{
					int num100 = num6;
					while (num100 <= num7 && (double)num100 <= Main.worldSurface - 2.0)
					{
						bool flag17 = true;
						for (int num101 = num99 - 2; num101 <= num99 + 1; num101++)
						{
							for (int num102 = num100 - 1; num102 <= num100 + 2; num102++)
							{
								Tile tile13 = Main.tile[num101, num102];
								if (num102 == num100 - 1)
								{
									if (!WorldGen.SolidTile(tile13))
									{
										flag17 = false;
									}
								}
								else if (tile13.active() && (!Main.tileCut[(int)tile13.type] || tile13.type == 454))
								{
									flag17 = false;
								}
							}
						}
						if (flag17)
						{
							list19.Add(new Tuple<int, int>(num99, num100));
						}
						num100++;
					}
				}
				if (list19.Count > 0)
				{
					float num103 = -1f;
					Tuple<int, int> tuple19 = list19[0];
					for (int num104 = 0; num104 < list19.Count; num104++)
					{
						float num105 = Vector2.Distance(new Vector2((float)list19[num104].Item1, (float)list19[num104].Item2) * 16f + Vector2.One * 8f, vector);
						if (num103 == -1f || num105 < num103)
						{
							num103 = num105;
							tuple19 = list19[num104];
						}
					}
					if (Collision.InTileBounds(tuple19.Item1, tuple19.Item2, num4, num6, num5, num7))
					{
						num8 = tuple19.Item1;
						num9 = tuple19.Item2;
					}
				}
				list19.Clear();
			}
			if (item.createTile == 138 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list20 = new List<Tuple<int, int>>();
				for (int num106 = num4; num106 <= num5; num106++)
				{
					for (int num107 = num6; num107 <= num7; num107++)
					{
						Tile tile14 = Main.tile[num106, num107 + 1];
						Tile tile15 = Main.tile[num106 - 1, num107 + 1];
						bool flag18 = true;
						if (!tile15.nactive() || !tile14.nactive())
						{
							flag18 = false;
						}
						if (tile15.slope() > 0 || tile14.slope() > 0 || tile15.halfBrick() || tile14.halfBrick())
						{
							flag18 = false;
						}
						if (Main.tileNoAttach[(int)tile15.type] || Main.tileNoAttach[(int)tile14.type])
						{
							flag18 = false;
						}
						for (int num108 = num106 - 1; num108 <= num106; num108++)
						{
							for (int num109 = num107 - 1; num109 <= num107; num109++)
							{
								Tile tile16 = Main.tile[num108, num109];
								if (tile16.active() && !Main.tileCut[(int)tile16.type])
								{
									flag18 = false;
								}
							}
						}
						int x = num106 * 16 - 16;
						int y = num107 * 16 - 16;
						int width = 32;
						int height = 32;
						Rectangle value = new Rectangle(x, y, width, height);
						for (int num110 = 0; num110 < 255; num110++)
						{
							Player player = Main.player[num110];
							if (player.active && !player.dead && player.Hitbox.Intersects(value))
							{
								flag18 = false;
								break;
							}
						}
						if (flag18)
						{
							list20.Add(new Tuple<int, int>(num106, num107));
						}
					}
				}
				if (list20.Count > 0)
				{
					float num111 = -1f;
					Tuple<int, int> tuple20 = list20[0];
					for (int num112 = 0; num112 < list20.Count; num112++)
					{
						float num113 = Vector2.Distance(new Vector2((float)list20[num112].Item1, (float)list20[num112].Item2) * 16f + Vector2.One * 8f, vector);
						if (num111 == -1f || num113 < num111)
						{
							num111 = num113;
							tuple20 = list20[num112];
						}
					}
					if (Collision.InTileBounds(tuple20.Item1, tuple20.Item2, num4, num6, num5, num7))
					{
						num8 = tuple20.Item1;
						num9 = tuple20.Item2;
					}
				}
				list20.Clear();
			}
			Player.SmartCursor_Torch(item, ref vector, num4, num5, num6, num7, ref num8, ref num9, num, num2);
			Player.SmartCursor_Filling(item, ref vector, num4, num5, num6, num7, ref num8, ref num9, num, num2);
			if (Player.SmartCursorSettings.SmartBlocksEnabled && item.createTile > -1 && item.type != 213 && Main.tileSolid[item.createTile] && !Main.tileSolidTop[item.createTile] && !Main.tileFrameImportant[item.createTile] && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list21 = new List<Tuple<int, int>>();
				bool flag19 = false;
				if (Main.tile[num, num2].active())
				{
					flag19 = true;
				}
				if (!Collision.InTileBounds(num, num2, num4, num6, num5, num7))
				{
					flag19 = true;
				}
				if (!flag19)
				{
					for (int num114 = num4; num114 <= num5; num114++)
					{
						for (int num115 = num6; num115 <= num7; num115++)
						{
							Tile tile17 = Main.tile[num114, num115];
							if (!tile17.active() || Main.tileCut[(int)tile17.type] || TileID.Sets.BreakableWhenPlacing[(int)tile17.type])
							{
								bool flag20 = false;
								if (Main.tile[num114 - 1, num115].active() && Main.tileSolid[(int)Main.tile[num114 - 1, num115].type] && !Main.tileSolidTop[(int)Main.tile[num114 - 1, num115].type])
								{
									flag20 = true;
								}
								if (Main.tile[num114 + 1, num115].active() && Main.tileSolid[(int)Main.tile[num114 + 1, num115].type] && !Main.tileSolidTop[(int)Main.tile[num114 + 1, num115].type])
								{
									flag20 = true;
								}
								if (Main.tile[num114, num115 - 1].active() && Main.tileSolid[(int)Main.tile[num114, num115 - 1].type] && !Main.tileSolidTop[(int)Main.tile[num114, num115 - 1].type])
								{
									flag20 = true;
								}
								if (Main.tile[num114, num115 + 1].active() && Main.tileSolid[(int)Main.tile[num114, num115 + 1].type] && !Main.tileSolidTop[(int)Main.tile[num114, num115 + 1].type])
								{
									flag20 = true;
								}
								if (flag20)
								{
									list21.Add(new Tuple<int, int>(num114, num115));
								}
							}
						}
					}
				}
				if (list21.Count > 0)
				{
					float num116 = -1f;
					Tuple<int, int> tuple21 = list21[0];
					for (int num117 = 0; num117 < list21.Count; num117++)
					{
						if (Collision.EmptyTile(list21[num117].Item1, list21[num117].Item2, false))
						{
							float num118 = Vector2.Distance(new Vector2((float)list21[num117].Item1, (float)list21[num117].Item2) * 16f + Vector2.One * 8f, vector);
							if (num116 == -1f || num118 < num116)
							{
								num116 = num118;
								tuple21 = list21[num117];
							}
						}
					}
					if (Collision.InTileBounds(tuple21.Item1, tuple21.Item2, num4, num6, num5, num7) && num116 != -1f)
					{
						num8 = tuple21.Item1;
						num9 = tuple21.Item2;
					}
				}
				list21.Clear();
			}
			if ((item.type == 1072 || item.type == 1544) && num3 != 0 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list22 = new List<Tuple<int, int>>();
				for (int num119 = num4; num119 <= num5; num119++)
				{
					for (int num120 = num6; num120 <= num7; num120++)
					{
						Tile tile18 = Main.tile[num119, num120];
						if (tile18.wall > 0 && (int)tile18.wallColor() != num3 && (!tile18.active() || !Main.tileSolid[(int)tile18.type] || Main.tileSolidTop[(int)tile18.type]))
						{
							list22.Add(new Tuple<int, int>(num119, num120));
						}
					}
				}
				if (list22.Count > 0)
				{
					float num121 = -1f;
					Tuple<int, int> tuple22 = list22[0];
					for (int num122 = 0; num122 < list22.Count; num122++)
					{
						float num123 = Vector2.Distance(new Vector2((float)list22[num122].Item1, (float)list22[num122].Item2) * 16f + Vector2.One * 8f, vector);
						if (num121 == -1f || num123 < num121)
						{
							num121 = num123;
							tuple22 = list22[num122];
						}
					}
					if (Collision.InTileBounds(tuple22.Item1, tuple22.Item2, num4, num6, num5, num7))
					{
						num8 = tuple22.Item1;
						num9 = tuple22.Item2;
					}
				}
				list22.Clear();
			}
			if ((item.type == 1071 || item.type == 1543) && num3 != 0 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list23 = new List<Tuple<int, int>>();
				for (int num124 = num4; num124 <= num5; num124++)
				{
					for (int num125 = num6; num125 <= num7; num125++)
					{
						Tile tile19 = Main.tile[num124, num125];
						if (tile19.active() && (int)tile19.color() != num3)
						{
							list23.Add(new Tuple<int, int>(num124, num125));
						}
					}
				}
				if (list23.Count > 0)
				{
					float num126 = -1f;
					Tuple<int, int> tuple23 = list23[0];
					for (int num127 = 0; num127 < list23.Count; num127++)
					{
						float num128 = Vector2.Distance(new Vector2((float)list23[num127].Item1, (float)list23[num127].Item2) * 16f + Vector2.One * 8f, vector);
						if (num126 == -1f || num128 < num126)
						{
							num126 = num128;
							tuple23 = list23[num127];
						}
					}
					if (Collision.InTileBounds(tuple23.Item1, tuple23.Item2, num4, num6, num5, num7))
					{
						num8 = tuple23.Item1;
						num9 = tuple23.Item2;
					}
				}
				list23.Clear();
			}
			if ((item.type == 1100 || item.type == 1545) && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list24 = new List<Tuple<int, int>>();
				for (int num129 = num4; num129 <= num5; num129++)
				{
					for (int num130 = num6; num130 <= num7; num130++)
					{
						Tile tile20 = Main.tile[num129, num130];
						if ((tile20.active() && tile20.color() > 0) || (tile20.wall > 0 && tile20.wallColor() > 0))
						{
							list24.Add(new Tuple<int, int>(num129, num130));
						}
					}
				}
				if (list24.Count > 0)
				{
					float num131 = -1f;
					Tuple<int, int> tuple24 = list24[0];
					for (int num132 = 0; num132 < list24.Count; num132++)
					{
						float num133 = Vector2.Distance(new Vector2((float)list24[num132].Item1, (float)list24[num132].Item2) * 16f + Vector2.One * 8f, vector);
						if (num131 == -1f || num133 < num131)
						{
							num131 = num133;
							tuple24 = list24[num132];
						}
					}
					if (Collision.InTileBounds(tuple24.Item1, tuple24.Item2, num4, num6, num5, num7))
					{
						num8 = tuple24.Item1;
						num9 = tuple24.Item2;
					}
				}
				list24.Clear();
			}
			if (item.type == 27 && num8 == -1 && num9 == -1 && num6 > 20)
			{
				List<Tuple<int, int>> list25 = new List<Tuple<int, int>>();
				for (int num134 = num4; num134 <= num5; num134++)
				{
					for (int num135 = num6; num135 <= num7; num135++)
					{
						Tile tile21 = Main.tile[num134, num135];
						Tile tile22 = Main.tile[num134, num135 - 1];
						Tile tile23 = Main.tile[num134, num135 + 1];
						Tile tile24 = Main.tile[num134 - 1, num135];
						Tile tile25 = Main.tile[num134 + 1, num135];
						Tile tile26 = Main.tile[num134 - 2, num135];
						Tile tile27 = Main.tile[num134 + 2, num135];
						Tile tile28 = Main.tile[num134 - 3, num135];
						Tile tile29 = Main.tile[num134 + 3, num135];
						if ((!tile21.active() || Main.tileCut[(int)tile21.type] || TileID.Sets.BreakableWhenPlacing[(int)tile21.type]) && (!tile22.active() || Main.tileCut[(int)tile22.type] || TileID.Sets.BreakableWhenPlacing[(int)tile22.type]) && (!tile24.active() || tile24.type != 20) && (!tile25.active() || tile25.type != 20) && (!tile26.active() || tile26.type != 20) && (!tile27.active() || tile27.type != 20) && (!tile28.active() || tile28.type != 20) && (!tile29.active() || tile29.type != 20) && tile23.active() && WorldGen.SolidTile2(tile23))
						{
							ushort type = tile23.type;
							if (type <= 109)
							{
								if (type <= 23)
								{
									if (type != 2 && type != 23)
									{
										goto IL_40EE;
									}
								}
								else if (type != 53)
								{
									if (type != 60)
									{
										if (type != 109)
										{
											goto IL_40EE;
										}
									}
									else
									{
										if (WorldGen.EmptyTileCheck(num134 - 2, num134 + 2, num135 - 20, num135, 20))
										{
											list25.Add(new Tuple<int, int>(num134, num135));
											goto IL_40EE;
										}
										goto IL_40EE;
									}
								}
							}
							else if (type <= 116)
							{
								if (type != 112 && type != 116)
								{
									goto IL_40EE;
								}
							}
							else if (type != 147 && type != 199 && type != 234)
							{
								goto IL_40EE;
							}
							if (tile24.liquid == 0 && tile21.liquid == 0 && tile25.liquid == 0 && WorldGen.EmptyTileCheck(num134 - 2, num134 + 2, num135 - 20, num135, 20))
							{
								list25.Add(new Tuple<int, int>(num134, num135));
							}
						}
						IL_40EE:;
					}
				}
				List<Tuple<int, int>> list26 = new List<Tuple<int, int>>();
				for (int num136 = 0; num136 < list25.Count; num136++)
				{
					bool flag21 = false;
					for (int num137 = -1; num137 < 2; num137 += 2)
					{
						Tile tile30 = Main.tile[list25[num136].Item1 + num137, list25[num136].Item2 + 1];
						if (tile30.active())
						{
							ushort type = tile30.type;
							if (type <= 109)
							{
								if (type <= 23)
								{
									if (type != 2 && type != 23)
									{
										goto IL_41EC;
									}
								}
								else if (type != 53 && type != 60 && type != 109)
								{
									goto IL_41EC;
								}
							}
							else if (type <= 116)
							{
								if (type != 112 && type != 116)
								{
									goto IL_41EC;
								}
							}
							else if (type != 147 && type != 199 && type != 234)
							{
								goto IL_41EC;
							}
							flag21 = true;
						}
						IL_41EC:;
					}
					if (!flag21)
					{
						list26.Add(list25[num136]);
					}
				}
				for (int num138 = 0; num138 < list26.Count; num138++)
				{
					list25.Remove(list26[num138]);
				}
				list26.Clear();
				if (list25.Count > 0)
				{
					float num139 = -1f;
					Tuple<int, int> tuple25 = list25[0];
					for (int num140 = 0; num140 < list25.Count; num140++)
					{
						float num141 = Vector2.Distance(new Vector2((float)list25[num140].Item1, (float)list25[num140].Item2) * 16f + Vector2.One * 8f, vector);
						if (num139 == -1f || num141 < num139)
						{
							num139 = num141;
							tuple25 = list25[num140];
						}
					}
					if (Collision.InTileBounds(tuple25.Item1, tuple25.Item2, num4, num6, num5, num7))
					{
						num8 = tuple25.Item1;
						num9 = tuple25.Item2;
					}
				}
				list25.Clear();
			}
			if (item.type == 205 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list27 = new List<Tuple<int, int>>();
				for (int num142 = num4; num142 <= num5; num142++)
				{
					for (int num143 = num6; num143 <= num7; num143++)
					{
						Tile tile31 = Main.tile[num142, num143];
						if (tile31.liquid > 0)
						{
							int num144 = (int)tile31.liquidType();
							int num145 = 0;
							for (int num146 = num142 - 1; num146 <= num142 + 1; num146++)
							{
								for (int num147 = num143 - 1; num147 <= num143 + 1; num147++)
								{
									if ((int)Main.tile[num146, num147].liquidType() == num144)
									{
										num145 += (int)Main.tile[num146, num147].liquid;
									}
								}
							}
							if (num145 > 100)
							{
								list27.Add(new Tuple<int, int>(num142, num143));
							}
						}
					}
				}
				if (list27.Count > 0)
				{
					float num148 = -1f;
					Tuple<int, int> tuple26 = list27[0];
					for (int num149 = 0; num149 < list27.Count; num149++)
					{
						float num150 = Vector2.Distance(new Vector2((float)list27[num149].Item1, (float)list27[num149].Item2) * 16f + Vector2.One * 8f, vector);
						if (num148 == -1f || num150 < num148)
						{
							num148 = num150;
							tuple26 = list27[num149];
						}
					}
					if (Collision.InTileBounds(tuple26.Item1, tuple26.Item2, num4, num6, num5, num7))
					{
						num8 = tuple26.Item1;
						num9 = tuple26.Item2;
					}
				}
				list27.Clear();
			}
			if (item.type == 849 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list28 = new List<Tuple<int, int>>();
				for (int num151 = num4; num151 <= num5; num151++)
				{
					for (int num152 = num6; num152 <= num7; num152++)
					{
						Tile tile32 = Main.tile[num151, num152];
						if ((tile32.wire() || tile32.wire2() || tile32.wire3() || tile32.wire4()) && !tile32.actuator() && tile32.active())
						{
							list28.Add(new Tuple<int, int>(num151, num152));
						}
					}
				}
				if (list28.Count > 0)
				{
					float num153 = -1f;
					Tuple<int, int> tuple27 = list28[0];
					for (int num154 = 0; num154 < list28.Count; num154++)
					{
						float num155 = Vector2.Distance(new Vector2((float)list28[num154].Item1, (float)list28[num154].Item2) * 16f + Vector2.One * 8f, vector);
						if (num153 == -1f || num155 < num153)
						{
							num153 = num155;
							tuple27 = list28[num154];
						}
					}
					if (Collision.InTileBounds(tuple27.Item1, tuple27.Item2, num4, num6, num5, num7))
					{
						num8 = tuple27.Item1;
						num9 = tuple27.Item2;
					}
				}
				list28.Clear();
			}
			if (item.createTile == 82 && num8 == -1 && num9 == -1)
			{
				int placeStyle = item.placeStyle;
				List<Tuple<int, int>> list29 = new List<Tuple<int, int>>();
				for (int num156 = num4; num156 <= num5; num156++)
				{
					for (int num157 = num6; num157 <= num7; num157++)
					{
						Tile tile33 = Main.tile[num156, num157];
						Tile tile34 = Main.tile[num156, num157 + 1];
						if ((!tile33.active() || TileID.Sets.BreakableWhenPlacing[(int)tile33.type] || (Main.tileCut[(int)tile33.type] && tile33.type != 82 && tile33.type != 83)) && tile34.nactive() && !tile34.halfBrick() && tile34.slope() == 0)
						{
							if (placeStyle == 0)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 2 && tile34.type != 109)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0)
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 1)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 60)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0)
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 2)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 0 && tile34.type != 59)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0)
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 3)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 203 && tile34.type != 199 && tile34.type != 23 && tile34.type != 25)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0)
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 4)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 53 && tile34.type != 116)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0 && tile33.lava())
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 5)
							{
								if (tile34.type != 78 && tile34.type != 380 && tile34.type != 57)
								{
									goto IL_4CFD;
								}
								if (tile33.liquid > 0 && !tile33.lava())
								{
									goto IL_4CFD;
								}
							}
							else if (placeStyle == 6 && ((tile34.type != 78 && tile34.type != 380 && tile34.type != 147 && tile34.type != 161 && tile34.type != 163 && tile34.type != 164 && tile34.type != 200) || (tile33.liquid > 0 && tile33.lava())))
							{
								goto IL_4CFD;
							}
							list29.Add(new Tuple<int, int>(num156, num157));
						}
						IL_4CFD:;
					}
				}
				if (list29.Count > 0)
				{
					float num158 = -1f;
					Tuple<int, int> tuple28 = list29[0];
					for (int num159 = 0; num159 < list29.Count; num159++)
					{
						float num160 = Vector2.Distance(new Vector2((float)list29[num159].Item1, (float)list29[num159].Item2) * 16f + Vector2.One * 8f, vector);
						if (num158 == -1f || num160 < num158)
						{
							num158 = num160;
							tuple28 = list29[num159];
						}
					}
					if (Collision.InTileBounds(tuple28.Item1, tuple28.Item2, num4, num6, num5, num7))
					{
						num8 = tuple28.Item1;
						num9 = tuple28.Item2;
					}
				}
				list29.Clear();
			}
			if (item.createTile == 380 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list30 = new List<Tuple<int, int>>();
				bool flag22 = false;
				if (Main.tile[num, num2].active() && Main.tile[num, num2].type == 380)
				{
					flag22 = true;
				}
				if (!flag22)
				{
					for (int num161 = num4; num161 <= num5; num161++)
					{
						for (int num162 = num6; num162 <= num7; num162++)
						{
							Tile tile35 = Main.tile[num161, num162];
							if (tile35.active() && tile35.type == 380)
							{
								if (!Main.tile[num161 - 1, num162].active() || Main.tileCut[(int)Main.tile[num161 - 1, num162].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num161 - 1, num162].type])
								{
									list30.Add(new Tuple<int, int>(num161 - 1, num162));
								}
								if (!Main.tile[num161 + 1, num162].active() || Main.tileCut[(int)Main.tile[num161 + 1, num162].type] || TileID.Sets.BreakableWhenPlacing[(int)Main.tile[num161 + 1, num162].type])
								{
									list30.Add(new Tuple<int, int>(num161 + 1, num162));
								}
							}
						}
					}
				}
				if (list30.Count > 0)
				{
					float num163 = -1f;
					Tuple<int, int> tuple29 = list30[0];
					for (int num164 = 0; num164 < list30.Count; num164++)
					{
						float num165 = Vector2.Distance(new Vector2((float)list30[num164].Item1, (float)list30[num164].Item2) * 16f + Vector2.One * 8f, vector);
						if (num163 == -1f || num165 < num163)
						{
							num163 = num165;
							tuple29 = list30[num164];
						}
					}
					if (Collision.InTileBounds(tuple29.Item1, tuple29.Item2, num4, num6, num5, num7) && num163 != -1f)
					{
						num8 = tuple29.Item1;
						num9 = tuple29.Item2;
					}
				}
				list30.Clear();
			}
			if (item.createTile == 78 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list31 = new List<Tuple<int, int>>();
				bool flag23 = false;
				if (Main.tile[num, num2].active())
				{
					flag23 = true;
				}
				if (!Collision.InTileBounds(num, num2, num4, num6, num5, num7))
				{
					flag23 = true;
				}
				if (!flag23)
				{
					for (int num166 = num4; num166 <= num5; num166++)
					{
						for (int num167 = num6; num167 <= num7; num167++)
						{
							Tile tile36 = Main.tile[num166, num167];
							Tile tile37 = Main.tile[num166, num167 + 1];
							if ((!tile36.active() || Main.tileCut[(int)tile36.type] || TileID.Sets.BreakableWhenPlacing[(int)tile36.type]) && tile37.nactive() && !tile37.halfBrick() && tile37.slope() == 0 && Main.tileSolid[(int)tile37.type])
							{
								list31.Add(new Tuple<int, int>(num166, num167));
							}
						}
					}
				}
				if (list31.Count > 0)
				{
					float num168 = -1f;
					Tuple<int, int> tuple30 = list31[0];
					for (int num169 = 0; num169 < list31.Count; num169++)
					{
						if (Collision.EmptyTile(list31[num169].Item1, list31[num169].Item2, true))
						{
							float num170 = Vector2.Distance(new Vector2((float)list31[num169].Item1, (float)list31[num169].Item2) * 16f + Vector2.One * 8f, vector);
							if (num168 == -1f || num170 < num168)
							{
								num168 = num170;
								tuple30 = list31[num169];
							}
						}
					}
					if (Collision.InTileBounds(tuple30.Item1, tuple30.Item2, num4, num6, num5, num7) && num168 != -1f)
					{
						num8 = tuple30.Item1;
						num9 = tuple30.Item2;
					}
				}
				list31.Clear();
			}
			if (item.type == 213 && num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list32 = new List<Tuple<int, int>>();
				for (int num171 = num4; num171 <= num5; num171++)
				{
					for (int num172 = num6; num172 <= num7; num172++)
					{
						Tile tile38 = Main.tile[num171, num172];
						bool flag24 = !Main.tile[num171 - 1, num172].active() || !Main.tile[num171, num172 + 1].active() || !Main.tile[num171 + 1, num172].active() || !Main.tile[num171, num172 - 1].active();
						bool flag25 = !Main.tile[num171 - 1, num172 - 1].active() || !Main.tile[num171 - 1, num172 + 1].active() || !Main.tile[num171 + 1, num172 + 1].active() || !Main.tile[num171 + 1, num172 - 1].active();
						if (tile38.active() && !tile38.inActive() && (tile38.type == 0 || tile38.type == 1) && (flag24 || (tile38.type == 0 & flag25)))
						{
							list32.Add(new Tuple<int, int>(num171, num172));
						}
					}
				}
				if (list32.Count > 0)
				{
					float num173 = -1f;
					Tuple<int, int> tuple31 = list32[0];
					for (int num174 = 0; num174 < list32.Count; num174++)
					{
						float num175 = Vector2.Distance(new Vector2((float)list32[num174].Item1, (float)list32[num174].Item2) * 16f + Vector2.One * 8f, vector);
						if (num173 == -1f || num175 < num173)
						{
							num173 = num175;
							tuple31 = list32[num174];
						}
					}
					if (Collision.InTileBounds(tuple31.Item1, tuple31.Item2, num4, num6, num5, num7))
					{
						num8 = tuple31.Item1;
						num9 = tuple31.Item2;
					}
				}
				list32.Clear();
			}
			if (num8 != -1 && num9 != -1)
			{
				Main.SmartCursorX = (Player.tileTargetX = num8);
				Main.SmartCursorY = (Player.tileTargetY = num9);
				Main.SmartCursorShowing = true;
			}
			list.Clear();
		}

		// Token: 0x06000385 RID: 901 RVA: 0x002420B0 File Offset: 0x002402B0
		private static void SmartCursor_Axe(Item item, ref Vector2 mouse, int LX, int HX, int LY, int HY, ref int fX, ref int fY)
		{
			if (item.axe > 0 && fX == -1 && fY == -1)
			{
				float num = -1f;
				for (int i = LX; i <= HX; i++)
				{
					for (int j = LY; j <= HY; j++)
					{
						if (Main.tile[i, j].active())
						{
							Tile tile = Main.tile[i, j];
							if (Main.tileAxe[(int)tile.type])
							{
								int num2 = i;
								int num3 = j;
								if (tile.type == 5)
								{
									if (Collision.InTileBounds(num2 + 1, num3, LX, LY, HX, HY))
									{
										if (Main.tile[num2, num3].frameY >= 198 && Main.tile[num2, num3].frameX == 44)
										{
											num2++;
										}
										if (Main.tile[num2, num3].frameX == 66 && Main.tile[num2, num3].frameY <= 44)
										{
											num2++;
										}
										if (Main.tile[num2, num3].frameX == 44 && Main.tile[num2, num3].frameY >= 132 && Main.tile[num2, num3].frameY <= 176)
										{
											num2++;
										}
									}
									if (Collision.InTileBounds(num2 - 1, num3, LX, LY, HX, HY))
									{
										if (Main.tile[num2, num3].frameY >= 198 && Main.tile[num2, num3].frameX == 66)
										{
											num2--;
										}
										if (Main.tile[num2, num3].frameX == 88 && Main.tile[num2, num3].frameY >= 66 && Main.tile[num2, num3].frameY <= 110)
										{
											num2--;
										}
										if (Main.tile[num2, num3].frameX == 22 && Main.tile[num2, num3].frameY >= 132 && Main.tile[num2, num3].frameY <= 176)
										{
											num2--;
										}
									}
									while (Main.tile[num2, num3].active() && Main.tile[num2, num3].type == 5 && Main.tile[num2, num3 + 1].type == 5 && Collision.InTileBounds(num2, num3 + 1, LX, LY, HX, HY))
									{
										num3++;
									}
								}
								if (tile.type == 80)
								{
									if (Collision.InTileBounds(num2 + 1, num3, LX, LY, HX, HY))
									{
										if (Main.tile[num2, num3].frameX == 54)
										{
											num2++;
										}
										if (Main.tile[num2, num3].frameX == 108 && Main.tile[num2, num3].frameY == 36)
										{
											num2++;
										}
									}
									if (Collision.InTileBounds(num2 - 1, num3, LX, LY, HX, HY))
									{
										if (Main.tile[num2, num3].frameX == 36)
										{
											num2--;
										}
										if (Main.tile[num2, num3].frameX == 108 && Main.tile[num2, num3].frameY == 18)
										{
											num2--;
										}
									}
									while (Main.tile[num2, num3].active() && Main.tile[num2, num3].type == 80 && Main.tile[num2, num3 + 1].type == 80 && Collision.InTileBounds(num2, num3 + 1, LX, LY, HX, HY))
									{
										num3++;
									}
								}
								if (tile.type != 323)
								{
									if (tile.type != 72)
									{
										goto IL_47A;
									}
								}
								while (Main.tile[num2, num3].active() && ((Main.tile[num2, num3].type == 323 && Main.tile[num2, num3 + 1].type == 323) || (Main.tile[num2, num3].type == 72 && Main.tile[num2, num3 + 1].type == 72)) && Collision.InTileBounds(num2, num3 + 1, LX, LY, HX, HY))
								{
									num3++;
								}
								IL_47A:
								float num4 = Vector2.Distance(new Vector2((float)num2, (float)num3) * 16f + Vector2.One * 8f, mouse);
								if (num == -1f || num4 < num)
								{
									num = num4;
									fX = num2;
									fY = num3;
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06000386 RID: 902 RVA: 0x002425A0 File Offset: 0x002407A0
		private static void SmartCursor_Filling(Item item, ref Vector2 mouse, int LX, int HX, int LY, int HY, ref int fX, ref int fY, int tX, int tY)
		{
			if (!Player.SmartCursorSettings.SmartBlocksEnabled && item.createTile > -1 && item.type != 213 && Main.tileSolid[item.createTile] && !Main.tileSolidTop[item.createTile] && !Main.tileFrameImportant[item.createTile] && fX == -1 && fY == -1)
			{
				List<Tuple<int, int>> list = new List<Tuple<int, int>>();
				bool flag = false;
				if (Main.tile[tX, tY].active())
				{
					flag = true;
				}
				if (!Collision.InTileBounds(tX, tY, LX, LY, HX, HY))
				{
					flag = true;
				}
				if (!flag)
				{
					for (int i = LX; i <= HX; i++)
					{
						for (int j = LY; j <= HY; j++)
						{
							Tile tile = Main.tile[i, j];
							if (!tile.active() || Main.tileCut[(int)tile.type] || TileID.Sets.BreakableWhenPlacing[(int)tile.type])
							{
								int num = 0;
								if (Main.tile[i - 1, j].active() && Main.tileSolid[(int)Main.tile[i - 1, j].type] && !Main.tileSolidTop[(int)Main.tile[i - 1, j].type])
								{
									num++;
								}
								if (Main.tile[i + 1, j].active() && Main.tileSolid[(int)Main.tile[i + 1, j].type] && !Main.tileSolidTop[(int)Main.tile[i + 1, j].type])
								{
									num++;
								}
								if (Main.tile[i, j - 1].active() && Main.tileSolid[(int)Main.tile[i, j - 1].type] && !Main.tileSolidTop[(int)Main.tile[i, j - 1].type])
								{
									num++;
								}
								if (Main.tile[i, j + 1].active() && Main.tileSolid[(int)Main.tile[i, j + 1].type] && !Main.tileSolidTop[(int)Main.tile[i, j + 1].type])
								{
									num++;
								}
								if (num >= 2)
								{
									list.Add(new Tuple<int, int>(i, j));
								}
							}
						}
					}
				}
				if (list.Count > 0)
				{
					float num2 = -1f;
					float num3 = float.PositiveInfinity;
					Tuple<int, int> tuple = list[0];
					for (int k = 0; k < list.Count; k++)
					{
						if (Collision.EmptyTile(list[k].Item1, list[k].Item2, true))
						{
							Vector2 vector = new Vector2((float)list[k].Item1, (float)list[k].Item2) * 16f + Vector2.One * 8f - mouse;
							bool flag2 = false;
							float num4 = Math.Abs(vector.X);
							float num5 = vector.Length();
							if (num4 < num3)
							{
								flag2 = true;
							}
							if (num4 == num3 && (num2 == -1f || num5 < num2))
							{
								flag2 = true;
							}
							if (flag2)
							{
								num2 = num5;
								num3 = num4;
								tuple = list[k];
							}
						}
					}
					if (Collision.InTileBounds(tuple.Item1, tuple.Item2, LX, LY, HX, HY) && num2 != -1f)
					{
						fX = tuple.Item1;
						fY = tuple.Item2;
					}
				}
				list.Clear();
			}
		}

		// Token: 0x06000387 RID: 903 RVA: 0x00242948 File Offset: 0x00240B48
		private static void SmartCursor_Torch(Item item, ref Vector2 mouse, int LX, int HX, int LY, int HY, ref int fX, ref int fY, int tX, int tY)
		{
			if (item.createTile == 4 && fX == -1 && fY == -1)
			{
				List<Tuple<int, int>> list = new List<Tuple<int, int>>();
				bool flag = item.type != 1333 && item.type != 523;
				for (int i = LX; i <= HX; i++)
				{
					for (int j = LY; j <= HY; j++)
					{
						Tile tile = Main.tile[i, j];
						Tile tile2 = Main.tile[i - 1, j];
						Tile tile3 = Main.tile[i + 1, j];
						Tile tile4 = Main.tile[i, j + 1];
						if (!tile.active() || TileID.Sets.BreakableWhenPlacing[(int)tile.type] || (Main.tileCut[(int)tile.type] && tile.type != 82 && tile.type != 83))
						{
							bool flag2 = false;
							for (int k = i - 7; k <= i + 7; k++)
							{
								for (int l = j - 7; l <= j + 7; l++)
								{
									if (Main.tile[k, l] != null && Main.tile[k, l].type == 4)
									{
										flag2 = true;
										break;
									}
								}
								if (flag2)
								{
									break;
								}
							}
							if (!flag2 && (!flag || tile.liquid <= 0) && (tile.wall > 0 || (tile2.active() && (tile2.slope() == 0 || tile2.slope() % 2 != 1) && ((Main.tileSolid[(int)tile2.type] && !Main.tileNoAttach[(int)tile2.type] && !Main.tileSolidTop[(int)tile2.type] && !TileID.Sets.NotReallySolid[(int)tile2.type]) || tile2.type == 124 || (tile2.type == 5 && Main.tile[i - 1, j - 1].type == 5 && Main.tile[i - 1, j + 1].type == 5))) || (tile3.active() && (tile3.slope() == 0 || tile3.slope() % 2 != 0) && ((Main.tileSolid[(int)tile3.type] && !Main.tileNoAttach[(int)tile3.type] && !Main.tileSolidTop[(int)tile3.type] && !TileID.Sets.NotReallySolid[(int)tile3.type]) || tile3.type == 124 || (tile3.type == 5 && Main.tile[i + 1, j - 1].type == 5 && Main.tile[i + 1, j + 1].type == 5))) || (tile4.active() && Main.tileSolid[(int)tile4.type] && !Main.tileNoAttach[(int)tile4.type] && (!Main.tileSolidTop[(int)tile4.type] || (TileID.Sets.Platforms[(int)tile4.type] && tile4.slope() == 0)) && !TileID.Sets.NotReallySolid[(int)tile4.type] && !tile4.halfBrick() && tile4.slope() == 0)) && tile.type != 4)
							{
								list.Add(new Tuple<int, int>(i, j));
							}
						}
					}
				}
				if (list.Count > 0)
				{
					float num = -1f;
					Tuple<int, int> tuple = list[0];
					for (int m = 0; m < list.Count; m++)
					{
						float num2 = Vector2.Distance(new Vector2((float)list[m].Item1, (float)list[m].Item2) * 16f + Vector2.One * 8f, mouse);
						if (num == -1f || num2 < num)
						{
							num = num2;
							tuple = list[m];
						}
					}
					if (Collision.InTileBounds(tuple.Item1, tuple.Item2, LX, LY, HX, HY))
					{
						fX = tuple.Item1;
						fY = tuple.Item2;
					}
				}
				list.Clear();
			}
		}

		// Token: 0x06000384 RID: 900 RVA: 0x00241368 File Offset: 0x0023F568
		public void SmartInteractLookup()
		{
			if (this.whoAmI != Main.myPlayer)
			{
				return;
			}
			Main.SmartInteractShowingGenuine = false;
			Main.SmartInteractShowingFake = false;
			Main.SmartInteractNPC = -1;
			Main.SmartInteractNPCsNearby.Clear();
			Main.SmartInteractTileCoords.Clear();
			Main.SmartInteractTileCoordsSelected.Clear();
			Main.TileInteractionLX = (Main.TileInteractionHX = (Main.TileInteractionLY = (Main.TileInteractionHY = -1)));
			bool smartCursorEnabled = Main.SmartCursorEnabled;
			if (!smartCursorEnabled && !PlayerInput.UsingGamepad)
			{
				return;
			}
			Item arg_74_0 = this.inventory[this.selectedItem];
			Vector2 vector = Main.screenPosition + new Vector2((float)Main.mouseX, (float)Main.mouseY);
			if (this.gravDir == -1f)
			{
				vector.Y = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY;
			}
			int num = Player.tileTargetX;
			int num2 = Player.tileTargetY;
			if (num < 10)
			{
				num = 10;
			}
			if (num > Main.maxTilesX - 10)
			{
				num = Main.maxTilesX - 10;
			}
			if (num2 < 10)
			{
				num2 = 10;
			}
			if (num2 > Main.maxTilesY - 10)
			{
				num2 = Main.maxTilesY - 10;
			}
			bool flag = false;
			if (Main.tile[num, num2] == null)
			{
				return;
			}
			if (Main.tile[num, num2].active())
			{
				ushort type = Main.tile[num, num2].type;
				if (type <= 334)
				{
					if (type != 4 && type != 33 && type != 334)
					{
						goto IL_176;
					}
				}
				else if (type != 395 && type != 410 && type != 455)
				{
					goto IL_176;
				}
				flag = true;
			}
			IL_176:
			if (flag)
			{
				return;
			}
			int num3 = 0;
			int num4 = (int)(this.position.X / 16f) - Player.tileRangeX - num3 + 1;
			int num5 = (int)((this.position.X + (float)this.width) / 16f) + Player.tileRangeX + num3 - 1;
			int num6 = (int)(this.position.Y / 16f) - Player.tileRangeY - num3 + 1;
			int num7 = (int)((this.position.Y + (float)this.height) / 16f) + Player.tileRangeY + num3 - 2;
			num4 = Utils.Clamp<int>(num4, 10, Main.maxTilesX - 10);
			num5 = Utils.Clamp<int>(num5, 10, Main.maxTilesX - 10);
			num6 = Utils.Clamp<int>(num6, 10, Main.maxTilesY - 10);
			num7 = Utils.Clamp<int>(num7, 10, Main.maxTilesY - 10);
			List<Tuple<int, int>> list = new List<Tuple<int, int>>();
			for (int i = 0; i < this.grapCount; i++)
			{
				Projectile expr_271 = Main.projectile[this.grappling[i]];
				int item = (int)expr_271.Center.X / 16;
				int item2 = (int)expr_271.Center.Y / 16;
				list.Add(new Tuple<int, int>(item, item2));
			}
			int num8 = -1;
			int num9 = -1;
			int num10 = -1;
			Vector2 point = Main.ReverseGravitySupport(Main.MouseScreen, 0f) + Main.screenPosition;
			if (num8 == -1 && num9 == -1)
			{
				List<Tuple<int, int>> list2 = new List<Tuple<int, int>>();
				for (int j = num4; j <= num5; j++)
				{
					for (int k = num6; k <= num7; k++)
					{
						Tile tile = Main.tile[j, k];
						if (tile.active())
						{
							ushort type = tile.type;
							if (type <= 209)
							{
								if (type <= 97)
								{
									if (type <= 55)
									{
										if (type <= 21)
										{
											if (type - 10 > 1 && type != 21)
											{
												goto IL_5B7;
											}
										}
										else if (type != 29 && type != 55)
										{
											goto IL_5B7;
										}
									}
									else if (type <= 85)
									{
										if (type != 79 && type != 85)
										{
											goto IL_5B7;
										}
									}
									else if (type != 88 && type != 97)
									{
										goto IL_5B7;
									}
								}
								else if (type <= 136)
								{
									if (type <= 125)
									{
										if (type != 104 && type != 125)
										{
											goto IL_5B7;
										}
									}
									else if (type != 132 && type != 136)
									{
										goto IL_5B7;
									}
								}
								else if (type <= 144)
								{
									if (type != 139 && type != 144)
									{
										goto IL_5B7;
									}
								}
								else if (type != 207 && type != 209)
								{
									goto IL_5B7;
								}
							}
							else if (type <= 356)
							{
								if (type <= 287)
								{
									if (type <= 216)
									{
										if (type != 212)
										{
											if (type - 215 > 1)
											{
												goto IL_5B7;
											}
										}
										else
										{
											if (this.HasItem(949))
											{
												list2.Add(new Tuple<int, int>(j, k));
												goto IL_5B7;
											}
											goto IL_5B7;
										}
									}
									else if (type != 237)
									{
										if (type != 287)
										{
											goto IL_5B7;
										}
									}
									else
									{
										if (this.HasItem(1293))
										{
											list2.Add(new Tuple<int, int>(j, k));
											goto IL_5B7;
										}
										goto IL_5B7;
									}
								}
								else if (type <= 338)
								{
									if (type != 335 && type != 338)
									{
										goto IL_5B7;
									}
								}
								else if (type != 354)
								{
									if (type != 356)
									{
										goto IL_5B7;
									}
									if (!Main.fastForwardTime && (Main.netMode == 1 || Main.sundialCooldown == 0))
									{
										list2.Add(new Tuple<int, int>(j, k));
										goto IL_5B7;
									}
									goto IL_5B7;
								}
							}
							else if (type <= 425)
							{
								if (type <= 389)
								{
									if (type != 377 && type - 386 > 3)
									{
										goto IL_5B7;
									}
								}
								else if (type - 410 > 1 && type != 425)
								{
									goto IL_5B7;
								}
							}
							else if (type <= 455)
							{
								if (type != 441 && type != 455)
								{
									goto IL_5B7;
								}
							}
							else if (type != 463 && type - 467 > 1)
							{
								goto IL_5B7;
							}
							list2.Add(new Tuple<int, int>(j, k));
						}
						IL_5B7:;
					}
				}
				if (list2.Count > 0)
				{
					float num11 = -1f;
					Tuple<int, int> tuple = list2[0];
					for (int l = 0; l < list2.Count; l++)
					{
						float num12 = Vector2.Distance(new Vector2((float)list2[l].Item1, (float)list2[l].Item2) * 16f + Vector2.One * 8f, vector);
						if (num11 == -1f || num12 < num11)
						{
							num11 = num12;
							tuple = list2[l];
						}
					}
					if (Collision.InTileBounds(tuple.Item1, tuple.Item2, num4, num6, num5, num7))
					{
						num8 = tuple.Item1;
						num9 = tuple.Item2;
					}
				}
				bool flag2 = false;
				int m = 0;
				while (m < list2.Count)
				{
					int item3 = list2[m].Item1;
					int item4 = list2[m].Item2;
					Tile tile2 = Main.tile[item3, item4];
					int num13 = 0;
					int num14 = 0;
					int num15 = 18;
					int num16 = 18;
					int num17 = 0;
					int num18 = 2;
					ushort type = tile2.type;
					if (type <= 207)
					{
						if (type <= 88)
						{
							if (type <= 29)
							{
								if (type <= 11)
								{
									if (type != 10)
									{
										if (type == 11)
										{
											goto IL_999;
										}
									}
									else
									{
										num13 = 1;
										num14 = 3;
										num18 = 0;
									}
								}
								else
								{
									if (type == 21)
									{
										goto IL_986;
									}
									if (type == 29)
									{
										goto IL_97E;
									}
								}
							}
							else if (type <= 79)
							{
								if (type == 55)
								{
									goto IL_986;
								}
								if (type == 79)
								{
									num13 = 4;
									num14 = 2;
									num18 = 0;
								}
							}
							else
							{
								if (type == 85)
								{
									goto IL_986;
								}
								if (type == 88)
								{
									num13 = 3;
									num14 = 1;
									num18 = 0;
								}
							}
						}
						else if (type <= 132)
						{
							if (type <= 104)
							{
								if (type == 97)
								{
									goto IL_986;
								}
								if (type == 104)
								{
									num13 = 2;
									num14 = 5;
								}
							}
							else if (type == 125 || type == 132)
							{
								goto IL_986;
							}
						}
						else
						{
							if (type <= 139)
							{
								if (type != 136)
								{
									if (type != 139)
									{
										goto IL_9F9;
									}
									num13 = 2;
									num14 = 2;
									num18 = 0;
									goto IL_9F9;
								}
							}
							else if (type != 144)
							{
								if (type != 207)
								{
									goto IL_9F9;
								}
								num13 = 2;
								num14 = 4;
								num18 = 0;
								goto IL_9F9;
							}
							num13 = 1;
							num14 = 1;
							num18 = 0;
						}
					}
					else
					{
						if (type <= 356)
						{
							if (type <= 287)
							{
								if (type <= 216)
								{
									if (type == 209)
									{
										num13 = 4;
										num14 = 3;
										num18 = 0;
										goto IL_9F9;
									}
									switch (type)
									{
										case 212:
											num13 = 4;
											num14 = 3;
											goto IL_9F9;
										case 213:
										case 214:
											goto IL_9F9;
										case 215:
											goto IL_9C2;
										case 216:
											break;
										default:
											goto IL_9F9;
									}
								}
								else
								{
									if (type == 237)
									{
										goto IL_9C2;
									}
									if (type != 287)
									{
										goto IL_9F9;
									}
									goto IL_986;
								}
							}
							else if (type <= 338)
							{
								if (type == 335)
								{
									goto IL_986;
								}
								if (type != 338)
								{
									goto IL_9F9;
								}
							}
							else
							{
								if (type == 354)
								{
									goto IL_9CA;
								}
								if (type != 356)
								{
									goto IL_9F9;
								}
								goto IL_999;
							}
							num13 = 1;
							num14 = 2;
							goto IL_9F9;
						}
						if (type <= 411)
						{
							if (type <= 389)
							{
								if (type != 377)
								{
									switch (type)
									{
										case 386:
											goto IL_986;
										case 387:
											goto IL_97E;
										case 388:
										case 389:
											num13 = 1;
											num14 = 5;
											goto IL_9F9;
										default:
											goto IL_9F9;
									}
								}
							}
							else
							{
								if (type == 410)
								{
									goto IL_999;
								}
								if (type != 411)
								{
									goto IL_9F9;
								}
								goto IL_986;
							}
						}
						else if (type <= 441)
						{
							if (type != 425 && type != 441)
							{
								goto IL_9F9;
							}
							goto IL_986;
						}
						else
						{
							if (type == 455)
							{
								goto IL_9CA;
							}
							if (type == 463)
							{
								num13 = 3;
								num14 = 4;
								goto IL_9F9;
							}
							if (type - 467 > 1)
							{
								goto IL_9F9;
							}
							goto IL_986;
						}
						IL_9C2:
						num13 = 3;
						num14 = 2;
						goto IL_9F9;
						IL_9CA:
						num13 = 3;
						num14 = 3;
						num18 = 0;
					}
					IL_9F9:
					if (num13 != 0 && num14 != 0)
					{
						int num19 = item3 - (int)tile2.frameX % (num15 * num13 + num17) / num15;
						int num20 = item4 - (int)tile2.frameY % (num16 * num14 + num18) / num16;
						bool flag3 = Collision.InTileBounds(num8, num9, num19, num20, num19 + num13 - 1, num20 + num14 - 1);
						if (!smartCursorEnabled)
						{
							flag3 = (flag3 && Collision.InTileBounds((int)vector.X / 16, (int)vector.Y / 16, num19, num20, num19 + num13 - 1, num20 + num14 - 1));
						}
						if (flag2)
						{
							flag3 = false;
						}
						if (!flag2 & flag3)
						{
							flag2 = true;
						}
						for (int n = num19; n < num19 + num13; n++)
						{
							for (int num21 = num20; num21 < num20 + num14; num21++)
							{
								Point item5 = new Point(n, num21);
								if (!Main.SmartInteractTileCoords.Contains(item5))
								{
									if (flag3)
									{
										Main.SmartInteractTileCoordsSelected.Add(item5);
									}
									if (flag3 | smartCursorEnabled)
									{
										Main.SmartInteractTileCoords.Add(item5);
									}
								}
							}
						}
					}
					m++;
					continue;
					IL_97E:
					num13 = 2;
					num14 = 1;
					goto IL_9F9;
					IL_986:
					num13 = 2;
					num14 = 2;
					goto IL_9F9;
					IL_999:
					num13 = 2;
					num14 = 3;
					num18 = 0;
					goto IL_9F9;
				}
				list2.Clear();
			}
			if (num10 == -1 & smartCursorEnabled)
			{
				Rectangle value = new Rectangle(num4 * 16, num6 * 16, (num5 - num4) * 16 + 16, (num7 - num6) * 16 + 16);
				bool flag4 = false;
				for (int num22 = 0; num22 < 200; num22++)
				{
					NPC nPC = Main.npc[num22];
					if (nPC.active && nPC.townNPC && nPC.Hitbox.Intersects(value))
					{
						Main.SmartInteractNPCsNearby.Add(num22);
						if (!flag4)
						{
							float num23 = nPC.Hitbox.Distance(point);
							if (num10 == -1 || Main.npc[num10].Hitbox.Distance(point) > num23)
							{
								num10 = num22;
							}
							if (num23 == 0f)
							{
								flag4 = true;
								num10 = num22;
								break;
							}
						}
					}
				}
				if (flag4)
				{
					num9 = (num8 = -1);
					Main.SmartInteractTileCoordsSelected.Clear();
				}
			}
			if (num8 != -1 && num9 != -1 && num10 != -1)
			{
				Rectangle arg_C3E_0 = new Rectangle(num8 * 16, num9 * 16, 16, 16);
				Rectangle hitbox = Main.npc[num10].Hitbox;
				if (arg_C3E_0.Distance(point) < hitbox.Distance(point))
				{
					num10 = -1;
				}
				else
				{
					num9 = (num8 = -1);
					Main.SmartInteractTileCoordsSelected.Clear();
				}
			}
			if (UILinkPointNavigator.InUse || (PlayerInput.UsingGamepad && Main.HoveringOverAnNPC))
			{
				Main.SmartInteractTileCoordsSelected.Clear();
			}
			if (PlayerInput.UsingGamepad && !Main.SmartCursorEnabled)
			{
				if (num8 != -1 && num9 != -1)
				{
					Main.TileInteractionLX = num4 - 10;
					Main.TileInteractionLY = num6 - 10;
					Main.TileInteractionHX = num5 + 10;
					Main.TileInteractionHY = num7 + 10;
					Main.SmartInteractShowingFake = (Main.SmartInteractTileCoords.Count > 0);
				}
			}
			else
			{
				if (num8 != -1 && num9 != -1)
				{
					Main.SmartInteractX = num8;
					Main.SmartInteractY = num9;
					Main.SmartInteractShowingGenuine = true;
					Main.TileInteractionLX = num4 - 10;
					Main.TileInteractionLY = num6 - 10;
					Main.TileInteractionHX = num5 + 10;
					Main.TileInteractionHY = num7 + 10;
				}
				if (num10 != -1)
				{
					Main.SmartInteractNPC = num10;
					Main.SmartInteractShowingGenuine = true;
				}
			}
			list.Clear();
		}

		// Token: 0x06000388 RID: 904 RVA: 0x00242D70 File Offset: 0x00240F70
		public void SmartSelectLookup()
		{
			if (this.controlTorch && this.itemAnimation == 0)
			{
				int num = 0;
				int num2 = (int)(((float)Main.mouseX + Main.screenPosition.X) / 16f);
				int num3 = (int)(((float)Main.mouseY + Main.screenPosition.Y) / 16f);
				if (this.gravDir == -1f)
				{
					num3 = (int)((Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16f);
				}
				int num4 = -10;
				int num5 = -10;
				int num6 = -10;
				int num7 = -10;
				int num8 = -10;
				for (int i = 0; i < 50; i++)
				{
					if (this.inventory[i].pick > 0 && num4 == -10)
					{
						num4 = this.inventory[i].tileBoost;
					}
					if (this.inventory[i].axe > 0 && num5 == -10)
					{
						num5 = this.inventory[i].tileBoost;
					}
					if (this.inventory[i].hammer > 0 && num6 == -10)
					{
						num6 = this.inventory[i].tileBoost;
					}
					if ((this.inventory[i].type == 929 || this.inventory[i].type == 1338 || this.inventory[i].type == 1345) && num7 == -10)
					{
						num7 = this.inventory[i].tileBoost;
					}
					if ((this.inventory[i].type == 424 || this.inventory[i].type == 1103) && num8 == -10)
					{
						num8 = this.inventory[i].tileBoost;
					}
				}
				int num9 = 0;
				int num10 = 0;
				if (this.position.X / 16f >= (float)num2)
				{
					num9 = (int)(this.position.X / 16f) - num2;
				}
				if ((this.position.X + (float)this.width) / 16f <= (float)num2)
				{
					num9 = num2 - (int)((this.position.X + (float)this.width) / 16f);
				}
				if (this.position.Y / 16f >= (float)num3)
				{
					num10 = (int)(this.position.Y / 16f) - num3;
				}
				if ((this.position.Y + (float)this.height) / 16f <= (float)num3)
				{
					num10 = num3 - (int)((this.position.Y + (float)this.height) / 16f);
				}
				bool flag = false;
				bool flag2 = false;
				try
				{
					flag2 = (Main.tile[num2, num3].liquid > 0);
					if (Main.tile[num2, num3].active())
					{
						int type = (int)Main.tile[num2, num3].type;
						if (type == 219 && num9 <= num8 + Player.tileRangeX && num10 <= num8 + Player.tileRangeY)
						{
							num = 7;
							flag = true;
						}
						else if (type == 209 && num9 <= num7 + Player.tileRangeX && num10 <= num7 + Player.tileRangeY)
						{
							num = 6;
							flag = true;
						}
						else if (Main.tileHammer[type] && num9 <= num6 + Player.tileRangeX && num10 <= num6 + Player.tileRangeY)
						{
							num = 1;
							flag = true;
						}
						else if (Main.tileAxe[type] && num9 <= num5 + Player.tileRangeX && num10 <= num5 + Player.tileRangeY)
						{
							num = 2;
							flag = true;
						}
						else if (num9 <= num4 + Player.tileRangeX && num10 <= num4 + Player.tileRangeY)
						{
							num = 3;
							flag = true;
						}
					}
					else if (flag2 && this.wet)
					{
						num = 4;
						flag = true;
					}
				}
				catch
				{
				}
				if (!flag && this.wet)
				{
					num = 4;
				}
				if (num == 0 || num == 4)
				{
					float arg_410_0 = Math.Abs((float)Main.mouseX + Main.screenPosition.X - (this.position.X + (float)(this.width / 2)));
					float num11 = Math.Abs((float)Main.mouseY + Main.screenPosition.Y - (this.position.Y + (float)(this.height / 2))) * 1.3f;
					if ((float)Math.Sqrt((double)(arg_410_0 * arg_410_0 + num11 * num11)) > 200f)
					{
						num = 5;
					}
				}
				for (int j = 0; j < 50; j++)
				{
					int type2 = this.inventory[j].type;
					if (num == 0)
					{
						if (type2 == 8 || type2 == 427 || type2 == 428 || type2 == 429 || type2 == 430 || type2 == 431 || type2 == 432 || type2 == 433 || type2 == 523 || type2 == 974 || type2 == 1245 || type2 == 1333 || type2 == 2274 || type2 == 3004 || type2 == 3045 || type2 == 3114)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
						if (type2 == 282 || type2 == 286 || type2 == 3002 || type2 == 3112)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
						}
					}
					else if (num == 1)
					{
						if (this.inventory[j].hammer > 0)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
					}
					else if (num == 2)
					{
						if (this.inventory[j].axe > 0)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
					}
					else if (num == 3)
					{
						if (this.inventory[j].pick > 0)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
					}
					else if (num == 4)
					{
						if (this.inventory[j].type != 282 && this.inventory[j].type != 286 && this.inventory[j].type != 3002 && this.inventory[j].type != 3112 && this.inventory[j].type != 930 && (type2 == 8 || type2 == 427 || type2 == 428 || type2 == 429 || type2 == 430 || type2 == 431 || type2 == 432 || type2 == 433 || type2 == 974 || type2 == 1245 || type2 == 2274 || type2 == 3004 || type2 == 3045 || type2 == 3114))
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							if (this.inventory[this.selectedItem].createTile != 4)
							{
								this.selectedItem = j;
							}
						}
						else
						{
							if ((type2 == 282 || type2 == 286 || type2 == 3002 || type2 == 3112) & flag2)
							{
								if (this.nonTorch == -1)
								{
									this.nonTorch = this.selectedItem;
								}
								this.selectedItem = j;
								return;
							}
							if (type2 == 930 & flag2)
							{
								bool flag3 = false;
								for (int k = 57; k >= 0; k--)
								{
									if (this.inventory[k].ammo == this.inventory[j].useAmmo)
									{
										flag3 = true;
										break;
									}
								}
								if (flag3)
								{
									if (this.nonTorch == -1)
									{
										this.nonTorch = this.selectedItem;
									}
									this.selectedItem = j;
									return;
								}
							}
							else if (type2 == 1333 || type2 == 523)
							{
								if (this.nonTorch == -1)
								{
									this.nonTorch = this.selectedItem;
								}
								this.selectedItem = j;
								return;
							}
						}
					}
					else if (num == 5)
					{
						if (type2 == 8 || type2 == 427 || type2 == 428 || type2 == 429 || type2 == 430 || type2 == 431 || type2 == 432 || type2 == 433 || type2 == 523 || type2 == 974 || type2 == 1245 || type2 == 1333 || type2 == 2274 || type2 == 3004 || type2 == 3045 || type2 == 3114)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							if (this.inventory[this.selectedItem].createTile != 4)
							{
								this.selectedItem = j;
							}
						}
						else if (type2 == 930)
						{
							bool flag4 = false;
							for (int l = 57; l >= 0; l--)
							{
								if (this.inventory[l].ammo == this.inventory[j].useAmmo)
								{
									flag4 = true;
									break;
								}
							}
							if (flag4)
							{
								if (this.nonTorch == -1)
								{
									this.nonTorch = this.selectedItem;
								}
								this.selectedItem = j;
								return;
							}
						}
						else if (type2 == 282 || type2 == 286 || type2 == 3002 || type2 == 3112)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
					}
					else if (num == 6)
					{
						int num12 = 929;
						if (Main.tile[num2, num3].frameX >= 144)
						{
							num12 = 1345;
						}
						else if (Main.tile[num2, num3].frameX >= 72)
						{
							num12 = 1338;
						}
						if (type2 == num12)
						{
							if (this.nonTorch == -1)
							{
								this.nonTorch = this.selectedItem;
							}
							this.selectedItem = j;
							return;
						}
					}
					else if (num == 7 && ItemID.Sets.ExtractinatorMode[type2] >= 0)
					{
						if (this.nonTorch == -1)
						{
							this.nonTorch = this.selectedItem;
						}
						this.selectedItem = j;
						return;
					}
				}
				return;
			}
			if (this.itemAnimation == 0 && this.DpadRadial.SelectedItem != -1 && this.inventory[this.DpadRadial.SelectedItem].stack > 0)
			{
				if (this.nonTorch == -1)
				{
					this.nonTorch = this.selectedItem;
				}
				this.selectedItem = this.DpadRadial.SelectedItem;
				return;
			}
			if (this.itemAnimation == 0 && this.CircularRadial.SelectedItem != -1 && this.inventory[this.CircularRadial.SelectedItem].stack > 0)
			{
				if (this.nonTorch == -1)
				{
					this.nonTorch = this.selectedItem;
				}
				this.selectedItem = this.CircularRadial.SelectedItem;
				return;
			}
			if (this.nonTorch > -1 && this.itemAnimation == 0)
			{
				this.selectedItem = this.nonTorch;
				this.nonTorch = -1;
			}
		}

		// Token: 0x060003CB RID: 971 RVA: 0x00263CB0 File Offset: 0x00261EB0
		public void Spawn()
		{
			Main.InitLifeBytes();
			if (this.whoAmI == Main.myPlayer)
			{
				if (Main.mapTime < 5)
				{
					Main.mapTime = 5;
				}
				Main.quickBG = 10;
				this.FindSpawn();
				if (!Player.CheckSpawn(this.SpawnX, this.SpawnY))
				{
					this.SpawnX = -1;
					this.SpawnY = -1;
				}
				Main.maxQ = true;
			}
			if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
			{
				NetMessage.SendData(12, -1, -1, null, Main.myPlayer, 0f, 0f, 0f, 0, 0, 0);
				Main.gameMenu = false;
			}
			this.headPosition = Vector2.Zero;
			this.bodyPosition = Vector2.Zero;
			this.legPosition = Vector2.Zero;
			this.headRotation = 0f;
			this.bodyRotation = 0f;
			this.legRotation = 0f;
			this.lavaTime = this.lavaMax;
			if (this.statLife <= 0)
			{
				int num = this.statLifeMax2 / 2;
				this.statLife = 100;
				if (num > this.statLife)
				{
					this.statLife = num;
				}
				this.breath = this.breathMax;
				if (this.spawnMax)
				{
					this.statLife = this.statLifeMax2;
					this.statMana = this.statManaMax2;
				}
			}
			this.immune = true;
			this.dead = false;
			this.immuneTime = 0;
			this.active = true;
			if (this.SpawnX >= 0 && this.SpawnY >= 0)
			{
				this.position.X = (float)(this.SpawnX * 16 + 8 - this.width / 2);
				this.position.Y = (float)(this.SpawnY * 16 - this.height);
			}
			else
			{
				this.position.X = (float)(Main.spawnTileX * 16 + 8 - this.width / 2);
				this.position.Y = (float)(Main.spawnTileY * 16 - this.height);
				for (int i = Main.spawnTileX - 1; i < Main.spawnTileX + 2; i++)
				{
					for (int j = Main.spawnTileY - 3; j < Main.spawnTileY; j++)
					{
						if (Main.tile[i, j] != null)
						{
							if (Main.tileSolid[(int)Main.tile[i, j].type] && !Main.tileSolidTop[(int)Main.tile[i, j].type])
							{
								WorldGen.KillTile(i, j, false, false, false);
							}
							if (Main.tile[i, j].liquid > 0)
							{
								Main.tile[i, j].lava(false);
								Main.tile[i, j].liquid = 0;
								WorldGen.SquareTileFrame(i, j, true);
							}
						}
					}
				}
			}
			this.wet = false;
			this.wetCount = 0;
			this.lavaWet = false;
			this.fallStart = (int)(this.position.Y / 16f);
			this.fallStart2 = this.fallStart;
			this.velocity.X = 0f;
			this.velocity.Y = 0f;
			for (int k = 0; k < 3; k++)
			{
				this.UpdateSocialShadow();
			}
			this.oldPosition = this.position + this.BlehOldPositionFixer;
			this.talkNPC = -1;
			if (this.whoAmI == Main.myPlayer)
			{
				Main.npcChatCornerItem = 0;
			}
			if (this.pvpDeath)
			{
				this.pvpDeath = false;
				this.immuneTime = 300;
				this.statLife = this.statLifeMax;
			}
			else
			{
				this.immuneTime = 60;
			}
			if (this.whoAmI == Main.myPlayer)
			{
				Main.BlackFadeIn = 255;
				Main.renderNow = true;
				if (Main.netMode == 1)
				{
					Netplay.newRecent();
				}
				Main.screenPosition.X = this.position.X + (float)(this.width / 2) - (float)(Main.screenWidth / 2);
				Main.screenPosition.Y = this.position.Y + (float)(this.height / 2) - (float)(Main.screenHeight / 2);
			}
		}

		// Token: 0x060003E7 RID: 999 RVA: 0x0026C544 File Offset: 0x0026A744
		public void SporeSac()
		{
			int damage = 70;
			float knockBack = 1.5f;
			if (Main.rand.Next(15) == 0)
			{
				int num = 0;
				for (int i = 0; i < 1000; i++)
				{
					if (Main.projectile[i].active && Main.projectile[i].owner == this.whoAmI && (Main.projectile[i].type == 567 || Main.projectile[i].type == 568))
					{
						num++;
					}
				}
				if (Main.rand.Next(15) >= num && num < 10)
				{
					int num2 = 50;
					int num3 = 24;
					int num4 = 90;
					for (int j = 0; j < num2; j++)
					{
						int num5 = Main.rand.Next(200 - j * 2, 400 + j * 2);
						Vector2 center = base.Center;
						center.X += (float)Main.rand.Next(-num5, num5 + 1);
						center.Y += (float)Main.rand.Next(-num5, num5 + 1);
						if (!Collision.SolidCollision(center, num3, num3) && !Collision.WetCollision(center, num3, num3))
						{
							center.X += (float)(num3 / 2);
							center.Y += (float)(num3 / 2);
							if (Collision.CanHit(new Vector2(base.Center.X, this.position.Y), 1, 1, center, 1, 1) || Collision.CanHit(new Vector2(base.Center.X, this.position.Y - 50f), 1, 1, center, 1, 1))
							{
								int num6 = (int)center.X / 16;
								int num7 = (int)center.Y / 16;
								bool flag = false;
								if (Main.rand.Next(3) == 0 && Main.tile[num6, num7] != null && Main.tile[num6, num7].wall > 0)
								{
									flag = true;
								}
								else
								{
									center.X -= (float)(num4 / 2);
									center.Y -= (float)(num4 / 2);
									if (Collision.SolidCollision(center, num4, num4))
									{
										center.X += (float)(num4 / 2);
										center.Y += (float)(num4 / 2);
										flag = true;
									}
								}
								if (flag)
								{
									for (int k = 0; k < 1000; k++)
									{
										if (Main.projectile[k].active && Main.projectile[k].owner == this.whoAmI && Main.projectile[k].aiStyle == 105 && (center - Main.projectile[k].Center).Length() < 48f)
										{
											flag = false;
											break;
										}
									}
									if (flag && Main.myPlayer == this.whoAmI)
									{
										Projectile.NewProjectile(center.X, center.Y, 0f, 0f, 567 + Main.rand.Next(2), damage, knockBack, this.whoAmI, 0f, 0f);
										return;
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06000360 RID: 864 RVA: 0x00228668 File Offset: 0x00226868
		public void StatusNPC(int type, int i)
		{
			if (this.meleeEnchant > 0)
			{
				if (this.meleeEnchant == 1)
				{
					Main.npc[i].AddBuff(70, 60 * Main.rand.Next(5, 10), false);
				}
				if (this.meleeEnchant == 2)
				{
					Main.npc[i].AddBuff(39, 60 * Main.rand.Next(3, 7), false);
				}
				if (this.meleeEnchant == 3)
				{
					Main.npc[i].AddBuff(24, 60 * Main.rand.Next(3, 7), false);
				}
				if (this.meleeEnchant == 5)
				{
					Main.npc[i].AddBuff(69, 60 * Main.rand.Next(10, 20), false);
				}
				if (this.meleeEnchant == 6)
				{
					Main.npc[i].AddBuff(31, 60 * Main.rand.Next(1, 4), false);
				}
				if (this.meleeEnchant == 8)
				{
					Main.npc[i].AddBuff(20, 60 * Main.rand.Next(5, 10), false);
				}
				if (this.meleeEnchant == 4)
				{
					Main.npc[i].AddBuff(72, 120, false);
				}
			}
			if (this.frostBurn)
			{
				Main.npc[i].AddBuff(44, 60 * Main.rand.Next(5, 15), false);
			}
			if (this.magmaStone)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.npc[i].AddBuff(24, 360, false);
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.npc[i].AddBuff(24, 240, false);
				}
				else
				{
					Main.npc[i].AddBuff(24, 120, false);
				}
			}
			if (type == 3211)
			{
				Main.npc[i].AddBuff(69, 60 * Main.rand.Next(5, 10), false);
			}
			if (type == 121)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.npc[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 3823)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.npc[i].AddBuff(24, 300, false);
					return;
				}
			}
			else if (type == 122)
			{
				if (Main.rand.Next(10) == 0)
				{
					Main.npc[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 190)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.npc[i].AddBuff(20, 420, false);
					return;
				}
			}
			else if (type == 217)
			{
				if (Main.rand.Next(5) == 0)
				{
					Main.npc[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 1123 && Main.rand.Next(10) != 0)
			{
				Main.npc[i].AddBuff(31, 120, false);
			}
		}

		// Token: 0x0600039B RID: 923 RVA: 0x0024B58C File Offset: 0x0024978C
		public void StatusPlayer(NPC npc)
		{
			if (Main.expertMode && ((npc.type == 266 && Main.rand.Next(3) == 0) || npc.type == 267))
			{
				int num = Main.rand.Next(9);
				if (num == 2 || num == 4)
				{
					num = Main.rand.Next(9);
				}
				float num2 = (float)Main.rand.Next(75, 150) * 0.01f;
				if (num == 0)
				{
					this.AddBuff(20, (int)(60f * num2 * 3.5f), true);
				}
				else if (num == 1)
				{
					this.AddBuff(22, (int)(60f * num2 * 2f), true);
				}
				else if (num == 2)
				{
					this.AddBuff(23, (int)(60f * num2 * 0.5f), true);
				}
				else if (num == 3)
				{
					this.AddBuff(30, (int)(60f * num2 * 5f), true);
				}
				else if (num == 4)
				{
					this.AddBuff(31, (int)(60f * num2 * 1f), true);
				}
				else if (num == 5)
				{
					this.AddBuff(32, (int)(60f * num2 * 3.5f), true);
				}
				else if (num == 6)
				{
					this.AddBuff(33, (int)(60f * num2 * 7.5f), true);
				}
				else if (num == 7)
				{
					this.AddBuff(35, (int)(60f * num2 * 1f), true);
				}
				else if (num == 8)
				{
					this.AddBuff(36, (int)((double)(60f * num2) * 6.5), true);
				}
			}
			if (npc.type == 530 || npc.type == 531)
			{
				this.AddBuff(70, Main.rand.Next(240, 481), true);
			}
			if (npc.type == 159 || npc.type == 158)
			{
				this.AddBuff(30, Main.rand.Next(300, 600), true);
			}
			if (npc.type == 525)
			{
				this.AddBuff(39, 420, true);
			}
			if (npc.type == 526)
			{
				this.AddBuff(69, 420, true);
			}
			if (npc.type == 527)
			{
				this.AddBuff(31, 840, true);
			}
			if (Main.expertMode && (npc.type == 49 || npc.type == 93 || npc.type == 51 || npc.type == 152) && Main.rand.Next(10) == 0)
			{
				this.AddBuff(148, Main.rand.Next(1800, 5400), true);
			}
			if (Main.expertMode && npc.type == 222)
			{
				this.AddBuff(20, Main.rand.Next(60, 240), true);
			}
			if (Main.expertMode && (npc.type == 210 || npc.type == 211))
			{
				this.AddBuff(20, Main.rand.Next(60, 180), true);
			}
			if (Main.expertMode && npc.type == 35)
			{
				this.AddBuff(30, Main.rand.Next(180, 300), true);
			}
			if (Main.expertMode && npc.type == 36 && Main.rand.Next(2) == 0)
			{
				this.AddBuff(32, Main.rand.Next(30, 60), true);
			}
			if (npc.type >= 269 && npc.type <= 272)
			{
				if (Main.rand.Next(3) == 0)
				{
					this.AddBuff(30, 600, true);
				}
				else if (Main.rand.Next(3) == 0)
				{
					this.AddBuff(32, 300, true);
				}
			}
			if (npc.type >= 273 && npc.type <= 276 && Main.rand.Next(2) == 0)
			{
				this.AddBuff(36, 600, true);
			}
			if (npc.type >= 277 && npc.type <= 280)
			{
				this.AddBuff(24, 600, true);
			}
			if (npc.type == 371)
			{
				this.AddBuff(103, 60 * Main.rand.Next(3, 8), true);
			}
			if (npc.type == 370 && Main.expertMode)
			{
				int num3 = Utils.SelectRandom<int>(Main.rand, new int[]
				{
					0,
					148,
					30
				});
				if (num3 != 0)
				{
					this.AddBuff(num3, 60 * Main.rand.Next(3, 11), true);
				}
			}
			if (((npc.type == 1 && npc.netID == -6) || npc.type == 81 || npc.type == 79) && Main.rand.Next(4) == 0)
			{
				this.AddBuff(22, 900, true);
			}
			if ((npc.type == 23 || npc.type == 25) && Main.rand.Next(3) == 0)
			{
				this.AddBuff(24, 420, true);
			}
			if ((npc.type == 34 || npc.type == 83 || npc.type == 84) && Main.rand.Next(3) == 0)
			{
				this.AddBuff(23, 240, true);
			}
			if ((npc.type == 104 || npc.type == 102) && Main.rand.Next(8) == 0)
			{
				this.AddBuff(30, 2700, true);
			}
			if (npc.type == 75 && Main.rand.Next(10) == 0)
			{
				this.AddBuff(35, 420, true);
			}
			if ((npc.type == 163 || npc.type == 238) && Main.rand.Next(10) == 0)
			{
				this.AddBuff(70, 480, true);
			}
			if ((npc.type == 79 || npc.type == 103) && Main.rand.Next(5) == 0)
			{
				this.AddBuff(35, 420, true);
			}
			if ((npc.type == 75 || npc.type == 78 || npc.type == 82) && Main.rand.Next(8) == 0)
			{
				this.AddBuff(32, 900, true);
			}
			if ((npc.type == 93 || npc.type == 109 || npc.type == 80) && Main.rand.Next(14) == 0)
			{
				this.AddBuff(31, 300, true);
			}
			if (npc.type >= 305 && npc.type <= 314 && Main.rand.Next(10) == 0)
			{
				this.AddBuff(33, 3600, true);
			}
			if (npc.type == 77 && Main.rand.Next(6) == 0)
			{
				this.AddBuff(36, 7200, true);
			}
			if (npc.type == 112 && Main.rand.Next(20) == 0)
			{
				this.AddBuff(33, 18000, true);
			}
			if (npc.type == 182 && Main.rand.Next(25) == 0)
			{
				this.AddBuff(33, 7200, true);
			}
			if (npc.type == 141 && Main.rand.Next(2) == 0)
			{
				this.AddBuff(20, 600, true);
			}
			if (npc.type == 147 && !this.frozen && Main.rand.Next(12) == 0)
			{
				this.AddBuff(46, 600, true);
			}
			if (npc.type == 150)
			{
				if (Main.rand.Next(2) == 0)
				{
					this.AddBuff(46, 900, true);
				}
				if (!this.frozen && Main.rand.Next(35) == 0)
				{
					this.AddBuff(47, 60, true);
				}
				else if (!this.frozen && Main.expertMode && Main.rand.Next(35) == 0)
				{
					this.AddBuff(47, 60, true);
				}
			}
			if (npc.type == 184)
			{
				this.AddBuff(46, 1200, true);
				if (!this.frozen && Main.rand.Next(15) == 0)
				{
					this.AddBuff(47, 60, true);
					return;
				}
				if (!this.frozen && Main.expertMode && Main.rand.Next(25) == 0)
				{
					this.AddBuff(47, 60, true);
				}
			}
		}

		// Token: 0x06000361 RID: 865 RVA: 0x00228934 File Offset: 0x00226B34
		public void StatusPvP(int type, int i)
		{
			if (this.meleeEnchant > 0)
			{
				if (this.meleeEnchant == 1)
				{
					Main.player[i].AddBuff(70, 60 * Main.rand.Next(5, 10), true);
				}
				if (this.meleeEnchant == 2)
				{
					Main.player[i].AddBuff(39, 60 * Main.rand.Next(3, 7), true);
				}
				if (this.meleeEnchant == 3)
				{
					Main.player[i].AddBuff(24, 60 * Main.rand.Next(3, 7), true);
				}
				if (this.meleeEnchant == 5)
				{
					Main.player[i].AddBuff(69, 60 * Main.rand.Next(10, 20), true);
				}
				if (this.meleeEnchant == 6)
				{
					Main.player[i].AddBuff(31, 60 * Main.rand.Next(1, 4), true);
				}
				if (this.meleeEnchant == 8)
				{
					Main.player[i].AddBuff(20, 60 * Main.rand.Next(5, 10), true);
				}
			}
			if (this.frostBurn)
			{
				Main.player[i].AddBuff(44, 60 * Main.rand.Next(1, 8), true);
			}
			if (this.magmaStone)
			{
				if (Main.rand.Next(7) == 0)
				{
					Main.player[i].AddBuff(24, 360, true);
				}
				else if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(24, 120, true);
				}
				else
				{
					Main.player[i].AddBuff(24, 60, true);
				}
			}
			if (type == 121)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 3823)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(24, 300, true);
					return;
				}
			}
			else if (type == 122)
			{
				if (Main.rand.Next(10) == 0)
				{
					Main.player[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 190)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(20, 420, false);
					return;
				}
			}
			else if (type == 217)
			{
				if (Main.rand.Next(5) == 0)
				{
					Main.player[i].AddBuff(24, 180, false);
					return;
				}
			}
			else if (type == 1123 && Main.rand.Next(9) != 0)
			{
				Main.player[i].AddBuff(31, 120, false);
			}
		}

		// Token: 0x0600039D RID: 925 RVA: 0x0024C6E4 File Offset: 0x0024A8E4
		public void StickyMovement()
		{
			bool flag = false;
			if (this.mount.Type == 6 && Math.Abs(this.velocity.X) > 5f)
			{
				flag = true;
			}
			if (this.mount.Type == 13 && Math.Abs(this.velocity.X) > 5f)
			{
				flag = true;
			}
			if (this.mount.Type == 11 && Math.Abs(this.velocity.X) > 5f)
			{
				flag = true;
			}
			int num = this.width / 2;
			int num2 = this.height / 2;
			new Vector2(this.position.X + (float)(this.width / 2) - (float)(num / 2), this.position.Y + (float)(this.height / 2) - (float)(num2 / 2));
			Vector2 vector = Collision.StickyTiles(this.position, this.velocity, this.width, this.height);
			if (vector.Y != -1f && vector.X != -1f)
			{
				int num3 = (int)vector.X;
				int num4 = (int)vector.Y;
				int type = (int)Main.tile[num3, num4].type;
				if (this.whoAmI == Main.myPlayer && type == 51 && (this.velocity.X != 0f || this.velocity.Y != 0f))
				{
					this.stickyBreak++;
					if (this.stickyBreak > Main.rand.Next(20, 100) | flag)
					{
						this.stickyBreak = 0;
						WorldGen.KillTile(num3, num4, false, false, false);
						if (Main.netMode == 1 && !Main.tile[num3, num4].active() && Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 0, (float)num3, (float)num4, 0f, 0, 0, 0);
						}
					}
				}
				if (flag)
				{
					return;
				}
				this.fallStart = (int)(this.position.Y / 16f);
				if (type != 229)
				{
					this.jump = 0;
				}
				if (this.velocity.X > 1f)
				{
					this.velocity.X = 1f;
				}
				if (this.velocity.X < -1f)
				{
					this.velocity.X = -1f;
				}
				if (this.velocity.Y > 1f)
				{
					this.velocity.Y = 1f;
				}
				if (this.velocity.Y < -5f)
				{
					this.velocity.Y = -5f;
				}
				if ((double)this.velocity.X > 0.75 || (double)this.velocity.X < -0.75)
				{
					this.velocity.X = this.velocity.X * 0.85f;
				}
				else
				{
					this.velocity.X = this.velocity.X * 0.6f;
				}
				if (this.velocity.Y < 0f)
				{
					this.velocity.Y = this.velocity.Y * 0.96f;
				}
				else
				{
					this.velocity.Y = this.velocity.Y * 0.3f;
				}
				if (type == 229 && Main.rand.Next(5) == 0 && ((double)this.velocity.Y > 0.15 || this.velocity.Y < 0f))
				{
					if ((float)(num3 * 16) < this.position.X + (float)(this.width / 2))
					{
						int num5 = Dust.NewDust(new Vector2(this.position.X - 4f, (float)(num4 * 16)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
						Main.dust[num5].scale += (float)Main.rand.Next(0, 6) * 0.1f;
						Main.dust[num5].velocity *= 0.1f;
						Main.dust[num5].noGravity = true;
					}
					else
					{
						int num6 = Dust.NewDust(new Vector2(this.position.X + (float)this.width - 2f, (float)(num4 * 16)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
						Main.dust[num6].scale += (float)Main.rand.Next(0, 6) * 0.1f;
						Main.dust[num6].velocity *= 0.1f;
						Main.dust[num6].noGravity = true;
					}
					if (Main.tile[num3, num4 + 1] != null && Main.tile[num3, num4 + 1].type == 229 && this.position.Y + (float)this.height > (float)((num4 + 1) * 16))
					{
						if ((float)(num3 * 16) < this.position.X + (float)(this.width / 2))
						{
							int num7 = Dust.NewDust(new Vector2(this.position.X - 4f, (float)(num4 * 16 + 16)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
							Main.dust[num7].scale += (float)Main.rand.Next(0, 6) * 0.1f;
							Main.dust[num7].velocity *= 0.1f;
							Main.dust[num7].noGravity = true;
						}
						else
						{
							int num8 = Dust.NewDust(new Vector2(this.position.X + (float)this.width - 2f, (float)(num4 * 16 + 16)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
							Main.dust[num8].scale += (float)Main.rand.Next(0, 6) * 0.1f;
							Main.dust[num8].velocity *= 0.1f;
							Main.dust[num8].noGravity = true;
						}
					}
					if (Main.tile[num3, num4 + 2] != null && Main.tile[num3, num4 + 2].type == 229 && this.position.Y + (float)this.height > (float)((num4 + 2) * 16))
					{
						if ((float)(num3 * 16) < this.position.X + (float)(this.width / 2))
						{
							int num9 = Dust.NewDust(new Vector2(this.position.X - 4f, (float)(num4 * 16 + 32)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
							Main.dust[num9].scale += (float)Main.rand.Next(0, 6) * 0.1f;
							Main.dust[num9].velocity *= 0.1f;
							Main.dust[num9].noGravity = true;
							return;
						}
						int num10 = Dust.NewDust(new Vector2(this.position.X + (float)this.width - 2f, (float)(num4 * 16 + 32)), 4, 16, 153, 0f, 0f, 50, default(Color), 1f);
						Main.dust[num10].scale += (float)Main.rand.Next(0, 6) * 0.1f;
						Main.dust[num10].velocity *= 0.1f;
						Main.dust[num10].noGravity = true;
						return;
					}
				}
			}
			else
			{
				this.stickyBreak = 0;
			}
		}

		// Token: 0x060003DF RID: 991 RVA: 0x0026BFE0 File Offset: 0x0026A1E0
		public bool SummonItemCheck()
		{
			for (int i = 0; i < 200; i++)
			{
				if (Main.npc[i].active && ((this.inventory[this.selectedItem].type == 43 && Main.npc[i].type == 4) || (this.inventory[this.selectedItem].type == 70 && Main.npc[i].type == 13) || ((this.inventory[this.selectedItem].type == 560 & Main.npc[i].type == 50) || (this.inventory[this.selectedItem].type == 544 && Main.npc[i].type == 125)) || (this.inventory[this.selectedItem].type == 544 && Main.npc[i].type == 126) || (this.inventory[this.selectedItem].type == 556 && Main.npc[i].type == 134) || (this.inventory[this.selectedItem].type == 557 && Main.npc[i].type == 127) || (this.inventory[this.selectedItem].type == 1133 && Main.npc[i].type == 222) || (this.inventory[this.selectedItem].type == 1331 && Main.npc[i].type == 266)))
				{
					return false;
				}
			}
			return true;
		}

		// Token: 0x060003E2 RID: 994 RVA: 0x0026C3B4 File Offset: 0x0026A5B4
		public void TakeUnityPotion()
		{
			for (int i = 0; i < 400; i++)
			{
				if (this.inventory[i].type == 2997 && this.inventory[i].stack > 0)
				{
					this.inventory[i].stack--;
					if (this.inventory[i].stack <= 0)
					{
						this.inventory[i].SetDefaults(0, false);
					}
					return;
				}
			}
		}

		// Token: 0x0600034C RID: 844 RVA: 0x002261E0 File Offset: 0x002243E0
		public bool TeamChangeAllowed()
		{
			return true;
		}

		// Token: 0x060003CA RID: 970 RVA: 0x00263A4C File Offset: 0x00261C4C
		public void Teleport(Vector2 newPos, int Style = 0, int extraInfo = 0)
		{
			try
			{
				this.grappling[0] = -1;
				this.grapCount = 0;
				for (int i = 0; i < 1000; i++)
				{
					if (Main.projectile[i].active && Main.projectile[i].owner == this.whoAmI && Main.projectile[i].aiStyle == 7)
					{
						Main.projectile[i].Kill();
					}
				}
				int extraInfo2 = 0;
				if (Style == 4)
				{
					extraInfo2 = this.lastPortalColorIndex;
				}
				float num = MathHelper.Clamp(1f - this.teleportTime * 0.99f, 0.01f, 1f);
				Main.TeleportEffect(this.getRect(), Style, extraInfo2, num);
				float num2 = Vector2.Distance(this.position, newPos);
				PressurePlateHelper.UpdatePlayerPosition(this);
				this.position = newPos;
				this.fallStart = (int)(this.position.Y / 16f);
				if (this.whoAmI == Main.myPlayer)
				{
					bool flag = false;
					if (num2 < new Vector2((float)Main.screenWidth, (float)Main.screenHeight).Length() / 2f + 100f)
					{
						int time = 0;
						if (Style == 1)
						{
							time = 10;
						}
						Main.SetCameraLerp(0.1f, time);
						flag = true;
					}
					else
					{
						Main.BlackFadeIn = 255;
						Lighting.BlackOut();
						Main.screenLastPosition = Main.screenPosition;
						Main.screenPosition.X = this.position.X + (float)(this.width / 2) - (float)(Main.screenWidth / 2);
						Main.screenPosition.Y = this.position.Y + (float)(this.height / 2) - (float)(Main.screenHeight / 2);
						Main.quickBG = 10;
					}
					if (num > 0.1f || !flag || Style != 0)
					{
						if (Main.mapTime < 5)
						{
							Main.mapTime = 5;
						}
						Main.maxQ = true;
						Main.renderNow = true;
					}
				}
				if (Style == 4)
				{
					this.lastPortalColorIndex = extraInfo;
					extraInfo2 = this.lastPortalColorIndex;
					this.portalPhysicsFlag = true;
					this.gravity = 0f;
				}
				PressurePlateHelper.UpdatePlayerPosition(this);
				for (int j = 0; j < 3; j++)
				{
					this.UpdateSocialShadow();
				}
				this.oldPosition = this.position + this.BlehOldPositionFixer;
				Main.TeleportEffect(this.getRect(), Style, extraInfo2, num);
				this.teleportTime = 1f;
				this.teleportStyle = Style;
			}
			catch
			{
			}
		}

		// Token: 0x06000410 RID: 1040 RVA: 0x0028410C File Offset: 0x0028230C
		public void TeleportationPotion()
		{
			bool flag = false;
			int teleportStartX = 100;
			int teleportRangeX = Main.maxTilesX - 200;
			int teleportStartY = 100;
			int teleportRangeY = Main.maxTilesY - 200;
			Vector2 vector = this.TestTeleport(ref flag, teleportStartX, teleportRangeX, teleportStartY, teleportRangeY);
			if (flag)
			{
				Vector2 vector2 = vector;
				this.Teleport(vector2, 2, 0);
				this.velocity = Vector2.Zero;
				if (Main.netMode == 2)
				{
					RemoteClient.CheckSection(this.whoAmI, this.position, 1);
					NetMessage.SendData(65, -1, -1, null, 0, (float)this.whoAmI, vector2.X, vector2.Y, 3, 0, 0);
				}
			}
		}

		// Token: 0x06000411 RID: 1041 RVA: 0x002841A4 File Offset: 0x002823A4
		private Vector2 TestTeleport(ref bool canSpawn, int teleportStartX, int teleportRangeX, int teleportStartY, int teleportRangeY)
		{
			int num = 0;
			int num2 = 0;
			int num3 = 0;
			int width = this.width;
			Vector2 vector = new Vector2((float)num2, (float)num3) * 16f + new Vector2((float)(-(float)width / 2 + 8), (float)(-(float)this.height));
			while (!canSpawn && num < 1000)
			{
				num++;
				num2 = teleportStartX + Main.rand.Next(teleportRangeX);
				num3 = teleportStartY + Main.rand.Next(teleportRangeY);
				vector = new Vector2((float)num2, (float)num3) * 16f + new Vector2((float)(-(float)width / 2 + 8), (float)(-(float)this.height));
				if (!Collision.SolidCollision(vector, width, this.height))
				{
					if (Main.tile[num2, num3] == null)
					{
						Main.tile[num2, num3] = new Tile();
					}
					if ((Main.tile[num2, num3].wall != 87 || (double)num3 <= Main.worldSurface || NPC.downedPlantBoss) && (!Main.wallDungeon[(int)Main.tile[num2, num3].wall] || (double)num3 <= Main.worldSurface || NPC.downedBoss3))
					{
						int i = 0;
						while (i < 100)
						{
							if (Main.tile[num2, num3 + i] == null)
							{
								Main.tile[num2, num3 + i] = new Tile();
							}
							Tile tile = Main.tile[num2, num3 + i];
							vector = new Vector2((float)num2, (float)(num3 + i)) * 16f + new Vector2((float)(-(float)width / 2 + 8), (float)(-(float)this.height));
							Vector4 vector2 = Collision.SlopeCollision(vector, this.velocity, width, this.height, this.gravDir, false);
							bool arg_1FF_0 = !Collision.SolidCollision(vector, width, this.height);
							if (vector2.Z == this.velocity.X && vector2.Y == this.velocity.Y && vector2.X == vector.X)
							{
								bool arg_1FE_0 = vector2.Y == vector.Y;
							}
							if (arg_1FF_0)
							{
								i++;
							}
							else
							{
								if (tile.active() && !tile.inActive() && Main.tileSolid[(int)tile.type])
								{
									break;
								}
								i++;
							}
						}
						if (!Collision.LavaCollision(vector, width, this.height) && Collision.HurtTiles(vector, this.velocity, width, this.height, false).Y <= 0f)
						{
							Collision.SlopeCollision(vector, this.velocity, width, this.height, this.gravDir, false);
							if (Collision.SolidCollision(vector, width, this.height) && i < 99)
							{
								Vector2 vector3 = Vector2.UnitX * 16f;
								if (!(Collision.TileCollision(vector - vector3, vector3, this.width, this.height, false, false, (int)this.gravDir) != vector3))
								{
									vector3 = -Vector2.UnitX * 16f;
									if (!(Collision.TileCollision(vector - vector3, vector3, this.width, this.height, false, false, (int)this.gravDir) != vector3))
									{
										vector3 = Vector2.UnitY * 16f;
										if (!(Collision.TileCollision(vector - vector3, vector3, this.width, this.height, false, false, (int)this.gravDir) != vector3))
										{
											vector3 = -Vector2.UnitY * 16f;
											if (!(Collision.TileCollision(vector - vector3, vector3, this.width, this.height, false, false, (int)this.gravDir) != vector3))
											{
												canSpawn = true;
												num3 += i;
												break;
											}
										}
									}
								}
							}
						}
					}
				}
			}
			return vector;
		}

		// Token: 0x060003B8 RID: 952 RVA: 0x0025A2C0 File Offset: 0x002584C0
		public void TileInteractionsCheck(int myX, int myY)
		{
			if (Main.tile[myX, myY] == null)
			{
				Main.tile[myX, myY] = new Tile();
			}
			if (Main.tile[myX, myY].active())
			{
				this.TileInteractionsMouseOver(myX, myY);
				this.TileInteractionsUse(myX, myY);
			}
		}

		// Token: 0x060003B9 RID: 953 RVA: 0x0025A310 File Offset: 0x00258510
		private void TileInteractionsCheckLongDistance(int myX, int myY)
		{
			if (Main.tile[myX, myY] == null)
			{
				Main.tile[myX, myY] = new Tile();
			}
			if (Main.tile[myX, myY].type == 21)
			{
				this.TileInteractionsMouseOver_Containers(myX, myY);
				if (this.showItemIconText == "")
				{
					this.showItemIcon = false;
					this.showItemIcon2 = 0;
				}
			}
			if (Main.tile[myX, myY].type == 88)
			{
				Tile tile = Main.tile[myX, myY];
				int num = myY;
				int arg_A1_0 = myX - (int)(tile.frameX % 54 / 18);
				if (tile.frameY % 36 != 0)
				{
					num--;
				}
				int num2 = Chest.FindChest(arg_A1_0, num);
				this.showItemIcon2 = -1;
				if (num2 < 0)
				{
					this.showItemIconText = Lang.dresserType[0].Value;
				}
				else
				{
					if (Main.chest[num2].name != "")
					{
						this.showItemIconText = Main.chest[num2].name;
					}
					else
					{
						this.showItemIconText = Lang.dresserType[(int)(tile.frameX / 54)].Value;
					}
					if (this.showItemIconText == Lang.dresserType[(int)(tile.frameX / 54)].Value)
					{
						this.showItemIcon2 = Chest.dresserTypeToIcon[(int)(tile.frameX / 54)];
						this.showItemIconText = "";
					}
				}
				this.noThrow = 2;
				this.showItemIcon = true;
				if (this.showItemIconText == "")
				{
					this.showItemIcon = false;
					this.showItemIcon2 = 0;
				}
			}
			if (Main.tileSign[(int)Main.tile[myX, myY].type])
			{
				this.noThrow = 2;
				int num3 = (int)(Main.tile[myX, myY].frameX / 18);
				int num4 = (int)(Main.tile[myX, myY].frameY / 18);
				num3 %= 2;
				int arg_1DC_0 = myX - num3;
				int num5 = myY - num4;
				Main.signBubble = true;
				Main.signX = arg_1DC_0 * 16 + 16;
				Main.signY = num5 * 16;
				int num6 = Sign.ReadSign(arg_1DC_0, num5, true);
				if (num6 != -1)
				{
					Main.signHover = num6;
					this.showItemIcon = false;
					this.showItemIcon2 = -1;
				}
			}
		}

		// Token: 0x060003BC RID: 956 RVA: 0x0025C76C File Offset: 0x0025A96C
		private void TileInteractionsMouseOver(int myX, int myY)
		{
			if (myX != Player.tileTargetX || myY != Player.tileTargetY)
			{
				return;
			}
			if (Main.tile[myX, myY].type == 79)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int num = (int)(Main.tile[myX, myY].frameY / 36);
				if (num == 0)
				{
					this.showItemIcon2 = 224;
				}
				else if (num == 1)
				{
					this.showItemIcon2 = 644;
				}
				else if (num == 2)
				{
					this.showItemIcon2 = 645;
				}
				else if (num == 3)
				{
					this.showItemIcon2 = 646;
				}
				else if (num == 4)
				{
					this.showItemIcon2 = 920;
				}
				else if (num == 5)
				{
					this.showItemIcon2 = 1470;
				}
				else if (num == 6)
				{
					this.showItemIcon2 = 1471;
				}
				else if (num == 7)
				{
					this.showItemIcon2 = 1472;
				}
				else if (num == 8)
				{
					this.showItemIcon2 = 1473;
				}
				else if (num == 9)
				{
					this.showItemIcon2 = 1719;
				}
				else if (num == 10)
				{
					this.showItemIcon2 = 1720;
				}
				else if (num == 11)
				{
					this.showItemIcon2 = 1721;
				}
				else if (num == 12)
				{
					this.showItemIcon2 = 1722;
				}
				else if (num >= 13 && num <= 18)
				{
					this.showItemIcon2 = 2066 + num - 13;
				}
				else if (num >= 19 && num <= 20)
				{
					this.showItemIcon2 = 2139 + num - 19;
				}
				else if (num == 21)
				{
					this.showItemIcon2 = 2231;
				}
				else if (num == 22)
				{
					this.showItemIcon2 = 2520;
				}
				else if (num == 23)
				{
					this.showItemIcon2 = 2538;
				}
				else if (num == 24)
				{
					this.showItemIcon2 = 2553;
				}
				else if (num == 25)
				{
					this.showItemIcon2 = 2568;
				}
				else if (num == 26)
				{
					this.showItemIcon2 = 2669;
				}
				else if (num == 27)
				{
					this.showItemIcon2 = 2811;
				}
				else if (num == 28)
				{
					this.showItemIcon2 = 3162;
				}
				else if (num == 29)
				{
					this.showItemIcon2 = 3164;
				}
				else if (num == 30)
				{
					this.showItemIcon2 = 3163;
				}
				else if (num == 31)
				{
					this.showItemIcon2 = 3897;
				}
				else
				{
					this.showItemIcon2 = 646;
				}
			}
			if (Main.tile[myX, myY].type == 33)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 105;
				int num2 = (int)(Main.tile[myX, myY].frameY / 22);
				if (num2 == 1)
				{
					this.showItemIcon2 = 1405;
				}
				if (num2 == 2)
				{
					this.showItemIcon2 = 1406;
				}
				if (num2 == 3)
				{
					this.showItemIcon2 = 1407;
				}
				if (num2 >= 4 && num2 <= 13)
				{
					this.showItemIcon2 = 2045 + num2 - 4;
				}
				if (num2 >= 14 && num2 <= 16)
				{
					this.showItemIcon2 = 2153 + num2 - 14;
				}
				if (num2 == 17)
				{
					this.showItemIcon2 = 2236;
				}
				if (num2 == 18)
				{
					this.showItemIcon2 = 2523;
				}
				if (num2 == 19)
				{
					this.showItemIcon2 = 2542;
				}
				if (num2 == 20)
				{
					this.showItemIcon2 = 2556;
				}
				if (num2 == 21)
				{
					this.showItemIcon2 = 2571;
				}
				if (num2 == 22)
				{
					this.showItemIcon2 = 2648;
				}
				if (num2 == 23)
				{
					this.showItemIcon2 = 2649;
				}
				if (num2 == 24)
				{
					this.showItemIcon2 = 2650;
				}
				if (num2 == 25)
				{
					this.showItemIcon2 = 2651;
				}
				else if (num2 == 26)
				{
					this.showItemIcon2 = 2818;
				}
				else if (num2 == 27)
				{
					this.showItemIcon2 = 3171;
				}
				else if (num2 == 28)
				{
					this.showItemIcon2 = 3173;
				}
				else if (num2 == 29)
				{
					this.showItemIcon2 = 3172;
				}
				else if (num2 == 30)
				{
					this.showItemIcon2 = 3890;
				}
			}
			if (Main.tile[myX, myY].type == 21)
			{
				this.TileInteractionsMouseOver_Containers(myX, myY);
			}
			if (Main.tile[myX, myY].type == 467)
			{
				this.TileInteractionsMouseOver_Containers(myX, myY);
			}
			if (Main.tile[myX, myY].type == 441)
			{
				Tile tile = Main.tile[myX, myY];
				if (tile.frameX % 36 != 0)
				{
					int num3 = myX - 1;
				}
				if (tile.frameY % 36 != 0)
				{
					int num4 = myY - 1;
				}
				this.showItemIcon2 = -1;
				this.showItemIcon2 = Chest.chestTypeToIcon[(int)(tile.frameX / 36)];
				this.noThrow = 2;
				this.showItemIcon = true;
			}
			if (Main.tile[myX, myY].type == 468)
			{
				Tile tile2 = Main.tile[myX, myY];
				if (tile2.frameX % 36 != 0)
				{
					int num5 = myX - 1;
				}
				if (tile2.frameY % 36 != 0)
				{
					int num6 = myY - 1;
				}
				this.showItemIcon2 = -1;
				this.showItemIcon2 = Chest.chestTypeToIcon2[(int)(tile2.frameX / 36)];
				this.noThrow = 2;
				this.showItemIcon = true;
			}
			if (Main.tile[myX, myY].type == 88)
			{
				Tile tile3 = Main.tile[myX, myY];
				int num7 = myY;
				int arg_577_0 = myX - (int)(tile3.frameX % 54 / 18);
				if (tile3.frameY % 36 != 0)
				{
					num7--;
				}
				int num8 = Chest.FindChest(arg_577_0, num7);
				this.showItemIcon2 = -1;
				if (num8 < 0)
				{
					this.showItemIconText = Lang.dresserType[0].Value;
				}
				else
				{
					if (Main.chest[num8].name != "")
					{
						this.showItemIconText = Main.chest[num8].name;
					}
					else
					{
						this.showItemIconText = Lang.dresserType[(int)(tile3.frameX / 54)].Value;
					}
					if (this.showItemIconText == Lang.dresserType[(int)(tile3.frameX / 54)].Value)
					{
						this.showItemIcon2 = Chest.dresserTypeToIcon[(int)(tile3.frameX / 54)];
						this.showItemIconText = "";
					}
				}
				this.noThrow = 2;
				this.showItemIcon = true;
				if (Main.tile[myX, myY].frameY > 0)
				{
					this.showItemIcon2 = 269;
				}
			}
			if (Main.tile[myX, myY].type == 10 || Main.tile[myX, myY].type == 11)
			{
				Tile tile4 = Main.tile[myX, myY];
				this.noThrow = 2;
				this.showItemIcon = true;
				int i = (int)tile4.frameY;
				int num9 = 0;
				while (i >= 54)
				{
					i -= 54;
					num9++;
				}
				if (tile4.type == 10)
				{
					num9 += (int)(36 * (tile4.frameX / 54));
				}
				if (tile4.type == 11)
				{
					num9 += (int)(36 * (tile4.frameX / 72));
				}
				if (num9 == 0)
				{
					this.showItemIcon2 = 25;
				}
				else if (num9 == 9)
				{
					this.showItemIcon2 = 837;
				}
				else if (num9 == 10)
				{
					this.showItemIcon2 = 912;
				}
				else if (num9 == 11)
				{
					this.showItemIcon2 = 1141;
				}
				else if (num9 == 12)
				{
					this.showItemIcon2 = 1137;
				}
				else if (num9 == 13)
				{
					this.showItemIcon2 = 1138;
				}
				else if (num9 == 14)
				{
					this.showItemIcon2 = 1139;
				}
				else if (num9 == 15)
				{
					this.showItemIcon2 = 1140;
				}
				else if (num9 == 16)
				{
					this.showItemIcon2 = 1411;
				}
				else if (num9 == 17)
				{
					this.showItemIcon2 = 1412;
				}
				else if (num9 == 18)
				{
					this.showItemIcon2 = 1413;
				}
				else if (num9 == 19)
				{
					this.showItemIcon2 = 1458;
				}
				else if (num9 >= 20 && num9 <= 23)
				{
					this.showItemIcon2 = 1709 + num9 - 20;
				}
				else if (num9 == 24)
				{
					this.showItemIcon2 = 1793;
				}
				else if (num9 == 25)
				{
					this.showItemIcon2 = 1815;
				}
				else if (num9 == 26)
				{
					this.showItemIcon2 = 1924;
				}
				else if (num9 == 27)
				{
					this.showItemIcon2 = 2044;
				}
				else if (num9 == 28)
				{
					this.showItemIcon2 = 2265;
				}
				else if (num9 == 29)
				{
					this.showItemIcon2 = 2528;
				}
				else if (num9 == 30)
				{
					this.showItemIcon2 = 2561;
				}
				else if (num9 == 31)
				{
					this.showItemIcon2 = 2576;
				}
				else if (num9 == 32)
				{
					this.showItemIcon2 = 2815;
				}
				else if (num9 == 33)
				{
					this.showItemIcon2 = 3129;
				}
				else if (num9 == 34)
				{
					this.showItemIcon2 = 3131;
				}
				else if (num9 == 35)
				{
					this.showItemIcon2 = 3130;
				}
				else if (num9 == 36)
				{
					this.showItemIcon2 = 3888;
				}
				else if (num9 >= 4 && num9 <= 8)
				{
					this.showItemIcon2 = 812 + num9;
				}
				else
				{
					this.showItemIcon2 = 649 + num9;
				}
			}
			if (Main.tile[myX, myY].type == 104)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				switch (Main.tile[myX, myY].frameX / 36)
				{
					case 0:
						this.showItemIcon2 = 359;
						break;
					case 1:
						this.showItemIcon2 = 2237;
						break;
					case 2:
						this.showItemIcon2 = 2238;
						break;
					case 3:
						this.showItemIcon2 = 2239;
						break;
					case 4:
						this.showItemIcon2 = 2240;
						break;
					case 5:
						this.showItemIcon2 = 2241;
						break;
					case 6:
						this.showItemIcon2 = 2560;
						break;
					case 7:
						this.showItemIcon2 = 2575;
						break;
					case 8:
						this.showItemIcon2 = 2591;
						break;
					case 9:
						this.showItemIcon2 = 2592;
						break;
					case 10:
						this.showItemIcon2 = 2593;
						break;
					case 11:
						this.showItemIcon2 = 2594;
						break;
					case 12:
						this.showItemIcon2 = 2595;
						break;
					case 13:
						this.showItemIcon2 = 2596;
						break;
					case 14:
						this.showItemIcon2 = 2597;
						break;
					case 15:
						this.showItemIcon2 = 2598;
						break;
					case 16:
						this.showItemIcon2 = 2599;
						break;
					case 17:
						this.showItemIcon2 = 2600;
						break;
					case 18:
						this.showItemIcon2 = 2601;
						break;
					case 19:
						this.showItemIcon2 = 2602;
						break;
					case 20:
						this.showItemIcon2 = 2603;
						break;
					case 21:
						this.showItemIcon2 = 2604;
						break;
					case 22:
						this.showItemIcon2 = 2605;
						break;
					case 23:
						this.showItemIcon2 = 2606;
						break;
					case 24:
						this.showItemIcon2 = 2809;
						break;
					case 25:
						this.showItemIcon2 = 3126;
						break;
					case 26:
						this.showItemIcon2 = 3128;
						break;
					case 27:
						this.showItemIcon2 = 3127;
						break;
					case 28:
						this.showItemIcon2 = 3898;
						break;
					case 29:
						this.showItemIcon2 = 3899;
						break;
					case 30:
						this.showItemIcon2 = 3900;
						break;
					case 31:
						this.showItemIcon2 = 3901;
						break;
					case 32:
						this.showItemIcon2 = 3902;
						break;
				}
			}
			if (Main.tile[myX, myY].type == 356)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3064;
			}
			if (Main.tile[myX, myY].type == 377)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3198;
			}
			if (Main.tile[myX, myY].type == 209)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				if (Main.tile[myX, myY].frameX < 72)
				{
					this.showItemIcon2 = 928;
				}
				else if (Main.tile[myX, myY].frameX < 144)
				{
					this.showItemIcon2 = 1337;
				}
				else if (Main.tile[myX, myY].frameX < 216)
				{
					this.showItemIcon2 = 3369;
				}
				else if (Main.tile[myX, myY].frameX < 360)
				{
					this.showItemIcon2 = 3664;
				}
				int j;
				for (j = (int)(Main.tile[myX, myY].frameX / 18); j >= 4; j -= 4)
				{
				}
				if (j < 2)
				{
					this.showItemIconR = true;
				}
				else
				{
					this.showItemIconR = false;
				}
			}
			if (Main.tile[myX, myY].type == 216)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int k = (int)Main.tile[myX, myY].frameY;
				int num10 = 0;
				while (k >= 40)
				{
					k -= 40;
					num10++;
				}
				this.showItemIcon2 = 970 + num10;
			}
			if (Main.tile[myX, myY].type == 387 || Main.tile[myX, myY].type == 386)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int num11 = 0;
				int num12 = 0;
				WorldGen.GetTopLeftAndStyles(ref num11, ref num12, 2, 1 + (Main.tile[myX, myY].type == 386).ToInt(), 18, 18);
				this.showItemIcon2 = 3239;
			}
			if (Main.tile[myX, myY].type == 389 || Main.tile[myX, myY].type == 388)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3240;
			}
			if (Main.tile[myX, myY].type == 335)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 2700;
			}
			if (Main.tile[myX, myY].type == 410)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3536 + Math.Min((int)(Main.tile[myX, myY].frameX / 36), 3);
			}
			if (Main.tile[myX, myY].type == 463)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3813;
			}
			if (Main.tile[myX, myY].type == 411 && Main.tile[myX, myY].frameX < 36)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3545;
			}
			if (Main.tile[myX, myY].type == 338)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 2738;
			}
			if (Main.tile[myX, myY].type == 455)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3747;
			}
			if (Main.tile[myX, myY].type == 219 && (this.inventory[this.selectedItem].type == 424 || this.inventory[this.selectedItem].type == 1103))
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = this.inventory[this.selectedItem].type;
			}
			if (Main.tile[myX, myY].type == 212)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 949;
			}
			if (Main.tile[myX, myY].type == 314 && this.gravDir == 1f)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 2343;
			}
			if (Main.tile[myX, myY].type == 215)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int num13 = (int)(Main.tile[myX, myY].frameX / 54);
				if (num13 == 0)
				{
					this.showItemIcon2 = 966;
				}
				else if (num13 == 7)
				{
					this.showItemIcon2 = 3724;
				}
				else if (num13 == 6)
				{
					this.showItemIcon2 = 3723;
				}
				else if (num13 == 5)
				{
					this.showItemIcon2 = 3050;
				}
				else
				{
					this.showItemIcon2 = 3046 + num13 - 1;
				}
			}
			if (Main.tile[myX, myY].type == 4)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int num14 = (int)(Main.tile[myX, myY].frameY / 22);
				if (num14 == 0)
				{
					this.showItemIcon2 = 8;
				}
				else if (num14 == 8)
				{
					this.showItemIcon2 = 523;
				}
				else if (num14 == 9)
				{
					this.showItemIcon2 = 974;
				}
				else if (num14 == 10)
				{
					this.showItemIcon2 = 1245;
				}
				else if (num14 == 11)
				{
					this.showItemIcon2 = 1333;
				}
				else if (num14 == 12)
				{
					this.showItemIcon2 = 2274;
				}
				else if (num14 == 13)
				{
					this.showItemIcon2 = 3004;
				}
				else if (num14 == 14)
				{
					this.showItemIcon2 = 3045;
				}
				else if (num14 == 15)
				{
					this.showItemIcon2 = 3114;
				}
				else
				{
					this.showItemIcon2 = 426 + num14;
				}
			}
			if (Main.tile[myX, myY].type == 13)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				int num15 = (int)(Main.tile[myX, myY].frameX / 18);
				if (num15 == 1)
				{
					this.showItemIcon2 = 28;
				}
				else if (num15 == 2)
				{
					this.showItemIcon2 = 110;
				}
				else if (num15 == 3)
				{
					this.showItemIcon2 = 350;
				}
				else if (num15 == 4)
				{
					this.showItemIcon2 = 351;
				}
				else if (num15 == 5)
				{
					this.showItemIcon2 = 2234;
				}
				else if (num15 == 6)
				{
					this.showItemIcon2 = 2244;
				}
				else if (num15 == 7)
				{
					this.showItemIcon2 = 2257;
				}
				else if (num15 == 8)
				{
					this.showItemIcon2 = 2258;
				}
				else
				{
					this.showItemIcon2 = 31;
				}
			}
			if (Main.tile[myX, myY].type == 29)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 87;
			}
			if (Main.tile[myX, myY].type == 97)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 346;
			}
			if (Main.tile[myX, myY].type == 49)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 148;
			}
			if (Main.tile[myX, myY].type == 174)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 713;
			}
			if (Main.tile[myX, myY].type == 50)
			{
				this.noThrow = 2;
				if (Main.tile[myX, myY].frameX == 90)
				{
					this.showItemIcon = true;
					this.showItemIcon2 = 165;
				}
			}
			if (Main.tile[myX, myY].type == 139)
			{
				this.noThrow = 2;
				int num16 = 0;
				for (int l = (int)(Main.tile[myX, myY].frameY / 18); l >= 2; l -= 2)
				{
					num16++;
				}
				this.showItemIcon = true;
				if (num16 == 28)
				{
					this.showItemIcon2 = 1963;
				}
				else if (num16 == 29)
				{
					this.showItemIcon2 = 1964;
				}
				else if (num16 == 30)
				{
					this.showItemIcon2 = 1965;
				}
				else if (num16 == 31)
				{
					this.showItemIcon2 = 2742;
				}
				else if (num16 == 32)
				{
					this.showItemIcon2 = 3044;
				}
				else if (num16 == 33)
				{
					this.showItemIcon2 = 3235;
				}
				else if (num16 == 34)
				{
					this.showItemIcon2 = 3236;
				}
				else if (num16 == 35)
				{
					this.showItemIcon2 = 3237;
				}
				else if (num16 == 36)
				{
					this.showItemIcon2 = 3370;
				}
				else if (num16 == 37)
				{
					this.showItemIcon2 = 3371;
				}
				else if (num16 == 38)
				{
					this.showItemIcon2 = 3796;
				}
				else if (num16 == 39)
				{
					this.showItemIcon2 = 3869;
				}
				else if (num16 >= 13)
				{
					this.showItemIcon2 = 1596 + num16 - 13;
				}
				else
				{
					this.showItemIcon2 = 562 + num16;
				}
			}
			if (Main.tile[myX, myY].type == 207)
			{
				this.noThrow = 2;
				int num17 = 0;
				for (int m = (int)(Main.tile[myX, myY].frameX / 18); m >= 2; m -= 2)
				{
					num17++;
				}
				this.showItemIcon = true;
				if (num17 == 0)
				{
					this.showItemIcon2 = 909;
				}
				else if (num17 == 1)
				{
					this.showItemIcon2 = 910;
				}
				else if (num17 == 2)
				{
					this.showItemIcon2 = 940;
				}
				else if (num17 == 3)
				{
					this.showItemIcon2 = 941;
				}
				else if (num17 == 4)
				{
					this.showItemIcon2 = 942;
				}
				else if (num17 == 5)
				{
					this.showItemIcon2 = 943;
				}
				else if (num17 == 6)
				{
					this.showItemIcon2 = 944;
				}
				else if (num17 == 7)
				{
					this.showItemIcon2 = 945;
				}
			}
			if (Main.tileSign[(int)Main.tile[myX, myY].type])
			{
				this.noThrow = 2;
				int num18 = (int)(Main.tile[myX, myY].frameX / 18);
				int num19 = (int)(Main.tile[myX, myY].frameY / 18);
				num18 %= 2;
				int arg_16E3_0 = myX - num18;
				int num20 = myY - num19;
				Main.signBubble = true;
				Main.signX = arg_16E3_0 * 16 + 16;
				Main.signY = num20 * 16;
				int num21 = Sign.ReadSign(arg_16E3_0, num20, false);
				if (num21 != -1)
				{
					Main.signHover = num21;
				}
				if (num21 != -1)
				{
					Main.signHover = num21;
					this.showItemIcon = false;
					this.showItemIcon2 = -1;
				}
			}
			if (Main.tile[myX, myY].type == 237)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 1293;
			}
			if (Main.tile[myX, myY].type == 466)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 3828;
			}
			if (Main.tile[myX, myY].type == 125)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 487;
			}
			if (Main.tile[myX, myY].type == 354)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 2999;
			}
			if (Main.tile[myX, myY].type == 287)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 2177;
			}
			if (Main.tile[myX, myY].type == 132)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 513;
			}
			if (Main.tile[myX, myY].type == 136)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = 538;
			}
			if (Main.tile[myX, myY].type == 144)
			{
				this.noThrow = 2;
				this.showItemIcon = true;
				this.showItemIcon2 = (int)(583 + Main.tile[myX, myY].frameX / 18);
			}
			if (Main.tile[myX, myY].type == 440)
			{
				int num22 = (int)(Main.tile[myX, myY].frameX / 54);
				int num23 = (int)(Main.tile[myX, myY].frameY / 54);
				int num24 = -1;
				switch (num22)
				{
					case 0:
						num24 = 1526;
						break;
					case 1:
						num24 = 1524;
						break;
					case 2:
						num24 = 1525;
						break;
					case 3:
						num24 = 1523;
						break;
					case 4:
						num24 = 1522;
						break;
					case 5:
						num24 = 1527;
						break;
					case 6:
						num24 = 3643;
						break;
				}
				if (num24 != -1 && (num23 == 1 || this.HasItem(num24)))
				{
					this.noThrow = 2;
					this.showItemIcon = true;
					this.showItemIcon2 = num24;
				}
			}
		}

		// Token: 0x060003BE RID: 958 RVA: 0x0025E148 File Offset: 0x0025C348
		private void TileInteractionsMouseOver_Containers(int myX, int myY)
		{
			LocalizedText[] array = Lang.chestType;
			int[] array2 = Chest.chestTypeToIcon;
			Tile tile = Main.tile[myX, myY];
			if (tile.type == 467)
			{
				array = Lang.chestType2;
				array2 = Chest.chestTypeToIcon2;
			}
			int num = myX;
			int num2 = myY;
			if (tile.frameX % 36 != 0)
			{
				num--;
			}
			if (tile.frameY % 36 != 0)
			{
				num2--;
			}
			int num3 = Chest.FindChest(num, num2);
			this.showItemIcon2 = -1;
			if (num3 < 0)
			{
				this.showItemIconText = array[0].Value;
			}
			else
			{
				if (Main.chest[num3].name != "")
				{
					this.showItemIconText = Main.chest[num3].name;
				}
				else
				{
					this.showItemIconText = array[(int)(tile.frameX / 36)].Value;
				}
				if (this.showItemIconText == array[(int)(tile.frameX / 36)].Value)
				{
					this.showItemIcon2 = array2[(int)(tile.frameX / 36)];
					this.showItemIconText = "";
				}
			}
			this.noThrow = 2;
			this.showItemIcon = true;
		}

		// Token: 0x060003BA RID: 954 RVA: 0x0025A534 File Offset: 0x00258734
		private void TileInteractionsUse(int myX, int myY)
		{
			if (WiresUI.Open)
			{
				return;
			}
			if (this.ownedProjectileCounts[651] > 0)
			{
				return;
			}
			bool flag = this.releaseUseTile;
			if (this.tileInteractAttempted)
			{
				bool flag2 = false;
				if (Main.tile[myX, myY].type == 212 && this.launcherWait <= 0)
				{
					bool flag3 = false;
					for (int i = 0; i < 58; i++)
					{
						if (this.inventory[i].type == 949 && this.inventory[i].stack > 0)
						{
							this.inventory[i].stack--;
							if (this.inventory[i].stack <= 0)
							{
								this.inventory[i].SetDefaults(0, false);
							}
							flag3 = true;
							break;
						}
					}
					if (flag3)
					{
						flag2 = true;
						this.launcherWait = 10;
						Main.PlaySound(SoundID.Item11, this.position);
						int j = (int)(Main.tile[myX, myY].frameX / 18);
						int num = 0;
						while (j >= 3)
						{
							num++;
							j -= 3;
						}
						j = myX - j;
						int k;
						for (k = (int)(Main.tile[myX, myY].frameY / 18); k >= 3; k -= 3)
						{
						}
						k = myY - k;
						float arg_1FF_0 = 12f + (float)Main.rand.Next(450) * 0.01f;
						float num2 = (float)Main.rand.Next(85, 105);
						float arg_1E7_0 = (float)Main.rand.Next(-35, 11);
						int type = 166;
						int damage = 35;
						float knockBack = 3.5f;
						Vector2 vector = new Vector2((float)((j + 2) * 16 - 8), (float)((k + 2) * 16 - 8));
						if (num == 0)
						{
							num2 *= -1f;
							vector.X -= 12f;
						}
						else
						{
							vector.X += 12f;
						}
						float num3 = num2;
						float num4 = arg_1E7_0;
						float num5 = (float)Math.Sqrt((double)(num3 * num3 + num4 * num4));
						num5 = arg_1FF_0 / num5;
						num3 *= num5;
						num4 *= num5;
						Projectile.NewProjectile(vector.X, vector.Y, num3, num4, type, damage, knockBack, Main.myPlayer, 0f, 0f);
					}
				}
				if (flag)
				{
					if (Main.tile[myX, myY].type == 132 || Main.tile[myX, myY].type == 136 || Main.tile[myX, myY].type == 144)
					{
						flag2 = true;
						Wiring.HitSwitch(myX, myY);
						NetMessage.SendData(59, -1, -1, null, myX, (float)myY, 0f, 0f, 0, 0, 0);
					}
					else if (Main.tile[myX, myY].type == 441 || Main.tile[myX, myY].type == 468)
					{
						flag2 = true;
						int l;
						for (l = (int)(Main.tile[myX, myY].frameX / 18); l > 1; l -= 2)
						{
						}
						l = myX - l;
						int num6 = myY - (int)(Main.tile[myX, myY].frameY / 18);
						Animation.NewTemporaryAnimation(2, Main.tile[myX, myY].type, l, num6);
						NetMessage.SendTemporaryAnimation(-1, 2, (int)Main.tile[myX, myY].type, l, num6);
						Wiring.HitSwitch(myX, myY);
						NetMessage.SendData(59, -1, -1, null, myX, (float)myY, 0f, 0f, 0, 0, 0);
					}
					else if (Main.tile[myX, myY].type == 139)
					{
						flag2 = true;
						Main.PlaySound(28, myX * 16, myY * 16, 0, 1f, 0f);
						WorldGen.SwitchMB(myX, myY);
					}
					else if (Main.tile[myX, myY].type == 215)
					{
						flag2 = true;
						Main.PlaySound(28, myX * 16, myY * 16, 0, 1f, 0f);
						int num7 = (int)(Main.tile[myX, myY].frameX % 54 / 18);
						int num8 = (int)(Main.tile[myX, myY].frameY % 36 / 18);
						int num9 = myX - num7;
						int num10 = myY - num8;
						int num11 = 36;
						if (Main.tile[num9, num10].frameY >= 36)
						{
							num11 = -36;
						}
						for (int m = num9; m < num9 + 3; m++)
						{
							for (int n = num10; n < num10 + 2; n++)
							{
								Main.tile[m, n].frameY = (short)((int)Main.tile[m, n].frameY + num11);
							}
						}
						NetMessage.SendTileSquare(-1, num9 + 1, num10 + 1, 3, TileChangeType.None);
					}
					else if (Main.tile[myX, myY].type == 207)
					{
						flag2 = true;
						Main.PlaySound(28, myX * 16, myY * 16, 0, 1f, 0f);
						WorldGen.SwitchFountain(myX, myY);
					}
					else if (Main.tile[myX, myY].type == 410)
					{
						flag2 = true;
						Main.PlaySound(28, myX * 16, myY * 16, 0, 1f, 0f);
						this.GamepadEnableGrappleCooldown();
						WorldGen.SwitchMonolith(myX, myY);
					}
					else if (Main.tile[myX, myY].type == 455)
					{
						flag2 = true;
						Main.PlaySound(28, myX * 16, myY * 16, 0, 1f, 0f);
						this.GamepadEnableGrappleCooldown();
						BirthdayParty.ToggleManualParty();
					}
					else if (Main.tile[myX, myY].type == 216)
					{
						flag2 = true;
						WorldGen.LaunchRocket(myX, myY);
					}
					else if (Main.tile[myX, myY].type == 386 || Main.tile[myX, myY].type == 387)
					{
						flag2 = true;
						bool value = Main.tile[myX, myY].type == 387;
						int num12 = WorldGen.ShiftTrapdoor(myX, myY, (float)(myY * 16) > base.Center.Y, -1).ToInt();
						if (num12 == 0)
						{
							num12 = -WorldGen.ShiftTrapdoor(myX, myY, (float)(myY * 16) <= base.Center.Y, -1).ToInt();
						}
						if (num12 != 0)
						{
							NetMessage.SendData(19, -1, -1, null, 2 + value.ToInt(), (float)myX, (float)myY, (float)(num12 * Math.Sign((float)(myY * 16) - base.Center.Y)), 0, 0, 0);
						}
					}
					else if (Main.tile[myX, myY].type == 388 || Main.tile[myX, myY].type == 389)
					{
						flag2 = true;
						bool flag4 = Main.tile[myX, myY].type == 389;
						WorldGen.ShiftTallGate(myX, myY, flag4);
						NetMessage.SendData(19, -1, -1, null, 4 + flag4.ToInt(), (float)myX, (float)myY, 0f, 0, 0, 0);
					}
					else if (Main.tile[myX, myY].type == 335)
					{
						flag2 = true;
						WorldGen.LaunchRocketSmall(myX, myY);
					}
					else if (Main.tile[myX, myY].type == 411 && Main.tile[myX, myY].frameX < 36)
					{
						flag2 = true;
						Wiring.HitSwitch(myX, myY);
						NetMessage.SendData(59, -1, -1, null, myX, (float)myY, 0f, 0f, 0, 0, 0);
					}
					else if (Main.tile[myX, myY].type == 338)
					{
						flag2 = true;
						int num13 = myY;
						if (Main.tile[myX, num13].frameY == 18)
						{
							num13--;
						}
						bool flag5 = false;
						for (int num14 = 0; num14 < 1000; num14++)
						{
							if (Main.projectile[num14].active && Main.projectile[num14].aiStyle == 73 && Main.projectile[num14].ai[0] == (float)myX && Main.projectile[num14].ai[1] == (float)num13)
							{
								flag5 = true;
								break;
							}
						}
						if (!flag5)
						{
							Projectile.NewProjectile((float)(myX * 16 + 8), (float)(num13 * 16 + 2), 0f, 0f, 419 + Main.rand.Next(4), 0, 0f, this.whoAmI, (float)myX, (float)num13);
						}
					}
					else if (Main.tile[myX, myY].type == 4 || Main.tile[myX, myY].type == 13 || Main.tile[myX, myY].type == 33 || Main.tile[myX, myY].type == 49 || (Main.tile[myX, myY].type == 50 && Main.tile[myX, myY].frameX == 90) || Main.tile[myX, myY].type == 174)
					{
						flag2 = true;
						WorldGen.KillTile(myX, myY, false, false, false);
						this.GamepadEnableGrappleCooldown();
						if (Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 0, (float)myX, (float)myY, 0f, 0, 0, 0);
						}
					}
					else if (Main.tile[myX, myY].type == 466)
					{
						flag2 = true;
						this.GamepadEnableGrappleCooldown();
						int num15 = myY;
						Tile expr_975 = Framing.GetTileSafely(myX, myY);
						if (expr_975.frameY == 0)
						{
							num15 += 3;
						}
						if (expr_975.frameY == 18)
						{
							num15 += 2;
						}
						if (expr_975.frameY == 36)
						{
							num15++;
						}
						bool flag6 = !DD2Event.Ongoing && !NPC.AnyNPCs(548) && !Main.pumpkinMoon && !Main.snowMoon;
						if (flag6)
						{
							flag6 = this.HasItem(3828);
						}
						if (flag6)
						{
							flag6 = !DD2Event.WouldFailSpawningHere(myX, num15);
							if (!flag6)
							{
								DD2Event.FailureMessage(-1);
							}
						}
						if (flag6)
						{
							flag6 = this.ConsumeItem(3828, true);
						}
						if (flag6)
						{
							DD2Event.SummonCrystal(myX, num15);
						}
					}
					else if (Main.tile[myX, myY].type == 334)
					{
						flag2 = true;
						if (this.ItemFitsWeaponRack(this.inventory[this.selectedItem]))
						{
							this.GamepadEnableGrappleCooldown();
							this.PlaceWeapon(myX, myY);
						}
						else
						{
							int num16 = myX;
							int num17 = myY;
							if (Main.tile[myX, myY].frameY == 0)
							{
								num17++;
							}
							if (Main.tile[myX, myY].frameY == 36)
							{
								num17--;
							}
							int frameX = (int)Main.tile[myX, num17].frameX;
							int num18 = (int)Main.tile[myX, num17].frameX;
							int num19 = 0;
							while (num18 >= 5000)
							{
								num18 -= 5000;
								num19++;
							}
							if (num19 != 0)
							{
								num18 = (num19 - 1) * 18;
							}
							num18 %= 54;
							if (num18 == 18)
							{
								frameX = (int)Main.tile[myX - 1, num17].frameX;
								num16--;
							}
							if (num18 == 36)
							{
								frameX = (int)Main.tile[myX - 2, num17].frameX;
								num16 -= 2;
							}
							if (frameX >= 5000)
							{
								this.GamepadEnableGrappleCooldown();
								WorldGen.KillTile(myX, num17, true, false, false);
								if (Main.netMode == 1)
								{
									NetMessage.SendData(17, -1, -1, null, 0, (float)myX, (float)num17, 1f, 0, 0, 0);
								}
							}
						}
					}
					else if (Main.tile[myX, myY].type == 440)
					{
						flag2 = true;
						int num20 = (int)(Main.tile[myX, myY].frameX / 54);
						int num21 = (int)(Main.tile[myX, myY].frameY / 54);
						short arg_BE9_0 = (short)(Main.tile[myX, myY].frameX % 54 / 18);
						short arg_C03_0 = (short)(Main.tile[myX, myY].frameY % 54 / 18);
						int num22 = -1;
						switch (num20)
						{
							case 0:
								num22 = 1526;
								break;
							case 1:
								num22 = 1524;
								break;
							case 2:
								num22 = 1525;
								break;
							case 3:
								num22 = 1523;
								break;
							case 4:
								num22 = 1522;
								break;
							case 5:
								num22 = 1527;
								break;
							case 6:
								num22 = 3643;
								break;
						}
						if (num22 != -1)
						{
							if (num21 == 0 && this.HasItem(num22) && this.selectedItem != 58)
							{
								this.GamepadEnableGrappleCooldown();
								if (Main.netMode != 1)
								{
									this.ConsumeItem(num22, false);
									WorldGen.ToggleGemLock(myX, myY, true);
								}
								else
								{
									this.ConsumeItem(num22, false);
									NetMessage.SendData(105, -1, -1, null, myX, (float)myY, 1f, 0f, 0, 0, 0);
								}
							}
							else if (num21 == 1)
							{
								this.GamepadEnableGrappleCooldown();
								if (Main.netMode != 1)
								{
									WorldGen.ToggleGemLock(myX, myY, false);
								}
								else
								{
									NetMessage.SendData(105, -1, -1, null, myX, (float)myY, 0f, 0f, 0, 0, 0);
								}
							}
						}
					}
					else if (Main.tile[myX, myY].type == 395)
					{
						flag2 = true;
						if (this.ItemFitsItemFrame(this.inventory[this.selectedItem]) && !this.inventory[this.selectedItem].favorited)
						{
							this.GamepadEnableGrappleCooldown();
							this.PlaceItemInFrame(myX, myY);
						}
						else
						{
							int num23 = myX;
							int num24 = myY;
							if (Main.tile[num23, num24].frameX % 36 != 0)
							{
								num23--;
							}
							if (Main.tile[num23, num24].frameY % 36 != 0)
							{
								num24--;
							}
							int num25 = TEItemFrame.Find(num23, num24);
							if (num25 != -1 && ((TEItemFrame)TileEntity.ByID[num25]).item.stack > 0)
							{
								this.GamepadEnableGrappleCooldown();
								WorldGen.KillTile(myX, num24, true, false, false);
								if (Main.netMode == 1)
								{
									NetMessage.SendData(17, -1, -1, null, 0, (float)myX, (float)num24, 1f, 0, 0, 0);
								}
							}
						}
					}
					else if (Main.tile[myX, myY].type == 125)
					{
						flag2 = true;
						this.AddBuff(29, 36000, true);
						Main.PlaySound(SoundID.Item4, this.position);
					}
					else if (Main.tile[myX, myY].type == 377)
					{
						flag2 = true;
						this.AddBuff(159, 36000, true);
						Main.PlaySound(SoundID.Item37, this.position);
					}
					else if (Main.tile[myX, myY].type == 354)
					{
						flag2 = true;
						this.AddBuff(150, 36000, true);
						Main.PlaySound(SoundID.Item4, this.position);
					}
					else if (Main.tile[myX, myY].type == 287)
					{
						flag2 = true;
						this.AddBuff(93, 36000, true);
						Main.PlaySound(7, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					}
					else if (Main.tile[myX, myY].type == 356)
					{
						flag2 = true;
						if (!Main.fastForwardTime && (Main.netMode == 1 || Main.sundialCooldown == 0))
						{
							Main.Sundialing();
							Main.PlaySound(SoundID.Item4, this.position);
						}
					}
					else if (Main.tile[myX, myY].type == 79)
					{
						flag2 = true;
						int num26 = myX + (int)(Main.tile[myX, myY].frameX / 18 * -1);
						if (Main.tile[myX, myY].frameX >= 72)
						{
							num26 += 4;
							num26++;
						}
						else
						{
							num26 += 2;
						}
						int num27 = (int)(Main.tile[myX, myY].frameY / 18);
						int num28 = 0;
						while (num27 > 1)
						{
							num27 -= 2;
							num28++;
						}
						int num29 = myY - num27;
						num29 += 2;
						this.FindSpawn();
						if (this.SpawnX == num26 && this.SpawnY == num29)
						{
							this.RemoveSpawn();
							Main.NewText(Language.GetTextValue("Game.SpawnPointRemoved"), 255, 240, 20, false);
						}
						else if (Player.CheckSpawn(num26, num29))
						{
							this.ChangeSpawn(num26, num29);
							Main.NewText(Language.GetTextValue("Game.SpawnPointSet"), 255, 240, 20, false);
						}
					}
					else if (Main.tileSign[(int)Main.tile[myX, myY].type])
					{
						flag2 = true;
						bool flag7 = true;
						if (this.sign >= 0 && Sign.ReadSign(myX, myY, true) == this.sign)
						{
							this.sign = -1;
							Main.npcChatText = "";
							Main.editSign = false;
							Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							flag7 = false;
						}
						if (flag7)
						{
							if (Main.netMode == 0)
							{
								this.talkNPC = -1;
								Main.npcChatCornerItem = 0;
								Main.playerInventory = false;
								Main.editSign = false;
								Main.PlaySound(10, -1, -1, 1, 1f, 0f);
								int num30 = Sign.ReadSign(myX, myY, true);
								this.sign = num30;
								Main.npcChatText = Main.sign[num30].text;
							}
							else
							{
								int num31 = (int)(Main.tile[myX, myY].frameX / 18);
								int num32 = (int)(Main.tile[myX, myY].frameY / 18);
								while (num31 > 1)
								{
									num31 -= 2;
								}
								int num33 = myX - num31;
								int num34 = myY - num32;
								if (Main.tileSign[(int)Main.tile[num33, num34].type])
								{
									NetMessage.SendData(46, -1, -1, null, num33, (float)num34, 0f, 0f, 0, 0, 0);
								}
							}
						}
					}
					else if (Main.tile[myX, myY].type == 104)
					{
						flag2 = true;
						string text = "AM";
						double num35 = Main.time;
						if (!Main.dayTime)
						{
							num35 += 54000.0;
						}
						num35 = num35 / 86400.0 * 24.0;
						double num36 = 7.5;
						num35 = num35 - num36 - 12.0;
						if (num35 < 0.0)
						{
							num35 += 24.0;
						}
						if (num35 >= 12.0)
						{
							text = "PM";
						}
						int num37 = (int)num35;
						double expr_12AE = (double)((int)((num35 - (double)num37) * 60.0));
						string text2 = string.Concat(expr_12AE);
						if (expr_12AE < 10.0)
						{
							text2 = "0" + text2;
						}
						if (num37 > 12)
						{
							num37 -= 12;
						}
						if (num37 == 0)
						{
							num37 = 12;
						}
						Main.NewText(Language.GetTextValue("Game.Time", string.Concat(new object[]
						{
							num37,
							":",
							text2,
							" ",
							text
						})), 255, 240, 20, false);
					}
					else if (Main.tile[myX, myY].type == 237)
					{
						flag2 = true;
						bool flag8 = false;
						if (!NPC.AnyNPCs(245) && Main.hardMode && NPC.downedPlantBoss)
						{
							for (int num38 = 0; num38 < 58; num38++)
							{
								if (this.inventory[num38].type == 1293)
								{
									this.inventory[num38].stack--;
									if (this.inventory[num38].stack <= 0)
									{
										this.inventory[num38].SetDefaults(0, false);
									}
									flag8 = true;
									break;
								}
							}
						}
						if (flag8)
						{
							Main.PlaySound(15, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							if (Main.netMode != 1)
							{
								NPC.SpawnOnPlayer(this.whoAmI, 245);
							}
							else
							{
								NetMessage.SendData(61, -1, -1, null, this.whoAmI, 245f, 0f, 0f, 0, 0, 0);
							}
						}
					}
					else if (Main.tile[myX, myY].type == 10)
					{
						flag2 = true;
						if (WorldGen.IsLockedDoor(myX, myY))
						{
							int num39 = 1141;
							for (int num40 = 0; num40 < 58; num40++)
							{
								if (this.inventory[num40].type == num39 && this.inventory[num40].stack > 0)
								{
									this.inventory[num40].stack--;
									if (this.inventory[num40].stack <= 0)
									{
										this.inventory[num40] = new Item();
									}
									WorldGen.UnlockDoor(myX, myY);
									if (Main.netMode == 1)
									{
										NetMessage.SendData(52, -1, -1, null, this.whoAmI, 2f, (float)myX, (float)myY, 0, 0, 0);
									}
								}
							}
						}
						else
						{
							WorldGen.OpenDoor(myX, myY, this.direction);
							NetMessage.SendData(19, -1, -1, null, 0, (float)myX, (float)myY, (float)this.direction, 0, 0, 0);
						}
					}
					else if (Main.tile[myX, myY].type == 11)
					{
						flag2 = true;
						if (WorldGen.CloseDoor(myX, myY, false))
						{
							NetMessage.SendData(19, -1, -1, null, 1, (float)myX, (float)myY, (float)this.direction, 0, 0, 0);
						}
					}
					else if (Main.tile[myX, myY].type == 88)
					{
						flag2 = true;
						if (Main.tile[myX, myY].frameY == 0)
						{
							Main.CancelClothesWindow(true);
							Main.mouseRightRelease = false;
							int num41 = (int)(Main.tile[myX, myY].frameX / 18);
							num41 %= 3;
							num41 = myX - num41;
							int num42 = myY - (int)(Main.tile[myX, myY].frameY / 18);
							if (this.sign > -1)
							{
								Main.PlaySound(11, -1, -1, 1, 1f, 0f);
								this.sign = -1;
								Main.editSign = false;
								Main.npcChatText = string.Empty;
							}
							if (Main.editChest)
							{
								Main.PlaySound(12, -1, -1, 1, 1f, 0f);
								Main.editChest = false;
								Main.npcChatText = string.Empty;
							}
							if (this.editedChestName)
							{
								NetMessage.SendData(33, -1, -1, NetworkText.FromLiteral(Main.chest[this.chest].name), this.chest, 1f, 0f, 0f, 0, 0, 0);
								this.editedChestName = false;
							}
							if (Main.netMode == 1)
							{
								if (num41 == this.chestX && num42 == this.chestY && this.chest != -1)
								{
									this.chest = -1;
									Recipe.FindRecipes();
									Main.PlaySound(11, -1, -1, 1, 1f, 0f);
								}
								else
								{
									NetMessage.SendData(31, -1, -1, null, num41, (float)num42, 0f, 0f, 0, 0, 0);
									Main.stackSplit = 600;
								}
							}
							else
							{
								this.flyingPigChest = -1;
								int num43 = Chest.FindChest(num41, num42);
								if (num43 != -1)
								{
									Main.stackSplit = 600;
									if (num43 == this.chest)
									{
										this.chest = -1;
										Recipe.FindRecipes();
										Main.PlaySound(11, -1, -1, 1, 1f, 0f);
									}
									else if (num43 != this.chest && this.chest == -1)
									{
										this.chest = num43;
										Main.playerInventory = true;
										if (PlayerInput.GrappleAndInteractAreShared)
										{
											PlayerInput.Triggers.JustPressed.Grapple = false;
										}
										Main.recBigList = false;
										Main.PlaySound(10, -1, -1, 1, 1f, 0f);
										this.chestX = num41;
										this.chestY = num42;
									}
									else
									{
										this.chest = num43;
										Main.playerInventory = true;
										if (PlayerInput.GrappleAndInteractAreShared)
										{
											PlayerInput.Triggers.JustPressed.Grapple = false;
										}
										Main.recBigList = false;
										Main.PlaySound(12, -1, -1, 1, 1f, 0f);
										this.chestX = num41;
										this.chestY = num42;
									}
									Recipe.FindRecipes();
								}
							}
						}
						else
						{
							Main.playerInventory = false;
							this.chest = -1;
							Recipe.FindRecipes();
							Main.dresserX = myX;
							Main.dresserY = myY;
							Main.OpenClothesWindow();
						}
					}
					else if (Main.tile[myX, myY].type == 209)
					{
						flag2 = true;
						Tile expr_1888 = Main.tile[myX, myY];
						int num44 = (int)(expr_1888.frameX % 72 / 18);
						int num45 = (int)(expr_1888.frameY % 54 / 18);
						int num46 = myX - num44;
						int num47 = myY - num45;
						int num48 = (int)(expr_1888.frameY / 54);
						int num49 = (int)(expr_1888.frameX / 72);
						int num50 = -1;
						if (num44 == 1 || num44 == 2)
						{
							num50 = num45;
						}
						int num51 = 0;
						if (num44 == 3 || (num44 == 2 && num49 != 3 && num49 != 4))
						{
							num51 = -54;
						}
						if (num44 == 0 || (num44 == 1 && num49 != 3 && num49 != 4))
						{
							num51 = 54;
						}
						if (num48 >= 8 && num51 > 0)
						{
							num51 = 0;
						}
						if (num48 == 0 && num51 < 0)
						{
							num51 = 0;
						}
						bool flag9 = false;
						if (num51 != 0)
						{
							for (int num52 = num46; num52 < num46 + 4; num52++)
							{
								for (int num53 = num47; num53 < num47 + 3; num53++)
								{
									Main.tile[num52, num53].frameY = (short)((int)Main.tile[num52, num53].frameY + num51);
								}
							}
							flag9 = true;
						}
						if ((num49 == 3 || num49 == 4) && (num50 == 1 || num50 == 0))
						{
							num51 = ((num49 == 3) ? 72 : -72);
							for (int num54 = num46; num54 < num46 + 4; num54++)
							{
								for (int num55 = num47; num55 < num47 + 3; num55++)
								{
									Main.tile[num54, num55].frameX = (short)((int)Main.tile[num54, num55].frameX + num51);
								}
							}
							flag9 = true;
						}
						if (flag9)
						{
							NetMessage.SendTileSquare(-1, num46 + 1, num47 + 1, 4, TileChangeType.None);
						}
						if (num50 != -1)
						{
							bool flag10 = false;
							if ((num49 == 3 || num49 == 4) && num50 == 2)
							{
								flag10 = true;
							}
							if (flag10)
							{
								WorldGen.ShootFromCannon(num46, num47, num48, num49 + 1, 0, 0f, this.whoAmI);
							}
						}
					}
					else if ((TileID.Sets.BasicChest[(int)Main.tile[myX, myY].type] || Main.tile[myX, myY].type == 29 || Main.tile[myX, myY].type == 97 || Main.tile[myX, myY].type == 463) && this.talkNPC == -1)
					{
						flag2 = true;
						Main.mouseRightRelease = false;
						int num56 = 0;
						int num57;
						for (num57 = (int)(Main.tile[myX, myY].frameX / 18); num57 > 1; num57 -= 2)
						{
						}
						num57 = myX - num57;
						int num58 = myY - (int)(Main.tile[myX, myY].frameY / 18);
						if (Main.tile[myX, myY].type == 29)
						{
							num56 = 1;
						}
						else if (Main.tile[myX, myY].type == 97)
						{
							num56 = 2;
						}
						else if (Main.tile[myX, myY].type == 463)
						{
							num56 = 3;
							if (Main.tile[myX, myY].frameX == 36)
							{
								num57--;
							}
							else
							{
								num57++;
							}
							num58 += 2;
						}
						if (this.sign > -1)
						{
							Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							this.sign = -1;
							Main.editSign = false;
							Main.npcChatText = string.Empty;
						}
						if (Main.editChest)
						{
							Main.PlaySound(12, -1, -1, 1, 1f, 0f);
							Main.editChest = false;
							Main.npcChatText = string.Empty;
						}
						if (this.editedChestName)
						{
							NetMessage.SendData(33, -1, -1, NetworkText.FromLiteral(Main.chest[this.chest].name), this.chest, 1f, 0f, 0f, 0, 0, 0);
							this.editedChestName = false;
						}
						if (Main.netMode == 1 && num56 == 0 && (Main.tile[num57, num58].frameX < 72 || Main.tile[num57, num58].frameX > 106) && (Main.tile[num57, num58].frameX < 144 || Main.tile[num57, num58].frameX > 178) && (Main.tile[num57, num58].frameX < 828 || Main.tile[num57, num58].frameX > 1006) && (Main.tile[num57, num58].frameX < 1296 || Main.tile[num57, num58].frameX > 1330) && (Main.tile[num57, num58].frameX < 1368 || Main.tile[num57, num58].frameX > 1402) && (Main.tile[num57, num58].frameX < 1440 || Main.tile[num57, num58].frameX > 1474))
						{
							if (num57 == this.chestX && num58 == this.chestY && this.chest != -1)
							{
								this.chest = -1;
								Recipe.FindRecipes();
								Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							}
							else
							{
								NetMessage.SendData(31, -1, -1, null, num57, (float)num58, 0f, 0f, 0, 0, 0);
								Main.stackSplit = 600;
							}
						}
						else
						{
							int num59 = -1;
							if (num56 == 1)
							{
								num59 = -2;
							}
							else if (num56 == 2)
							{
								num59 = -3;
							}
							else if (num56 == 3)
							{
								num59 = -4;
							}
							else
							{
								bool flag11 = false;
								if (Chest.isLocked(num57, num58))
								{
									int num60 = 327;
									if (Main.tile[num57, num58].frameX >= 144 && Main.tile[num57, num58].frameX <= 178)
									{
										num60 = 329;
									}
									if (Main.tile[num57, num58].frameX >= 828 && Main.tile[num57, num58].frameX <= 1006)
									{
										int num61 = (int)(Main.tile[num57, num58].frameX / 18);
										int num62 = 0;
										while (num61 >= 2)
										{
											num61 -= 2;
											num62++;
										}
										num62 -= 23;
										num60 = 1533 + num62;
									}
									flag11 = true;
									for (int num63 = 0; num63 < 58; num63++)
									{
										if (this.inventory[num63].type == num60 && this.inventory[num63].stack > 0 && Chest.Unlock(num57, num58))
										{
											if (num60 != 329)
											{
												this.inventory[num63].stack--;
												if (this.inventory[num63].stack <= 0)
												{
													this.inventory[num63] = new Item();
												}
											}
											if (Main.netMode == 1)
											{
												NetMessage.SendData(52, -1, -1, null, this.whoAmI, 1f, (float)num57, (float)num58, 0, 0, 0);
											}
										}
									}
								}
								if (!flag11)
								{
									num59 = Chest.FindChest(num57, num58);
								}
							}
							if (num59 != -1)
							{
								Main.stackSplit = 600;
								if (num59 == this.chest)
								{
									this.chest = -1;
									Main.PlaySound(11, -1, -1, 1, 1f, 0f);
								}
								else if (num59 != this.chest && this.chest == -1)
								{
									this.chest = num59;
									Main.playerInventory = true;
									if (PlayerInput.GrappleAndInteractAreShared)
									{
										PlayerInput.Triggers.JustPressed.Grapple = false;
									}
									Main.recBigList = false;
									Main.PlaySound(10, -1, -1, 1, 1f, 0f);
									this.chestX = num57;
									this.chestY = num58;
									if (Main.tile[num57, num58].frameX >= 36 && Main.tile[num57, num58].frameX < 72)
									{
										AchievementsHelper.HandleSpecialEvent(this, 16);
									}
								}
								else
								{
									this.chest = num59;
									Main.playerInventory = true;
									if (PlayerInput.GrappleAndInteractAreShared)
									{
										PlayerInput.Triggers.JustPressed.Grapple = false;
									}
									Main.recBigList = false;
									Main.PlaySound(12, -1, -1, 1, 1f, 0f);
									this.chestX = num57;
									this.chestY = num58;
								}
								Recipe.FindRecipes();
							}
						}
					}
					else if (Main.tile[myX, myY].type == 314 && this.gravDir == 1f)
					{
						flag2 = true;
						bool flag12 = true;
						if (this.mount.Active)
						{
							if (this.mount.Cart)
							{
								flag12 = false;
							}
							else
							{
								this.mount.Dismount(this);
							}
						}
						if (flag12)
						{
							this.LaunchMinecartHook(myX, myY);
						}
					}
				}
				if (flag2)
				{
					this.tileInteractionHappened = true;
				}
			}
		}

		// Token: 0x06000350 RID: 848 RVA: 0x002263C0 File Offset: 0x002245C0
		public void ToggleInv()
		{
			bool grappleAndInteractAreShared = PlayerInput.GrappleAndInteractAreShared;
			if (Main.mapFullscreen)
			{
				Main.mapFullscreen = false;
				this.releaseInventory = false;
				Main.PlaySound(11, -1, -1, 1, 1f, 0f);
			}
			else if (PlayerInput.InBuildingMode)
			{
				PlayerInput.ExitBuildingMode();
				Main.PlaySound(11, -1, -1, 1, 1f, 0f);
			}
			else if (Main.ingameOptionsWindow)
			{
				if (PlayerInput.UsingGamepadUI && UILinkPointNavigator.CurrentPage == 1002)
				{
					UILinkPointNavigator.ChangePage(1001);
				}
				else
				{
					IngameOptions.Close();
				}
			}
			else if (Main.inFancyUI)
			{
				IngameFancyUI.Close();
			}
			else if (CaptureManager.Instance.Active)
			{
				CaptureManager.Instance.Active = false;
			}
			else if (this.talkNPC >= 0)
			{
				this.talkNPC = -1;
				Main.npcChatCornerItem = 0;
				Main.npcChatText = "";
				Main.PlaySound(11, -1, -1, 1, 1f, 0f);
				if (PlayerInput.UsingGamepad)
				{
					Main.npcChatRelease = false;
				}
			}
			else if (this.sign >= 0)
			{
				this.sign = -1;
				Main.editSign = false;
				Main.npcChatText = "";
				Main.PlaySound(11, -1, -1, 1, 1f, 0f);
			}
			else if (Main.clothesWindow)
			{
				Main.CancelClothesWindow(false);
			}
			else if (!Main.playerInventory)
			{
				Recipe.FindRecipes();
				Main.playerInventory = true;
				Main.EquipPageSelected = 0;
				Main.PlaySound(10, -1, -1, 1, 1f, 0f);
			}
			else
			{
				Main.playerInventory = false;
				if (!PlayerInput.UsingGamepad)
				{
					Main.EquipPageSelected = 0;
				}
				else
				{
					PlayerInput.NavigatorUnCachePosition();
					Main.GamepadCursorAlpha = 0f;
					Player.StopMoneyTroughFromWorking = 3;
				}
				Main.PlaySound(11, -1, -1, 1, 1f, 0f);
				if (ItemSlot.Options.HighlightNewItems)
				{
					Item[] array = this.inventory;
					for (int i = 0; i < array.Length; i++)
					{
						array[i].newAndShiny = false;
					}
				}
			}
			if (grappleAndInteractAreShared)
			{
				this.GamepadEnableGrappleCooldown();
			}
		}

		// Token: 0x06000382 RID: 898 RVA: 0x0023BA84 File Offset: 0x00239C84
		public void ToggleLight()
		{
			this.hideMisc[1] = !this.hideMisc[1];
			if (this.hideMisc[1])
			{
				this.ClearBuff(this.miscEquips[1].buffType);
				if (this.miscEquips[1].buffType == 27)
				{
					this.ClearBuff(102);
					this.ClearBuff(101);
				}
			}
		}

		// Token: 0x06000381 RID: 897 RVA: 0x0023BA46 File Offset: 0x00239C46
		public void TogglePet()
		{
			this.hideMisc[0] = !this.hideMisc[0];
			if (this.hideMisc[0])
			{
				this.ClearBuff(this.miscEquips[0].buffType);
			}
		}

		// Token: 0x060003C0 RID: 960 RVA: 0x0025E320 File Offset: 0x0025C520
		private void TryBouncingBlocks(bool Falling)
		{
			if ((this.velocity.Y >= 5f || this.velocity.Y <= -5f) && !this.wet)
			{
				int num = 0;
				bool flag = false;
				foreach (Point current in this.TouchedTiles)
				{
					Tile tile = Main.tile[current.X, current.Y];
					if (tile != null && tile.active() && tile.nactive() && Main.tileBouncy[(int)tile.type])
					{
						flag = true;
						num = current.Y;
						break;
					}
				}
				if (flag)
				{
					this.velocity.Y = this.velocity.Y * -0.8f;
					if (this.controlJump)
					{
						this.velocity.Y = MathHelper.Clamp(this.velocity.Y, -13f, 13f);
					}
					this.position.Y = (float)(num * 16 - ((this.velocity.Y < 0f) ? this.height : -16));
					this.FloorVisuals(Falling);
					this.velocity.Y = MathHelper.Clamp(this.velocity.Y, -20f, 20f);
					if (this.velocity.Y * this.gravDir < 0f)
					{
						this.fallStart = (int)this.position.Y / 16;
					}
				}
			}
		}

		// Token: 0x06000368 RID: 872 RVA: 0x0022B0F0 File Offset: 0x002292F0
		private void TryGettingDevArmor()
		{
			if (Main.rand.Next(20) != 0)
			{
				return;
			}
			switch (Main.rand.Next(14))
			{
				case 0:
					this.QuickSpawnItem(666, 1);
					this.QuickSpawnItem(667, 1);
					this.QuickSpawnItem(668, 1);
					this.QuickSpawnItem(665, 1);
					this.QuickSpawnItem(3287, 1);
					return;
				case 1:
					this.QuickSpawnItem(1554, 1);
					this.QuickSpawnItem(1555, 1);
					this.QuickSpawnItem(1556, 1);
					this.QuickSpawnItem(1586, 1);
					return;
				case 2:
					this.QuickSpawnItem(1587, 1);
					this.QuickSpawnItem(1588, 1);
					this.QuickSpawnItem(1586, 1);
					return;
				case 3:
					this.QuickSpawnItem(1557, 1);
					this.QuickSpawnItem(1558, 1);
					this.QuickSpawnItem(1559, 1);
					this.QuickSpawnItem(1585, 1);
					return;
				case 4:
					this.QuickSpawnItem(1560, 1);
					this.QuickSpawnItem(1561, 1);
					this.QuickSpawnItem(1562, 1);
					this.QuickSpawnItem(1584, 1);
					return;
				case 5:
					this.QuickSpawnItem(1563, 1);
					this.QuickSpawnItem(1564, 1);
					this.QuickSpawnItem(1565, 1);
					this.QuickSpawnItem(3582, 1);
					return;
				case 6:
					this.QuickSpawnItem(1566, 1);
					this.QuickSpawnItem(1567, 1);
					this.QuickSpawnItem(1568, 1);
					return;
				case 7:
					this.QuickSpawnItem(1580, 1);
					this.QuickSpawnItem(1581, 1);
					this.QuickSpawnItem(1582, 1);
					this.QuickSpawnItem(1583, 1);
					return;
				case 8:
					this.QuickSpawnItem(3226, 1);
					this.QuickSpawnItem(3227, 1);
					this.QuickSpawnItem(3228, 1);
					this.QuickSpawnItem(3288, 1);
					return;
				case 9:
					this.QuickSpawnItem(3583, 1);
					this.QuickSpawnItem(3581, 1);
					this.QuickSpawnItem(3578, 1);
					this.QuickSpawnItem(3579, 1);
					this.QuickSpawnItem(3580, 1);
					return;
				case 10:
					this.QuickSpawnItem(3585, 1);
					this.QuickSpawnItem(3586, 1);
					this.QuickSpawnItem(3587, 1);
					this.QuickSpawnItem(3588, 1);
					this.QuickSpawnItem(3024, 4);
					return;
				case 11:
					this.QuickSpawnItem(3589, 1);
					this.QuickSpawnItem(3590, 1);
					this.QuickSpawnItem(3591, 1);
					this.QuickSpawnItem(3592, 1);
					this.QuickSpawnItem(3599, 4);
					return;
				case 12:
					this.QuickSpawnItem(3921, 1);
					this.QuickSpawnItem(3922, 1);
					this.QuickSpawnItem(3923, 1);
					this.QuickSpawnItem(3924, 1);
					return;
				case 13:
					this.QuickSpawnItem(3925, 1);
					this.QuickSpawnItem(3926, 1);
					this.QuickSpawnItem(3927, 1);
					this.QuickSpawnItem(3928, 1);
					this.QuickSpawnItem(3929, 1);
					return;
				default:
					return;
			}
		}

		// Token: 0x060003BF RID: 959 RVA: 0x0025E260 File Offset: 0x0025C460
		private void TryLandingOnDetonator()
		{
			if (this.whoAmI != Main.myPlayer)
			{
				return;
			}
			if (this.velocity.Y >= 3f)
			{
				Point point = (base.Bottom + new Vector2(0f, 0.01f)).ToTileCoordinates();
				Tile tileSafely = Framing.GetTileSafely(point.X, point.Y);
				if (tileSafely.active() && tileSafely.type == 411 && tileSafely.frameY == 0 && tileSafely.frameX < 36)
				{
					Wiring.HitSwitch(point.X, point.Y);
					NetMessage.SendData(59, -1, -1, null, point.X, (float)point.Y, 0f, 0f, 0, 0, 0);
				}
			}
		}

		// Token: 0x06000415 RID: 1045 RVA: 0x00285394 File Offset: 0x00283594
		public void TryPortalJumping()
		{
			if (this.mount.Active || this.dead)
			{
				return;
			}
			PortalHelper.TryGoingThroughPortals(this);
		}

		// Token: 0x060003C4 RID: 964 RVA: 0x0025F928 File Offset: 0x0025DB28
		private static bool TryPurchasing(int price, List<Item[]> inv, List<Point> slotCoins, List<Point> slotsEmpty, List<Point> slotEmptyBank, List<Point> slotEmptyBank2, List<Point> slotEmptyBank3)
		{
			long num = (long)price;
			Dictionary<Point, Item> dictionary = new Dictionary<Point, Item>();
			bool result = false;
			while (num > 0L)
			{
				long num2 = 1000000L;
				for (int i = 0; i < 4; i++)
				{
					if (num >= num2)
					{
						foreach (Point current in slotCoins)
						{
							if (inv[current.X][current.Y].type == 74 - i)
							{
								long num3 = num / num2;
								dictionary[current] = inv[current.X][current.Y].Clone();
								if (num3 < (long)inv[current.X][current.Y].stack)
								{
									inv[current.X][current.Y].stack -= (int)num3;
								}
								else
								{
									inv[current.X][current.Y].SetDefaults(0, false);
									slotsEmpty.Add(current);
								}
								num -= num2 * (long)(dictionary[current].stack - inv[current.X][current.Y].stack);
							}
						}
					}
					num2 /= 100L;
				}
				if (num > 0L)
				{
					if (slotsEmpty.Count <= 0)
					{
						foreach (KeyValuePair<Point, Item> current2 in dictionary)
						{
							inv[current2.Key.X][current2.Key.Y] = current2.Value.Clone();
						}
						result = true;
						break;
					}
					slotsEmpty.Sort(new Comparison<Point>(DelegateMethods.CompareYReverse));
					Point point = new Point(-1, -1);
					for (int j = 0; j < inv.Count; j++)
					{
						num2 = 10000L;
						for (int k = 0; k < 3; k++)
						{
							if (num >= num2)
							{
								foreach (Point current3 in slotCoins)
								{
									if (current3.X == j && inv[current3.X][current3.Y].type == 74 - k && inv[current3.X][current3.Y].stack >= 1)
									{
										List<Point> list = slotsEmpty;
										if (j == 1 && slotEmptyBank.Count > 0)
										{
											list = slotEmptyBank;
										}
										if (j == 2 && slotEmptyBank2.Count > 0)
										{
											list = slotEmptyBank2;
										}
										Item expr_241 = inv[current3.X][current3.Y];
										int num4 = expr_241.stack - 1;
										expr_241.stack = num4;
										if (num4 <= 0)
										{
											inv[current3.X][current3.Y].SetDefaults(0, false);
											list.Add(current3);
										}
										dictionary[list[0]] = inv[list[0].X][list[0].Y].Clone();
										inv[list[0].X][list[0].Y].SetDefaults(73 - k, false);
										inv[list[0].X][list[0].Y].stack = 100;
										point = list[0];
										list.RemoveAt(0);
										break;
									}
								}
							}
							if (point.X != -1 || point.Y != -1)
							{
								break;
							}
							num2 /= 100L;
						}
						for (int l = 0; l < 2; l++)
						{
							if (point.X == -1 && point.Y == -1)
							{
								foreach (Point current4 in slotCoins)
								{
									if (current4.X == j && inv[current4.X][current4.Y].type == 73 + l && inv[current4.X][current4.Y].stack >= 1)
									{
										List<Point> list2 = slotsEmpty;
										if (j == 1 && slotEmptyBank.Count > 0)
										{
											list2 = slotEmptyBank;
										}
										if (j == 2 && slotEmptyBank2.Count > 0)
										{
											list2 = slotEmptyBank2;
										}
										if (j == 3 && slotEmptyBank3.Count > 0)
										{
											list2 = slotEmptyBank3;
										}
										Item expr_437 = inv[current4.X][current4.Y];
										int num4 = expr_437.stack - 1;
										expr_437.stack = num4;
										if (num4 <= 0)
										{
											inv[current4.X][current4.Y].SetDefaults(0, false);
											list2.Add(current4);
										}
										dictionary[list2[0]] = inv[list2[0].X][list2[0].Y].Clone();
										inv[list2[0].X][list2[0].Y].SetDefaults(72 + l, false);
										inv[list2[0].X][list2[0].Y].stack = 100;
										point = list2[0];
										list2.RemoveAt(0);
										break;
									}
								}
							}
						}
						if (point.X != -1 && point.Y != -1)
						{
							slotCoins.Add(point);
							break;
						}
					}
					slotsEmpty.Sort(new Comparison<Point>(DelegateMethods.CompareYReverse));
					slotEmptyBank.Sort(new Comparison<Point>(DelegateMethods.CompareYReverse));
					slotEmptyBank2.Sort(new Comparison<Point>(DelegateMethods.CompareYReverse));
					slotEmptyBank3.Sort(new Comparison<Point>(DelegateMethods.CompareYReverse));
				}
			}
			return result;
		}

		// Token: 0x060003E3 RID: 995 RVA: 0x0026C42C File Offset: 0x0026A62C
		public void UnityTeleport(Vector2 telePos)
		{
			int num = 3;
			if (Main.netMode == 0)
			{
				this.Teleport(telePos, num, 0);
				return;
			}
			NetMessage.SendData(65, -1, -1, null, 2, (float)this.whoAmI, telePos.X, telePos.Y, num, 0, 0);
		}

		// Token: 0x060003AC RID: 940 RVA: 0x0024E77C File Offset: 0x0024C97C
		public void Update(int i)
		{
			if (i == Main.myPlayer && Main.netMode != 2)
			{
				LockOnHelper.Update();
			}
			if (this.launcherWait > 0)
			{
				this.launcherWait--;
			}
			this.maxFallSpeed = 10f;
			this.gravity = Player.defaultGravity;
			Player.jumpHeight = 15;
			Player.jumpSpeed = 5.01f;
			this.maxRunSpeed = 3f;
			this.runAcceleration = 0.08f;
			this.runSlowdown = 0.2f;
			this.accRunSpeed = this.maxRunSpeed;
			if (!this.mount.Active || !this.mount.Cart)
			{
				this.onWrongGround = false;
			}
			this.heldProj = -1;
			if (this.PortalPhysicsEnabled)
			{
				this.maxFallSpeed = 35f;
			}
			if (this.wet)
			{
				if (this.honeyWet)
				{
					this.gravity = 0.1f;
					this.maxFallSpeed = 3f;
				}
				else if (this.merman)
				{
					this.gravity = 0.3f;
					this.maxFallSpeed = 7f;
				}
				else
				{
					this.gravity = 0.2f;
					this.maxFallSpeed = 5f;
					Player.jumpHeight = 30;
					Player.jumpSpeed = 6.01f;
				}
			}
			if (this.vortexDebuff)
			{
				this.gravity = 0f;
			}
			this.maxFallSpeed += 0.01f;
			bool flag = false;
			if (Main.mapFullscreen)
			{
				this.GamepadEnableGrappleCooldown();
			}
			else if (this._quickGrappleCooldown > 0)
			{
				this._quickGrappleCooldown--;
			}
			if (Main.myPlayer == i)
			{
				TileObject.objectPreview.Reset();
				if (DD2Event.DownedInvasionAnyDifficulty)
				{
					this.downedDD2EventAnyDifficulty = true;
				}
			}
			if (this.active)
			{
				if (this.ghostDmg > 0f)
				{
					this.ghostDmg -= 2.5f;
				}
				if (this.ghostDmg < 0f)
				{
					this.ghostDmg = 0f;
				}
				if (Main.expertMode)
				{
					if (this.lifeSteal < 70f)
					{
						this.lifeSteal += 0.5f;
					}
					if (this.lifeSteal > 70f)
					{
						this.lifeSteal = 70f;
					}
				}
				else
				{
					if (this.lifeSteal < 80f)
					{
						this.lifeSteal += 0.6f;
					}
					if (this.lifeSteal > 80f)
					{
						this.lifeSteal = 80f;
					}
				}
				if (this.mount.Active)
				{
					this.position.Y = this.position.Y + (float)this.height;
					this.height = 42 + this.mount.HeightBoost;
					this.position.Y = this.position.Y - (float)this.height;
					if (this.mount.Type == 0)
					{
						int arg_2EA_0 = (int)(this.position.X + (float)(this.width / 2)) / 16;
						int j = (int)(this.position.Y + (float)(this.height / 2) - 14f) / 16;
						Lighting.AddLight(arg_2EA_0, j, 0.5f, 0.2f, 0.05f);
						Lighting.AddLight(arg_2EA_0 + this.direction, j, 0.5f, 0.2f, 0.05f);
						Lighting.AddLight(arg_2EA_0 + this.direction * 2, j, 0.5f, 0.2f, 0.05f);
					}
				}
				else
				{
					this.position.Y = this.position.Y + (float)this.height;
					this.height = 42;
					this.position.Y = this.position.Y - (float)this.height;
				}
				Main.ActivePlayersCount++;
				this.outOfRange = false;
				if (this.whoAmI != Main.myPlayer)
				{
					int num = (int)(this.position.X + (float)(this.width / 2)) / 16;
					int num2 = (int)(this.position.Y + (float)(this.height / 2)) / 16;
					if (!WorldGen.InWorld(num, num2, 4))
					{
						flag = true;
					}
					else if (Main.tile[num, num2] == null)
					{
						flag = true;
					}
					else if (Main.tile[num - 3, num2] == null)
					{
						flag = true;
					}
					else if (Main.tile[num + 3, num2] == null)
					{
						flag = true;
					}
					else if (Main.tile[num, num2 - 3] == null)
					{
						flag = true;
					}
					else if (Main.tile[num, num2 + 3] == null)
					{
						flag = true;
					}
					if (flag)
					{
						this.outOfRange = true;
						this.numMinions = 0;
						this.slotsMinions = 0f;
						this.itemAnimation = 0;
						this.PlayerFrame();
					}
				}
				if (this.tankPet >= 0)
				{
					if (!this.tankPetReset)
					{
						this.tankPetReset = true;
					}
					else
					{
						this.tankPet = -1;
					}
				}
			}
			if (this.chatOverhead.timeLeft > 0)
			{
				this.chatOverhead.timeLeft = this.chatOverhead.timeLeft - 1;
			}
			if (!this.active | flag)
			{
				return;
			}
			this.miscCounter++;
			if (this.miscCounter >= 300)
			{
				this.miscCounter = 0;
			}
			this.infernoCounter++;
			if (this.infernoCounter >= 180)
			{
				this.infernoCounter = 0;
			}
			float num3 = (float)(Main.maxTilesX / 4200);
			num3 *= num3;
			float num4 = (float)((double)(this.position.Y / 16f - (60f + 10f * num3)) / (Main.worldSurface / 6.0));
			if ((double)num4 < 0.25)
			{
				num4 = 0.25f;
			}
			if (num4 > 1f)
			{
				num4 = 1f;
			}
			this.gravity *= num4;
			this.maxRegenDelay = (1f - (float)this.statMana / (float)this.statManaMax2) * 60f * 4f + 45f;
			this.maxRegenDelay *= 0.7f;
			this.UpdateSocialShadow();
			this.UpdateTeleportVisuals();
			this.whoAmI = i;
			if (this.whoAmI == Main.myPlayer)
			{
				if (!DD2Event.Ongoing)
				{
					this.PurgeDD2EnergyCrystals();
				}
				this.TryPortalJumping();
			}
			if (this.runSoundDelay > 0)
			{
				this.runSoundDelay--;
			}
			if (this.attackCD > 0)
			{
				this.attackCD--;
			}
			if (this.itemAnimation == 0)
			{
				this.attackCD = 0;
			}
			if (this.potionDelay > 0)
			{
				this.potionDelay--;
			}
			if (i == Main.myPlayer)
			{
				if (this.trashItem.type >= 1522 && this.trashItem.type <= 1527)
				{
					this.trashItem.SetDefaults(0, false);
				}
				if (this.trashItem.type == 3643)
				{
					this.trashItem.SetDefaults(0, false);
				}
				this.UpdateBiomes();
				this.UpdateMinionTarget();
			}
			if (this.ghost)
			{
				this.Ghost();
				return;
			}
			if (this.dead)
			{
				this.UpdateDead();
				return;
			}
			if (i == Main.myPlayer)
			{
				this.controlUp = false;
				this.controlLeft = false;
				this.controlDown = false;
				this.controlRight = false;
				this.controlJump = false;
				this.controlUseItem = false;
				this.controlUseTile = false;
				this.controlThrow = false;
				this.controlInv = false;
				this.controlHook = false;
				this.controlTorch = false;
				this.controlSmart = false;
				this.controlMount = false;
				this.controlQuickHeal = false;
				this.controlQuickMana = false;
				this.mapStyle = false;
				this.mapAlphaDown = false;
				this.mapAlphaUp = false;
				this.mapFullScreen = false;
				this.mapZoomIn = false;
				this.mapZoomOut = false;
				if (Main.hasFocus)
				{
					if (!Main.drawingPlayerChat && !Main.editSign && !Main.editChest && !Main.blockInput)
					{
						PlayerInput.Triggers.Current.CopyInto(this);
						if (Main.mapFullscreen)
						{
							if (this.controlUp)
							{
								Main.mapFullscreenPos.Y = Main.mapFullscreenPos.Y - 1f * (16f / Main.mapFullscreenScale);
							}
							if (this.controlDown)
							{
								Main.mapFullscreenPos.Y = Main.mapFullscreenPos.Y + 1f * (16f / Main.mapFullscreenScale);
							}
							if (this.controlLeft)
							{
								Main.mapFullscreenPos.X = Main.mapFullscreenPos.X - 1f * (16f / Main.mapFullscreenScale);
							}
							if (this.controlRight)
							{
								Main.mapFullscreenPos.X = Main.mapFullscreenPos.X + 1f * (16f / Main.mapFullscreenScale);
							}
							this.controlUp = false;
							this.controlLeft = false;
							this.controlDown = false;
							this.controlRight = false;
							this.controlJump = false;
							this.controlUseItem = false;
							this.controlUseTile = false;
							this.controlThrow = false;
							this.controlHook = false;
							this.controlTorch = false;
							this.controlSmart = false;
							this.controlMount = false;
						}
						if (this.controlQuickHeal)
						{
							if (this.releaseQuickHeal)
							{
								this.QuickHeal();
							}
							this.releaseQuickHeal = false;
						}
						else
						{
							this.releaseQuickHeal = true;
						}
						if (this.controlQuickMana)
						{
							if (this.releaseQuickMana)
							{
								this.QuickMana();
							}
							this.releaseQuickMana = false;
						}
						else
						{
							this.releaseQuickMana = true;
						}
						if (this.controlLeft && this.controlRight)
						{
							this.controlLeft = false;
							this.controlRight = false;
						}
						if (Main.cSmartCursorToggle)
						{
							if (this.controlSmart && this.releaseSmart)
							{
								Main.PlaySound(12, -1, -1, 1, 1f, 0f);
								Main.SmartCursorEnabled = !Main.SmartCursorEnabled;
							}
						}
						else
						{
							if (Main.SmartCursorEnabled != this.controlSmart)
							{
								Main.PlaySound(12, -1, -1, 1, 1f, 0f);
							}
							Main.SmartCursorEnabled = this.controlSmart;
						}
						if (this.controlSmart)
						{
							this.releaseSmart = false;
						}
						else
						{
							this.releaseSmart = true;
						}
						if (this.controlMount)
						{
							if (this.releaseMount)
							{
								this.QuickMount();
							}
							this.releaseMount = false;
						}
						else
						{
							this.releaseMount = true;
						}
						if (Main.mapFullscreen)
						{
							if (this.mapZoomIn)
							{
								Main.mapFullscreenScale *= 1.05f;
							}
							if (this.mapZoomOut)
							{
								Main.mapFullscreenScale *= 0.95f;
							}
						}
						else
						{
							if (Main.mapStyle == 1)
							{
								if (this.mapZoomIn)
								{
									Main.mapMinimapScale *= 1.025f;
								}
								if (this.mapZoomOut)
								{
									Main.mapMinimapScale *= 0.975f;
								}
								if (this.mapAlphaUp)
								{
									Main.mapMinimapAlpha += 0.015f;
								}
								if (this.mapAlphaDown)
								{
									Main.mapMinimapAlpha -= 0.015f;
								}
							}
							else if (Main.mapStyle == 2)
							{
								if (this.mapZoomIn)
								{
									Main.mapOverlayScale *= 1.05f;
								}
								if (this.mapZoomOut)
								{
									Main.mapOverlayScale *= 0.95f;
								}
								if (this.mapAlphaUp)
								{
									Main.mapOverlayAlpha += 0.015f;
								}
								if (this.mapAlphaDown)
								{
									Main.mapOverlayAlpha -= 0.015f;
								}
							}
							if (this.mapStyle)
							{
								if (this.releaseMapStyle)
								{
									Main.PlaySound(12, -1, -1, 1, 1f, 0f);
									Main.mapStyle++;
									if (Main.mapStyle > 2)
									{
										Main.mapStyle = 0;
									}
								}
								this.releaseMapStyle = false;
							}
							else
							{
								this.releaseMapStyle = true;
							}
						}
						if (this.mapFullScreen)
						{
							if (this.releaseMapFullscreen)
							{
								if (Main.mapFullscreen)
								{
									Main.PlaySound(11, -1, -1, 1, 1f, 0f);
									Main.mapFullscreen = false;
								}
								else if (Main.mapEnabled)
								{
									Main.playerInventory = false;
									this.talkNPC = -1;
									Main.npcChatCornerItem = 0;
									Main.PlaySound(10, -1, -1, 1, 1f, 0f);
									Main.mapFullscreenScale = 2.5f;
									Main.mapFullscreen = true;
									Main.resetMapFull = true;
									Main.buffString = string.Empty;
								}
							}
							this.releaseMapFullscreen = false;
						}
						else
						{
							this.releaseMapFullscreen = true;
						}
					}
					else if (!PlayerInput.UsingGamepad && !Main.editSign && !Main.editChest && !Main.blockInput)
					{
						PlayerInput.Triggers.Current.CopyIntoDuringChat(this);
					}
					if (this.confused)
					{
						bool flag2 = this.controlLeft;
						bool flag3 = this.controlUp;
						this.controlLeft = this.controlRight;
						this.controlRight = flag2;
						this.controlUp = this.controlRight;
						this.controlDown = flag3;
					}
					else if (this.cartFlip)
					{
						if (this.controlRight || this.controlLeft)
						{
							bool flag4 = this.controlLeft;
							this.controlLeft = this.controlRight;
							this.controlRight = flag4;
						}
						else
						{
							this.cartFlip = false;
						}
					}
					for (int k = 0; k < this.doubleTapCardinalTimer.Length; k++)
					{
						this.doubleTapCardinalTimer[k]--;
						if (this.doubleTapCardinalTimer[k] < 0)
						{
							this.doubleTapCardinalTimer[k] = 0;
						}
					}
					for (int l = 0; l < 4; l++)
					{
						bool flag5 = false;
						bool flag6 = false;
						switch (l)
						{
							case 0:
								flag5 = (this.controlDown && this.releaseDown);
								flag6 = this.controlDown;
								break;
							case 1:
								flag5 = (this.controlUp && this.releaseUp);
								flag6 = this.controlUp;
								break;
							case 2:
								flag5 = (this.controlRight && this.releaseRight);
								flag6 = this.controlRight;
								break;
							case 3:
								flag5 = (this.controlLeft && this.releaseLeft);
								flag6 = this.controlLeft;
								break;
						}
						if (flag5)
						{
							if (this.doubleTapCardinalTimer[l] > 0)
							{
								this.KeyDoubleTap(l);
							}
							else
							{
								this.doubleTapCardinalTimer[l] = 15;
							}
						}
						if (flag6)
						{
							this.holdDownCardinalTimer[l]++;
							this.KeyHoldDown(l, this.holdDownCardinalTimer[l]);
						}
						else
						{
							this.holdDownCardinalTimer[l] = 0;
						}
					}
					if (this.controlInv)
					{
						if (this.releaseInventory)
						{
							this.ToggleInv();
						}
						this.releaseInventory = false;
					}
					else
					{
						this.releaseInventory = true;
					}
					if (this.delayUseItem)
					{
						if (!this.controlUseItem)
						{
							this.delayUseItem = false;
						}
						this.controlUseItem = false;
					}
					if (this.itemAnimation == 0 && this.itemTime == 0 && this.reuseDelay == 0)
					{
						this.dropItemCheck();
						int num5 = this.selectedItem;
						bool flag7 = false;
						if (!Main.drawingPlayerChat && this.selectedItem != 58 && !Main.editSign && !Main.editChest)
						{
							if (PlayerInput.Triggers.Current.Hotbar1)
							{
								this.selectedItem = 0;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar2)
							{
								this.selectedItem = 1;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar3)
							{
								this.selectedItem = 2;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar4)
							{
								this.selectedItem = 3;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar5)
							{
								this.selectedItem = 4;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar6)
							{
								this.selectedItem = 5;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar7)
							{
								this.selectedItem = 6;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar8)
							{
								this.selectedItem = 7;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar9)
							{
								this.selectedItem = 8;
								flag7 = true;
							}
							if (PlayerInput.Triggers.Current.Hotbar10)
							{
								this.selectedItem = 9;
								flag7 = true;
							}
							int selectedBinding = this.DpadRadial.SelectedBinding;
							int selectedBinding2 = this.CircularRadial.SelectedBinding;
							int arg_F5B_0 = this.QuicksRadial.SelectedBinding;
							this.DpadRadial.Update();
							this.CircularRadial.Update();
							this.QuicksRadial.Update();
							if (this.CircularRadial.SelectedBinding >= 0 && selectedBinding2 != this.CircularRadial.SelectedBinding)
							{
								this.DpadRadial.ChangeSelection(-1);
							}
							if (this.DpadRadial.SelectedBinding >= 0 && selectedBinding != this.DpadRadial.SelectedBinding)
							{
								this.CircularRadial.ChangeSelection(-1);
							}
							if (this.QuicksRadial.SelectedBinding != -1 && PlayerInput.Triggers.JustReleased.RadialQuickbar && !PlayerInput.MiscSettingsTEMP.HotbarRadialShouldBeUsed)
							{
								switch (this.QuicksRadial.SelectedBinding)
								{
									case 0:
										this.QuickHeal();
										break;
									case 1:
										this.QuickBuff();
										break;
									case 2:
										this.QuickMana();
										break;
								}
							}
							if (this.controlTorch | flag7)
							{
								this.DpadRadial.ChangeSelection(-1);
								this.CircularRadial.ChangeSelection(-1);
							}
							if (this.controlTorch & flag7)
							{
								if (this.selectedItem != this.nonTorch)
								{
									Main.PlaySound(12, -1, -1, 1, 1f, 0f);
								}
								this.nonTorch = this.selectedItem;
								this.selectedItem = num5;
								flag7 = false;
							}
						}
						bool flag8 = Main.hairWindow;
						if (flag8)
						{
							int y = Main.screenHeight / 2 + 60;
							flag8 = new Rectangle(Main.screenWidth / 2 - Main.hairStyleBackTexture.Width / 2, y, Main.hairStyleBackTexture.Width, Main.hairStyleBackTexture.Height).Contains(Main.MouseScreen.ToPoint());
						}
						if (flag7 && CaptureManager.Instance.Active)
						{
							CaptureManager.Instance.Active = false;
						}
						if (num5 != this.selectedItem)
						{
							Main.PlaySound(12, -1, -1, 1, 1f, 0f);
						}
						if (Main.mapFullscreen)
						{
							float num6 = (float)(PlayerInput.ScrollWheelDelta / 120);
							if (PlayerInput.UsingGamepad)
							{
								num6 += (float)(PlayerInput.Triggers.Current.HotbarPlus.ToInt() - PlayerInput.Triggers.Current.HotbarMinus.ToInt()) * 0.1f;
							}
							Main.mapFullscreenScale *= 1f + num6 * 0.3f;
						}
						else if (CaptureManager.Instance.Active)
						{
							CaptureManager.Instance.Scrolling();
						}
						else if (!flag8)
						{
							if (!Main.playerInventory)
							{
								this.HandleHotbar();
							}
							else
							{
								int num7 = PlayerInput.ScrollWheelDelta / 120;
								bool flag9 = true;
								if (Main.recBigList)
								{
									int num8 = 42;
									int num9 = 340;
									int num10 = 310;
									PlayerInput.SetZoom_UI();
									int num11 = (Main.screenWidth - num10 - 280) / num8;
									int num12 = (Main.screenHeight - num9 - 20) / num8;
									if (new Rectangle(num10, num9, num11 * num8, num12 * num8).Contains(Main.MouseScreen.ToPoint()))
									{
										num7 *= -1;
										int num13 = Math.Sign(num7);
										while (num7 != 0)
										{
											if (num7 < 0)
											{
												Main.recStart -= num11;
												if (Main.recStart < 0)
												{
													Main.recStart = 0;
												}
											}
											else
											{
												Main.recStart += num11;
												if (Main.recStart > Main.numAvailableRecipes - num11)
												{
													Main.recStart = Main.numAvailableRecipes - num11;
												}
											}
											num7 -= num13;
										}
									}
									PlayerInput.SetZoom_World();
								}
								if (flag9)
								{
									Main.focusRecipe += num7;
									if (Main.focusRecipe > Main.numAvailableRecipes - 1)
									{
										Main.focusRecipe = Main.numAvailableRecipes - 1;
									}
									if (Main.focusRecipe < 0)
									{
										Main.focusRecipe = 0;
									}
								}
							}
						}
					}
					else
					{
						bool flag10 = false;
						if (!Main.drawingPlayerChat && this.selectedItem != 58 && !Main.editSign && !Main.editChest)
						{
							int num14 = -1;
							if (Main.keyState.IsKeyDown(Keys.D1))
							{
								num14 = 0;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D2))
							{
								num14 = 1;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D3))
							{
								num14 = 2;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D4))
							{
								num14 = 3;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D5))
							{
								num14 = 4;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D6))
							{
								num14 = 5;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D7))
							{
								num14 = 6;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D8))
							{
								num14 = 7;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D9))
							{
								num14 = 8;
								flag10 = true;
							}
							if (Main.keyState.IsKeyDown(Keys.D0))
							{
								num14 = 9;
								flag10 = true;
							}
							if (flag10)
							{
								if (num14 != this.nonTorch)
								{
									Main.PlaySound(12, -1, -1, 1, 1f, 0f);
								}
								this.nonTorch = num14;
							}
						}
					}
				}
				if (this.selectedItem == 58)
				{
					this.nonTorch = -1;
				}
				else
				{
					this.SmartSelectLookup();
				}
				if (this.stoned != this.lastStoned)
				{
					if (this.whoAmI == Main.myPlayer && this.stoned)
					{
						int damage = (int)(20.0 * (double)Main.damageMultiplier);
						this.Hurt(PlayerDeathReason.ByOther(5), damage, 0, false, false, false, -1);
					}
					Main.PlaySound(0, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					for (int m = 0; m < 20; m++)
					{
						int num15 = Dust.NewDust(this.position, this.width, this.height, 1, 0f, 0f, 0, default(Color), 1f);
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num15].noGravity = true;
						}
					}
				}
				this.lastStoned = this.stoned;
				if (this.frozen || this.webbed || this.stoned)
				{
					this.controlJump = false;
					this.controlDown = false;
					this.controlLeft = false;
					this.controlRight = false;
					this.controlUp = false;
					this.controlUseItem = false;
					this.controlUseTile = false;
					this.controlThrow = false;
					this.gravDir = 1f;
				}
				if (!this.controlThrow)
				{
					this.releaseThrow = true;
				}
				else
				{
					this.releaseThrow = false;
				}
				if (Main.netMode == 1)
				{
					bool flag11 = false;
					if (this.controlUp != Main.clientPlayer.controlUp)
					{
						flag11 = true;
					}
					if (this.controlDown != Main.clientPlayer.controlDown)
					{
						flag11 = true;
					}
					if (this.controlLeft != Main.clientPlayer.controlLeft)
					{
						flag11 = true;
					}
					if (this.controlRight != Main.clientPlayer.controlRight)
					{
						flag11 = true;
					}
					if (this.controlJump != Main.clientPlayer.controlJump)
					{
						flag11 = true;
					}
					if (this.controlUseItem != Main.clientPlayer.controlUseItem)
					{
						flag11 = true;
					}
					if (this.selectedItem != Main.clientPlayer.selectedItem)
					{
						flag11 = true;
					}
					if (flag11)
					{
						NetMessage.SendData(13, -1, -1, null, Main.myPlayer, 0f, 0f, 0f, 0, 0, 0);
					}
				}
				if (Main.playerInventory)
				{
					this.AdjTiles();
				}
				if (this.chest != -1)
				{
					if (this.chest != -2)
					{
						this.flyingPigChest = -1;
					}
					if (this.flyingPigChest >= 0)
					{
						if (!Main.projectile[this.flyingPigChest].active || Main.projectile[this.flyingPigChest].type != 525)
						{
							Main.PlaySound(SoundID.Item59, -1, -1);
							this.chest = -1;
							Recipe.FindRecipes();
						}
						else
						{
							int num16 = (int)(((double)this.position.X + (double)this.width * 0.5) / 16.0);
							int num17 = (int)(((double)this.position.Y + (double)this.height * 0.5) / 16.0);
							this.chestX = (int)Main.projectile[this.flyingPigChest].Center.X / 16;
							this.chestY = (int)Main.projectile[this.flyingPigChest].Center.Y / 16;
							if (num16 < this.chestX - Player.tileRangeX || num16 > this.chestX + Player.tileRangeX + 1 || num17 < this.chestY - Player.tileRangeY || num17 > this.chestY + Player.tileRangeY + 1)
							{
								if (this.chest != -1)
								{
									Main.PlaySound(SoundID.Item59, -1, -1);
								}
								this.chest = -1;
								Recipe.FindRecipes();
							}
						}
					}
					else
					{
						int num18 = (int)(((double)this.position.X + (double)this.width * 0.5) / 16.0);
						int num19 = (int)(((double)this.position.Y + (double)this.height * 0.5) / 16.0);
						if (Main.tile[this.chestX, this.chestY].type == 463 && num19 < this.chestY)
						{
							num19 += 2;
						}
						if (num18 < this.chestX - Player.tileRangeX || num18 > this.chestX + Player.tileRangeX + 1 || num19 < this.chestY - Player.tileRangeY || num19 > this.chestY + Player.tileRangeY + 1)
						{
							if (this.chest != -1)
							{
								Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							}
							this.chest = -1;
							Recipe.FindRecipes();
						}
						else if (!Main.tile[this.chestX, this.chestY].active())
						{
							Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							this.chest = -1;
							Recipe.FindRecipes();
						}
					}
				}
				else
				{
					this.flyingPigChest = -1;
				}
				if (this.velocity.Y <= 0f)
				{
					this.fallStart2 = (int)(this.position.Y / 16f);
				}
				if (this.velocity.Y == 0f)
				{
					int num20 = 25;
					num20 += this.extraFall;
					int num21 = (int)(this.position.Y / 16f) - this.fallStart;
					if (this.mount.CanFly)
					{
						num21 = 0;
					}
					if (this.mount.Cart && Minecart.OnTrack(this.position, this.width, this.height))
					{
						num21 = 0;
					}
					if (this.mount.Type == 1)
					{
						num21 = 0;
					}
					this.mount.FatigueRecovery();
					bool flag12 = false;
					for (int n = 3; n < 10; n++)
					{
						if (this.armor[n].stack > 0 && this.armor[n].wingSlot > -1)
						{
							flag12 = true;
						}
					}
					if (this.stoned)
					{
						int num22 = (int)(((float)num21 * this.gravDir - 2f) * 20f);
						if (num22 > 0)
						{
							this.Hurt(PlayerDeathReason.ByOther(5), num22, 0, false, false, false, -1);
							this.immune = false;
						}
					}
					else if (((this.gravDir == 1f && num21 > num20) || (this.gravDir == -1f && num21 < -num20)) && !this.noFallDmg && !flag12)
					{
						this.immune = false;
						int num23 = (int)((float)num21 * this.gravDir - (float)num20) * 10;
						if (this.mount.Active)
						{
							num23 = (int)((float)num23 * this.mount.FallDamage);
						}
						this.Hurt(PlayerDeathReason.ByOther(0), num23, 0, false, false, false, -1);
						if (!this.dead && this.statLife <= this.statLifeMax2 / 10)
						{
							AchievementsHelper.HandleSpecialEvent(this, 8);
						}
					}
					this.fallStart = (int)(this.position.Y / 16f);
				}
				if (this.jump > 0 || this.rocketDelay > 0 || this.wet || this.slowFall || (double)num4 < 0.8 || this.tongued)
				{
					this.fallStart = (int)(this.position.Y / 16f);
				}
			}
			if (Main.netMode != 1)
			{
				if (this.chest == -1 && this.lastChest >= 0 && Main.chest[this.lastChest] != null && Main.chest[this.lastChest] != null)
				{
					int arg_1BB6_0 = Main.chest[this.lastChest].x;
					int y2 = Main.chest[this.lastChest].y;
					NPC.BigMimicSummonCheck(arg_1BB6_0, y2);
				}
				this.lastChest = this.chest;
			}
			if (this.mouseInterface)
			{
				this.delayUseItem = true;
			}
			Player.tileTargetX = (int)(((float)Main.mouseX + Main.screenPosition.X) / 16f);
			Player.tileTargetY = (int)(((float)Main.mouseY + Main.screenPosition.Y) / 16f);
			if (this.gravDir == -1f)
			{
				Player.tileTargetY = (int)((Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY) / 16f);
			}
			if (Player.tileTargetX >= Main.maxTilesX - 5)
			{
				Player.tileTargetX = Main.maxTilesX - 5;
			}
			if (Player.tileTargetY >= Main.maxTilesY - 5)
			{
				Player.tileTargetY = Main.maxTilesY - 5;
			}
			if (Player.tileTargetX < 5)
			{
				Player.tileTargetX = 5;
			}
			if (Player.tileTargetY < 5)
			{
				Player.tileTargetY = 5;
			}
			if (Main.tile[Player.tileTargetX - 1, Player.tileTargetY] == null)
			{
				Main.tile[Player.tileTargetX - 1, Player.tileTargetY] = new Tile();
			}
			if (Main.tile[Player.tileTargetX + 1, Player.tileTargetY] == null)
			{
				Main.tile[Player.tileTargetX + 1, Player.tileTargetY] = new Tile();
			}
			if (Main.tile[Player.tileTargetX, Player.tileTargetY] == null)
			{
				Main.tile[Player.tileTargetX, Player.tileTargetY] = new Tile();
			}
			if (!Main.tile[Player.tileTargetX, Player.tileTargetY].active())
			{
				if (Main.tile[Player.tileTargetX - 1, Player.tileTargetY].active() && Main.tile[Player.tileTargetX - 1, Player.tileTargetY].type == 323)
				{
					short expr_1D9F = Main.tile[Player.tileTargetX - 1, Player.tileTargetY].frameY;
					if (expr_1D9F < -4)
					{
						Player.tileTargetX++;
					}
					if (expr_1D9F > 4)
					{
						Player.tileTargetX--;
					}
				}
				else if (Main.tile[Player.tileTargetX + 1, Player.tileTargetY].active() && Main.tile[Player.tileTargetX + 1, Player.tileTargetY].type == 323)
				{
					short expr_1E1E = Main.tile[Player.tileTargetX + 1, Player.tileTargetY].frameY;
					if (expr_1E1E < -4)
					{
						Player.tileTargetX++;
					}
					if (expr_1E1E > 4)
					{
						Player.tileTargetX--;
					}
				}
			}
			try
			{
				this.SmartCursorLookup();
				this.SmartInteractLookup();
			}
			catch
			{
				Main.SmartCursorEnabled = false;
			}
			this.UpdateImmunity();
			if (this.petalTimer > 0)
			{
				this.petalTimer--;
			}
			if (this.shadowDodgeTimer > 0)
			{
				this.shadowDodgeTimer--;
			}
			if (this.jump > 0 || this.velocity.Y != 0f)
			{
				this.slippy = false;
				this.slippy2 = false;
				this.powerrun = false;
				this.sticky = false;
			}
			this.potionDelayTime = Item.potionDelay;
			this.restorationDelayTime = Item.restorationDelay;
			if (this.pStone)
			{
				this.potionDelayTime = (int)((double)this.potionDelayTime * 0.75);
				this.restorationDelayTime = (int)((double)this.restorationDelayTime * 0.75);
			}
			if (this.yoraiz0rEye > 0)
			{
				this.Yoraiz0rEye();
			}
			this.ResetEffects();
			this.UpdateDyes(i);
			this.meleeCrit += this.inventory[this.selectedItem].crit;
			this.magicCrit += this.inventory[this.selectedItem].crit;
			this.rangedCrit += this.inventory[this.selectedItem].crit;
			this.thrownCrit += this.inventory[this.selectedItem].crit;
			if (this.whoAmI == Main.myPlayer)
			{
				Main.musicBox2 = -1;
				if (Main.waterCandles > 0)
				{
					this.AddBuff(86, 2, false);
				}
				if (Main.peaceCandles > 0)
				{
					this.AddBuff(157, 2, false);
				}
				if (Main.campfire)
				{
					this.AddBuff(87, 2, false);
				}
				if (Main.starInBottle)
				{
					this.AddBuff(158, 2, false);
				}
				if (Main.heartLantern)
				{
					this.AddBuff(89, 2, false);
				}
				if (Main.sunflower)
				{
					this.AddBuff(146, 2, false);
				}
				if (this.hasBanner)
				{
					this.AddBuff(147, 2, false);
				}
				if (!this.behindBackWall && this.ZoneSandstorm)
				{
					this.AddBuff(194, 2, false);
				}
			}
			for (int num24 = 0; num24 < 206; num24++)
			{
				this.buffImmune[num24] = false;
			}
			this.UpdateBuffs(i);
			if (this.whoAmI == Main.myPlayer)
			{
				if (!this.onFire && !this.poisoned)
				{
					this.trapDebuffSource = false;
				}
				this.UpdatePet(i);
				this.UpdatePetLight(i);
			}
			bool flag13 = this.wet && !this.lavaWet && (!this.mount.Active || this.mount.Type != 3);
			if (this.accMerman & flag13)
			{
				this.releaseJump = true;
				this.wings = 0;
				this.merman = true;
				this.accFlipper = true;
				this.AddBuff(34, 2, true);
			}
			else
			{
				this.merman = false;
			}
			if (!flag13 && this.forceWerewolf)
			{
				this.forceMerman = false;
			}
			if (this.forceMerman & flag13)
			{
				this.wings = 0;
			}
			this.accMerman = false;
			this.hideMerman = false;
			this.forceMerman = false;
			if (this.wolfAcc && !this.merman && !Main.dayTime && !this.wereWolf)
			{
				this.AddBuff(28, 60, true);
			}
			this.wolfAcc = false;
			this.hideWolf = false;
			this.forceWerewolf = false;
			if (this.whoAmI == Main.myPlayer)
			{
				for (int num25 = 0; num25 < 22; num25++)
				{
					if (this.buffType[num25] > 0 && this.buffTime[num25] <= 0)
					{
						this.DelBuff(num25);
					}
				}
			}
			this.beetleDefense = false;
			this.beetleOffense = false;
			this.doubleJumpCloud = false;
			this.setSolar = false;
			this.head = this.armor[0].headSlot;
			this.body = this.armor[1].bodySlot;
			this.legs = this.armor[2].legSlot;
			this.handon = -1;
			this.handoff = -1;
			this.back = -1;
			this.front = -1;
			this.shoe = -1;
			this.waist = -1;
			this.shield = -1;
			this.neck = -1;
			this.face = -1;
			this.balloon = -1;
			if (this.MountFishronSpecialCounter > 0f)
			{
				this.MountFishronSpecialCounter -= 1f;
			}
			if (this._portalPhysicsTime > 0)
			{
				this._portalPhysicsTime--;
			}
			this.UpdateEquips(i);
			if (this.velocity.Y == 0f || this.controlJump)
			{
				this.portalPhysicsFlag = false;
			}
			if (this.inventory[this.selectedItem].type == 3384 || this.portalPhysicsFlag)
			{
				this._portalPhysicsTime = 30;
			}
			if (this.mount.Active)
			{
				this.mount.UpdateEffects(this);
			}
			this.gemCount++;
			if (this.gemCount >= 10)
			{
				this.gem = -1;
				this.ownedLargeGems = 0;
				this.gemCount = 0;
				for (int num26 = 0; num26 <= 58; num26++)
				{
					if (this.inventory[num26].type == 0 || this.inventory[num26].stack == 0)
					{
						this.inventory[num26].TurnToAir();
					}
					if (this.inventory[num26].type >= 1522 && this.inventory[num26].type <= 1527)
					{
						this.gem = this.inventory[num26].type - 1522;
						this.ownedLargeGems[this.gem] = true;
					}
					if (this.inventory[num26].type == 3643)
					{
						this.gem = 6;
						this.ownedLargeGems[this.gem] = true;
					}
				}
			}
			this.UpdateArmorLights();
			this.UpdateArmorSets(i);
			if (this.maxTurretsOld != this.maxTurrets)
			{
				this.UpdateMaxTurrets();
				this.maxTurretsOld = this.maxTurrets;
			}
			if (this.shieldRaised)
			{
				this.statDefense += 20;
			}
			if ((this.merman || this.forceMerman) & flag13)
			{
				this.wings = 0;
			}
			if (this.invis)
			{
				if (this.itemAnimation == 0 && this.aggro > -750)
				{
					this.aggro = -750;
				}
				else if (this.aggro > -250)
				{
					this.aggro = -250;
				}
			}
			if (this.inventory[this.selectedItem].type == 3106)
			{
				if (this.itemAnimation > 0)
				{
					this.stealthTimer = 15;
					if (this.stealth > 0f)
					{
						this.stealth += 0.1f;
					}
				}
				else if ((double)this.velocity.X > -0.1 && (double)this.velocity.X < 0.1 && (double)this.velocity.Y > -0.1 && (double)this.velocity.Y < 0.1 && !this.mount.Active)
				{
					if (this.stealthTimer == 0 && this.stealth > 0f)
					{
						this.stealth -= 0.02f;
						if ((double)this.stealth <= 0.0)
						{
							this.stealth = 0f;
							if (Main.netMode == 1)
							{
								NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
							}
						}
					}
				}
				else
				{
					if (this.stealth > 0f)
					{
						this.stealth += 0.1f;
					}
					if (this.mount.Active)
					{
						this.stealth = 1f;
					}
				}
				if (this.stealth > 1f)
				{
					this.stealth = 1f;
				}
				this.meleeDamage += (1f - this.stealth) * 3f;
				this.meleeCrit += (int)((1f - this.stealth) * 30f);
				if (this.meleeCrit > 100)
				{
					this.meleeCrit = 100;
				}
				this.aggro -= (int)((1f - this.stealth) * 750f);
				if (this.stealthTimer > 0)
				{
					this.stealthTimer--;
				}
			}
			else if (this.shroomiteStealth)
			{
				if (this.itemAnimation > 0)
				{
					this.stealthTimer = 5;
				}
				if ((double)this.velocity.X > -0.1 && (double)this.velocity.X < 0.1 && (double)this.velocity.Y > -0.1 && (double)this.velocity.Y < 0.1 && !this.mount.Active)
				{
					if (this.stealthTimer == 0 && this.stealth > 0f)
					{
						this.stealth -= 0.015f;
						if ((double)this.stealth <= 0.0)
						{
							this.stealth = 0f;
							if (Main.netMode == 1)
							{
								NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
							}
						}
					}
				}
				else
				{
					float num27 = Math.Abs(this.velocity.X) + Math.Abs(this.velocity.Y);
					this.stealth += num27 * 0.0075f;
					if (this.stealth > 1f)
					{
						this.stealth = 1f;
					}
					if (this.mount.Active)
					{
						this.stealth = 1f;
					}
				}
				this.rangedDamage += (1f - this.stealth) * 0.6f;
				this.rangedCrit += (int)((1f - this.stealth) * 10f);
				this.aggro -= (int)((1f - this.stealth) * 750f);
				if (this.stealthTimer > 0)
				{
					this.stealthTimer--;
				}
			}
			else if (this.setVortex)
			{
				bool flag14 = false;
				if (this.vortexStealthActive)
				{
					float num28 = this.stealth;
					this.stealth -= 0.04f;
					if (this.stealth < 0f)
					{
						this.stealth = 0f;
					}
					else
					{
						flag14 = true;
					}
					if (this.stealth == 0f && num28 != this.stealth && Main.netMode == 1)
					{
						NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					}
					this.rangedDamage += (1f - this.stealth) * 0.8f;
					this.rangedCrit += (int)((1f - this.stealth) * 20f);
					this.aggro -= (int)((1f - this.stealth) * 1200f);
					this.moveSpeed *= 0.3f;
					if (this.mount.Active)
					{
						this.vortexStealthActive = false;
					}
				}
				else
				{
					float num29 = this.stealth;
					this.stealth += 0.04f;
					if (this.stealth > 1f)
					{
						this.stealth = 1f;
					}
					else
					{
						flag14 = true;
					}
					if (this.stealth == 1f && num29 != this.stealth && Main.netMode == 1)
					{
						NetMessage.SendData(84, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
					}
				}
				if (flag14)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust expr_2AC7 = Main.dust[Dust.NewDust(base.Center - vector * 30f, 0, 0, 229, 0f, 0f, 0, default(Color), 1f)];
						expr_2AC7.noGravity = true;
						expr_2AC7.position = base.Center - vector * (float)Main.rand.Next(5, 11);
						expr_2AC7.velocity = vector.RotatedBy(1.5707963705062866, default(Vector2)) * 4f;
						expr_2AC7.scale = 0.5f + Main.rand.NextFloat();
						expr_2AC7.fadeIn = 0.5f;
					}
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector2 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust expr_2BA6 = Main.dust[Dust.NewDust(base.Center - vector2 * 30f, 0, 0, 240, 0f, 0f, 0, default(Color), 1f)];
						expr_2BA6.noGravity = true;
						expr_2BA6.position = base.Center - vector2 * 12f;
						expr_2BA6.velocity = vector2.RotatedBy(-1.5707963705062866, default(Vector2)) * 2f;
						expr_2BA6.scale = 0.5f + Main.rand.NextFloat();
						expr_2BA6.fadeIn = 0.5f;
					}
				}
			}
			else
			{
				this.stealth = 1f;
			}
			if (this.manaSick)
			{
				this.magicDamage *= 1f - this.manaSickReduction;
			}
			if (this.inventory[this.selectedItem].type == 1947)
			{
				this.meleeSpeed = (1f + this.meleeSpeed) / 2f;
			}
			if ((double)this.pickSpeed < 0.3)
			{
				this.pickSpeed = 0.3f;
			}
			if (this.meleeSpeed > 3f)
			{
				this.meleeSpeed = 3f;
			}
			if ((double)this.moveSpeed > 1.6)
			{
				this.moveSpeed = 1.6f;
			}
			if (this.tileSpeed > 3f)
			{
				this.tileSpeed = 3f;
			}
			this.tileSpeed = 1f / this.tileSpeed;
			if (this.wallSpeed > 3f)
			{
				this.wallSpeed = 3f;
			}
			this.wallSpeed = 1f / this.wallSpeed;
			if (this.statManaMax2 > 400)
			{
				this.statManaMax2 = 400;
			}
			if (this.statDefense < 0)
			{
				this.statDefense = 0;
			}
			if (this.slowOgreSpit)
			{
				this.moveSpeed /= 3f;
				if (this.velocity.Y == 0f && Math.Abs(this.velocity.X) > 1f)
				{
					this.velocity.X = this.velocity.X / 2f;
				}
			}
			else if (this.dazed)
			{
				this.moveSpeed /= 3f;
			}
			else if (this.slow)
			{
				this.moveSpeed /= 2f;
			}
			else if (this.chilled)
			{
				this.moveSpeed *= 0.75f;
			}
			if (this.shieldRaised)
			{
				this.moveSpeed /= 3f;
				if (this.velocity.Y == 0f && Math.Abs(this.velocity.X) > 3f)
				{
					this.velocity.X = this.velocity.X / 2f;
				}
			}
			if (DD2Event.Ongoing)
			{
				DD2Event.FindArenaHitbox();
				if (DD2Event.ShouldBlockBuilding(base.Center))
				{
					this.noBuilding = true;
					this.AddBuff(199, 3, true);
				}
			}
			this.meleeSpeed = 1f / this.meleeSpeed;
			this.UpdateLifeRegen();
			this.soulDrain = 0;
			this.UpdateManaRegen();
			if (this.manaRegenCount < 0)
			{
				this.manaRegenCount = 0;
			}
			if (this.statMana > this.statManaMax2)
			{
				this.statMana = this.statManaMax2;
			}
			this.runAcceleration *= this.moveSpeed;
			this.maxRunSpeed *= this.moveSpeed;
			this.UpdateJumpHeight();
			for (int num30 = 0; num30 < 22; num30++)
			{
				if (this.buffType[num30] > 0 && this.buffTime[num30] > 0 && this.buffImmune[this.buffType[num30]])
				{
					this.DelBuff(num30);
				}
			}
			if (this.brokenArmor)
			{
				this.statDefense /= 2;
			}
			if (this.witheredArmor)
			{
				this.statDefense /= 2;
			}
			if (this.witheredWeapon)
			{
				this.meleeDamage *= 0.5f;
				this.rangedDamage *= 0.5f;
				this.magicDamage *= 0.5f;
				this.minionDamage *= 0.5f;
				this.thrownDamage *= 0.5f;
			}
			this.lastTileRangeX = Player.tileRangeX;
			this.lastTileRangeY = Player.tileRangeY;
			if (this.mount.Active && this.mount.BlockExtraJumps)
			{
				this.jumpAgainCloud = false;
				this.jumpAgainSandstorm = false;
				this.jumpAgainBlizzard = false;
				this.jumpAgainFart = false;
				this.jumpAgainSail = false;
				this.jumpAgainUnicorn = false;
			}
			else
			{
				if (!this.doubleJumpCloud)
				{
					this.jumpAgainCloud = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainCloud = true;
				}
				if (!this.doubleJumpSandstorm)
				{
					this.jumpAgainSandstorm = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainSandstorm = true;
				}
				if (!this.doubleJumpBlizzard)
				{
					this.jumpAgainBlizzard = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainBlizzard = true;
				}
				if (!this.doubleJumpFart)
				{
					this.jumpAgainFart = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainFart = true;
				}
				if (!this.doubleJumpSail)
				{
					this.jumpAgainSail = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainSail = true;
				}
				if (!this.doubleJumpUnicorn)
				{
					this.jumpAgainUnicorn = false;
				}
				else if (this.velocity.Y == 0f || this.sliding)
				{
					this.jumpAgainUnicorn = true;
				}
			}
			if (!this.carpet)
			{
				this.canCarpet = false;
				this.carpetFrame = -1;
			}
			else if (this.velocity.Y == 0f || this.sliding)
			{
				this.canCarpet = true;
				this.carpetTime = 0;
				this.carpetFrame = -1;
				this.carpetFrameCounter = 0f;
			}
			if (this.gravDir == -1f)
			{
				this.canCarpet = false;
			}
			if (this.ropeCount > 0)
			{
				this.ropeCount--;
			}
			if (!this.pulley && !this.frozen && !this.webbed && !this.stoned && !this.controlJump && this.gravDir == 1f && this.ropeCount == 0 && this.grappling[0] == -1 && !this.tongued && !this.mount.Active)
			{
				this.FindPulley();
			}
			if (this.pulley)
			{
				if (this.mount.Active)
				{
					this.pulley = false;
				}
				this.sandStorm = false;
				this.dJumpEffectCloud = false;
				this.dJumpEffectSandstorm = false;
				this.dJumpEffectBlizzard = false;
				this.dJumpEffectFart = false;
				this.dJumpEffectSail = false;
				this.dJumpEffectUnicorn = false;
				int num31 = (int)(this.position.X + (float)(this.width / 2)) / 16;
				int num32 = (int)(this.position.Y - 8f) / 16;
				bool flag15 = false;
				if (this.pulleyDir == 0)
				{
					this.pulleyDir = 1;
				}
				if (this.pulleyDir == 1)
				{
					if (this.direction == -1 && this.controlLeft && (this.releaseLeft || this.leftTimer == 0))
					{
						this.pulleyDir = 2;
						flag15 = true;
					}
					else if ((this.direction == 1 && this.controlRight && this.releaseRight) || this.rightTimer == 0)
					{
						this.pulleyDir = 2;
						flag15 = true;
					}
					else
					{
						if (this.direction == 1 && this.controlLeft)
						{
							this.direction = -1;
							flag15 = true;
						}
						if (this.direction == -1 && this.controlRight)
						{
							this.direction = 1;
							flag15 = true;
						}
					}
				}
				else if (this.pulleyDir == 2)
				{
					if (this.direction == 1 && this.controlLeft)
					{
						flag15 = true;
						if (!Collision.SolidCollision(new Vector2((float)(num31 * 16 + 8 - this.width / 2), this.position.Y), this.width, this.height))
						{
							this.pulleyDir = 1;
							this.direction = -1;
							flag15 = true;
						}
					}
					if (this.direction == -1 && this.controlRight)
					{
						flag15 = true;
						if (!Collision.SolidCollision(new Vector2((float)(num31 * 16 + 8 - this.width / 2), this.position.Y), this.width, this.height))
						{
							this.pulleyDir = 1;
							this.direction = 1;
							flag15 = true;
						}
					}
				}
				bool flag16 = false;
				if (!flag15 && ((this.controlLeft && (this.releaseLeft || this.leftTimer == 0)) || (this.controlRight && (this.releaseRight || this.rightTimer == 0))))
				{
					int num33 = 1;
					if (this.controlLeft)
					{
						num33 = -1;
					}
					int num34 = num31 + num33;
					if (Main.tile[num34, num32].active() && Main.tileRope[(int)Main.tile[num34, num32].type])
					{
						this.pulleyDir = 1;
						this.direction = num33;
						int num35 = num34 * 16 + 8 - this.width / 2;
						float num36 = this.position.Y;
						num36 = (float)(num32 * 16 + 22);
						if ((!Main.tile[num34, num32 - 1].active() || !Main.tileRope[(int)Main.tile[num34, num32 - 1].type]) && (!Main.tile[num34, num32 + 1].active() || !Main.tileRope[(int)Main.tile[num34, num32 + 1].type]))
						{
							num36 = (float)(num32 * 16 + 22);
						}
						if (Collision.SolidCollision(new Vector2((float)num35, num36), this.width, this.height))
						{
							this.pulleyDir = 2;
							this.direction = -num33;
							if (this.direction == 1)
							{
								num35 = num34 * 16 + 8 - this.width / 2 + 6;
							}
							else
							{
								num35 = num34 * 16 + 8 - this.width / 2 + -6;
							}
						}
						if (i == Main.myPlayer)
						{
							Main.cameraX = Main.cameraX + this.position.X - (float)num35;
						}
						this.position.X = (float)num35;
						this.gfxOffY = this.position.Y - num36;
						this.position.Y = num36;
						flag16 = true;
					}
				}
				if (!flag16 && !flag15 && !this.controlUp && ((this.controlLeft && this.releaseLeft) || (this.controlRight && this.releaseRight)))
				{
					this.pulley = false;
					if (this.controlLeft && this.velocity.X == 0f)
					{
						this.velocity.X = -1f;
					}
					if (this.controlRight && this.velocity.X == 0f)
					{
						this.velocity.X = 1f;
					}
				}
				if (this.velocity.X != 0f)
				{
					this.pulley = false;
				}
				if (Main.tile[num31, num32] == null)
				{
					Main.tile[num31, num32] = new Tile();
				}
				if (!Main.tile[num31, num32].active() || !Main.tileRope[(int)Main.tile[num31, num32].type])
				{
					this.pulley = false;
				}
				if (this.gravDir != 1f)
				{
					this.pulley = false;
				}
				if (this.frozen || this.webbed || this.stoned)
				{
					this.pulley = false;
				}
				if (!this.pulley)
				{
					this.velocity.Y = this.velocity.Y - this.gravity;
				}
				if (this.controlJump)
				{
					this.pulley = false;
					this.jump = Player.jumpHeight;
					this.velocity.Y = -Player.jumpSpeed;
				}
			}
			if (this.pulley)
			{
				this.fallStart = (int)this.position.Y / 16;
				this.wingFrame = 0;
				if (this.wings == 4)
				{
					this.wingFrame = 3;
				}
				int num37 = (int)(this.position.X + (float)(this.width / 2)) / 16;
				int num38 = (int)(this.position.Y - 16f) / 16;
				int num39 = (int)(this.position.Y - 8f) / 16;
				bool flag17 = true;
				bool flag18 = false;
				if ((Main.tile[num37, num39 - 1].active() && Main.tileRope[(int)Main.tile[num37, num39 - 1].type]) || (Main.tile[num37, num39 + 1].active() && Main.tileRope[(int)Main.tile[num37, num39 + 1].type]))
				{
					flag18 = true;
				}
				if (Main.tile[num37, num38] == null)
				{
					Main.tile[num37, num38] = new Tile();
				}
				if (!Main.tile[num37, num38].active() || !Main.tileRope[(int)Main.tile[num37, num38].type])
				{
					flag17 = false;
					if (this.velocity.Y < 0f)
					{
						this.velocity.Y = 0f;
					}
				}
				if (flag18)
				{
					if (this.controlUp & flag17)
					{
						float num40 = this.position.X;
						float y3 = this.position.Y - Math.Abs(this.velocity.Y) - 2f;
						if (Collision.SolidCollision(new Vector2(num40, y3), this.width, this.height))
						{
							num40 = (float)(num37 * 16 + 8 - this.width / 2 + 6);
							if (!Collision.SolidCollision(new Vector2(num40, y3), this.width, (int)((float)this.height + Math.Abs(this.velocity.Y) + 2f)))
							{
								if (i == Main.myPlayer)
								{
									Main.cameraX = Main.cameraX + this.position.X - num40;
								}
								this.pulleyDir = 2;
								this.direction = 1;
								this.position.X = num40;
								this.velocity.X = 0f;
							}
							else
							{
								num40 = (float)(num37 * 16 + 8 - this.width / 2 + -6);
								if (!Collision.SolidCollision(new Vector2(num40, y3), this.width, (int)((float)this.height + Math.Abs(this.velocity.Y) + 2f)))
								{
									if (i == Main.myPlayer)
									{
										Main.cameraX = Main.cameraX + this.position.X - num40;
									}
									this.pulleyDir = 2;
									this.direction = -1;
									this.position.X = num40;
									this.velocity.X = 0f;
								}
							}
						}
						if (this.velocity.Y > 0f)
						{
							this.velocity.Y = this.velocity.Y * 0.7f;
						}
						if (this.velocity.Y > -3f)
						{
							this.velocity.Y = this.velocity.Y - 0.2f;
						}
						else
						{
							this.velocity.Y = this.velocity.Y - 0.02f;
						}
						if (this.velocity.Y < -8f)
						{
							this.velocity.Y = -8f;
						}
					}
					else if (this.controlDown)
					{
						float num41 = this.position.X;
						float y4 = this.position.Y;
						if (Collision.SolidCollision(new Vector2(num41, y4), this.width, (int)((float)this.height + Math.Abs(this.velocity.Y) + 2f)))
						{
							num41 = (float)(num37 * 16 + 8 - this.width / 2 + 6);
							if (!Collision.SolidCollision(new Vector2(num41, y4), this.width, (int)((float)this.height + Math.Abs(this.velocity.Y) + 2f)))
							{
								if (i == Main.myPlayer)
								{
									Main.cameraX = Main.cameraX + this.position.X - num41;
								}
								this.pulleyDir = 2;
								this.direction = 1;
								this.position.X = num41;
								this.velocity.X = 0f;
							}
							else
							{
								num41 = (float)(num37 * 16 + 8 - this.width / 2 + -6);
								if (!Collision.SolidCollision(new Vector2(num41, y4), this.width, (int)((float)this.height + Math.Abs(this.velocity.Y) + 2f)))
								{
									if (i == Main.myPlayer)
									{
										Main.cameraX = Main.cameraX + this.position.X - num41;
									}
									this.pulleyDir = 2;
									this.direction = -1;
									this.position.X = num41;
									this.velocity.X = 0f;
								}
							}
						}
						if (this.velocity.Y < 0f)
						{
							this.velocity.Y = this.velocity.Y * 0.7f;
						}
						if (this.velocity.Y < 3f)
						{
							this.velocity.Y = this.velocity.Y + 0.2f;
						}
						else
						{
							this.velocity.Y = this.velocity.Y + 0.1f;
						}
						if (this.velocity.Y > this.maxFallSpeed)
						{
							this.velocity.Y = this.maxFallSpeed;
						}
					}
					else
					{
						this.velocity.Y = this.velocity.Y * 0.7f;
						if ((double)this.velocity.Y > -0.1 && (double)this.velocity.Y < 0.1)
						{
							this.velocity.Y = 0f;
						}
					}
				}
				else if (this.controlDown)
				{
					this.ropeCount = 10;
					this.pulley = false;
					this.velocity.Y = 1f;
				}
				else
				{
					this.velocity.Y = 0f;
					this.position.Y = (float)(num38 * 16 + 22);
				}
				float num42 = (float)(num37 * 16 + 8 - this.width / 2);
				if (this.pulleyDir == 1)
				{
					num42 = (float)(num37 * 16 + 8 - this.width / 2);
				}
				if (this.pulleyDir == 2)
				{
					num42 = (float)(num37 * 16 + 8 - this.width / 2 + 6 * this.direction);
				}
				if (i == Main.myPlayer)
				{
					Main.cameraX = Main.cameraX + this.position.X - num42;
				}
				this.position.X = num42;
				this.pulleyFrameCounter += Math.Abs(this.velocity.Y * 0.75f);
				if (this.velocity.Y != 0f)
				{
					this.pulleyFrameCounter += 0.75f;
				}
				if (this.pulleyFrameCounter > 10f)
				{
					this.pulleyFrame++;
					this.pulleyFrameCounter = 0f;
				}
				if (this.pulleyFrame > 1)
				{
					this.pulleyFrame = 0;
				}
				this.canCarpet = true;
				this.carpetFrame = -1;
				this.wingTime = (float)this.wingTimeMax;
				this.rocketTime = this.rocketTimeMax;
				this.rocketDelay = 0;
				this.rocketFrame = false;
				this.canRocket = false;
				this.rocketRelease = false;
				this.DashMovement();
			}
			else if (this.grappling[0] == -1 && !this.tongued)
			{
				if (this.wingsLogic > 0 && this.velocity.Y != 0f && !this.merman)
				{
					if (this.wingsLogic == 1 || this.wingsLogic == 2)
					{
						this.accRunSpeed = 6.25f;
					}
					if (this.wingsLogic == 4)
					{
						this.accRunSpeed = 6.5f;
					}
					if (this.wingsLogic == 5 || this.wingsLogic == 6 || this.wingsLogic == 13 || this.wingsLogic == 15)
					{
						this.accRunSpeed = 6.75f;
					}
					if (this.wingsLogic == 7 || this.wingsLogic == 8)
					{
						this.accRunSpeed = 7f;
					}
					if (this.wingsLogic == 9 || this.wingsLogic == 10 || this.wingsLogic == 11 || this.wingsLogic == 20 || this.wingsLogic == 21 || this.wingsLogic == 23 || this.wingsLogic == 24)
					{
						this.accRunSpeed = 7.5f;
					}
					if (this.wingsLogic == 22)
					{
						if (this.controlDown && this.controlJump && this.wingTime > 0f)
						{
							this.accRunSpeed = 10f;
							this.runAcceleration *= 10f;
						}
						else
						{
							this.accRunSpeed = 6.25f;
						}
					}
					if (this.wingsLogic == 30 || this.wingsLogic == 31)
					{
						if (this.controlDown && this.controlJump && this.wingTime > 0f)
						{
							this.accRunSpeed = 12f;
							this.runAcceleration *= 12f;
						}
						else
						{
							this.accRunSpeed = 6.5f;
							this.runAcceleration *= 1.5f;
						}
					}
					if (this.wingsLogic == 26)
					{
						this.accRunSpeed = 8f;
						this.runAcceleration *= 2f;
					}
					if (this.wingsLogic == 37)
					{
						if (this.controlDown && this.controlJump && this.wingTime > 0f)
						{
							this.accRunSpeed = 12f;
							this.runAcceleration *= 12f;
						}
						else
						{
							this.accRunSpeed = 6f;
							this.runAcceleration *= 2.5f;
						}
					}
					if (this.wingsLogic == 29 || this.wingsLogic == 32)
					{
						this.accRunSpeed = 9f;
						this.runAcceleration *= 2.5f;
					}
					if (this.wingsLogic == 12)
					{
						this.accRunSpeed = 7.75f;
					}
					if (this.wingsLogic == 16 || this.wingsLogic == 17 || this.wingsLogic == 18 || this.wingsLogic == 19 || this.wingsLogic == 34 || this.wingsLogic == 3 || this.wingsLogic == 28 || this.wingsLogic == 33 || this.wingsLogic == 34 || this.wingsLogic == 35 || this.wingsLogic == 36)
					{
						this.accRunSpeed = 7f;
					}
				}
				if (this.sticky)
				{
					this.maxRunSpeed *= 0.25f;
					this.runAcceleration *= 0.25f;
					this.runSlowdown *= 2f;
					if (this.velocity.X > this.maxRunSpeed)
					{
						this.velocity.X = this.maxRunSpeed;
					}
					if (this.velocity.X < -this.maxRunSpeed)
					{
						this.velocity.X = -this.maxRunSpeed;
					}
				}
				else if (this.powerrun)
				{
					this.maxRunSpeed *= 3.5f;
					this.runAcceleration *= 1f;
					this.runSlowdown *= 2f;
				}
				else if (this.slippy2)
				{
					this.runAcceleration *= 0.6f;
					this.runSlowdown = 0f;
					if (this.iceSkate)
					{
						this.runAcceleration *= 3.5f;
						this.maxRunSpeed *= 1.25f;
					}
				}
				else if (this.slippy)
				{
					this.runAcceleration *= 0.7f;
					if (this.iceSkate)
					{
						this.runAcceleration *= 3.5f;
						this.maxRunSpeed *= 1.25f;
					}
					else
					{
						this.runSlowdown *= 0.1f;
					}
				}
				if (this.sandStorm)
				{
					this.runAcceleration *= 1.5f;
					this.maxRunSpeed *= 2f;
				}
				if (this.dJumpEffectBlizzard && this.doubleJumpBlizzard)
				{
					this.runAcceleration *= 3f;
					this.maxRunSpeed *= 1.5f;
				}
				if (this.dJumpEffectFart && this.doubleJumpFart)
				{
					this.runAcceleration *= 3f;
					this.maxRunSpeed *= 1.75f;
				}
				if (this.dJumpEffectUnicorn && this.doubleJumpUnicorn)
				{
					this.runAcceleration *= 3f;
					this.maxRunSpeed *= 1.5f;
				}
				if (this.dJumpEffectSail && this.doubleJumpSail)
				{
					this.runAcceleration *= 1.5f;
					this.maxRunSpeed *= 1.25f;
				}
				if (this.carpetFrame != -1)
				{
					this.runAcceleration *= 1.25f;
					this.maxRunSpeed *= 1.5f;
				}
				if (this.inventory[this.selectedItem].type == 3106 && this.stealth < 1f)
				{
					float num43 = this.maxRunSpeed / 2f * (1f - this.stealth);
					this.maxRunSpeed -= num43;
					this.accRunSpeed = this.maxRunSpeed;
				}
				if (this.mount.Active)
				{
					this.rocketBoots = 0;
					this.wings = 0;
					this.wingsLogic = 0;
					this.maxRunSpeed = this.mount.RunSpeed;
					this.accRunSpeed = this.mount.DashSpeed;
					this.runAcceleration = this.mount.Acceleration;
					if (this.mount.Type == 12 && !this.MountFishronSpecial)
					{
						this.runAcceleration /= 2f;
						this.maxRunSpeed /= 2f;
					}
					this.mount.AbilityRecovery();
					if (this.mount.Cart && this.velocity.Y == 0f)
					{
						if (!Minecart.OnTrack(this.position, this.width, this.height))
						{
							this.fullRotation = 0f;
							this.onWrongGround = true;
							this.runSlowdown = 0.2f;
							if ((this.controlLeft && this.releaseLeft) || (this.controlRight && this.releaseRight))
							{
								this.mount.Dismount(this);
							}
						}
						else
						{
							this.runSlowdown = this.runAcceleration;
							this.onWrongGround = false;
						}
					}
					if (this.mount.Type == 8)
					{
						this.mount.UpdateDrill(this, this.controlUp, this.controlDown);
					}
				}
				this.HorizontalMovement();
				if (this.gravControl)
				{
					if (this.controlUp && this.releaseUp)
					{
						if (this.gravDir == 1f)
						{
							this.gravDir = -1f;
							this.fallStart = (int)(this.position.Y / 16f);
							this.jump = 0;
							Main.PlaySound(SoundID.Item8, this.position);
						}
						else
						{
							this.gravDir = 1f;
							this.fallStart = (int)(this.position.Y / 16f);
							this.jump = 0;
							Main.PlaySound(SoundID.Item8, this.position);
						}
					}
				}
				else if (this.gravControl2)
				{
					if (this.controlUp && this.releaseUp && this.velocity.Y == 0f)
					{
						if (this.gravDir == 1f)
						{
							this.gravDir = -1f;
							this.fallStart = (int)(this.position.Y / 16f);
							this.jump = 0;
							Main.PlaySound(SoundID.Item8, this.position);
						}
						else
						{
							this.gravDir = 1f;
							this.fallStart = (int)(this.position.Y / 16f);
							this.jump = 0;
							Main.PlaySound(SoundID.Item8, this.position);
						}
					}
				}
				else
				{
					this.gravDir = 1f;
				}
				if (this.velocity.Y == 0f && this.mount.Active && this.mount.CanHover && this.controlUp && this.releaseUp)
				{
					this.velocity.Y = -(this.mount.Acceleration + this.gravity + 0.001f);
				}
				if (this.controlUp)
				{
					this.releaseUp = false;
				}
				else
				{
					this.releaseUp = true;
				}
				this.sandStorm = false;
				this.JumpMovement();
				if (this.wingsLogic == 0)
				{
					this.wingTime = 0f;
				}
				if (this.rocketBoots == 0)
				{
					this.rocketTime = 0;
				}
				if (this.jump == 0)
				{
					this.dJumpEffectCloud = false;
					this.dJumpEffectSandstorm = false;
					this.dJumpEffectBlizzard = false;
					this.dJumpEffectFart = false;
					this.dJumpEffectSail = false;
					this.dJumpEffectUnicorn = false;
				}
				this.DashMovement();
				this.WallslideMovement();
				this.CarpetMovement();
				this.DoubleJumpVisuals();
				if (this.wings > 0 || this.mount.Active)
				{
					this.sandStorm = false;
				}
				if (((this.gravDir == 1f && this.velocity.Y > -Player.jumpSpeed) || (this.gravDir == -1f && this.velocity.Y < Player.jumpSpeed)) && this.velocity.Y != 0f)
				{
					this.canRocket = true;
				}
				bool flag19 = false;
				if (((this.velocity.Y == 0f || this.sliding) && this.releaseJump) || (this.autoJump && this.justJumped))
				{
					this.mount.ResetFlightTime(this.velocity.X);
					this.wingTime = (float)this.wingTimeMax;
				}
				if (this.wingsLogic > 0 && this.controlJump && this.wingTime > 0f && !this.jumpAgainCloud && this.jump == 0 && this.velocity.Y != 0f)
				{
					flag19 = true;
				}
				if ((this.wingsLogic == 22 || this.wingsLogic == 28 || this.wingsLogic == 30 || this.wingsLogic == 32 || this.wingsLogic == 29 || this.wingsLogic == 33 || this.wingsLogic == 35 || this.wingsLogic == 37) && this.controlJump && this.controlDown && this.wingTime > 0f)
				{
					flag19 = true;
				}
				if (this.frozen || this.webbed || this.stoned)
				{
					if (this.mount.Active)
					{
						this.mount.Dismount(this);
					}
					this.velocity.Y = this.velocity.Y + this.gravity;
					if (this.velocity.Y > this.maxFallSpeed)
					{
						this.velocity.Y = this.maxFallSpeed;
					}
					this.sandStorm = false;
					this.dJumpEffectCloud = false;
					this.dJumpEffectSandstorm = false;
					this.dJumpEffectBlizzard = false;
					this.dJumpEffectFart = false;
					this.dJumpEffectSail = false;
					this.dJumpEffectUnicorn = false;
				}
				else
				{
					if (flag19)
					{
						if (this.wings == 10 && Main.rand.Next(2) == 0)
						{
							int num44 = 4;
							if (this.direction == 1)
							{
								num44 = -40;
							}
							int num45 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num44, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 76, 0f, 0f, 50, default(Color), 0.6f);
							Main.dust[num45].fadeIn = 1.1f;
							Main.dust[num45].noGravity = true;
							Main.dust[num45].noLight = true;
							Main.dust[num45].velocity *= 0.3f;
							Main.dust[num45].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 34 && Main.rand.Next(2) == 0)
						{
							int num46 = 4;
							if (this.direction == 1)
							{
								num46 = -40;
							}
							int num47 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num46, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 261, 0f, 0f, 50, default(Color), 0.6f);
							Main.dust[num47].fadeIn = 1.1f;
							Main.dust[num47].noGravity = true;
							Main.dust[num47].noLight = true;
							Main.dust[num47].velocity *= 0.3f;
							Main.dust[num47].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 9 && Main.rand.Next(2) == 0)
						{
							int num48 = 4;
							if (this.direction == 1)
							{
								num48 = -40;
							}
							int num49 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num48, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 6, 0f, 0f, 200, default(Color), 2f);
							Main.dust[num49].noGravity = true;
							Main.dust[num49].velocity *= 0.3f;
							Main.dust[num49].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 6 && Main.rand.Next(4) == 0)
						{
							int num50 = 4;
							if (this.direction == 1)
							{
								num50 = -40;
							}
							int num51 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num50, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 55, 0f, 0f, 200, default(Color), 1f);
							Main.dust[num51].velocity *= 0.3f;
							Main.dust[num51].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 5 && Main.rand.Next(3) == 0)
						{
							int num52 = 6;
							if (this.direction == 1)
							{
								num52 = -30;
							}
							int num53 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num52, this.position.Y), 18, this.height, 58, 0f, 0f, 255, default(Color), 1.2f);
							Main.dust[num53].velocity *= 0.3f;
							Main.dust[num53].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 26)
						{
							int num54 = 6;
							if (this.direction == 1)
							{
								num54 = -30;
							}
							int num55 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num54, this.position.Y), 18, this.height, 217, 0f, 0f, 100, default(Color), 1.4f);
							Main.dust[num55].noGravity = true;
							Main.dust[num55].noLight = true;
							Main.dust[num55].velocity /= 4f;
							Main.dust[num55].velocity -= this.velocity;
							Main.dust[num55].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							if (Main.rand.Next(2) == 0)
							{
								num54 = -24;
								if (this.direction == 1)
								{
									num54 = 12;
								}
								float num56 = this.position.Y;
								if (this.gravDir == -1f)
								{
									num56 += (float)(this.height / 2);
								}
								num55 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num54, num56), 12, this.height / 2, 217, 0f, 0f, 100, default(Color), 1.4f);
								Main.dust[num55].noGravity = true;
								Main.dust[num55].noLight = true;
								Main.dust[num55].velocity /= 4f;
								Main.dust[num55].velocity -= this.velocity;
								Main.dust[num55].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
						}
						if (this.wings == 37)
						{
							int num57 = 6;
							if (this.direction == 1)
							{
								num57 = -30;
							}
							Dust dust = Dust.NewDustDirect(new Vector2(this.position.X + (float)(this.width / 2) + (float)num57, this.position.Y), 24, this.height, Utils.SelectRandom<int>(Main.rand, new int[]
							{
								31,
								31,
								31
							}), 0f, 0f, 100, default(Color), 1f);
							dust.noGravity = true;
							dust.noLight = true;
							dust.velocity /= 4f;
							dust.velocity -= this.velocity / 2f;
							dust.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							if (dust.type == 55)
							{
								dust.noGravity = true;
								dust.velocity *= 2f;
								dust.color = Color.Red;
							}
							if (Main.rand.Next(3) == 0)
							{
								num57 = -24;
								if (this.direction == 1)
								{
									num57 = 12;
								}
								float num58 = this.position.Y;
								if (this.gravDir == -1f)
								{
									num58 += (float)(this.height / 2);
								}
								dust = Dust.NewDustDirect(new Vector2(this.position.X + (float)(this.width / 2) + (float)num57, num58), 16, this.height / 2, Utils.SelectRandom<int>(Main.rand, new int[]
								{
									31,
									31,
									31
								}), 0f, 0f, 100, default(Color), 1f);
								dust.noGravity = true;
								dust.noLight = true;
								dust.velocity /= 4f;
								dust.velocity -= this.velocity / 2f;
								dust.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								if (dust.type == 55)
								{
									dust.noGravity = true;
									dust.velocity *= 2f;
									dust.color = Color.Red;
								}
							}
						}
						if (this.wings == 29 && Main.rand.Next(3) == 0)
						{
							int num59 = 4;
							if (this.direction == 1)
							{
								num59 = -40;
							}
							int num60 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num59, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 6, 0f, 0f, 100, default(Color), 2.4f);
							Main.dust[num60].noGravity = true;
							Main.dust[num60].velocity *= 0.3f;
							if (Main.rand.Next(10) == 0)
							{
								Main.dust[num60].fadeIn = 2f;
							}
							Main.dust[num60].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
						if (this.wings == 31)
						{
							if (Main.rand.Next(6) == 0)
							{
								int num61 = 4;
								if (this.direction == 1)
								{
									num61 = -40;
								}
								Dust expr_557F = Main.dust[Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num61, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 86, 0f, 0f, 0, default(Color), 1f)];
								expr_557F.noGravity = true;
								expr_557F.scale = 1f;
								expr_557F.fadeIn = 1.2f;
								expr_557F.velocity *= 0.2f;
								expr_557F.noLight = true;
								expr_557F.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
							if (Main.rand.Next(3) == 0)
							{
								int num62 = 4;
								if (this.direction == 1)
								{
									num62 = -40;
								}
								Dust expr_5656 = Main.dust[Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num62, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 240, 0f, 0f, 0, default(Color), 1f)];
								expr_5656.noGravity = true;
								expr_5656.scale = 1.2f;
								expr_5656.velocity *= 0.2f;
								expr_5656.alpha = 200;
								expr_5656.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
							if (Main.rand.Next(2) == 0)
							{
								if (Main.rand.Next(6) == 0)
								{
									int num63 = -24;
									if (this.direction == 1)
									{
										num63 = 12;
									}
									float num64 = this.position.Y;
									if (this.gravDir == -1f)
									{
										num64 += (float)(this.height / 2);
									}
									Dust expr_5749 = Main.dust[Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num63, num64), 12, this.height / 2, 86, 0f, 0f, 0, default(Color), 1f)];
									expr_5749.noGravity = true;
									expr_5749.scale = 1f;
									expr_5749.fadeIn = 1.2f;
									expr_5749.velocity *= 0.2f;
									expr_5749.noLight = true;
									expr_5749.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (Main.rand.Next(3) == 0)
								{
									int num63 = -24;
									if (this.direction == 1)
									{
										num63 = 12;
									}
									float num65 = this.position.Y;
									if (this.gravDir == -1f)
									{
										num65 += (float)(this.height / 2);
									}
									Dust expr_5836 = Main.dust[Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num63, num65), 12, this.height / 2, 240, 0f, 0f, 0, default(Color), 1f)];
									expr_5836.noGravity = true;
									expr_5836.scale = 1.2f;
									expr_5836.velocity *= 0.2f;
									expr_5836.alpha = 200;
									expr_5836.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
							}
						}
						this.WingMovement();
					}
					if (this.wings == 4)
					{
						if (flag19 || this.jump > 0)
						{
							this.rocketDelay2--;
							if (this.rocketDelay2 <= 0)
							{
								Main.PlaySound(SoundID.Item13, this.position);
								this.rocketDelay2 = 60;
							}
							int num66 = 2;
							if (this.controlUp)
							{
								num66 = 4;
							}
							for (int num67 = 0; num67 < num66; num67++)
							{
								int type = 6;
								if (this.head == 41)
								{
									int arg_58FD_0 = this.body;
								}
								float scale = 1.75f;
								int alpha = 100;
								float x = this.position.X + (float)(this.width / 2) + 16f;
								if (this.direction > 0)
								{
									x = this.position.X + (float)(this.width / 2) - 26f;
								}
								float num68 = this.position.Y + (float)this.height - 18f;
								if (num67 == 1 || num67 == 3)
								{
									x = this.position.X + (float)(this.width / 2) + 8f;
									if (this.direction > 0)
									{
										x = this.position.X + (float)(this.width / 2) - 20f;
									}
									num68 += 6f;
								}
								if (num67 > 1)
								{
									num68 += this.velocity.Y;
								}
								int num69 = Dust.NewDust(new Vector2(x, num68), 8, 8, type, 0f, 0f, alpha, default(Color), scale);
								Dust expr_5A11_cp_0_cp_0 = Main.dust[num69];
								expr_5A11_cp_0_cp_0.velocity.X = expr_5A11_cp_0_cp_0.velocity.X * 0.1f;
								Main.dust[num69].velocity.Y = Main.dust[num69].velocity.Y * 1f + 2f * this.gravDir - this.velocity.Y * 0.3f;
								Main.dust[num69].noGravity = true;
								Main.dust[num69].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								if (num66 == 4)
								{
									Dust expr_5AA6_cp_0_cp_0 = Main.dust[num69];
									expr_5AA6_cp_0_cp_0.velocity.Y = expr_5AA6_cp_0_cp_0.velocity.Y + 6f;
								}
							}
							this.wingFrameCounter++;
							if (this.wingFrameCounter > 4)
							{
								this.wingFrame++;
								this.wingFrameCounter = 0;
								if (this.wingFrame >= 3)
								{
									this.wingFrame = 0;
								}
							}
						}
						else if (!this.controlJump || this.velocity.Y == 0f)
						{
							this.wingFrame = 3;
						}
					}
					else if (this.wings == 28)
					{
						if (this.velocity.Y != 0f)
						{
							Lighting.AddLight(base.Bottom, 0.3f, 0.1f, 0.4f);
						}
					}
					else if (this.wings == 22)
					{
						if (!this.controlJump)
						{
							this.wingFrame = 0;
							this.wingFrameCounter = 0;
						}
						else if (this.wingTime > 0f)
						{
							if (this.controlDown)
							{
								if (this.velocity.X != 0f)
								{
									this.wingFrameCounter++;
									int num70 = 2;
									if (this.wingFrameCounter < num70)
									{
										this.wingFrame = 1;
									}
									else if (this.wingFrameCounter < num70 * 2)
									{
										this.wingFrame = 2;
									}
									else if (this.wingFrameCounter < num70 * 3)
									{
										this.wingFrame = 3;
									}
									else if (this.wingFrameCounter < num70 * 4 - 1)
									{
										this.wingFrame = 2;
									}
									else
									{
										this.wingFrame = 2;
										this.wingFrameCounter = 0;
									}
								}
								else
								{
									this.wingFrameCounter++;
									int num71 = 6;
									if (this.wingFrameCounter < num71)
									{
										this.wingFrame = 4;
									}
									else if (this.wingFrameCounter < num71 * 2)
									{
										this.wingFrame = 5;
									}
									else if (this.wingFrameCounter < num71 * 3 - 1)
									{
										this.wingFrame = 4;
									}
									else
									{
										this.wingFrame = 4;
										this.wingFrameCounter = 0;
									}
								}
							}
							else
							{
								this.wingFrameCounter++;
								int num72 = 2;
								if (this.wingFrameCounter < num72)
								{
									this.wingFrame = 4;
								}
								else if (this.wingFrameCounter < num72 * 2)
								{
									this.wingFrame = 5;
								}
								else if (this.wingFrameCounter < num72 * 3)
								{
									this.wingFrame = 6;
								}
								else if (this.wingFrameCounter < num72 * 4 - 1)
								{
									this.wingFrame = 5;
								}
								else
								{
									this.wingFrame = 5;
									this.wingFrameCounter = 0;
								}
							}
						}
						else
						{
							this.wingFrameCounter++;
							int num73 = 6;
							if (this.wingFrameCounter < num73)
							{
								this.wingFrame = 4;
							}
							else if (this.wingFrameCounter < num73 * 2)
							{
								this.wingFrame = 5;
							}
							else if (this.wingFrameCounter < num73 * 3 - 1)
							{
								this.wingFrame = 4;
							}
							else
							{
								this.wingFrame = 4;
								this.wingFrameCounter = 0;
							}
						}
					}
					else if (this.wings == 12)
					{
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							int num74 = 5;
							if (this.wingFrameCounter < num74)
							{
								this.wingFrame = 1;
							}
							else if (this.wingFrameCounter < num74 * 2)
							{
								this.wingFrame = 2;
							}
							else if (this.wingFrameCounter < num74 * 3)
							{
								this.wingFrame = 3;
							}
							else if (this.wingFrameCounter < num74 * 4 - 1)
							{
								this.wingFrame = 2;
							}
							else
							{
								this.wingFrame = 2;
								this.wingFrameCounter = 0;
							}
						}
						else if (this.velocity.Y != 0f)
						{
							this.wingFrame = 2;
						}
						else
						{
							this.wingFrame = 0;
						}
					}
					else if (this.wings == 24)
					{
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							int num75 = 1;
							if (this.wingFrameCounter < num75)
							{
								this.wingFrame = 1;
							}
							else if (this.wingFrameCounter < num75 * 2)
							{
								this.wingFrame = 2;
							}
							else if (this.wingFrameCounter < num75 * 3)
							{
								this.wingFrame = 3;
							}
							else
							{
								this.wingFrame = 2;
								if (this.wingFrameCounter >= num75 * 4 - 1)
								{
									this.wingFrameCounter = 0;
								}
							}
						}
						else if (this.velocity.Y != 0f)
						{
							if (this.controlJump)
							{
								this.wingFrameCounter++;
								int num76 = 3;
								if (this.wingFrameCounter < num76)
								{
									this.wingFrame = 1;
								}
								else if (this.wingFrameCounter < num76 * 2)
								{
									this.wingFrame = 2;
								}
								else if (this.wingFrameCounter < num76 * 3)
								{
									this.wingFrame = 3;
								}
								else
								{
									this.wingFrame = 2;
									if (this.wingFrameCounter >= num76 * 4 - 1)
									{
										this.wingFrameCounter = 0;
									}
								}
							}
							else if (this.wingTime == 0f)
							{
								this.wingFrame = 0;
							}
							else
							{
								this.wingFrame = 1;
							}
						}
						else
						{
							this.wingFrame = 0;
						}
					}
					else if (this.wings == 30)
					{
						bool flag20 = false;
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							int num77 = 2;
							if (this.wingFrameCounter >= num77 * 3)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = 1 + this.wingFrameCounter / num77;
							flag20 = true;
						}
						else if (this.velocity.Y != 0f)
						{
							if (this.controlJump)
							{
								this.wingFrameCounter++;
								int num78 = 2;
								if (this.wingFrameCounter >= num78 * 3)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = 1 + this.wingFrameCounter / num78;
								flag20 = true;
							}
							else if (this.wingTime == 0f)
							{
								this.wingFrame = 0;
							}
							else
							{
								this.wingFrame = 0;
							}
						}
						else
						{
							this.wingFrame = 0;
						}
						if (flag20)
						{
							for (int num79 = 0; num79 < 4; num79++)
							{
								if (Main.rand.Next(4) == 0)
								{
									Vector2 value = (-0.745398164f + 0.3926991f * (float)num79 + 0.03f * (float)num79).ToRotationVector2() * new Vector2((float)(-(float)this.direction * 20), 20f);
									Dust dust2 = Main.dust[Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, Color.White, 0.8f)];
									dust2.noGravity = true;
									dust2.position = base.Center + value;
									dust2.velocity = base.DirectionTo(dust2.position) * 2f;
									if (Main.rand.Next(10) != 0)
									{
										dust2.customData = this;
									}
									else
									{
										dust2.fadeIn = 0.5f;
									}
									dust2.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
							}
							for (int num80 = 0; num80 < 4; num80++)
							{
								if (Main.rand.Next(8) == 0)
								{
									Vector2 value2 = (-0.7053982f + 0.3926991f * (float)num80 + 0.03f * (float)num80).ToRotationVector2() * new Vector2((float)(this.direction * 20), 24f) + new Vector2((float)(-(float)this.direction) * 16f, 0f);
									Dust dust3 = Main.dust[Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, Color.White, 0.5f)];
									dust3.noGravity = true;
									dust3.position = base.Center + value2;
									dust3.velocity = Vector2.Normalize(dust3.position - base.Center - new Vector2((float)(-(float)this.direction) * 16f, 0f)) * 2f;
									dust3.position += dust3.velocity * 5f;
									if (Main.rand.Next(10) != 0)
									{
										dust3.customData = this;
									}
									else
									{
										dust3.fadeIn = 0.5f;
									}
									dust3.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
							}
						}
					}
					else if (this.wings == 34)
					{
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							int num81 = 4;
							if (this.wingFrameCounter >= num81 * 6)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = this.wingFrameCounter / num81;
						}
						else if (this.velocity.Y != 0f)
						{
							if (this.controlJump)
							{
								this.wingFrameCounter++;
								int num82 = 9;
								if (this.wingFrameCounter >= num82 * 6)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = this.wingFrameCounter / num82;
							}
							else
							{
								this.wingFrameCounter++;
								int num83 = 6;
								if (this.wingFrameCounter >= num83 * 6)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = this.wingFrameCounter / num83;
							}
						}
						else
						{
							this.wingFrameCounter++;
							int num84 = 4;
							if (this.wingFrameCounter >= num84 * 6)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = this.wingFrameCounter / num84;
						}
					}
					else if (this.wings == 39)
					{
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							int num85 = 4;
							if (this.wingFrameCounter >= num85 * 6)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = this.wingFrameCounter / num85;
						}
						else if (this.velocity.Y != 0f)
						{
							if (this.controlJump)
							{
								this.wingFrameCounter++;
								int num86 = 9;
								if (this.wingFrameCounter >= num86 * 6)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = this.wingFrameCounter / num86;
							}
							else
							{
								this.wingFrameCounter++;
								int num87 = 6;
								if (this.wingFrameCounter >= num87 * 6)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = this.wingFrameCounter / num87;
							}
						}
						else
						{
							this.wingFrameCounter++;
							int num88 = 4;
							if (this.wingFrameCounter >= num88 * 6)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = this.wingFrameCounter / num88;
						}
						int num89 = 1;
						if (this.wingFrame == 3)
						{
							num89 = 5;
						}
						if (this.velocity.Y == 0f)
						{
							num89 = 0;
						}
						Rectangle rectangle = Utils.CenteredRectangle((this.gravDir == 1f) ? (base.Bottom + new Vector2(0f, -10f)) : (base.Top + new Vector2(0f, 10f)), new Vector2(50f, 20f));
						for (int num90 = 0; num90 < num89; num90++)
						{
							Dust expr_65F1 = Dust.NewDustDirect(rectangle.TopLeft(), rectangle.Width, rectangle.Height, 31, 0f, 0f, 0, Color.Black, 1f);
							expr_65F1.scale = 0.7f;
							expr_65F1.velocity *= 0.4f;
							expr_65F1.velocity.Y = expr_65F1.velocity.Y + this.gravDir * 0.5f;
							expr_65F1.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
						}
					}
					else if (this.wings == 33)
					{
						bool flag21 = false;
						if (flag19 || this.jump > 0)
						{
							flag21 = true;
						}
						else if (this.velocity.Y != 0f && this.controlJump)
						{
							flag21 = true;
						}
						if (flag21)
						{
							Color newColor = Main.hslToRgb(Main.rgbToHsl(this.eyeColor).X, 1f, 0.5f);
							int num91 = (this.direction == 1) ? 0 : -4;
							int num92 = (this.gravDir == 1f) ? this.height : 0;
							for (int num93 = 0; num93 < 2; num93++)
							{
								Dust dust4 = Main.dust[Dust.NewDust(this.position, this.width, this.height, 182, this.velocity.X, this.velocity.Y, 127, newColor, 1f)];
								dust4.noGravity = true;
								dust4.fadeIn = 1f;
								dust4.scale = 1f;
								dust4.noLight = true;
								if (num93 == 0)
								{
									dust4.position = new Vector2(this.position.X + (float)num91, this.position.Y + (float)num92);
									dust4.velocity.X = dust4.velocity.X * 1f - 2f - this.velocity.X * 0.3f;
									dust4.velocity.Y = dust4.velocity.Y * 1f + 2f * this.gravDir - this.velocity.Y * 0.3f;
								}
								else if (num93 == 1)
								{
									dust4.position = new Vector2(this.position.X + (float)this.width + (float)num91, this.position.Y + (float)num92);
									dust4.velocity.X = dust4.velocity.X * 1f + 2f - this.velocity.X * 0.3f;
									dust4.velocity.Y = dust4.velocity.Y * 1f + 2f * this.gravDir - this.velocity.Y * 0.3f;
								}
								Dust expr_68B6 = Dust.CloneDust(dust4);
								expr_68B6.scale *= 0.65f;
								expr_68B6.fadeIn *= 0.65f;
								expr_68B6.color = new Color(255, 255, 255, 255);
								dust4.noLight = true;
								dust4.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
						}
					}
					else if (this.wings == 38)
					{
						bool flag22 = false;
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							if (this.wingFrameCounter >= 32)
							{
								this.wingFrameCounter = 0;
							}
							this.wingFrame = 1 + this.wingFrameCounter / 8;
							if (this.wingFrame == 4)
							{
								this.wingFrame = 2;
							}
							flag22 = true;
						}
						else if (this.velocity.Y != 0f)
						{
							if (this.controlJump)
							{
								this.wingFrameCounter++;
								if (this.wingFrameCounter >= 32)
								{
									this.wingFrameCounter = 0;
								}
								this.wingFrame = 1 + this.wingFrameCounter / 8;
								if (this.wingFrame == 4)
								{
									this.wingFrame = 2;
								}
								flag22 = true;
							}
							else
							{
								this.wingFrame = 0;
							}
						}
						else
						{
							this.wingFrame = 0;
						}
						if (flag22)
						{
							Vector2 value3 = new Vector2((float)this.direction, this.gravDir);
							Vector2 value4 = this.velocity * 0.5f;
							int type2 = 267;
							int num94 = this.miscCounter * this.direction;
							for (int num95 = 0; num95 < 3; num95++)
							{
								Vector2 value5 = Vector2.Zero;
								if (num95 != 1)
								{
									if (num95 == 2)
									{
										value5 = this.velocity * -0.66f;
									}
								}
								else
								{
									value5 = this.velocity * -0.33f;
								}
								Vector2 value6 = new Vector2(-39f, 6f) * value3 + new Vector2(2f, 0f).RotatedBy((double)((float)num94 / -15f * 6.28318548f), default(Vector2));
								Dust expr_6AF7 = Dust.NewDustPerfect(base.Center + value6 + value5, type2, new Vector2?(value4), 0, this.underShirtColor, 1f);
								expr_6AF7.noGravity = true;
								expr_6AF7.noLight = true;
								expr_6AF7.scale = 0.47f;
								expr_6AF7.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								value6 = new Vector2(-23f, 2f) * value3 + new Vector2(2f, 0f).RotatedBy((double)((float)num94 / -15f * 6.28318548f), default(Vector2));
								Dust expr_6B9F = Dust.NewDustPerfect(base.Center + value6 + value5, type2, new Vector2?(value4), 0, this.underShirtColor, 1f);
								expr_6B9F.noGravity = true;
								expr_6B9F.noLight = true;
								expr_6B9F.scale = 0.35f;
								expr_6B9F.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								value6 = new Vector2(-31f, -6f) * value3 + new Vector2(2f, 0f).RotatedBy((double)((float)num94 / -20f * 6.28318548f), default(Vector2));
								Dust expr_6C47 = Dust.NewDustPerfect(base.Center + value6 + value5, type2, new Vector2?(value4), 0, this.underShirtColor, 1f);
								expr_6C47.noGravity = true;
								expr_6C47.noLight = true;
								expr_6C47.scale = 0.49f;
								expr_6C47.shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
						}
					}
					else
					{
						int num96 = 4;
						if (this.wings == 32)
						{
							num96 = 3;
						}
						if (flag19 || this.jump > 0)
						{
							this.wingFrameCounter++;
							if (this.wingFrameCounter > num96)
							{
								this.wingFrame++;
								this.wingFrameCounter = 0;
								if (this.wingFrame >= 4)
								{
									this.wingFrame = 0;
								}
							}
						}
						else if (this.velocity.Y != 0f)
						{
							this.wingFrame = 1;
							if (this.wings == 32)
							{
								this.wingFrame = 3;
							}
							if (this.wings == 29 && Main.rand.Next(5) == 0)
							{
								int num97 = 4;
								if (this.direction == 1)
								{
									num97 = -40;
								}
								int num98 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num97, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 6, 0f, 0f, 100, default(Color), 2.4f);
								Main.dust[num98].noGravity = true;
								Main.dust[num98].velocity *= 0.3f;
								if (Main.rand.Next(10) == 0)
								{
									Main.dust[num98].fadeIn = 2f;
								}
								Main.dust[num98].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
							}
						}
						else
						{
							this.wingFrame = 0;
						}
					}
					if (this.wingsLogic > 0 && this.rocketBoots > 0 && this.velocity.Y != 0f)
					{
						int num99 = 6;
						this.wingTime += (float)(this.rocketTime * num99);
						if (this.wingTime > (float)(this.wingTimeMax + this.rocketTimeMax * num99))
						{
							this.wingTime = (float)(this.wingTimeMax + this.rocketTimeMax * num99);
						}
						this.rocketTime = 0;
					}
					if (flag19 && this.wings != 4 && this.wings != 22 && this.wings != 0 && this.wings != 24 && this.wings != 28 && this.wings != 30 && this.wings != 33)
					{
						if (this.wingFrame == 3)
						{
							if (!this.flapSound)
							{
								Main.PlaySound(SoundID.Item32, this.position);
							}
							this.flapSound = true;
						}
						else
						{
							this.flapSound = false;
						}
					}
					if (this.velocity.Y == 0f || this.sliding || (this.autoJump && this.justJumped))
					{
						this.rocketTime = this.rocketTimeMax;
					}
					if ((this.wingTime == 0f || this.wingsLogic == 0) && this.rocketBoots > 0 && this.controlJump && this.rocketDelay == 0 && this.canRocket && this.rocketRelease && !this.jumpAgainCloud)
					{
						if (this.rocketTime > 0)
						{
							this.rocketTime--;
							this.rocketDelay = 10;
							if (this.rocketDelay2 <= 0)
							{
								if (this.rocketBoots == 1)
								{
									Main.PlaySound(SoundID.Item13, this.position);
									this.rocketDelay2 = 30;
								}
								else if (this.rocketBoots == 2 || this.rocketBoots == 3)
								{
									Main.PlaySound(SoundID.Item24, this.position);
									this.rocketDelay2 = 15;
								}
							}
						}
						else
						{
							this.canRocket = false;
						}
					}
					if (this.rocketDelay2 > 0)
					{
						this.rocketDelay2--;
					}
					if (this.rocketDelay == 0)
					{
						this.rocketFrame = false;
					}
					if (this.rocketDelay > 0)
					{
						int num100 = this.height;
						if (this.gravDir == -1f)
						{
							num100 = 4;
						}
						this.rocketFrame = true;
						for (int num101 = 0; num101 < 2; num101++)
						{
							int type3 = 6;
							float scale2 = 2.5f;
							int alpha2 = 100;
							if (this.rocketBoots == 2)
							{
								type3 = 16;
								scale2 = 1.5f;
								alpha2 = 20;
							}
							else if (this.rocketBoots == 3)
							{
								type3 = 76;
								scale2 = 1f;
								alpha2 = 20;
							}
							else if (this.socialShadowRocketBoots)
							{
								type3 = 27;
								scale2 = 1.5f;
							}
							if (num101 == 0)
							{
								int num102 = Dust.NewDust(new Vector2(this.position.X - 4f, this.position.Y + (float)num100 - 10f), 8, 8, type3, 0f, 0f, alpha2, default(Color), scale2);
								Main.dust[num102].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
								if (this.rocketBoots == 1)
								{
									Main.dust[num102].noGravity = true;
								}
								Main.dust[num102].velocity.X = Main.dust[num102].velocity.X * 1f - 2f - this.velocity.X * 0.3f;
								Main.dust[num102].velocity.Y = Main.dust[num102].velocity.Y * 1f + 2f * this.gravDir - this.velocity.Y * 0.3f;
								if (this.rocketBoots == 2)
								{
									Main.dust[num102].velocity *= 0.1f;
								}
								if (this.rocketBoots == 3)
								{
									Main.dust[num102].velocity *= 0.05f;
									Dust expr_723D_cp_0_cp_0 = Main.dust[num102];
									expr_723D_cp_0_cp_0.velocity.Y = expr_723D_cp_0_cp_0.velocity.Y + 0.15f;
									Main.dust[num102].noLight = true;
									if (Main.rand.Next(2) == 0)
									{
										Main.dust[num102].noGravity = true;
										Main.dust[num102].scale = 1.75f;
									}
								}
							}
							else
							{
								int num103 = Dust.NewDust(new Vector2(this.position.X + (float)this.width - 4f, this.position.Y + (float)num100 - 10f), 8, 8, type3, 0f, 0f, alpha2, default(Color), scale2);
								Main.dust[num103].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
								if (this.rocketBoots == 1)
								{
									Main.dust[num103].noGravity = true;
								}
								Main.dust[num103].velocity.X = Main.dust[num103].velocity.X * 1f + 2f - this.velocity.X * 0.3f;
								Main.dust[num103].velocity.Y = Main.dust[num103].velocity.Y * 1f + 2f * this.gravDir - this.velocity.Y * 0.3f;
								if (this.rocketBoots == 2)
								{
									Main.dust[num103].velocity *= 0.1f;
								}
								if (this.rocketBoots == 3)
								{
									Main.dust[num103].velocity *= 0.05f;
									Dust expr_73FD_cp_0_cp_0 = Main.dust[num103];
									expr_73FD_cp_0_cp_0.velocity.Y = expr_73FD_cp_0_cp_0.velocity.Y + 0.15f;
									Main.dust[num103].noLight = true;
									if (Main.rand.Next(2) == 0)
									{
										Main.dust[num103].noGravity = true;
										Main.dust[num103].scale = 1.75f;
									}
								}
							}
						}
						if (this.rocketDelay == 0)
						{
							this.releaseJump = true;
						}
						this.rocketDelay--;
						this.velocity.Y = this.velocity.Y - 0.1f * this.gravDir;
						if (this.gravDir == 1f)
						{
							if (this.velocity.Y > 0f)
							{
								this.velocity.Y = this.velocity.Y - 0.5f;
							}
							else if ((double)this.velocity.Y > (double)(-(double)Player.jumpSpeed) * 0.5)
							{
								this.velocity.Y = this.velocity.Y - 0.1f;
							}
							if (this.velocity.Y < -Player.jumpSpeed * 1.5f)
							{
								this.velocity.Y = -Player.jumpSpeed * 1.5f;
							}
						}
						else
						{
							if (this.velocity.Y < 0f)
							{
								this.velocity.Y = this.velocity.Y + 0.5f;
							}
							else if ((double)this.velocity.Y < (double)Player.jumpSpeed * 0.5)
							{
								this.velocity.Y = this.velocity.Y + 0.1f;
							}
							if (this.velocity.Y > Player.jumpSpeed * 1.5f)
							{
								this.velocity.Y = Player.jumpSpeed * 1.5f;
							}
						}
					}
					else if (!flag19)
					{
						if (this.mount.CanHover)
						{
							this.mount.Hover(this);
						}
						else if (this.mount.CanFly && this.controlJump && this.jump == 0)
						{
							if (this.mount.Flight())
							{
								if (this.controlDown)
								{
									this.velocity.Y = this.velocity.Y * 0.9f;
									if (this.velocity.Y > -1f && (double)this.velocity.Y < 0.5)
									{
										this.velocity.Y = 1E-05f;
									}
								}
								else
								{
									if (this.velocity.Y > 0f)
									{
										this.velocity.Y = this.velocity.Y - 0.5f;
									}
									else if ((double)this.velocity.Y > (double)(-(double)Player.jumpSpeed) * 1.5)
									{
										this.velocity.Y = this.velocity.Y - 0.1f;
									}
									if (this.velocity.Y < -Player.jumpSpeed * 1.5f)
									{
										this.velocity.Y = -Player.jumpSpeed * 1.5f;
									}
								}
							}
							else
							{
								this.velocity.Y = this.velocity.Y + this.gravity / 3f * this.gravDir;
								if (this.gravDir == 1f)
								{
									if (this.velocity.Y > this.maxFallSpeed / 3f && !this.controlDown)
									{
										this.velocity.Y = this.maxFallSpeed / 3f;
									}
								}
								else if (this.velocity.Y < -this.maxFallSpeed / 3f && !this.controlUp)
								{
									this.velocity.Y = -this.maxFallSpeed / 3f;
								}
							}
						}
						else if (this.slowFall && ((!this.controlDown && this.gravDir == 1f) || (!this.controlDown && this.gravDir == -1f)))
						{
							if ((this.controlUp && this.gravDir == 1f) || (this.controlUp && this.gravDir == -1f))
							{
								this.gravity = this.gravity / 10f * this.gravDir;
							}
							else
							{
								this.gravity = this.gravity / 3f * this.gravDir;
							}
							this.velocity.Y = this.velocity.Y + this.gravity;
						}
						else if (this.wingsLogic > 0 && this.controlJump && this.velocity.Y > 0f)
						{
							this.fallStart = (int)(this.position.Y / 16f);
							if (this.velocity.Y > 0f)
							{
								if (this.wings == 10 && Main.rand.Next(3) == 0)
								{
									int num104 = 4;
									if (this.direction == 1)
									{
										num104 = -40;
									}
									int num105 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num104, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 76, 0f, 0f, 50, default(Color), 0.6f);
									Main.dust[num105].fadeIn = 1.1f;
									Main.dust[num105].noGravity = true;
									Main.dust[num105].noLight = true;
									Main.dust[num105].velocity *= 0.3f;
									Main.dust[num105].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (this.wings == 34 && Main.rand.Next(3) == 0)
								{
									int num106 = 4;
									if (this.direction == 1)
									{
										num106 = -40;
									}
									int num107 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num106, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 261, 0f, 0f, 50, default(Color), 0.6f);
									Main.dust[num107].fadeIn = 1.1f;
									Main.dust[num107].noGravity = true;
									Main.dust[num107].noLight = true;
									Main.dust[num107].velocity *= 0.3f;
									Main.dust[num107].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (this.wings == 9 && Main.rand.Next(3) == 0)
								{
									int num108 = 8;
									if (this.direction == 1)
									{
										num108 = -40;
									}
									int num109 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num108, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 6, 0f, 0f, 200, default(Color), 2f);
									Main.dust[num109].noGravity = true;
									Main.dust[num109].velocity *= 0.3f;
									Main.dust[num109].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (this.wings == 29 && Main.rand.Next(3) == 0)
								{
									int num110 = 8;
									if (this.direction == 1)
									{
										num110 = -40;
									}
									int num111 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num110, this.position.Y + (float)(this.height / 2) - 15f), 30, 30, 6, 0f, 0f, 100, default(Color), 2.4f);
									Main.dust[num111].noGravity = true;
									Main.dust[num111].velocity *= 0.3f;
									if (Main.rand.Next(10) == 0)
									{
										Main.dust[num111].fadeIn = 2f;
									}
									Main.dust[num111].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (this.wings == 6)
								{
									if (Main.rand.Next(10) == 0)
									{
										int num112 = 4;
										if (this.direction == 1)
										{
											num112 = -40;
										}
										int num113 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num112, this.position.Y + (float)(this.height / 2) - 12f), 30, 20, 55, 0f, 0f, 200, default(Color), 1f);
										Main.dust[num113].velocity *= 0.3f;
										Main.dust[num113].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
									}
								}
								else if (this.wings == 5 && Main.rand.Next(6) == 0)
								{
									int num114 = 6;
									if (this.direction == 1)
									{
										num114 = -30;
									}
									int num115 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num114, this.position.Y), 18, this.height, 58, 0f, 0f, 255, default(Color), 1.2f);
									Main.dust[num115].velocity *= 0.3f;
									Main.dust[num115].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
								}
								if (this.wings == 4)
								{
									this.rocketDelay2--;
									if (this.rocketDelay2 <= 0)
									{
										Main.PlaySound(SoundID.Item13, this.position);
										this.rocketDelay2 = 60;
									}
									int type4 = 6;
									float scale3 = 1.5f;
									int alpha3 = 100;
									float x2 = this.position.X + (float)(this.width / 2) + 16f;
									if (this.direction > 0)
									{
										x2 = this.position.X + (float)(this.width / 2) - 26f;
									}
									float num116 = this.position.Y + (float)this.height - 18f;
									if (Main.rand.Next(2) == 1)
									{
										x2 = this.position.X + (float)(this.width / 2) + 8f;
										if (this.direction > 0)
										{
											x2 = this.position.X + (float)(this.width / 2) - 20f;
										}
										num116 += 6f;
									}
									int num117 = Dust.NewDust(new Vector2(x2, num116), 8, 8, type4, 0f, 0f, alpha3, default(Color), scale3);
									Dust expr_7F5A_cp_0_cp_0 = Main.dust[num117];
									expr_7F5A_cp_0_cp_0.velocity.X = expr_7F5A_cp_0_cp_0.velocity.X * 0.3f;
									Dust expr_7F75_cp_0_cp_0 = Main.dust[num117];
									expr_7F75_cp_0_cp_0.velocity.Y = expr_7F75_cp_0_cp_0.velocity.Y + 10f;
									Main.dust[num117].noGravity = true;
									Main.dust[num117].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
									this.wingFrameCounter++;
									if (this.wingFrameCounter > 4)
									{
										this.wingFrame++;
										this.wingFrameCounter = 0;
										if (this.wingFrame >= 3)
										{
											this.wingFrame = 0;
										}
									}
								}
								else if (this.wings != 22 && this.wings != 28)
								{
									if (this.wings == 30)
									{
										this.wingFrameCounter++;
										int num118 = 5;
										if (this.wingFrameCounter >= num118 * 3)
										{
											this.wingFrameCounter = 0;
										}
										this.wingFrame = 1 + this.wingFrameCounter / num118;
									}
									else if (this.wings == 34)
									{
										this.wingFrameCounter++;
										int num119 = 7;
										if (this.wingFrameCounter >= num119 * 6)
										{
											this.wingFrameCounter = 0;
										}
										this.wingFrame = this.wingFrameCounter / num119;
									}
									else if (this.wings == 39)
									{
										this.wingFrameCounter++;
										int num120 = 12;
										if (this.wingFrameCounter >= num120 * 6)
										{
											this.wingFrameCounter = 0;
										}
										this.wingFrame = this.wingFrameCounter / num120;
									}
									else if (this.wings == 26)
									{
										int num121 = 6;
										if (this.direction == 1)
										{
											num121 = -30;
										}
										int num122 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num121, this.position.Y), 18, this.height, 217, 0f, 0f, 100, default(Color), 1.4f);
										Main.dust[num122].noGravity = true;
										Main.dust[num122].noLight = true;
										Main.dust[num122].velocity /= 4f;
										Main.dust[num122].velocity -= this.velocity;
										Main.dust[num122].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
										if (Main.rand.Next(2) == 0)
										{
											num121 = -24;
											if (this.direction == 1)
											{
												num121 = 12;
											}
											float num123 = this.position.Y;
											if (this.gravDir == -1f)
											{
												num123 += (float)(this.height / 2);
											}
											num122 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num121, num123), 12, this.height / 2, 217, 0f, 0f, 100, default(Color), 1.4f);
											Main.dust[num122].noGravity = true;
											Main.dust[num122].noLight = true;
											Main.dust[num122].velocity /= 4f;
											Main.dust[num122].velocity -= this.velocity;
											Main.dust[num122].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
										}
										this.wingFrame = 2;
									}
									else if (this.wings == 37)
									{
										Color color = Color.Lerp(Color.Black, Color.White, Main.rand.NextFloat());
										int num124 = 6;
										if (this.direction == 1)
										{
											num124 = -30;
										}
										int num125 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num124, this.position.Y), 24, this.height, Utils.SelectRandom<int>(Main.rand, new int[]
										{
											31,
											31,
											31
										}), 0f, 0f, 100, default(Color), 0.7f);
										Main.dust[num125].noGravity = true;
										Main.dust[num125].noLight = true;
										Main.dust[num125].velocity /= 4f;
										Main.dust[num125].velocity -= this.velocity;
										Main.dust[num125].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
										if (Main.dust[num125].type == 55)
										{
											Main.dust[num125].color = color;
										}
										if (Main.rand.Next(3) == 0)
										{
											num124 = -24;
											if (this.direction == 1)
											{
												num124 = 12;
											}
											float num126 = this.position.Y;
											if (this.gravDir == -1f)
											{
												num126 += (float)(this.height / 2);
											}
											num125 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)num124, num126), 12, this.height / 2, Utils.SelectRandom<int>(Main.rand, new int[]
											{
												31,
												31,
												31
											}), 0f, 0f, 140, default(Color), 0.7f);
											Main.dust[num125].noGravity = true;
											Main.dust[num125].noLight = true;
											Main.dust[num125].velocity /= 4f;
											Main.dust[num125].velocity -= this.velocity;
											Main.dust[num125].shader = GameShaders.Armor.GetSecondaryShader(this.cWings, this);
											if (Main.dust[num125].type == 55)
											{
												Main.dust[num125].color = color;
											}
										}
										this.wingFrame = 2;
									}
									else if (this.wings != 24)
									{
										if (this.wings == 12)
										{
											this.wingFrame = 3;
										}
										else
										{
											this.wingFrame = 2;
										}
									}
								}
							}
							this.velocity.Y = this.velocity.Y + this.gravity / 3f * this.gravDir;
							if (this.gravDir == 1f)
							{
								if (this.velocity.Y > this.maxFallSpeed / 3f && !this.controlDown)
								{
									this.velocity.Y = this.maxFallSpeed / 3f;
								}
							}
							else if (this.velocity.Y < -this.maxFallSpeed / 3f && !this.controlUp)
							{
								this.velocity.Y = -this.maxFallSpeed / 3f;
							}
						}
						else if (this.cartRampTime <= 0)
						{
							this.velocity.Y = this.velocity.Y + this.gravity * this.gravDir;
						}
						else
						{
							this.cartRampTime--;
						}
					}
					if (!this.mount.Active || this.mount.Type != 5)
					{
						if (this.gravDir == 1f)
						{
							if (this.velocity.Y > this.maxFallSpeed)
							{
								this.velocity.Y = this.maxFallSpeed;
							}
							if (this.slowFall && this.velocity.Y > this.maxFallSpeed / 3f && !this.controlDown)
							{
								this.velocity.Y = this.maxFallSpeed / 3f;
							}
							if (this.slowFall && this.velocity.Y > this.maxFallSpeed / 5f && this.controlUp)
							{
								this.velocity.Y = this.maxFallSpeed / 10f;
							}
						}
						else
						{
							if (this.velocity.Y < -this.maxFallSpeed)
							{
								this.velocity.Y = -this.maxFallSpeed;
							}
							if (this.slowFall && this.velocity.Y < -this.maxFallSpeed / 3f && !this.controlDown)
							{
								this.velocity.Y = -this.maxFallSpeed / 3f;
							}
							if (this.slowFall && this.velocity.Y < -this.maxFallSpeed / 5f && this.controlUp)
							{
								this.velocity.Y = -this.maxFallSpeed / 10f;
							}
						}
					}
				}
			}
			if (this.mount.Active)
			{
				this.wingFrame = 0;
			}
			if ((this.wingsLogic == 22 || this.wingsLogic == 28 || this.wingsLogic == 30 || this.wingsLogic == 31 || this.wingsLogic == 33 || this.wingsLogic == 35 || this.wingsLogic == 37) && this.controlDown && this.controlJump && this.wingTime > 0f && !this.merman)
			{
				this.velocity.Y = this.velocity.Y * 0.9f;
				if (this.velocity.Y > -2f && this.velocity.Y < 1f)
				{
					this.velocity.Y = 1E-05f;
				}
			}
			if (this.wingsLogic == 37 && this.controlDown && this.controlJump && this.wingTime > 0f && !this.merman)
			{
				this.velocity.Y = this.velocity.Y * 0.92f;
				if (this.velocity.Y > -2f && this.velocity.Y < 1f)
				{
					this.velocity.Y = 1E-05f;
				}
			}
			this.GrabItems(i);
			this.LookForTileInteractions();
			if (this.tongued)
			{
				bool flag23 = false;
				if (Main.wof >= 0)
				{
					float num127 = Main.npc[Main.wof].position.X + (float)(Main.npc[Main.wof].width / 2);
					num127 += (float)(Main.npc[Main.wof].direction * 200);
					float arg_89E2_0 = Main.npc[Main.wof].position.Y + (float)(Main.npc[Main.wof].height / 2);
					Vector2 center = base.Center;
					float num128 = num127 - center.X;
					float num129 = arg_89E2_0 - center.Y;
					float num130 = (float)Math.Sqrt((double)(num128 * num128 + num129 * num129));
					float num131 = 11f;
					float num132;
					if (num130 > num131)
					{
						num132 = num131 / num130;
					}
					else
					{
						num132 = 1f;
						flag23 = true;
					}
					num128 *= num132;
					num129 *= num132;
					this.velocity.X = num128;
					this.velocity.Y = num129;
				}
				else
				{
					flag23 = true;
				}
				if (flag23 && Main.myPlayer == this.whoAmI)
				{
					for (int num133 = 0; num133 < 22; num133++)
					{
						if (this.buffType[num133] == 38)
						{
							this.DelBuff(num133);
						}
					}
				}
			}
			if (Main.myPlayer == this.whoAmI)
			{
				this.WOFTongue();
				if (this.controlHook)
				{
					if (this.releaseHook)
					{
						this.QuickGrapple();
					}
					this.releaseHook = false;
				}
				else
				{
					this.releaseHook = true;
				}
				if (this.talkNPC >= 0)
				{
					Rectangle rectangle2 = new Rectangle((int)(this.position.X + (float)(this.width / 2) - (float)(Player.tileRangeX * 16)), (int)(this.position.Y + (float)(this.height / 2) - (float)(Player.tileRangeY * 16)), Player.tileRangeX * 16 * 2, Player.tileRangeY * 16 * 2);
					Rectangle value7 = new Rectangle((int)Main.npc[this.talkNPC].position.X, (int)Main.npc[this.talkNPC].position.Y, Main.npc[this.talkNPC].width, Main.npc[this.talkNPC].height);
					if (!rectangle2.Intersects(value7) || this.chest != -1 || !Main.npc[this.talkNPC].active)
					{
						if (this.chest == -1)
						{
							Main.PlaySound(11, -1, -1, 1, 1f, 0f);
						}
						this.talkNPC = -1;
						Main.npcChatCornerItem = 0;
						Main.npcChatText = "";
					}
				}
				if (this.sign >= 0)
				{
					Rectangle value8 = new Rectangle((int)(this.position.X + (float)(this.width / 2) - (float)(Player.tileRangeX * 16)), (int)(this.position.Y + (float)(this.height / 2) - (float)(Player.tileRangeY * 16)), Player.tileRangeX * 16 * 2, Player.tileRangeY * 16 * 2);
					try
					{
						bool flag24 = false;
						if (Main.sign[this.sign] == null)
						{
							flag24 = true;
						}
						if (!flag24 && !new Rectangle(Main.sign[this.sign].x * 16, Main.sign[this.sign].y * 16, 32, 32).Intersects(value8))
						{
							flag24 = true;
						}
						if (flag24)
						{
							Main.PlaySound(11, -1, -1, 1, 1f, 0f);
							this.sign = -1;
							Main.editSign = false;
							Main.npcChatText = "";
						}
					}
					catch
					{
						Main.PlaySound(11, -1, -1, 1, 1f, 0f);
						this.sign = -1;
						Main.editSign = false;
						Main.npcChatText = "";
					}
				}
				if (Main.editSign)
				{
					if (this.sign == -1)
					{
						Main.editSign = false;
					}
					else
					{
						Main.InputTextSign();
					}
				}
				else if (Main.editChest)
				{
					Main.InputTextChest();
					if (Main.player[Main.myPlayer].chest == -1)
					{
						Main.editChest = false;
					}
				}
				if (this.mount.Active && this.mount.Cart && Math.Abs(this.velocity.X) > 4f)
				{
					Rectangle rectangle3 = new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height);
					for (int num134 = 0; num134 < 200; num134++)
					{
						if (Main.npc[num134].active && !Main.npc[num134].dontTakeDamage && !Main.npc[num134].friendly && Main.npc[num134].immune[i] == 0 && rectangle3.Intersects(new Rectangle((int)Main.npc[num134].position.X, (int)Main.npc[num134].position.Y, Main.npc[num134].width, Main.npc[num134].height)))
						{
							float num135 = (float)this.meleeCrit;
							if (num135 < (float)this.rangedCrit)
							{
								num135 = (float)this.rangedCrit;
							}
							if (num135 < (float)this.magicCrit)
							{
								num135 = (float)this.magicCrit;
							}
							bool crit = false;
							if ((float)Main.rand.Next(1, 101) <= num135)
							{
								crit = true;
							}
							float num136 = Math.Abs(this.velocity.X) / this.maxRunSpeed;
							int damage2 = Main.DamageVar(25f + 55f * num136);
							if (this.mount.Type == 11)
							{
								damage2 = Main.DamageVar(50f + 100f * num136);
							}
							if (this.mount.Type == 13)
							{
								damage2 = Main.DamageVar(15f + 30f * num136);
							}
							float knockback = 5f + 25f * num136;
							int direction = 1;
							if (this.velocity.X < 0f)
							{
								direction = -1;
							}
							if (this.whoAmI == Main.myPlayer)
							{
								this.ApplyDamageToNPC(Main.npc[num134], damage2, knockback, direction, crit);
							}
							Main.npc[num134].immune[i] = 30;
							if (!Main.npc[num134].active)
							{
								AchievementsHelper.HandleSpecialEvent(this, 9);
							}
						}
					}
				}
				this.Update_NPCCollision();
				Vector2 vector3;
				if (!this.mount.Active || !this.mount.Cart)
				{
					vector3 = Collision.HurtTiles(this.position, this.velocity, this.width, this.height, this.fireWalk);
				}
				else
				{
					vector3 = Collision.HurtTiles(this.position, this.velocity, this.width, this.height - 16, this.fireWalk);
				}
				if (vector3.Y == 0f && !this.fireWalk)
				{
					foreach (Point current in this.TouchedTiles)
					{
						Tile tile = Main.tile[current.X, current.Y];
						if (tile != null && tile.active() && tile.nactive() && !this.fireWalk && TileID.Sets.TouchDamageHot[(int)tile.type] != 0)
						{
							vector3.Y = (float)TileID.Sets.TouchDamageHot[(int)tile.type];
							vector3.X = (float)((base.Center.X / 16f < (float)current.X + 0.5f) ? -1 : 1);
							break;
						}
					}
				}
				if (vector3.Y == 20f)
				{
					this.AddBuff(67, 20, true);
				}
				else if (vector3.Y == 15f)
				{
					if (this.suffocateDelay < 5)
					{
						this.suffocateDelay += 1;
					}
					else
					{
						this.AddBuff(68, 1, true);
					}
				}
				else if (vector3.Y != 0f)
				{
					int damage3 = Main.DamageVar(vector3.Y);
					this.Hurt(PlayerDeathReason.ByOther(3), damage3, 0, false, false, false, 0);
				}
				else
				{
					this.suffocateDelay = 0;
				}
			}
			if (this.controlRight)
			{
				this.releaseRight = false;
			}
			else
			{
				this.releaseRight = true;
				this.rightTimer = 7;
			}
			if (this.controlLeft)
			{
				this.releaseLeft = false;
			}
			else
			{
				this.releaseLeft = true;
				this.leftTimer = 7;
			}
			this.releaseDown = !this.controlDown;
			if (this.rightTimer > 0)
			{
				this.rightTimer--;
			}
			else if (this.controlRight)
			{
				this.rightTimer = 7;
			}
			if (this.leftTimer > 0)
			{
				this.leftTimer--;
			}
			else if (this.controlLeft)
			{
				this.leftTimer = 7;
			}
			this.GrappleMovement();
			this.StickyMovement();
			this.CheckDrowning();
			if (this.gravDir == -1f)
			{
				this.waterWalk = false;
				this.waterWalk2 = false;
			}
			int num137 = this.height;
			if (this.waterWalk)
			{
				num137 -= 6;
			}
			bool flag25 = Collision.LavaCollision(this.position, this.width, num137);
			if (flag25)
			{
				if (!this.lavaImmune && Main.myPlayer == i && !this.immune)
				{
					if (this.lavaTime > 0)
					{
						this.lavaTime--;
					}
					else if (this.lavaRose)
					{
						this.Hurt(PlayerDeathReason.ByOther(2), 50, 0, false, false, false, -1);
						this.AddBuff(24, 210, true);
					}
					else
					{
						this.Hurt(PlayerDeathReason.ByOther(2), 80, 0, false, false, false, -1);
						this.AddBuff(24, 420, true);
					}
				}
				this.lavaWet = true;
			}
			else
			{
				this.lavaWet = false;
				if (this.lavaTime < this.lavaMax)
				{
					this.lavaTime++;
				}
			}
			if (this.lavaTime > this.lavaMax)
			{
				this.lavaTime = this.lavaMax;
			}
			if (this.waterWalk2 && !this.waterWalk)
			{
				num137 -= 6;
			}
			bool arg_936B_0 = Collision.WetCollision(this.position, this.width, this.height);
			bool flag26 = Collision.honey;
			if (flag26)
			{
				this.AddBuff(48, 1800, true);
				this.honeyWet = true;
			}
			if (arg_936B_0)
			{
				if (this.onFire && !this.lavaWet)
				{
					for (int num138 = 0; num138 < 22; num138++)
					{
						if (this.buffType[num138] == 24)
						{
							this.DelBuff(num138);
						}
					}
				}
				if (!this.wet)
				{
					if (this.wetCount == 0)
					{
						this.wetCount = 10;
						if (!flag25)
						{
							if (this.honeyWet)
							{
								for (int num139 = 0; num139 < 20; num139++)
								{
									int num140 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2) - 8f), this.width + 12, 24, 152, 0f, 0f, 0, default(Color), 1f);
									Dust expr_9452_cp_0_cp_0 = Main.dust[num140];
									expr_9452_cp_0_cp_0.velocity.Y = expr_9452_cp_0_cp_0.velocity.Y - 1f;
									Dust expr_946D_cp_0_cp_0 = Main.dust[num140];
									expr_946D_cp_0_cp_0.velocity.X = expr_946D_cp_0_cp_0.velocity.X * 2.5f;
									Main.dust[num140].scale = 1.3f;
									Main.dust[num140].alpha = 100;
									Main.dust[num140].noGravity = true;
								}
								Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
							}
							else
							{
								for (int num141 = 0; num141 < 50; num141++)
								{
									int num142 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2) - 8f), this.width + 12, 24, Dust.dustWater(), 0f, 0f, 0, default(Color), 1f);
									Dust expr_9560_cp_0_cp_0 = Main.dust[num142];
									expr_9560_cp_0_cp_0.velocity.Y = expr_9560_cp_0_cp_0.velocity.Y - 3f;
									Dust expr_957B_cp_0_cp_0 = Main.dust[num142];
									expr_957B_cp_0_cp_0.velocity.X = expr_957B_cp_0_cp_0.velocity.X * 2.5f;
									Main.dust[num142].scale = 0.8f;
									Main.dust[num142].alpha = 100;
									Main.dust[num142].noGravity = true;
								}
								Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
							}
						}
						else
						{
							for (int num143 = 0; num143 < 20; num143++)
							{
								int num144 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2) - 8f), this.width + 12, 24, 35, 0f, 0f, 0, default(Color), 1f);
								Dust expr_966B_cp_0_cp_0 = Main.dust[num144];
								expr_966B_cp_0_cp_0.velocity.Y = expr_966B_cp_0_cp_0.velocity.Y - 1.5f;
								Dust expr_9686_cp_0_cp_0 = Main.dust[num144];
								expr_9686_cp_0_cp_0.velocity.X = expr_9686_cp_0_cp_0.velocity.X * 2.5f;
								Main.dust[num144].scale = 1.3f;
								Main.dust[num144].alpha = 100;
								Main.dust[num144].noGravity = true;
							}
							Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
					}
					this.wet = true;
				}
			}
			else if (this.wet)
			{
				this.wet = false;
				if (this.jump > Player.jumpHeight / 5 && this.wetSlime == 0)
				{
					this.jump = Player.jumpHeight / 5;
				}
				if (this.wetCount == 0)
				{
					this.wetCount = 10;
					if (!this.lavaWet)
					{
						if (this.honeyWet)
						{
							for (int num145 = 0; num145 < 20; num145++)
							{
								int num146 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2) - 8f), this.width + 12, 24, 152, 0f, 0f, 0, default(Color), 1f);
								Dust expr_97DF_cp_0_cp_0 = Main.dust[num146];
								expr_97DF_cp_0_cp_0.velocity.Y = expr_97DF_cp_0_cp_0.velocity.Y - 1f;
								Dust expr_97FA_cp_0_cp_0 = Main.dust[num146];
								expr_97FA_cp_0_cp_0.velocity.X = expr_97FA_cp_0_cp_0.velocity.X * 2.5f;
								Main.dust[num146].scale = 1.3f;
								Main.dust[num146].alpha = 100;
								Main.dust[num146].noGravity = true;
							}
							Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
						}
						else
						{
							for (int num147 = 0; num147 < 50; num147++)
							{
								int num148 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2)), this.width + 12, 24, Dust.dustWater(), 0f, 0f, 0, default(Color), 1f);
								Dust expr_98E7_cp_0_cp_0 = Main.dust[num148];
								expr_98E7_cp_0_cp_0.velocity.Y = expr_98E7_cp_0_cp_0.velocity.Y - 4f;
								Dust expr_9902_cp_0_cp_0 = Main.dust[num148];
								expr_9902_cp_0_cp_0.velocity.X = expr_9902_cp_0_cp_0.velocity.X * 2.5f;
								Main.dust[num148].scale = 0.8f;
								Main.dust[num148].alpha = 100;
								Main.dust[num148].noGravity = true;
							}
							Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 0, 1f, 0f);
						}
					}
					else
					{
						for (int num149 = 0; num149 < 20; num149++)
						{
							int num150 = Dust.NewDust(new Vector2(this.position.X - 6f, this.position.Y + (float)(this.height / 2) - 8f), this.width + 12, 24, 35, 0f, 0f, 0, default(Color), 1f);
							Dust expr_99F2_cp_0_cp_0 = Main.dust[num150];
							expr_99F2_cp_0_cp_0.velocity.Y = expr_99F2_cp_0_cp_0.velocity.Y - 1.5f;
							Dust expr_9A0D_cp_0_cp_0 = Main.dust[num150];
							expr_9A0D_cp_0_cp_0.velocity.X = expr_9A0D_cp_0_cp_0.velocity.X * 2.5f;
							Main.dust[num150].scale = 1.3f;
							Main.dust[num150].alpha = 100;
							Main.dust[num150].noGravity = true;
						}
						Main.PlaySound(19, (int)this.position.X, (int)this.position.Y, 1, 1f, 0f);
					}
				}
			}
			if (!flag26)
			{
				this.honeyWet = false;
			}
			if (!this.wet)
			{
				this.lavaWet = false;
				this.honeyWet = false;
			}
			if (this.wetCount > 0)
			{
				this.wetCount -= 1;
			}
			if (this.wetSlime > 0)
			{
				this.wetSlime -= 1;
			}
			if (this.wet && this.mount.Active)
			{
				switch (this.mount.Type)
				{
					case 3:
						this.wetSlime = 30;
						if (this.velocity.Y > 2f)
						{
							this.velocity.Y = this.velocity.Y * 0.9f;
						}
						this.velocity.Y = this.velocity.Y - 0.5f;
						if (this.velocity.Y < -4f)
						{
							this.velocity.Y = -4f;
						}
						break;
					case 5:
					case 7:
						if (this.whoAmI == Main.myPlayer)
						{
							this.mount.Dismount(this);
						}
						break;
				}
			}
			if (Main.expertMode && this.ZoneSnow && this.wet && !this.lavaWet && !this.honeyWet && !this.arcticDivingGear)
			{
				this.AddBuff(46, 150, true);
			}
			float num151 = 1f + Math.Abs(this.velocity.X) / 3f;
			if (this.gfxOffY > 0f)
			{
				this.gfxOffY -= num151 * this.stepSpeed;
				if (this.gfxOffY < 0f)
				{
					this.gfxOffY = 0f;
				}
			}
			else if (this.gfxOffY < 0f)
			{
				this.gfxOffY += num151 * this.stepSpeed;
				if (this.gfxOffY > 0f)
				{
					this.gfxOffY = 0f;
				}
			}
			if (this.gfxOffY > 32f)
			{
				this.gfxOffY = 32f;
			}
			if (this.gfxOffY < -32f)
			{
				this.gfxOffY = -32f;
			}
			if (Main.myPlayer == i && !this.iceSkate)
			{
				this.CheckIceBreak();
			}
			this.SlopeDownMovement();
			bool flag27 = this.mount.Type == 7 || this.mount.Type == 8 || this.mount.Type == 12;
			if (this.velocity.Y == this.gravity && (!this.mount.Active || (!this.mount.Cart && !flag27)))
			{
				Collision.StepDown(ref this.position, ref this.velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.waterWalk || this.waterWalk2);
			}
			if (this.gravDir == -1f)
			{
				if ((this.carpetFrame != -1 || this.velocity.Y <= this.gravity) && !this.controlUp)
				{
					Collision.StepUp(ref this.position, ref this.velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.controlUp, 0);
				}
			}
			else if (flag27 || ((this.carpetFrame != -1 || this.velocity.Y >= this.gravity) && !this.controlDown && !this.mount.Cart))
			{
				Collision.StepUp(ref this.position, ref this.velocity, this.width, this.height, ref this.stepSpeed, ref this.gfxOffY, (int)this.gravDir, this.controlUp, 0);
			}
			this.oldPosition = this.position;
			this.oldDirection = this.direction;
			bool falling = false;
			if (this.velocity.Y > this.gravity)
			{
				falling = true;
			}
			if (this.velocity.Y < -this.gravity)
			{
				falling = true;
			}
			Vector2 velocity = this.velocity;
			this.slideDir = 0;
			bool ignorePlats = false;
			bool fallThrough = this.controlDown;
			if (this.gravDir == -1f || (this.mount.Active && this.mount.Cart) || this.GoingDownWithGrapple)
			{
				ignorePlats = true;
				fallThrough = true;
			}
			this.onTrack = false;
			bool flag28 = false;
			if (this.mount.Active && this.mount.Cart)
			{
				float num152;
				if (!this.ignoreWater && !this.merman)
				{
					if (this.honeyWet)
					{
						num152 = 0.25f;
					}
					else if (this.wet)
					{
						num152 = 0.5f;
					}
					else
					{
						num152 = 1f;
					}
				}
				else
				{
					num152 = 1f;
				}
				this.velocity *= num152;
				DelegateMethods.Minecart.rotation = this.fullRotation;
				DelegateMethods.Minecart.rotationOrigin = this.fullRotationOrigin;
				BitsByte bitsByte = Minecart.TrackCollision(ref this.position, ref this.velocity, ref this.lastBoost, this.width, this.height, this.controlDown, this.controlUp, this.fallStart2, false, this.mount.MinecartDust);
				if (bitsByte[0])
				{
					this.onTrack = true;
					this.gfxOffY = Minecart.TrackRotation(ref this.fullRotation, this.position + this.velocity, this.width, this.height, this.controlDown, this.controlUp, this.mount.MinecartDust);
					this.fullRotationOrigin = new Vector2((float)(this.width / 2), (float)this.height);
				}
				if (bitsByte[1])
				{
					if (this.controlLeft || this.controlRight)
					{
						if (this.cartFlip)
						{
							this.cartFlip = false;
						}
						else
						{
							this.cartFlip = true;
						}
					}
					if (this.velocity.X > 0f)
					{
						this.direction = 1;
					}
					else if (this.velocity.X < 0f)
					{
						this.direction = -1;
					}
					Main.PlaySound(SoundID.Item56, (int)this.position.X + this.width / 2, (int)this.position.Y + this.height / 2);
				}
				this.velocity /= num152;
				if (bitsByte[3] && this.whoAmI == Main.myPlayer)
				{
					flag28 = true;
				}
				if (bitsByte[2])
				{
					this.cartRampTime = (int)(Math.Abs(this.velocity.X) / this.mount.RunSpeed * 20f);
				}
				if (bitsByte[4])
				{
					this.trackBoost -= 4f;
				}
				if (bitsByte[5])
				{
					this.trackBoost += 4f;
				}
			}
			bool flag29 = this.whoAmI == Main.myPlayer && !this.mount.Active && Main.RunningAchievementEnabled;
			Vector2 position = this.position;
			if (this.vortexDebuff)
			{
				this.velocity.Y = this.velocity.Y * 0.8f + (float)Math.Cos((double)(base.Center.X % 120f / 120f * 6.28318548f)) * 5f * 0.2f;
			}
			if (this.tongued)
			{
				this.position += this.velocity;
				flag29 = false;
			}
			else if (this.honeyWet && !this.ignoreWater)
			{
				this.HoneyCollision(fallThrough, ignorePlats);
			}
			else if (this.wet && !this.merman && !this.ignoreWater)
			{
				this.WaterCollision(fallThrough, ignorePlats);
			}
			else
			{
				this.DryCollision(fallThrough, ignorePlats);
				if (this.mount.Active && this.mount.Type == 3 && this.velocity.Y != 0f && !this.SlimeDontHyperJump)
				{
					Vector2 velocity2 = this.velocity;
					this.velocity.X = 0f;
					this.DryCollision(fallThrough, ignorePlats);
					this.velocity.X = velocity2.X;
				}
			}
			this.UpdateTouchingTiles();
			this.TryBouncingBlocks(falling);
			this.TryLandingOnDetonator();
			this.SlopingCollision(fallThrough);
			Collision.StepConveyorBelt(this, this.gravDir);
			if (flag29 && this.velocity.Y == 0f)
			{
				AchievementsHelper.HandleRunning(Math.Abs(this.position.X - position.X));
			}
			if (flag28)
			{
				NetMessage.SendData(13, -1, -1, null, this.whoAmI, 0f, 0f, 0f, 0, 0, 0);
				Minecart.HitTrackSwitch(new Vector2(this.position.X, this.position.Y), this.width, this.height);
			}
			if (velocity.X != this.velocity.X)
			{
				if (velocity.X < 0f)
				{
					this.slideDir = -1;
				}
				else if (velocity.X > 0f)
				{
					this.slideDir = 1;
				}
			}
			if (this.gravDir == 1f && Collision.up)
			{
				this.velocity.Y = 0.01f;
				if (!this.merman)
				{
					this.jump = 0;
				}
			}
			else if (this.gravDir == -1f && Collision.down)
			{
				this.velocity.Y = -0.01f;
				if (!this.merman)
				{
					this.jump = 0;
				}
			}
			if (this.velocity.Y == 0f && this.grappling[0] == -1)
			{
				this.FloorVisuals(falling);
			}
			if (this.whoAmI == Main.myPlayer)
			{
				Collision.SwitchTiles(this.position, this.width, this.height, this.oldPosition, 1);
			}
			PressurePlateHelper.UpdatePlayerPosition(this);
			this.BordersMovement();
			this.numMinions = 0;
			this.slotsMinions = 0f;
			this.ItemCheck_ManageRightClickFeatures();
			this.ItemCheckWrapped(i);
			this.PlayerFrame();
			if (this.mount.Type == 8)
			{
				this.mount.UseDrill(this);
			}
			if (this.statLife > this.statLifeMax2)
			{
				this.statLife = this.statLifeMax2;
			}
			if (this.statMana > this.statManaMax2)
			{
				this.statMana = this.statManaMax2;
			}
			this.grappling[0] = -1;
			this.grapCount = 0;
			this.releaseUseTile = !this.tileInteractAttempted;
		}

		// Token: 0x060003AD RID: 941 RVA: 0x00258C9C File Offset: 0x00256E9C
		private void UpdateArmorLights()
		{
			if (this.vortexStealthActive)
			{
				return;
			}
			float num = 0f;
			float num2 = 0f;
			float num3 = 0f;
			int num4 = this.head;
			if (num4 <= 171)
			{
				if (num4 != 11)
				{
					switch (num4)
					{
						case 169:
							num = 0f;
							num2 = 0.36f;
							num3 = 0.4f;
							break;
						case 170:
							num = 0.4f;
							num2 = 0.16f;
							num3 = 0.36f;
							break;
						case 171:
							num = 0.5f;
							num2 = 0.25f;
							num3 = 0.05f;
							break;
					}
				}
				else
				{
					num = 0.92f;
					num2 = 0.8f;
					num3 = 0.65f;
				}
			}
			else if (num4 != 178)
			{
				if (num4 != 189)
				{
					if (num4 == 211)
					{
						num = 0.2f;
						num2 = 0.4f;
						num3 = 0.8f;
					}
				}
				else
				{
					num = 0.9f;
					num2 = 0.9f;
					num3 = 0.7f;
				}
			}
			else
			{
				num = 0.1f;
				num2 = 0.2f;
				num3 = 0.3f;
			}
			float num5 = 0f;
			float num6 = 0f;
			float num7 = 0f;
			num4 = this.body;
			switch (num4)
			{
				case 175:
					num5 = 0f;
					num6 = 0.36f;
					num7 = 0.4f;
					break;
				case 176:
					num5 = 0.4f;
					num6 = 0.16f;
					num7 = 0.36f;
					break;
				case 177:
					num5 = 0.5f;
					num6 = 0.25f;
					num7 = 0.05f;
					break;
				default:
					if (num4 != 190)
					{
						if (num4 == 205)
						{
							num5 = 0.2f;
							num6 = 0.4f;
							num7 = 0.8f;
						}
					}
					else
					{
						num = 0.9f;
						num2 = 0.9f;
						num3 = 0.7f;
					}
					break;
			}
			float num8 = 0f;
			float num9 = 0f;
			float num10 = 0f;
			num4 = this.legs;
			switch (num4)
			{
				case 110:
					num8 = 0f;
					num9 = 0.36f;
					num10 = 0.4f;
					break;
				case 111:
					num8 = 0.4f;
					num9 = 0.16f;
					num10 = 0.36f;
					break;
				case 112:
					num8 = 0.5f;
					num9 = 0.25f;
					num10 = 0.05f;
					break;
				default:
					if (num4 == 130)
					{
						num = 0.9f;
						num2 = 0.9f;
						num3 = 0.7f;
					}
					break;
			}
			if (num != 0f || num2 != 0f || num3 != 0f)
			{
				float num11 = 1f;
				if (num == num5 && num2 == num6 && num3 == num7)
				{
					num11 += 0.5f;
				}
				if (num == num8 && num2 == num9 && num3 == num10)
				{
					num11 += 0.5f;
				}
				Vector2 vector = new Vector2((float)(this.width / 2 + 8 * this.direction), 2f);
				if (this.fullRotation != 0f)
				{
					vector = vector.RotatedBy((double)this.fullRotation, this.fullRotationOrigin);
				}
				int arg_314_0 = (int)(this.position.X + vector.X) / 16;
				int j = (int)(this.position.Y + vector.Y) / 16;
				Lighting.AddLight(arg_314_0, j, num * num11, num2 * num11, num3 * num11);
			}
			if (num5 != 0f || num6 != 0f || num7 != 0f)
			{
				float num12 = 1f;
				if (num5 == num && num6 == num2 && num7 == num3)
				{
					num12 += 0.5f;
				}
				if (num5 == num8 && num6 == num9 && num7 == num10)
				{
					num12 += 0.5f;
				}
				Vector2 vector2 = new Vector2((float)(this.width / 2 + 8), (float)(this.height / 2));
				if (this.fullRotation != 0f)
				{
					vector2 = vector2.RotatedBy((double)this.fullRotation, this.fullRotationOrigin);
				}
				int arg_3EE_0 = (int)(this.position.X + vector2.X) / 16;
				int j2 = (int)(this.position.Y + vector2.Y) / 16;
				Lighting.AddLight(arg_3EE_0, j2, num5 * num12, num6 * num12, num7 * num12);
			}
			if (num8 != 0f || num9 != 0f || num10 != 0f)
			{
				float num13 = 1f;
				if (num8 == num5 && num9 == num6 && num10 == num7)
				{
					num13 += 0.5f;
				}
				if (num8 == num && num9 == num2 && num10 == num3)
				{
					num13 += 0.5f;
				}
				Vector2 vector3 = new Vector2((float)(this.width / 2 + 8 * this.direction), (float)this.height * 0.75f);
				if (this.fullRotation != 0f)
				{
					vector3 = vector3.RotatedBy((double)this.fullRotation, this.fullRotationOrigin);
				}
				int arg_4D6_0 = (int)(this.position.X + vector3.X) / 16;
				int j3 = (int)(this.position.Y + vector3.Y) / 16;
				Lighting.AddLight(arg_4D6_0, j3, num8 * num13, num9 * num13, num10 * num13);
			}
		}

		// Token: 0x06000379 RID: 889 RVA: 0x002388BC File Offset: 0x00236ABC
		public void UpdateArmorSets(int i)
		{
			this.setBonus = "";
			if (this.body == 67 && this.legs == 56 && this.head >= 103 && this.head <= 105)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Shroomite");
				this.shroomiteStealth = true;
			}
			if ((this.head == 52 && this.body == 32 && this.legs == 31) || (this.head == 53 && this.body == 33 && this.legs == 32) || (this.head == 54 && this.body == 34 && this.legs == 33) || (this.head == 55 && this.body == 35 && this.legs == 34) || (this.head == 70 && this.body == 46 && this.legs == 42) || (this.head == 71 && this.body == 47 && this.legs == 43) || (this.head == 166 && this.body == 173 && this.legs == 108) || (this.head == 167 && this.body == 174 && this.legs == 109))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Wood");
				this.statDefense++;
			}
			if ((this.head == 1 && this.body == 1 && this.legs == 1) || ((this.head == 72 || this.head == 2) && this.body == 2 && this.legs == 2) || (this.head == 47 && this.body == 28 && this.legs == 27))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.MetalTier1");
				this.statDefense += 2;
			}
			if ((this.head == 3 && this.body == 3 && this.legs == 3) || ((this.head == 73 || this.head == 4) && this.body == 4 && this.legs == 4) || (this.head == 48 && this.body == 29 && this.legs == 28) || (this.head == 49 && this.body == 30 && this.legs == 29))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.MetalTier2");
				this.statDefense += 3;
			}
			if (this.head == 188 && this.body == 189 && this.legs == 129)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Fossil");
				this.thrownCost50 = true;
			}
			if (this.head == 50 && this.body == 31 && this.legs == 30)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Platinum");
				this.statDefense += 4;
			}
			if (this.head == 112 && this.body == 75 && this.legs == 64)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Pumpkin");
				this.meleeDamage += 0.1f;
				this.magicDamage += 0.1f;
				this.rangedDamage += 0.1f;
				this.thrownDamage += 0.1f;
			}
			if (this.head == 22 && this.body == 14 && this.legs == 14)
			{
				this.thrownCost33 = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Ninja");
			}
			if (this.head == 157 && this.body == 105 && this.legs == 98)
			{
				int num = 0;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.BeetleDamage");
				this.beetleOffense = true;
				this.beetleCounter -= 3f;
				this.beetleCounter -= (float)(this.beetleCountdown / 10);
				this.beetleCountdown++;
				if (this.beetleCounter < 0f)
				{
					this.beetleCounter = 0f;
				}
				int num2 = 400;
				int num3 = 1200;
				int num4 = 4600;
				if (this.beetleCounter > (float)(num2 + num3 + num4 + num3))
				{
					this.beetleCounter = (float)(num2 + num3 + num4 + num3);
				}
				if (this.beetleCounter > (float)(num2 + num3 + num4))
				{
					this.AddBuff(100, 5, false);
					num = 3;
				}
				else if (this.beetleCounter > (float)(num2 + num3))
				{
					this.AddBuff(99, 5, false);
					num = 2;
				}
				else if (this.beetleCounter > (float)num2)
				{
					this.AddBuff(98, 5, false);
					num = 1;
				}
				if (num < this.beetleOrbs)
				{
					this.beetleCountdown = 0;
				}
				else if (num > this.beetleOrbs)
				{
					this.beetleCounter += 200f;
				}
				if (num != this.beetleOrbs && this.beetleOrbs > 0)
				{
					for (int j = 0; j < 22; j++)
					{
						if (this.buffType[j] >= 98 && this.buffType[j] <= 100 && this.buffType[j] != 97 + num)
						{
							this.DelBuff(j);
						}
					}
				}
			}
			else if (this.head == 157 && this.body == 106 && this.legs == 98)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.BeetleDefense");
				this.beetleDefense = true;
				this.beetleCounter += 1f;
				int num5 = 180;
				if (this.beetleCounter >= (float)num5)
				{
					if (this.beetleOrbs > 0 && this.beetleOrbs < 3)
					{
						for (int k = 0; k < 22; k++)
						{
							if (this.buffType[k] >= 95 && this.buffType[k] <= 96)
							{
								this.DelBuff(k);
							}
						}
					}
					if (this.beetleOrbs < 3)
					{
						this.AddBuff(95 + this.beetleOrbs, 5, false);
						this.beetleCounter = 0f;
					}
					else
					{
						this.beetleCounter = (float)num5;
					}
				}
			}
			if (!this.beetleDefense && !this.beetleOffense)
			{
				this.beetleCounter = 0f;
			}
			else
			{
				this.beetleFrameCounter++;
				if (this.beetleFrameCounter >= 1)
				{
					this.beetleFrameCounter = 0;
					this.beetleFrame++;
					if (this.beetleFrame > 2)
					{
						this.beetleFrame = 0;
					}
				}
				for (int l = this.beetleOrbs; l < 3; l++)
				{
					this.beetlePos[l].X = 0f;
					this.beetlePos[l].Y = 0f;
				}
				for (int m = 0; m < this.beetleOrbs; m++)
				{
					this.beetlePos[m] += this.beetleVel[m];
					Vector2[] expr_702_cp_0_cp_0 = this.beetleVel;
					int expr_702_cp_0_cp_1 = m;
					expr_702_cp_0_cp_0[expr_702_cp_0_cp_1].X = expr_702_cp_0_cp_0[expr_702_cp_0_cp_1].X + (float)Main.rand.Next(-100, 101) * 0.005f;
					Vector2[] expr_72D_cp_0_cp_0 = this.beetleVel;
					int expr_72D_cp_0_cp_1 = m;
					expr_72D_cp_0_cp_0[expr_72D_cp_0_cp_1].Y = expr_72D_cp_0_cp_0[expr_72D_cp_0_cp_1].Y + (float)Main.rand.Next(-100, 101) * 0.005f;
					float num6 = this.beetlePos[m].X;
					float num7 = this.beetlePos[m].Y;
					float num8 = (float)Math.Sqrt((double)(num6 * num6 + num7 * num7));
					if (num8 > 100f)
					{
						num8 = 20f / num8;
						num6 *= -num8;
						num7 *= -num8;
						int num9 = 10;
						this.beetleVel[m].X = (this.beetleVel[m].X * (float)(num9 - 1) + num6) / (float)num9;
						this.beetleVel[m].Y = (this.beetleVel[m].Y * (float)(num9 - 1) + num7) / (float)num9;
					}
					else if (num8 > 30f)
					{
						num8 = 10f / num8;
						num6 *= -num8;
						num7 *= -num8;
						int num10 = 20;
						this.beetleVel[m].X = (this.beetleVel[m].X * (float)(num10 - 1) + num6) / (float)num10;
						this.beetleVel[m].Y = (this.beetleVel[m].Y * (float)(num10 - 1) + num7) / (float)num10;
					}
					num6 = this.beetleVel[m].X;
					num7 = this.beetleVel[m].Y;
					num8 = (float)Math.Sqrt((double)(num6 * num6 + num7 * num7));
					if (num8 > 2f)
					{
						this.beetleVel[m] *= 0.9f;
					}
					this.beetlePos[m] -= this.velocity * 0.25f;
				}
			}
			if (this.head == 14 && ((this.body >= 58 && this.body <= 63) || this.body == 167))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Wizard");
				this.magicCrit += 10;
			}
			if (this.head == 159 && ((this.body >= 58 && this.body <= 63) || this.body == 167))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.MagicHat");
				this.statManaMax2 += 60;
			}
			if ((this.head == 5 || this.head == 74) && (this.body == 5 || this.body == 48) && (this.legs == 5 || this.legs == 44))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.ShadowScale");
				this.moveSpeed += 0.15f;
			}
			if (this.head == 57 && this.body == 37 && this.legs == 35)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Crimson");
				this.crimsonRegen = true;
			}
			if (this.head == 101 && this.body == 66 && this.legs == 55)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.SpectreHealing");
				this.ghostHeal = true;
			}
			if (this.head == 156 && this.body == 66 && this.legs == 55)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.SpectreDamage");
				this.ghostHurt = true;
			}
			if (this.head == 6 && this.body == 6 && this.legs == 6)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Meteor");
				this.spaceGun = true;
			}
			if (this.head == 46 && this.body == 27 && this.legs == 26)
			{
				this.frostArmor = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Frost");
				this.frostBurn = true;
			}
			if ((this.head == 75 || this.head == 7) && this.body == 7 && this.legs == 7)
			{
				this.boneArmor = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Bone");
				this.ammoCost80 = true;
			}
			if ((this.head == 76 || this.head == 8) && (this.body == 49 || this.body == 8) && (this.legs == 45 || this.legs == 8))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Jungle");
				this.manaCost -= 0.16f;
			}
			if (this.head == 9 && this.body == 9 && this.legs == 9)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Molten");
				this.meleeDamage += 0.17f;
			}
			if (this.head == 11 && this.body == 20 && this.legs == 19)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Mining");
				this.pickSpeed -= 0.3f;
			}
			if ((this.head == 78 || this.head == 79 || this.head == 80) && this.body == 51 && this.legs == 47)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Chlorophyte");
				this.AddBuff(60, 18000, true);
			}
			else if (this.crystalLeaf)
			{
				for (int n = 0; n < 22; n++)
				{
					if (this.buffType[n] == 60)
					{
						this.DelBuff(n);
					}
				}
			}
			if (this.head == 99 && this.body == 65 && this.legs == 54)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Turtle");
				this.thorns = 1f;
				this.turtleThorns = true;
			}
			if (this.body == 17 && this.legs == 16)
			{
				if (this.head == 29)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.CobaltCaster");
					this.manaCost -= 0.14f;
				}
				else if (this.head == 30)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.CobaltMelee");
					this.meleeSpeed += 0.15f;
				}
				else if (this.head == 31)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.CobaltRanged");
					this.ammoCost80 = true;
				}
			}
			if (this.body == 18 && this.legs == 17)
			{
				if (this.head == 32)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.MythrilCaster");
					this.manaCost -= 0.17f;
				}
				else if (this.head == 33)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.MythrilMelee");
					this.meleeCrit += 5;
				}
				else if (this.head == 34)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.MythrilRanged");
					this.ammoCost80 = true;
				}
			}
			if (this.body == 19 && this.legs == 18)
			{
				if (this.head == 35)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.AdamantiteCaster");
					this.manaCost -= 0.19f;
				}
				else if (this.head == 36)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.AdamantiteMelee");
					this.meleeSpeed += 0.18f;
					this.moveSpeed += 0.18f;
				}
				else if (this.head == 37)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.AdamantiteRanged");
					this.ammoCost75 = true;
				}
			}
			if (this.body == 54 && this.legs == 49 && (this.head == 83 || this.head == 84 || this.head == 85))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Palladium");
				this.onHitRegen = true;
			}
			if (this.body == 55 && this.legs == 50 && (this.head == 86 || this.head == 87 || this.head == 88))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Orichalcum");
				this.onHitPetal = true;
			}
			if (this.body == 56 && this.legs == 51 && (this.head == 89 || this.head == 90 || this.head == 91))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Titanium");
				this.onHitDodge = true;
			}
			if (this.body == 24 && this.legs == 23)
			{
				if (this.head == 42)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.HallowCaster");
					this.manaCost -= 0.2f;
				}
				else if (this.head == 43)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.HallowMelee");
					this.meleeSpeed += 0.19f;
					this.moveSpeed += 0.19f;
				}
				else if (this.head == 41)
				{
					this.setBonus = Language.GetTextValue("ArmorSetBonus.HallowRanged");
					this.ammoCost75 = true;
				}
			}
			if (this.head == 82 && this.body == 53 && this.legs == 48)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Tiki");
				this.maxMinions++;
			}
			if (this.head == 134 && this.body == 95 && this.legs == 79)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Spooky");
				this.minionDamage += 0.25f;
			}
			if (this.head == 160 && this.body == 168 && this.legs == 103)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Bee");
				this.minionDamage += 0.1f;
				if (this.itemAnimation > 0 && this.inventory[this.selectedItem].type == 1121)
				{
					AchievementsHelper.HandleSpecialEvent(this, 3);
				}
			}
			if (this.head == 162 && this.body == 170 && this.legs == 105)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Spider");
				this.minionDamage += 0.12f;
			}
			if (this.head == 171 && this.body == 177 && this.legs == 112)
			{
				this.setSolar = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Solar");
				this.solarCounter++;
				int num11 = 240;
				if (this.solarCounter >= num11)
				{
					if (this.solarShields > 0 && this.solarShields < 3)
					{
						for (int num12 = 0; num12 < 22; num12++)
						{
							if (this.buffType[num12] >= 170 && this.buffType[num12] <= 171)
							{
								this.DelBuff(num12);
							}
						}
					}
					if (this.solarShields < 3)
					{
						this.AddBuff(170 + this.solarShields, 5, false);
						for (int num13 = 0; num13 < 16; num13++)
						{
							Dust expr_12BD = Main.dust[Dust.NewDust(this.position, this.width, this.height, 6, 0f, 0f, 100, default(Color), 1f)];
							expr_12BD.noGravity = true;
							expr_12BD.scale = 1.7f;
							expr_12BD.fadeIn = 0.5f;
							expr_12BD.velocity *= 5f;
							expr_12BD.shader = GameShaders.Armor.GetSecondaryShader(this.ArmorSetDye(), this);
						}
						this.solarCounter = 0;
					}
					else
					{
						this.solarCounter = num11;
					}
				}
				for (int num14 = this.solarShields; num14 < 3; num14++)
				{
					this.solarShieldPos[num14] = Vector2.Zero;
				}
				for (int num15 = 0; num15 < this.solarShields; num15++)
				{
					this.solarShieldPos[num15] += this.solarShieldVel[num15];
					Vector2 value = ((float)this.miscCounter / 100f * 6.28318548f + (float)num15 * (6.28318548f / (float)this.solarShields)).ToRotationVector2() * 6f;
					value.X = (float)(this.direction * 20);
					this.solarShieldVel[num15] = (value - this.solarShieldPos[num15]) * 0.2f;
				}
				if (this.dashDelay >= 0)
				{
					this.solarDashing = false;
					this.solarDashConsumedFlare = false;
				}
				bool flag = this.solarDashing && this.dashDelay < 0;
				if (this.solarShields > 0 | flag)
				{
					this.dash = 3;
				}
			}
			else
			{
				this.solarCounter = 0;
			}
			if (this.head == 169 && this.body == 175 && this.legs == 110)
			{
				this.setVortex = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Vortex", Language.GetTextValue(Main.ReversedUpDownArmorSetBonuses ? "Key.UP" : "Key.DOWN"));
			}
			else
			{
				this.vortexStealthActive = false;
			}
			if (this.head == 170 && this.body == 176 && this.legs == 111)
			{
				if (this.nebulaCD > 0)
				{
					this.nebulaCD--;
				}
				this.setNebula = true;
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Nebula");
			}
			if (this.head == 189 && this.body == 190 && this.legs == 130)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Stardust", Language.GetTextValue(Main.ReversedUpDownArmorSetBonuses ? "Key.UP" : "Key.DOWN"));
				this.setStardust = true;
				if (this.whoAmI == Main.myPlayer)
				{
					if (this.FindBuffIndex(187) == -1)
					{
						this.AddBuff(187, 3600, true);
					}
					if (this.ownedProjectileCounts[623] < 1)
					{
						Projectile.NewProjectile(base.Center.X, base.Center.Y, 0f, -1f, 623, 0, 0f, Main.myPlayer, 0f, 0f);
					}
				}
			}
			else if (this.FindBuffIndex(187) != -1)
			{
				this.DelBuff(this.FindBuffIndex(187));
			}
			if (this.head == 200 && this.body == 198 && this.legs == 142)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.Forbidden", Language.GetTextValue(Main.ReversedUpDownArmorSetBonuses ? "Key.UP" : "Key.DOWN"));
				this.setForbidden = true;
				this.UpdateForbiddenSetLock();
				Lighting.AddLight(base.Center, 0.8f, 0.7f, 0.2f);
			}
			if (this.head == 204 && this.body == 201 && this.legs == 145)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.SquireTier2");
				this.setSquireT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 203 && this.body == 200 && this.legs == 144)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.ApprenticeTier2");
				this.setApprenticeT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 205 && this.body == 202 && (this.legs == 147 || this.legs == 146))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.HuntressTier2");
				this.setHuntressT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 206 && this.body == 203 && this.legs == 148)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.MonkTier2");
				this.setMonkT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 210 && this.body == 204 && this.legs == 152)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.SquireTier3");
				this.setSquireT3 = true;
				this.setSquireT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 211 && this.body == 205 && this.legs == 153)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.ApprenticeTier3");
				this.setApprenticeT3 = true;
				this.setApprenticeT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 212 && this.body == 206 && (this.legs == 154 || this.legs == 155))
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.HuntressTier3");
				this.setHuntressT3 = true;
				this.setHuntressT2 = true;
				this.maxTurrets++;
			}
			if (this.head == 213 && this.body == 207 && this.legs == 156)
			{
				this.setBonus = Language.GetTextValue("ArmorSetBonus.MonkTier3");
				this.setMonkT3 = true;
				this.setMonkT2 = true;
				this.maxTurrets++;
			}
		}

		// Token: 0x0600037C RID: 892 RVA: 0x0023A5A4 File Offset: 0x002387A4
		public void UpdateBiomes()
		{
			Point point = base.Center.ToTileCoordinates();
			this.ZoneDungeon = false;
			if (Main.dungeonTiles >= 250 && (double)base.Center.Y > Main.worldSurface * 16.0)
			{
				int num = (int)base.Center.X / 16;
				int num2 = (int)base.Center.Y / 16;
				if (Main.wallDungeon[(int)Main.tile[num, num2].wall])
				{
					this.ZoneDungeon = true;
				}
			}
			Tile tileSafely = Framing.GetTileSafely(base.Center);
			if (tileSafely != null)
			{
				this.behindBackWall = (tileSafely.wall > 0);
			}
			if (Main.sandTiles > 1000 && base.Center.Y > 3200f)
			{
				if (WallID.Sets.Conversion.Sandstone[(int)tileSafely.wall] || WallID.Sets.Conversion.HardenedSand[(int)tileSafely.wall])
				{
					this.ZoneUndergroundDesert = true;
				}
			}
			else
			{
				this.ZoneUndergroundDesert = false;
			}
			this.ZoneCorrupt = (Main.evilTiles >= 200);
			this.ZoneHoly = (Main.holyTiles >= 100);
			this.ZoneMeteor = (Main.meteorTiles >= 50);
			this.ZoneJungle = (Main.jungleTiles >= 80);
			this.ZoneSnow = (Main.snowTiles >= 300);
			this.ZoneCrimson = (Main.bloodTiles >= 200);
			this.ZoneWaterCandle = (Main.waterCandles > 0);
			this.ZonePeaceCandle = (Main.peaceCandles > 0);
			this.ZoneDesert = (Main.sandTiles > 1000);
			this.ZoneGlowshroom = (Main.shroomTiles > 100);
			this.ZoneUnderworldHeight = (point.Y > Main.maxTilesY - 200);
			this.ZoneRockLayerHeight = (point.Y <= Main.maxTilesY - 200 && (double)point.Y > Main.rockLayer);
			this.ZoneDirtLayerHeight = ((double)point.Y <= Main.rockLayer && (double)point.Y > Main.worldSurface);
			this.ZoneOverworldHeight = ((double)point.Y <= Main.worldSurface && (double)point.Y > Main.worldSurface * 0.34999999403953552);
			this.ZoneSkyHeight = ((double)point.Y <= Main.worldSurface * 0.34999999403953552);
			this.ZoneBeach = (this.ZoneOverworldHeight && (point.X < 380 || point.X > Main.maxTilesX - 380));
			this.ZoneRain = (Main.raining && (double)point.Y <= Main.worldSurface);
			this.ZoneSandstorm = ((double)point.Y <= Main.worldSurface && this.ZoneDesert && !this.ZoneBeach && Sandstorm.Happening);
			this.ZoneTowerSolar = (this.ZoneTowerVortex = (this.ZoneTowerNebula = (this.ZoneTowerStardust = false)));
			this.ZoneOldOneArmy = false;
			Vector2 value = Vector2.Zero;
			Vector2 value2 = Vector2.Zero;
			Vector2 value3 = Vector2.Zero;
			Vector2 value4 = Vector2.Zero;
			Vector2 arg_321_0 = Vector2.Zero;
			for (int i = 0; i < 200; i++)
			{
				if (Main.npc[i].active)
				{
					if (Main.npc[i].type == 493)
					{
						if (base.Distance(Main.npc[i].Center) <= 4000f)
						{
							this.ZoneTowerStardust = true;
							value4 = Main.npc[i].Center;
						}
					}
					else if (Main.npc[i].type == 507)
					{
						if (base.Distance(Main.npc[i].Center) <= 4000f)
						{
							this.ZoneTowerNebula = true;
							value3 = Main.npc[i].Center;
						}
					}
					else if (Main.npc[i].type == 422)
					{
						if (base.Distance(Main.npc[i].Center) <= 4000f)
						{
							this.ZoneTowerVortex = true;
							value2 = Main.npc[i].Center;
						}
					}
					else if (Main.npc[i].type == 517)
					{
						if (base.Distance(Main.npc[i].Center) <= 4000f)
						{
							this.ZoneTowerSolar = true;
							value = Main.npc[i].Center;
						}
					}
					else if (Main.npc[i].type == 549 && base.Distance(Main.npc[i].Center) <= 4000f)
					{
						this.ZoneOldOneArmy = true;
						value = Main.npc[i].Center;
					}
				}
			}
			bool flag = this.ZoneRain && this.ZoneSnow;
			bool flag2 = point.Y > Main.maxTilesY - 320;
			bool flag3 = this.ZoneOverworldHeight && (point.X < 380 || point.X > Main.maxTilesX - 380);
			this.ManageSpecialBiomeVisuals("Stardust", this.ZoneTowerStardust, value4 - new Vector2(0f, 10f));
			this.ManageSpecialBiomeVisuals("Nebula", this.ZoneTowerNebula, value3 - new Vector2(0f, 10f));
			this.ManageSpecialBiomeVisuals("Vortex", this.ZoneTowerVortex, value2 - new Vector2(0f, 10f));
			this.ManageSpecialBiomeVisuals("Solar", this.ZoneTowerSolar, value - new Vector2(0f, 10f));
			this.ManageSpecialBiomeVisuals("MoonLord", NPC.AnyNPCs(398), default(Vector2));
			this.ManageSpecialBiomeVisuals("BloodMoon", Main.bloodMoon, default(Vector2));
			this.ManageSpecialBiomeVisuals("Blizzard", Main.UseStormEffects & flag, default(Vector2));
			this.ManageSpecialBiomeVisuals("HeatDistortion", Main.UseHeatDistortion && (flag2 || ((double)point.Y < Main.worldSurface && this.ZoneDesert && !flag3 && !Main.raining && !Filters.Scene["Sandstorm"].IsActive())), default(Vector2));
			if (!Filters.Scene["WaterDistortion"].IsActive() && Main.WaveQuality > 0)
			{
				Filters.Scene.Activate("WaterDistortion", default(Vector2), new object[0]);
			}
			else if (Filters.Scene["WaterDistortion"].IsActive() && Main.WaveQuality == 0)
			{
				Filters.Scene.Deactivate("WaterDistortion", new object[0]);
			}
			if (Filters.Scene["WaterDistortion"].IsActive())
			{
				float arg_75B_0 = (float)Main.maxTilesX * 0.5f - Math.Abs((float)point.X - (float)Main.maxTilesX * 0.5f);
				float num3 = 1f;
				float num4 = Math.Abs(Main.windSpeed);
				num3 += num4 * 1f;
				float num5 = MathHelper.Clamp(Main.maxRaining, 0f, 1f);
				num3 += num5 * 1.5f;
				float num6 = -(MathHelper.Clamp((arg_75B_0 - 380f) / 100f, 0f, 1f) * 0.5f - 0.25f);
				num3 += num6;
				float num7 = 1f - MathHelper.Clamp(3f * ((float)((double)point.Y - Main.worldSurface) / (float)(Main.rockLayer - Main.worldSurface)), 0f, 1f);
				num3 *= num7;
				float num8 = 0.9f - MathHelper.Clamp((float)(Main.maxTilesY - point.Y - 200) / 300f, 0f, 1f) * 0.9f;
				num3 += num8;
				num3 += (1f - num7) * 0.75f;
				num3 = MathHelper.Clamp(num3, 0f, 2.5f);
				Filters.Scene["WaterDistortion"].GetShader().UseIntensity(num3);
			}
			if (flag2)
			{
				float num9 = (float)(point.Y - (Main.maxTilesY - 320)) / 120f;
				num9 = Math.Min(1f, num9) * 2f;
				Filters.Scene["HeatDistortion"].GetShader().UseIntensity(num9);
			}
			this._shaderObstructionInternalValue = Utils.Clamp<float>(this._shaderObstructionInternalValue + (float)this.behindBackWall.ToDirectionInt() * -0.005f, -0.1f, 1.1f);
			this._stormShaderObstruction = Utils.Clamp<float>(this._shaderObstructionInternalValue, 0f, 1f);
			if (Filters.Scene["Sandstorm"].IsActive())
			{
				Filters.Scene["Sandstorm"].GetShader().UseIntensity(this._stormShaderObstruction * 0.4f * Math.Min(1f, Sandstorm.Severity));
				Filters.Scene["Sandstorm"].GetShader().UseOpacity(Math.Min(1f, Sandstorm.Severity * 1.5f) * this._stormShaderObstruction);
				((SimpleOverlay)Overlays.Scene["Sandstorm"]).GetShader().UseOpacity(Math.Min(1f, Sandstorm.Severity * 1.5f) * (1f - this._stormShaderObstruction));
			}
			else if (this.ZoneDesert && !flag3 && !Main.raining && !flag2)
			{
				Vector3 vector = Main.tileColor.ToVector3();
				float num10 = (vector.X + vector.Y + vector.Z) / 3f;
				float num11 = this._stormShaderObstruction * 4f * Math.Max(0f, 0.5f - Main.cloudAlpha) * num10;
				Filters.Scene["HeatDistortion"].GetShader().UseIntensity(num11);
				if (num11 <= 0f)
				{
					Filters.Scene["HeatDistortion"].IsHidden = true;
				}
				else
				{
					Filters.Scene["HeatDistortion"].IsHidden = false;
				}
			}
			if (flag)
			{
				bool arg_A8B_0 = Main.GetActiveSound(Player._strongBlizzardSound) != null;
				ActiveSound activeSound = Main.GetActiveSound(Player._insideBlizzardSound);
				if (!arg_A8B_0)
				{
					Player._strongBlizzardSound = Main.PlayTrackedSound(SoundID.BlizzardStrongLoop);
				}
				if (activeSound == null)
				{
					Player._insideBlizzardSound = Main.PlayTrackedSound(SoundID.BlizzardInsideBuildingLoop);
				}
				Main.GetActiveSound(Player._strongBlizzardSound);
				activeSound = Main.GetActiveSound(Player._insideBlizzardSound);
				float num12 = Math.Min(1f, Main.cloudAlpha * 2f) * this._stormShaderObstruction;
				Filters.Scene["Blizzard"].GetShader().UseIntensity(this._stormShaderObstruction * 0.4f * Math.Min(1f, Main.cloudAlpha * 2f) * 0.9f + 0.1f);
				Filters.Scene["Blizzard"].GetShader().UseOpacity(num12);
				((SimpleOverlay)Overlays.Scene["Blizzard"]).GetShader().UseOpacity(1f - num12);
			}
			if (flag)
			{
				Player._blizzardSoundVolume = Math.Min(Player._blizzardSoundVolume + 0.01f, 1f);
			}
			else
			{
				Player._blizzardSoundVolume = Math.Max(Player._blizzardSoundVolume - 0.01f, 0f);
			}
			float num13 = Math.Min(1f, Main.cloudAlpha * 2f) * this._stormShaderObstruction;
			ActiveSound activeSound2 = Main.GetActiveSound(Player._strongBlizzardSound);
			ActiveSound activeSound3 = Main.GetActiveSound(Player._insideBlizzardSound);
			if (Player._blizzardSoundVolume > 0f)
			{
				if (activeSound2 == null)
				{
					Player._strongBlizzardSound = Main.PlayTrackedSound(SoundID.BlizzardStrongLoop);
					activeSound2 = Main.GetActiveSound(Player._strongBlizzardSound);
				}
				activeSound2.Volume = num13 * Player._blizzardSoundVolume;
				if (activeSound3 == null)
				{
					Player._insideBlizzardSound = Main.PlayTrackedSound(SoundID.BlizzardInsideBuildingLoop);
					activeSound3 = Main.GetActiveSound(Player._insideBlizzardSound);
				}
				activeSound3.Volume = (1f - num13) * Player._blizzardSoundVolume;
			}
			else
			{
				if (activeSound2 != null)
				{
					activeSound2.Volume = 0f;
				}
				else
				{
					Player._strongBlizzardSound = SlotId.Invalid;
				}
				if (activeSound3 != null)
				{
					activeSound3.Volume = 0f;
				}
				else
				{
					Player._insideBlizzardSound = SlotId.Invalid;
				}
			}
			if (!this.dead)
			{
				Point point2 = base.Center.ToTileCoordinates();
				if (WorldGen.InWorld(point2.X, point2.Y, 1))
				{
					int num14 = 0;
					if (Main.tile[point2.X, point2.Y] != null)
					{
						num14 = (int)Main.tile[point2.X, point2.Y].wall;
					}
					if (num14 != 62)
					{
						if (num14 == 86)
						{
							AchievementsHelper.HandleSpecialEvent(this, 12);
						}
					}
					else
					{
						AchievementsHelper.HandleSpecialEvent(this, 13);
					}
				}
				if (this._funkytownCheckCD > 0)
				{
					this._funkytownCheckCD--;
				}
				if (this.position.Y / 16f > (float)(Main.maxTilesY - 200))
				{
					AchievementsHelper.HandleSpecialEvent(this, 14);
					return;
				}
				if (this._funkytownCheckCD == 0 && (double)(this.position.Y / 16f) < Main.worldSurface && Main.shroomTiles >= 200)
				{
					AchievementsHelper.HandleSpecialEvent(this, 15);
					return;
				}
			}
			else
			{
				this._funkytownCheckCD = 100;
			}
		}

		// Token: 0x06000371 RID: 881 RVA: 0x0022EFEC File Offset: 0x0022D1EC
		public void UpdateBuffs(int i)
		{
			if (this.soulDrain > 0 && this.whoAmI == Main.myPlayer)
			{
				this.AddBuff(151, 2, true);
			}
			for (int j = 0; j < 1000; j++)
			{
				if (Main.projectile[j].active && Main.projectile[j].owner == i)
				{
					this.ownedProjectileCounts[Main.projectile[j].type]++;
				}
			}
			for (int k = 0; k < 22; k++)
			{
				if (this.buffType[k] > 0 && this.buffTime[k] > 0)
				{
					if (this.whoAmI == Main.myPlayer && this.buffType[k] != 28)
					{
						this.buffTime[k]--;
					}
					if (this.buffType[k] == 1)
					{
						this.lavaImmune = true;
						this.fireWalk = true;
						this.buffImmune[24] = true;
					}
					else if (this.buffType[k] == 158)
					{
						this.manaRegenBonus += 2;
					}
					else if (this.buffType[k] == 159 && this.inventory[this.selectedItem].melee)
					{
						this.armorPenetration = 4;
					}
					else if (this.buffType[k] == 2)
					{
						this.lifeRegen += 4;
					}
					else if (this.buffType[k] == 3)
					{
						this.moveSpeed += 0.25f;
					}
					else if (this.buffType[k] == 4)
					{
						this.gills = true;
					}
					else if (this.buffType[k] == 5)
					{
						this.statDefense += 8;
					}
					else if (this.buffType[k] == 6)
					{
						this.manaRegenBuff = true;
					}
					else if (this.buffType[k] == 7)
					{
						this.magicDamage += 0.2f;
					}
					else if (this.buffType[k] == 8)
					{
						this.slowFall = true;
					}
					else if (this.buffType[k] == 9)
					{
						this.findTreasure = true;
					}
					else if (this.buffType[k] == 10)
					{
						this.invis = true;
					}
					else if (this.buffType[k] == 11)
					{
						Lighting.AddLight((int)(this.position.X + (float)(this.width / 2)) / 16, (int)(this.position.Y + (float)(this.height / 2)) / 16, 0.8f, 0.95f, 1f);
					}
					else if (this.buffType[k] == 12)
					{
						this.nightVision = true;
					}
					else if (this.buffType[k] == 13)
					{
						this.enemySpawns = true;
					}
					else if (this.buffType[k] == 14)
					{
						if (this.thorns < 1f)
						{
							this.thorns = 0.333333343f;
						}
					}
					else if (this.buffType[k] == 15)
					{
						this.waterWalk = true;
					}
					else if (this.buffType[k] == 16)
					{
						this.archery = true;
					}
					else if (this.buffType[k] == 17)
					{
						this.detectCreature = true;
					}
					else if (this.buffType[k] == 18)
					{
						this.gravControl = true;
					}
					else if (this.buffType[k] == 30)
					{
						this.bleed = true;
					}
					else if (this.buffType[k] == 31)
					{
						this.confused = true;
					}
					else if (this.buffType[k] == 32)
					{
						this.slow = true;
					}
					else if (this.buffType[k] == 35)
					{
						this.silence = true;
					}
					else if (this.buffType[k] == 160)
					{
						this.dazed = true;
					}
					else if (this.buffType[k] == 46)
					{
						this.chilled = true;
					}
					else if (this.buffType[k] == 47)
					{
						this.frozen = true;
					}
					else if (this.buffType[k] == 156)
					{
						this.stoned = true;
					}
					else if (this.buffType[k] == 69)
					{
						this.ichor = true;
						this.statDefense -= 20;
					}
					else if (this.buffType[k] == 36)
					{
						this.brokenArmor = true;
					}
					else if (this.buffType[k] == 48)
					{
						this.honey = true;
					}
					else if (this.buffType[k] == 59)
					{
						this.shadowDodge = true;
					}
					else if (this.buffType[k] == 93)
					{
						this.ammoBox = true;
					}
					else if (this.buffType[k] == 58)
					{
						this.palladiumRegen = true;
					}
					else if (this.buffType[k] == 88)
					{
						this.chaosState = true;
					}
					else if (this.buffType[k] == 63)
					{
						this.moveSpeed += 1f;
					}
					else if (this.buffType[k] == 104)
					{
						this.pickSpeed -= 0.25f;
					}
					else if (this.buffType[k] == 105)
					{
						this.lifeMagnet = true;
					}
					else if (this.buffType[k] == 106)
					{
						this.calmed = true;
					}
					else if (this.buffType[k] == 121)
					{
						this.fishingSkill += 15;
					}
					else if (this.buffType[k] == 122)
					{
						this.sonarPotion = true;
					}
					else if (this.buffType[k] == 123)
					{
						this.cratePotion = true;
					}
					else if (this.buffType[k] == 107)
					{
						this.tileSpeed += 0.25f;
						this.wallSpeed += 0.25f;
						this.blockRange++;
					}
					else if (this.buffType[k] == 108)
					{
						this.kbBuff = true;
					}
					else if (this.buffType[k] == 109)
					{
						this.ignoreWater = true;
						this.accFlipper = true;
					}
					else if (this.buffType[k] == 110)
					{
						this.maxMinions++;
					}
					else if (this.buffType[k] == 150)
					{
						this.maxMinions++;
					}
					else if (this.buffType[k] == 111)
					{
						this.dangerSense = true;
					}
					else if (this.buffType[k] == 112)
					{
						this.ammoPotion = true;
					}
					else if (this.buffType[k] == 113)
					{
						this.lifeForce = true;
						this.statLifeMax2 += this.statLifeMax / 5 / 20 * 20;
					}
					else if (this.buffType[k] == 114)
					{
						this.endurance += 0.1f;
					}
					else if (this.buffType[k] == 115)
					{
						this.meleeCrit += 10;
						this.rangedCrit += 10;
						this.magicCrit += 10;
						this.thrownCrit += 10;
					}
					else if (this.buffType[k] == 116)
					{
						this.inferno = true;
						Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), 0.65f, 0.4f, 0.1f);
						int num = 24;
						float num2 = 200f;
						bool flag = this.infernoCounter % 60 == 0;
						int damage = 10;
						if (this.whoAmI == Main.myPlayer)
						{
							for (int l = 0; l < 200; l++)
							{
								NPC nPC = Main.npc[l];
								if (nPC.active && !nPC.friendly && nPC.damage > 0 && !nPC.dontTakeDamage && !nPC.buffImmune[num] && Vector2.Distance(base.Center, nPC.Center) <= num2)
								{
									if (nPC.FindBuffIndex(num) == -1)
									{
										nPC.AddBuff(num, 120, false);
									}
									if (flag)
									{
										this.ApplyDamageToNPC(nPC, damage, 0f, 0, false);
									}
								}
							}
							if (this.hostile)
							{
								for (int m = 0; m < 255; m++)
								{
									Player player = Main.player[m];
									if (player != this && player.active && !player.dead && player.hostile && !player.buffImmune[num] && (player.team != this.team || player.team == 0) && Vector2.Distance(base.Center, player.Center) <= num2)
									{
										if (player.FindBuffIndex(num) == -1)
										{
											player.AddBuff(num, 120, true);
										}
										if (flag)
										{
											player.Hurt(PlayerDeathReason.LegacyEmpty(), damage, 0, true, false, false, -1);
											if (Main.netMode != 0)
											{
												PlayerDeathReason reason = PlayerDeathReason.ByPlayer(this.whoAmI);
												NetMessage.SendPlayerHurt(m, reason, damage, 0, false, true, 0, -1, -1);
											}
										}
									}
								}
							}
						}
					}
					else if (this.buffType[k] == 117)
					{
						this.thrownDamage += 0.1f;
						this.meleeDamage += 0.1f;
						this.rangedDamage += 0.1f;
						this.magicDamage += 0.1f;
						this.minionDamage += 0.1f;
					}
					else if (this.buffType[k] == 119)
					{
						this.loveStruck = true;
					}
					else if (this.buffType[k] == 120)
					{
						this.stinky = true;
					}
					else if (this.buffType[k] == 124)
					{
						this.resistCold = true;
					}
					else if (this.buffType[k] == 165)
					{
						this.lifeRegen += 6;
						this.statDefense += 8;
						this.dryadWard = true;
						if (this.thorns < 1f)
						{
							this.thorns += 0.2f;
						}
					}
					else if (this.buffType[k] == 144)
					{
						this.electrified = true;
						Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 0.8f, 1.1f);
					}
					else if (this.buffType[k] == 94)
					{
						this.manaSick = true;
						this.manaSickReduction = Player.manaSickLessDmg * ((float)this.buffTime[k] / (float)Player.manaSickTime);
					}
					else if (this.buffType[k] >= 95 && this.buffType[k] <= 97)
					{
						this.buffTime[k] = 5;
						int num3 = (int)((byte)(1 + this.buffType[k] - 95));
						if (this.beetleOrbs > 0 && this.beetleOrbs != num3)
						{
							if (this.beetleOrbs > num3)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int n = 0; n < 22; n++)
								{
									if (this.buffType[n] >= 95 && this.buffType[n] <= 95 + num3 - 1)
									{
										this.DelBuff(n);
										n--;
									}
								}
							}
						}
						this.beetleOrbs = num3;
						if (!this.beetleDefense)
						{
							this.beetleOrbs = 0;
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.beetleBuff = true;
						}
					}
					else if (this.buffType[k] >= 170 && this.buffType[k] <= 172)
					{
						this.buffTime[k] = 5;
						int num4 = (int)((byte)(1 + this.buffType[k] - 170));
						if (this.solarShields > 0 && this.solarShields != num4)
						{
							if (this.solarShields > num4)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int num5 = 0; num5 < 22; num5++)
								{
									if (this.buffType[num5] >= 170 && this.buffType[num5] <= 170 + num4 - 1)
									{
										this.DelBuff(num5);
										num5--;
									}
								}
							}
						}
						this.solarShields = num4;
						if (!this.setSolar)
						{
							this.solarShields = 0;
							this.DelBuff(k);
							k--;
						}
					}
					else if (this.buffType[k] >= 98 && this.buffType[k] <= 100)
					{
						int num6 = (int)((byte)(1 + this.buffType[k] - 98));
						if (this.beetleOrbs > 0 && this.beetleOrbs != num6)
						{
							if (this.beetleOrbs > num6)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int num7 = 0; num7 < 22; num7++)
								{
									if (this.buffType[num7] >= 98 && this.buffType[num7] <= 98 + num6 - 1)
									{
										this.DelBuff(num7);
										num7--;
									}
								}
							}
						}
						this.beetleOrbs = num6;
						this.meleeDamage += 0.1f * (float)this.beetleOrbs;
						this.meleeSpeed += 0.1f * (float)this.beetleOrbs;
						if (!this.beetleOffense)
						{
							this.beetleOrbs = 0;
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.beetleBuff = true;
						}
					}
					else if (this.buffType[k] >= 176 && this.buffType[k] <= 178)
					{
						int num8 = this.nebulaLevelMana;
						int num9 = (int)((byte)(1 + this.buffType[k] - 176));
						if (num8 > 0 && num8 != num9)
						{
							if (num8 > num9)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int num10 = 0; num10 < 22; num10++)
								{
									if (this.buffType[num10] >= 176 && this.buffType[num10] <= 178 + num9 - 1)
									{
										this.DelBuff(num10);
										num10--;
									}
								}
							}
						}
						this.nebulaLevelMana = num9;
						if (this.buffTime[k] == 2 && this.nebulaLevelMana > 1)
						{
							this.nebulaLevelMana--;
							this.buffType[k]--;
							this.buffTime[k] = 480;
						}
					}
					else if (this.buffType[k] >= 173 && this.buffType[k] <= 175)
					{
						int num11 = this.nebulaLevelLife;
						int num12 = (int)((byte)(1 + this.buffType[k] - 173));
						if (num11 > 0 && num11 != num12)
						{
							if (num11 > num12)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int num13 = 0; num13 < 22; num13++)
								{
									if (this.buffType[num13] >= 173 && this.buffType[num13] <= 175 + num12 - 1)
									{
										this.DelBuff(num13);
										num13--;
									}
								}
							}
						}
						this.nebulaLevelLife = num12;
						if (this.buffTime[k] == 2 && this.nebulaLevelLife > 1)
						{
							this.nebulaLevelLife--;
							this.buffType[k]--;
							this.buffTime[k] = 480;
						}
						this.lifeRegen += 10 * this.nebulaLevelLife;
					}
					else if (this.buffType[k] >= 179 && this.buffType[k] <= 181)
					{
						int num14 = this.nebulaLevelDamage;
						int num15 = (int)((byte)(1 + this.buffType[k] - 179));
						if (num14 > 0 && num14 != num15)
						{
							if (num14 > num15)
							{
								this.DelBuff(k);
								k--;
							}
							else
							{
								for (int num16 = 0; num16 < 22; num16++)
								{
									if (this.buffType[num16] >= 179 && this.buffType[num16] <= 181 + num15 - 1)
									{
										this.DelBuff(num16);
										num16--;
									}
								}
							}
						}
						this.nebulaLevelDamage = num15;
						if (this.buffTime[k] == 2 && this.nebulaLevelDamage > 1)
						{
							this.nebulaLevelDamage--;
							this.buffType[k]--;
							this.buffTime[k] = 480;
						}
						float num17 = 0.15f * (float)this.nebulaLevelDamage;
						this.meleeDamage += num17;
						this.rangedDamage += num17;
						this.magicDamage += num17;
						this.minionDamage += num17;
						this.thrownDamage += num17;
					}
					else if (this.buffType[k] == 62)
					{
						if ((double)this.statLife <= (double)this.statLifeMax2 * 0.5)
						{
							Lighting.AddLight((int)(base.Center.X / 16f), (int)(base.Center.Y / 16f), 0.1f, 0.2f, 0.45f);
							this.iceBarrier = true;
							this.endurance += 0.25f;
							this.iceBarrierFrameCounter += 1;
							if (this.iceBarrierFrameCounter > 2)
							{
								this.iceBarrierFrameCounter = 0;
								this.iceBarrierFrame += 1;
								if (this.iceBarrierFrame >= 12)
								{
									this.iceBarrierFrame = 0;
								}
							}
						}
						else
						{
							this.DelBuff(k);
							k--;
						}
					}
					else if (this.buffType[k] == 49)
					{
						for (int num18 = 191; num18 <= 194; num18++)
						{
							if (this.ownedProjectileCounts[num18] > 0)
							{
								this.pygmy = true;
							}
						}
						if (!this.pygmy)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 83)
					{
						if (this.ownedProjectileCounts[317] > 0)
						{
							this.raven = true;
						}
						if (!this.raven)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 64)
					{
						if (this.ownedProjectileCounts[266] > 0)
						{
							this.slime = true;
						}
						if (!this.slime)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 125)
					{
						if (this.ownedProjectileCounts[373] > 0)
						{
							this.hornetMinion = true;
						}
						if (!this.hornetMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 126)
					{
						if (this.ownedProjectileCounts[375] > 0)
						{
							this.impMinion = true;
						}
						if (!this.impMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 133)
					{
						if (this.ownedProjectileCounts[390] > 0 || this.ownedProjectileCounts[391] > 0 || this.ownedProjectileCounts[392] > 0)
						{
							this.spiderMinion = true;
						}
						if (!this.spiderMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 134)
					{
						if (this.ownedProjectileCounts[387] > 0 || this.ownedProjectileCounts[388] > 0)
						{
							this.twinsMinion = true;
						}
						if (!this.twinsMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 135)
					{
						if (this.ownedProjectileCounts[393] > 0 || this.ownedProjectileCounts[394] > 0 || this.ownedProjectileCounts[395] > 0)
						{
							this.pirateMinion = true;
						}
						if (!this.pirateMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 139)
					{
						if (this.ownedProjectileCounts[407] > 0)
						{
							this.sharknadoMinion = true;
						}
						if (!this.sharknadoMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 140)
					{
						if (this.ownedProjectileCounts[423] > 0)
						{
							this.UFOMinion = true;
						}
						if (!this.UFOMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 182)
					{
						if (this.ownedProjectileCounts[613] > 0)
						{
							this.stardustMinion = true;
						}
						if (!this.stardustMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 187)
					{
						if (this.ownedProjectileCounts[623] > 0)
						{
							this.stardustGuardian = true;
						}
						if (!this.stardustGuardian)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 188)
					{
						if (this.ownedProjectileCounts[625] > 0)
						{
							this.stardustDragon = true;
						}
						if (!this.stardustDragon)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 161)
					{
						if (this.ownedProjectileCounts[533] > 0)
						{
							this.DeadlySphereMinion = true;
						}
						if (!this.DeadlySphereMinion)
						{
							this.DelBuff(k);
							k--;
						}
						else
						{
							this.buffTime[k] = 18000;
						}
					}
					else if (this.buffType[k] == 90)
					{
						this.mount.SetMount(0, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 128)
					{
						this.mount.SetMount(1, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 129)
					{
						this.mount.SetMount(2, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 130)
					{
						this.mount.SetMount(3, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 118)
					{
						this.mount.SetMount(6, this, true);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 138)
					{
						this.mount.SetMount(6, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 167)
					{
						this.mount.SetMount(11, this, true);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 166)
					{
						this.mount.SetMount(11, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 184)
					{
						this.mount.SetMount(13, this, true);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 185)
					{
						this.mount.SetMount(13, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 131)
					{
						this.ignoreWater = true;
						this.accFlipper = true;
						this.mount.SetMount(4, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 132)
					{
						this.mount.SetMount(5, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 168)
					{
						this.ignoreWater = true;
						this.accFlipper = true;
						this.mount.SetMount(12, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 141)
					{
						this.mount.SetMount(7, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 142)
					{
						this.mount.SetMount(8, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 143)
					{
						this.mount.SetMount(9, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 162)
					{
						this.mount.SetMount(10, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 193)
					{
						this.mount.SetMount(14, this, false);
						this.buffTime[k] = 10;
					}
					else if (this.buffType[k] == 37)
					{
						if (Main.wof >= 0 && Main.npc[Main.wof].type == 113)
						{
							this.gross = true;
							this.buffTime[k] = 10;
						}
						else
						{
							this.DelBuff(k);
							k--;
						}
					}
					else if (this.buffType[k] == 38)
					{
						this.buffTime[k] = 10;
						this.tongued = true;
					}
					else if (this.buffType[k] == 146)
					{
						this.moveSpeed += 0.1f;
						this.moveSpeed *= 1.1f;
						this.sunflower = true;
					}
					else if (this.buffType[k] == 19)
					{
						this.buffTime[k] = 18000;
						this.lightOrb = true;
						bool flag2 = true;
						if (this.ownedProjectileCounts[18] > 0)
						{
							flag2 = false;
						}
						if (flag2 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 18, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 155)
					{
						this.buffTime[k] = 18000;
						this.crimsonHeart = true;
						bool flag3 = true;
						if (this.ownedProjectileCounts[500] > 0)
						{
							flag3 = false;
						}
						if (flag3 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 500, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 191)
					{
						this.CommonPetBuffHandle(k, ref this.companionCube, 653);
					}
					else if (this.buffType[k] == 202)
					{
						this.CommonPetBuffHandle(k, ref this.petFlagDD2Dragon, 701);
					}
					else if (this.buffType[k] == 200)
					{
						this.CommonPetBuffHandle(k, ref this.petFlagDD2Gato, 703);
					}
					else if (this.buffType[k] == 201)
					{
						this.CommonPetBuffHandle(k, ref this.petFlagDD2Ghost, 702);
					}
					else if (this.buffType[k] == 190)
					{
						this.buffTime[k] = 18000;
						this.suspiciouslookingTentacle = true;
						bool flag4 = true;
						if (this.ownedProjectileCounts[650] > 0)
						{
							flag4 = false;
						}
						if (flag4 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 650, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 27 || this.buffType[k] == 101 || this.buffType[k] == 102)
					{
						this.buffTime[k] = 18000;
						bool flag5 = true;
						int num19 = 72;
						if (this.buffType[k] == 27)
						{
							this.blueFairy = true;
						}
						if (this.buffType[k] == 101)
						{
							num19 = 86;
							this.redFairy = true;
						}
						if (this.buffType[k] == 102)
						{
							num19 = 87;
							this.greenFairy = true;
						}
						if (this.head == 45 && this.body == 26 && this.legs == 25)
						{
							num19 = 72;
						}
						if (this.ownedProjectileCounts[num19] > 0)
						{
							flag5 = false;
						}
						if (flag5 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, num19, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 40)
					{
						this.buffTime[k] = 18000;
						this.bunny = true;
						bool flag6 = true;
						if (this.ownedProjectileCounts[111] > 0)
						{
							flag6 = false;
						}
						if (flag6 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 111, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 148)
					{
						this.rabid = true;
						if (Main.rand.Next(1200) == 0)
						{
							int num20 = Main.rand.Next(6);
							float num21 = (float)Main.rand.Next(60, 100) * 0.01f;
							if (num20 == 0)
							{
								this.AddBuff(22, (int)(60f * num21 * 3f), true);
							}
							else if (num20 == 1)
							{
								this.AddBuff(23, (int)(60f * num21 * 0.75f), true);
							}
							else if (num20 == 2)
							{
								this.AddBuff(31, (int)(60f * num21 * 1.5f), true);
							}
							else if (num20 == 3)
							{
								this.AddBuff(32, (int)(60f * num21 * 3.5f), true);
							}
							else if (num20 == 4)
							{
								this.AddBuff(33, (int)(60f * num21 * 5f), true);
							}
							else if (num20 == 5)
							{
								this.AddBuff(35, (int)(60f * num21 * 1f), true);
							}
						}
						this.meleeDamage += 0.2f;
						this.magicDamage += 0.2f;
						this.rangedDamage += 0.2f;
						this.thrownDamage += 0.2f;
						this.minionDamage += 0.2f;
					}
					else if (this.buffType[k] == 41)
					{
						this.buffTime[k] = 18000;
						this.penguin = true;
						bool flag7 = true;
						if (this.ownedProjectileCounts[112] > 0)
						{
							flag7 = false;
						}
						if (flag7 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 112, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 152)
					{
						this.buffTime[k] = 18000;
						this.magicLantern = true;
						if (this.ownedProjectileCounts[492] == 0 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 492, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 91)
					{
						this.buffTime[k] = 18000;
						this.puppy = true;
						bool flag8 = true;
						if (this.ownedProjectileCounts[334] > 0)
						{
							flag8 = false;
						}
						if (flag8 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 334, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 92)
					{
						this.buffTime[k] = 18000;
						this.grinch = true;
						bool flag9 = true;
						if (this.ownedProjectileCounts[353] > 0)
						{
							flag9 = false;
						}
						if (flag9 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 353, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 84)
					{
						this.buffTime[k] = 18000;
						this.blackCat = true;
						bool flag10 = true;
						if (this.ownedProjectileCounts[319] > 0)
						{
							flag10 = false;
						}
						if (flag10 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 319, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 61)
					{
						this.buffTime[k] = 18000;
						this.dino = true;
						bool flag11 = true;
						if (this.ownedProjectileCounts[236] > 0)
						{
							flag11 = false;
						}
						if (flag11 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 236, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 154)
					{
						this.buffTime[k] = 18000;
						this.babyFaceMonster = true;
						bool flag12 = true;
						if (this.ownedProjectileCounts[499] > 0)
						{
							flag12 = false;
						}
						if (flag12 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 499, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 65)
					{
						this.buffTime[k] = 18000;
						this.eyeSpring = true;
						bool flag13 = true;
						if (this.ownedProjectileCounts[268] > 0)
						{
							flag13 = false;
						}
						if (flag13 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 268, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 66)
					{
						this.buffTime[k] = 18000;
						this.snowman = true;
						bool flag14 = true;
						if (this.ownedProjectileCounts[269] > 0)
						{
							flag14 = false;
						}
						if (flag14 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 269, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 42)
					{
						this.buffTime[k] = 18000;
						this.turtle = true;
						bool flag15 = true;
						if (this.ownedProjectileCounts[127] > 0)
						{
							flag15 = false;
						}
						if (flag15 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 127, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 45)
					{
						this.buffTime[k] = 18000;
						this.eater = true;
						bool flag16 = true;
						if (this.ownedProjectileCounts[175] > 0)
						{
							flag16 = false;
						}
						if (flag16 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 175, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 50)
					{
						this.buffTime[k] = 18000;
						this.skeletron = true;
						bool flag17 = true;
						if (this.ownedProjectileCounts[197] > 0)
						{
							flag17 = false;
						}
						if (flag17 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 197, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 51)
					{
						this.buffTime[k] = 18000;
						this.hornet = true;
						bool flag18 = true;
						if (this.ownedProjectileCounts[198] > 0)
						{
							flag18 = false;
						}
						if (flag18 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 198, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 52)
					{
						this.buffTime[k] = 18000;
						this.tiki = true;
						bool flag19 = true;
						if (this.ownedProjectileCounts[199] > 0)
						{
							flag19 = false;
						}
						if (flag19 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 199, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 53)
					{
						this.buffTime[k] = 18000;
						this.lizard = true;
						bool flag20 = true;
						if (this.ownedProjectileCounts[200] > 0)
						{
							flag20 = false;
						}
						if (flag20 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 200, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 54)
					{
						this.buffTime[k] = 18000;
						this.parrot = true;
						bool flag21 = true;
						if (this.ownedProjectileCounts[208] > 0)
						{
							flag21 = false;
						}
						if (flag21 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 208, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 55)
					{
						this.buffTime[k] = 18000;
						this.truffle = true;
						bool flag22 = true;
						if (this.ownedProjectileCounts[209] > 0)
						{
							flag22 = false;
						}
						if (flag22 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 209, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 56)
					{
						this.buffTime[k] = 18000;
						this.sapling = true;
						bool flag23 = true;
						if (this.ownedProjectileCounts[210] > 0)
						{
							flag23 = false;
						}
						if (flag23 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 210, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 85)
					{
						this.buffTime[k] = 18000;
						this.cSapling = true;
						bool flag24 = true;
						if (this.ownedProjectileCounts[324] > 0)
						{
							flag24 = false;
						}
						if (flag24 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 324, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 81)
					{
						this.buffTime[k] = 18000;
						this.spider = true;
						bool flag25 = true;
						if (this.ownedProjectileCounts[313] > 0)
						{
							flag25 = false;
						}
						if (flag25 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 313, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 82)
					{
						this.buffTime[k] = 18000;
						this.squashling = true;
						bool flag26 = true;
						if (this.ownedProjectileCounts[314] > 0)
						{
							flag26 = false;
						}
						if (flag26 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 314, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 57)
					{
						this.buffTime[k] = 18000;
						this.wisp = true;
						bool flag27 = true;
						if (this.ownedProjectileCounts[211] > 0)
						{
							flag27 = false;
						}
						if (flag27 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 211, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 60)
					{
						this.buffTime[k] = 18000;
						this.crystalLeaf = true;
						bool flag28 = true;
						for (int num22 = 0; num22 < 1000; num22++)
						{
							if (Main.projectile[num22].active && Main.projectile[num22].owner == this.whoAmI && Main.projectile[num22].type == 226)
							{
								if (!flag28)
								{
									Main.projectile[num22].Kill();
								}
								flag28 = false;
							}
						}
						if (flag28 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 226, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 127)
					{
						this.buffTime[k] = 18000;
						this.zephyrfish = true;
						bool flag29 = true;
						if (this.ownedProjectileCounts[380] > 0)
						{
							flag29 = false;
						}
						if (flag29 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 380, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 136)
					{
						this.buffTime[k] = 18000;
						this.miniMinotaur = true;
						bool flag30 = true;
						if (this.ownedProjectileCounts[398] > 0)
						{
							flag30 = false;
						}
						if (flag30 && this.whoAmI == Main.myPlayer)
						{
							Projectile.NewProjectile(this.position.X + (float)(this.width / 2), this.position.Y + (float)(this.height / 2), 0f, 0f, 398, 0, 0f, this.whoAmI, 0f, 0f);
						}
					}
					else if (this.buffType[k] == 70)
					{
						this.venom = true;
					}
					else if (this.buffType[k] == 20)
					{
						this.poisoned = true;
					}
					else if (this.buffType[k] == 21)
					{
						this.potionDelay = this.buffTime[k];
					}
					else if (this.buffType[k] == 22)
					{
						this.blind = true;
					}
					else if (this.buffType[k] == 80)
					{
						this.blackout = true;
					}
					else if (this.buffType[k] == 23)
					{
						this.noItems = true;
					}
					else if (this.buffType[k] == 24)
					{
						this.onFire = true;
					}
					else if (this.buffType[k] == 103)
					{
						this.dripping = true;
					}
					else if (this.buffType[k] == 137)
					{
						this.drippingSlime = true;
					}
					else if (this.buffType[k] == 67)
					{
						this.burned = true;
					}
					else if (this.buffType[k] == 68)
					{
						this.suffocating = true;
					}
					else if (this.buffType[k] == 39)
					{
						this.onFire2 = true;
					}
					else if (this.buffType[k] == 44)
					{
						this.onFrostBurn = true;
					}
					else if (this.buffType[k] == 163)
					{
						this.headcovered = true;
						this.bleed = true;
					}
					else if (this.buffType[k] == 164)
					{
						this.vortexDebuff = true;
					}
					else if (this.buffType[k] == 194)
					{
						this.windPushed = true;
					}
					else if (this.buffType[k] == 195)
					{
						this.witheredArmor = true;
					}
					else if (this.buffType[k] == 205)
					{
						this.ballistaPanic = true;
					}
					else if (this.buffType[k] == 196)
					{
						this.witheredWeapon = true;
					}
					else if (this.buffType[k] == 197)
					{
						this.slowOgreSpit = true;
					}
					else if (this.buffType[k] == 198)
					{
						this.parryDamageBuff = true;
					}
					else if (this.buffType[k] == 145)
					{
						this.moonLeech = true;
					}
					else if (this.buffType[k] == 149)
					{
						this.webbed = true;
						if (this.velocity.Y != 0f)
						{
							this.velocity = new Vector2(0f, 1E-06f);
						}
						else
						{
							this.velocity = Vector2.Zero;
						}
						Player.jumpHeight = 0;
						this.gravity = 0f;
						this.moveSpeed = 0f;
						this.dash = 0;
						this.noKnockback = true;
						this.grappling[0] = -1;
						this.grapCount = 0;
						for (int num23 = 0; num23 < 1000; num23++)
						{
							if (Main.projectile[num23].active && Main.projectile[num23].owner == this.whoAmI && Main.projectile[num23].aiStyle == 7)
							{
								Main.projectile[num23].Kill();
							}
						}
					}
					else if (this.buffType[k] == 43)
					{
						this.defendedByPaladin = true;
					}
					else if (this.buffType[k] == 29)
					{
						this.magicCrit += 2;
						this.magicDamage += 0.05f;
						this.statManaMax2 += 20;
						this.manaCost -= 0.02f;
					}
					else if (this.buffType[k] == 28)
					{
						if (!Main.dayTime && this.wolfAcc && !this.merman)
						{
							this.lifeRegen++;
							this.wereWolf = true;
							this.meleeCrit += 2;
							this.meleeDamage += 0.051f;
							this.meleeSpeed += 0.051f;
							this.statDefense += 3;
							this.moveSpeed += 0.05f;
						}
						else
						{
							this.DelBuff(k);
							k--;
						}
					}
					else if (this.buffType[k] == 33)
					{
						this.meleeDamage -= 0.051f;
						this.meleeSpeed -= 0.051f;
						this.statDefense -= 4;
						this.moveSpeed -= 0.1f;
					}
					else if (this.buffType[k] == 25)
					{
						this.statDefense -= 4;
						this.meleeCrit += 2;
						this.meleeDamage += 0.1f;
						this.meleeSpeed += 0.1f;
					}
					else if (this.buffType[k] == 26)
					{
						this.wellFed = true;
						this.statDefense += 2;
						this.meleeCrit += 2;
						this.meleeDamage += 0.05f;
						this.meleeSpeed += 0.05f;
						this.magicCrit += 2;
						this.magicDamage += 0.05f;
						this.rangedCrit += 2;
						this.rangedDamage += 0.05f;
						this.thrownCrit += 2;
						this.thrownDamage += 0.05f;
						this.minionDamage += 0.05f;
						this.minionKB += 0.5f;
						this.moveSpeed += 0.2f;
					}
					else if (this.buffType[k] == 71)
					{
						this.meleeEnchant = 1;
					}
					else if (this.buffType[k] == 73)
					{
						this.meleeEnchant = 2;
					}
					else if (this.buffType[k] == 74)
					{
						this.meleeEnchant = 3;
					}
					else if (this.buffType[k] == 75)
					{
						this.meleeEnchant = 4;
					}
					else if (this.buffType[k] == 76)
					{
						this.meleeEnchant = 5;
					}
					else if (this.buffType[k] == 77)
					{
						this.meleeEnchant = 6;
					}
					else if (this.buffType[k] == 78)
					{
						this.meleeEnchant = 7;
					}
					else if (this.buffType[k] == 79)
					{
						this.meleeEnchant = 8;
					}
				}
			}
		}

		// Token: 0x0600037E RID: 894 RVA: 0x0023B448 File Offset: 0x00239648
		public void UpdateDead()
		{
			this._portalPhysicsTime = 0;
			this.MountFishronSpecialCounter = 0f;
			this.gem = -1;
			this.ownedLargeGems = 0;
			this.slippy = false;
			this.slippy2 = false;
			this.powerrun = false;
			this.wings = 0;
			this.wingsLogic = 0;
			this.face = (this.neck = (this.back = (this.front = (this.handoff = (this.handon = (this.shoe = (this.waist = (this.balloon = (this.shield = 0)))))))));
			this.poisoned = false;
			this.venom = false;
			this.onFire = false;
			this.dripping = false;
			this.drippingSlime = false;
			this.burned = false;
			this.suffocating = false;
			this.onFire2 = false;
			this.onFrostBurn = false;
			this.blind = false;
			this.blackout = false;
			this.loveStruck = false;
			this.dryadWard = false;
			this.stinky = false;
			this.resistCold = false;
			this.electrified = false;
			this.moonLeech = false;
			this.headcovered = false;
			this.vortexDebuff = false;
			this.windPushed = false;
			this.setForbidden = false;
			this.setMonkT3 = false;
			this.setHuntressT3 = false;
			this.setApprenticeT3 = false;
			this.setSquireT3 = false;
			this.setForbiddenCooldownLocked = false;
			this.setSolar = (this.setVortex = (this.setNebula = (this.setStardust = false)));
			this.nebulaLevelDamage = (this.nebulaLevelLife = (this.nebulaLevelMana = 0));
			this.trapDebuffSource = false;
			this.yoraiz0rEye = 0;
			this.yoraiz0rDarkness = false;
			this.leinforsHair = false;
			this.gravDir = 1f;
			for (int i = 0; i < 22; i++)
			{
				if (this.buffType[i] <= 0 || !Main.persistentBuff[this.buffType[i]])
				{
					this.buffTime[i] = 0;
					this.buffType[i] = 0;
				}
			}
			if (this.whoAmI == Main.myPlayer)
			{
				Main.npcChatText = "";
				Main.editSign = false;
			}
			this.grappling[0] = -1;
			this.grappling[1] = -1;
			this.grappling[2] = -1;
			this.sign = -1;
			this.talkNPC = -1;
			Main.npcChatCornerItem = 0;
			this.statLife = 0;
			this.channel = false;
			this.potionDelay = 0;
			this.chest = -1;
			this.changeItem = -1;
			this.itemAnimation = 0;
			this.immuneAlpha += 2;
			if (this.immuneAlpha > 255)
			{
				this.immuneAlpha = 255;
			}
			this.headPosition += this.headVelocity;
			this.bodyPosition += this.bodyVelocity;
			this.legPosition += this.legVelocity;
			this.headRotation += this.headVelocity.X * 0.1f;
			this.bodyRotation += this.bodyVelocity.X * 0.1f;
			this.legRotation += this.legVelocity.X * 0.1f;
			this.headVelocity.Y = this.headVelocity.Y + 0.1f;
			this.bodyVelocity.Y = this.bodyVelocity.Y + 0.1f;
			this.legVelocity.Y = this.legVelocity.Y + 0.1f;
			this.headVelocity.X = this.headVelocity.X * 0.99f;
			this.bodyVelocity.X = this.bodyVelocity.X * 0.99f;
			this.legVelocity.X = this.legVelocity.X * 0.99f;
			for (int j = 0; j < this.npcTypeNoAggro.Length; j++)
			{
				this.npcTypeNoAggro[j] = false;
			}
			if (this.difficulty == 2)
			{
				if (this.respawnTimer > 0)
				{
					this.respawnTimer--;
					return;
				}
				if (this.whoAmI == Main.myPlayer || Main.netMode == 2)
				{
					this.ghost = true;
					return;
				}
			}
			else
			{
				this.respawnTimer--;
				if (this.respawnTimer <= 0 && Main.myPlayer == this.whoAmI)
				{
					if (Main.mouseItem.type > 0)
					{
						Main.playerInventory = true;
					}
					this.Spawn();
				}
			}
		}

		// Token: 0x0600036F RID: 879 RVA: 0x0022EB0C File Offset: 0x0022CD0C
		public void UpdateDyes(int plr)
		{
			this.cHead = 0;
			this.cBody = 0;
			this.cLegs = 0;
			this.cHandOn = 0;
			this.cHandOff = 0;
			this.cBack = 0;
			this.cFront = 0;
			this.cShoe = 0;
			this.cWaist = 0;
			this.cShield = 0;
			this.cNeck = 0;
			this.cFace = 0;
			this.cBalloon = 0;
			this.cWings = 0;
			this.cCarpet = 0;
			this.cGrapple = (this.cMount = (this.cMinecart = (this.cPet = (this.cLight = (this.cYorai = 0)))));
			if (this.dye[0] != null)
			{
				this.cHead = (int)this.dye[0].dye;
			}
			if (this.dye[1] != null)
			{
				this.cBody = (int)this.dye[1].dye;
			}
			if (this.dye[2] != null)
			{
				this.cLegs = (int)this.dye[2].dye;
			}
			if (this.wearsRobe)
			{
				this.cLegs = this.cBody;
			}
			if (this.miscDyes[0] != null)
			{
				this.cPet = (int)this.miscDyes[0].dye;
			}
			if (this.miscDyes[1] != null)
			{
				this.cLight = (int)this.miscDyes[1].dye;
			}
			if (this.miscDyes[2] != null)
			{
				this.cMinecart = (int)this.miscDyes[2].dye;
			}
			if (this.miscDyes[3] != null)
			{
				this.cMount = (int)this.miscDyes[3].dye;
			}
			if (this.miscDyes[4] != null)
			{
				this.cGrapple = (int)this.miscDyes[4].dye;
			}
			for (int i = 0; i < 20; i++)
			{
				int num = i % 10;
				if (this.dye[num] != null && this.armor[i].type > 0 && this.armor[i].stack > 0 && (i / 10 >= 1 || !this.hideVisual[num] || this.armor[i].wingSlot > 0 || this.armor[i].type == 934))
				{
					if (this.armor[i].handOnSlot > 0 && this.armor[i].handOnSlot < 20)
					{
						this.cHandOn = (int)this.dye[num].dye;
					}
					if (this.armor[i].handOffSlot > 0 && this.armor[i].handOffSlot < 12)
					{
						this.cHandOff = (int)this.dye[num].dye;
					}
					if (this.armor[i].backSlot > 0 && this.armor[i].backSlot < 14)
					{
						this.cBack = (int)this.dye[num].dye;
					}
					if (this.armor[i].frontSlot > 0 && this.armor[i].frontSlot < 5)
					{
						this.cFront = (int)this.dye[num].dye;
					}
					if (this.armor[i].shoeSlot > 0 && this.armor[i].shoeSlot < 18)
					{
						this.cShoe = (int)this.dye[num].dye;
					}
					if (this.armor[i].waistSlot > 0 && this.armor[i].waistSlot < 13)
					{
						this.cWaist = (int)this.dye[num].dye;
					}
					if (this.armor[i].shieldSlot > 0 && this.armor[i].shieldSlot < 7)
					{
						this.cShield = (int)this.dye[num].dye;
					}
					if (this.armor[i].neckSlot > 0 && this.armor[i].neckSlot < 10)
					{
						this.cNeck = (int)this.dye[num].dye;
					}
					if (this.armor[i].faceSlot > 0 && this.armor[i].faceSlot < 9)
					{
						this.cFace = (int)this.dye[num].dye;
					}
					if (this.armor[i].balloonSlot > 0 && this.armor[i].balloonSlot < 18)
					{
						this.cBalloon = (int)this.dye[num].dye;
					}
					if (this.armor[i].wingSlot > 0 && this.armor[i].wingSlot < 40)
					{
						this.cWings = (int)this.dye[num].dye;
					}
					if (this.armor[i].type == 934)
					{
						this.cCarpet = (int)this.dye[num].dye;
					}
				}
			}
			this.cYorai = this.cPet;
		}

		// Token: 0x06000378 RID: 888 RVA: 0x00232E04 File Offset: 0x00231004
		public void UpdateEquips(int i)
		{
			for (int j = 0; j < 58; j++)
			{
				int type = this.inventory[j].type;
				if ((type == 15 || type == 707) && this.accWatch < 1)
				{
					this.accWatch = 1;
				}
				if ((type == 16 || type == 708) && this.accWatch < 2)
				{
					this.accWatch = 2;
				}
				if ((type == 17 || type == 709) && this.accWatch < 3)
				{
					this.accWatch = 3;
				}
				if (type == 393)
				{
					this.accCompass = 1;
				}
				if (type == 18)
				{
					this.accDepthMeter = 1;
				}
				if (type == 395 || type == 3123 || type == 3124)
				{
					this.accWatch = 3;
					this.accDepthMeter = 1;
					this.accCompass = 1;
				}
				if (type == 3120 || type == 3036 || type == 3123 || type == 3124)
				{
					this.accFishFinder = true;
				}
				if (type == 3037 || type == 3036 || type == 3123 || type == 3124)
				{
					this.accWeatherRadio = true;
				}
				if (type == 3096 || type == 3036 || type == 3123 || type == 3124)
				{
					this.accCalendar = true;
				}
				if (type == 3084 || type == 3122 || type == 3123 || type == 3124)
				{
					this.accThirdEye = true;
				}
				if (type == 3095 || type == 3122 || type == 3123 || type == 3124)
				{
					this.accJarOfSouls = true;
				}
				if (type == 3118 || type == 3122 || type == 3123 || type == 3124)
				{
					this.accCritterGuide = true;
				}
				if (type == 3099 || type == 3121 || type == 3123 || type == 3124)
				{
					this.accStopwatch = true;
				}
				if (type == 3102 || type == 3121 || type == 3123 || type == 3124)
				{
					this.accOreFinder = true;
				}
				if (type == 3119 || type == 3121 || type == 3123 || type == 3124)
				{
					this.accDreamCatcher = true;
				}
				if (type == 3619 || type == 3611)
				{
					this.InfoAccMechShowWires = true;
				}
				if (type == 486 || type == 3611)
				{
					this.rulerLine = true;
				}
				if (type == 2799)
				{
					this.rulerGrid = true;
				}
				if (type == 2216 || type == 3061)
				{
					this.autoPaint = true;
				}
				if (type == 3624)
				{
					this.autoActuator = true;
				}
			}
			for (int k = 0; k < 8 + this.extraAccessorySlots; k++)
			{
				if (!this.armor[k].expertOnly || Main.expertMode)
				{
					int type2 = this.armor[k].type;
					if ((type2 == 15 || type2 == 707) && this.accWatch < 1)
					{
						this.accWatch = 1;
					}
					if ((type2 == 16 || type2 == 708) && this.accWatch < 2)
					{
						this.accWatch = 2;
					}
					if ((type2 == 17 || type2 == 709) && this.accWatch < 3)
					{
						this.accWatch = 3;
					}
					if (type2 == 393)
					{
						this.accCompass = 1;
					}
					if (type2 == 18)
					{
						this.accDepthMeter = 1;
					}
					if (type2 == 395 || type2 == 3123 || type2 == 3124)
					{
						this.accWatch = 3;
						this.accDepthMeter = 1;
						this.accCompass = 1;
					}
					if (type2 == 3120 || type2 == 3036 || type2 == 3123 || type2 == 3124)
					{
						this.accFishFinder = true;
					}
					if (type2 == 3037 || type2 == 3036 || type2 == 3123 || type2 == 3124)
					{
						this.accWeatherRadio = true;
					}
					if (type2 == 3096 || type2 == 3036 || type2 == 3123 || type2 == 3124)
					{
						this.accCalendar = true;
					}
					if (type2 == 3084 || type2 == 3122 || type2 == 3123 || type2 == 3124)
					{
						this.accThirdEye = true;
					}
					if (type2 == 3095 || type2 == 3122 || type2 == 3123 || type2 == 3124)
					{
						this.accJarOfSouls = true;
					}
					if (type2 == 3118 || type2 == 3122 || type2 == 3123 || type2 == 3124)
					{
						this.accCritterGuide = true;
					}
					if (type2 == 3099 || type2 == 3121 || type2 == 3123 || type2 == 3124)
					{
						this.accStopwatch = true;
					}
					if (type2 == 3102 || type2 == 3121 || type2 == 3123 || type2 == 3124)
					{
						this.accOreFinder = true;
					}
					if (type2 == 3119 || type2 == 3121 || type2 == 3123 || type2 == 3124)
					{
						this.accDreamCatcher = true;
					}
					if (type2 == 3619)
					{
						this.InfoAccMechShowWires = true;
					}
					if (this.armor[k].type == 3017 && this.whoAmI == Main.myPlayer && this.velocity.Y == 0f && this.grappling[0] == -1)
					{
						int num = (int)base.Center.X / 16;
						int num2 = (int)(this.position.Y + (float)this.height - 1f) / 16;
						if (Main.tile[num, num2] == null)
						{
							Main.tile[num, num2] = new Tile();
						}
						if (!Main.tile[num, num2].active() && Main.tile[num, num2].liquid == 0 && Main.tile[num, num2 + 1] != null && WorldGen.SolidTile(num, num2 + 1))
						{
							Main.tile[num, num2].frameY = 0;
							Main.tile[num, num2].slope(0);
							Main.tile[num, num2].halfBrick(false);
							if (Main.tile[num, num2 + 1].type == 2)
							{
								if (Main.rand.Next(2) == 0)
								{
									Main.tile[num, num2].active(true);
									Main.tile[num, num2].type = 3;
									Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(6, 11));
									while (Main.tile[num, num2].frameX == 144)
									{
										Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(6, 11));
									}
								}
								else
								{
									Main.tile[num, num2].active(true);
									Main.tile[num, num2].type = 73;
									Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(6, 21));
									while (Main.tile[num, num2].frameX == 144)
									{
										Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(6, 21));
									}
								}
								if (Main.netMode == 1)
								{
									NetMessage.SendTileSquare(-1, num, num2, 1, TileChangeType.None);
								}
							}
							else if (Main.tile[num, num2 + 1].type == 109)
							{
								if (Main.rand.Next(2) == 0)
								{
									Main.tile[num, num2].active(true);
									Main.tile[num, num2].type = 110;
									Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(4, 7));
									while (Main.tile[num, num2].frameX == 90)
									{
										Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(4, 7));
									}
								}
								else
								{
									Main.tile[num, num2].active(true);
									Main.tile[num, num2].type = 113;
									Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(2, 8));
									while (Main.tile[num, num2].frameX == 90)
									{
										Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(2, 8));
									}
								}
								if (Main.netMode == 1)
								{
									NetMessage.SendTileSquare(-1, num, num2, 1, TileChangeType.None);
								}
							}
							else if (Main.tile[num, num2 + 1].type == 60)
							{
								Main.tile[num, num2].active(true);
								Main.tile[num, num2].type = 74;
								Main.tile[num, num2].frameX = (short)(18 * Main.rand.Next(9, 17));
								if (Main.netMode == 1)
								{
									NetMessage.SendTileSquare(-1, num, num2, 1, TileChangeType.None);
								}
							}
						}
					}
					this.statDefense += this.armor[k].defense;
					this.lifeRegen += this.armor[k].lifeRegen;
					if (this.armor[k].shieldSlot > 0)
					{
						this.hasRaisableShield = true;
					}
					int type3 = this.armor[k].type;
					switch (type3)
					{
						case 3797:
							this.maxTurrets++;
							this.manaCost -= 0.1f;
							break;
						case 3798:
							this.magicDamage += 0.1f;
							this.minionDamage += 0.2f;
							break;
						case 3799:
							this.minionDamage += 0.1f;
							this.magicCrit += 20;
							break;
						case 3800:
							this.maxTurrets++;
							this.lifeRegen += 8;
							break;
						case 3801:
							this.meleeDamage += 0.15f;
							this.minionDamage += 0.15f;
							break;
						case 3802:
							this.minionDamage += 0.15f;
							this.meleeCrit += 20;
							this.moveSpeed += 0.2f;
							break;
						case 3803:
							this.maxTurrets++;
							this.rangedCrit += 10;
							break;
						case 3804:
							this.rangedDamage += 0.2f;
							this.minionDamage += 0.2f;
							break;
						case 3805:
							this.minionDamage += 0.1f;
							this.moveSpeed += 0.2f;
							break;
						case 3806:
							this.maxTurrets++;
							this.meleeSpeed += 0.2f;
							break;
						case 3807:
							this.meleeDamage += 0.2f;
							this.minionDamage += 0.2f;
							break;
						case 3808:
							this.minionDamage += 0.1f;
							this.meleeCrit += 10;
							this.moveSpeed += 0.2f;
							break;
						default:
							switch (type3)
							{
								case 3871:
									this.maxTurrets += 2;
									this.minionDamage += 0.1f;
									break;
								case 3872:
									this.minionDamage += 0.3f;
									this.lifeRegen += 16;
									break;
								case 3873:
									this.minionDamage += 0.2f;
									this.meleeCrit += 20;
									this.moveSpeed += 0.3f;
									break;
								case 3874:
									this.maxTurrets += 2;
									this.magicDamage += 0.1f;
									this.minionDamage += 0.1f;
									break;
								case 3875:
									this.minionDamage += 0.3f;
									this.magicDamage += 0.15f;
									break;
								case 3876:
									this.minionDamage += 0.2f;
									this.magicCrit += 25;
									break;
								case 3877:
									this.maxTurrets += 2;
									this.minionDamage += 0.1f;
									this.rangedCrit += 10;
									break;
								case 3878:
									this.minionDamage += 0.25f;
									this.rangedDamage += 0.25f;
									break;
								case 3879:
									this.minionDamage += 0.25f;
									this.moveSpeed += 0.2f;
									break;
								case 3880:
									this.maxTurrets += 2;
									this.minionDamage += 0.2f;
									this.meleeDamage += 0.2f;
									break;
								case 3881:
									this.meleeSpeed += 0.2f;
									this.minionDamage += 0.2f;
									break;
								case 3882:
									this.minionDamage += 0.2f;
									this.meleeCrit += 20;
									this.moveSpeed += 0.2f;
									break;
							}
							break;
					}
					if (this.armor[k].type == 268)
					{
						this.accDivingHelm = true;
					}
					if (this.armor[k].type == 238)
					{
						this.magicDamage += 0.15f;
					}
					if (this.armor[k].type == 3770)
					{
						this.slowFall = true;
					}
					if (this.armor[k].type == 3776)
					{
						this.magicDamage += 0.15f;
						this.minionDamage += 0.15f;
					}
					if (this.armor[k].type == 3777)
					{
						this.statManaMax2 += 80;
					}
					if (this.armor[k].type == 3778)
					{
						this.maxMinions += 2;
					}
					if (this.armor[k].type == 3212)
					{
						this.armorPenetration += 5;
					}
					if (this.armor[k].type == 2277)
					{
						this.magicDamage += 0.05f;
						this.meleeDamage += 0.05f;
						this.rangedDamage += 0.05f;
						this.thrownDamage += 0.05f;
						this.magicCrit += 5;
						this.rangedCrit += 5;
						this.meleeCrit += 5;
						this.thrownCrit += 5;
						this.meleeSpeed += 0.1f;
						this.moveSpeed += 0.1f;
					}
					if (this.armor[k].type == 2279)
					{
						this.magicDamage += 0.06f;
						this.magicCrit += 6;
						this.manaCost -= 0.1f;
					}
					if (this.armor[k].type == 3109)
					{
						this.nightVision = true;
					}
					if (this.armor[k].type == 256)
					{
						this.thrownVelocity += 0.15f;
					}
					if (this.armor[k].type == 257)
					{
						this.thrownDamage += 0.15f;
					}
					if (this.armor[k].type == 258)
					{
						this.thrownCrit += 10;
					}
					if (this.armor[k].type == 3374)
					{
						this.thrownVelocity += 0.2f;
					}
					if (this.armor[k].type == 3375)
					{
						this.thrownDamage += 0.2f;
					}
					if (this.armor[k].type == 3376)
					{
						this.thrownCrit += 15;
					}
					if (this.armor[k].type == 2275)
					{
						this.magicDamage += 0.07f;
						this.magicCrit += 7;
					}
					if (this.armor[k].type == 123 || this.armor[k].type == 124 || this.armor[k].type == 125)
					{
						this.magicDamage += 0.07f;
					}
					if (this.armor[k].type == 151 || this.armor[k].type == 152 || this.armor[k].type == 153 || this.armor[k].type == 959)
					{
						this.rangedDamage += 0.05f;
					}
					if (this.armor[k].type == 111 || this.armor[k].type == 228 || this.armor[k].type == 229 || this.armor[k].type == 230 || this.armor[k].type == 960 || this.armor[k].type == 961 || this.armor[k].type == 962)
					{
						this.statManaMax2 += 20;
					}
					if (this.armor[k].type == 228 || this.armor[k].type == 960)
					{
						this.statManaMax2 += 20;
					}
					if (this.armor[k].type == 228 || this.armor[k].type == 229 || this.armor[k].type == 230 || this.armor[k].type == 960 || this.armor[k].type == 961 || this.armor[k].type == 962)
					{
						this.magicCrit += 4;
					}
					if (this.armor[k].type == 100 || this.armor[k].type == 101 || this.armor[k].type == 102)
					{
						this.meleeSpeed += 0.07f;
					}
					if (this.armor[k].type == 956 || this.armor[k].type == 957 || this.armor[k].type == 958)
					{
						this.meleeSpeed += 0.07f;
					}
					if (this.armor[k].type == 792 || this.armor[k].type == 793 || this.armor[k].type == 794)
					{
						this.meleeDamage += 0.02f;
						this.rangedDamage += 0.02f;
						this.magicDamage += 0.02f;
						this.thrownDamage += 0.02f;
					}
					if (this.armor[k].type == 371)
					{
						this.magicCrit += 9;
						this.statManaMax2 += 40;
					}
					if (this.armor[k].type == 372)
					{
						this.moveSpeed += 0.07f;
						this.meleeSpeed += 0.12f;
					}
					if (this.armor[k].type == 373)
					{
						this.rangedDamage += 0.1f;
						this.rangedCrit += 6;
					}
					if (this.armor[k].type == 374)
					{
						this.magicCrit += 3;
						this.meleeCrit += 3;
						this.rangedCrit += 3;
					}
					if (this.armor[k].type == 375)
					{
						this.moveSpeed += 0.1f;
					}
					if (this.armor[k].type == 376)
					{
						this.magicDamage += 0.15f;
						this.statManaMax2 += 60;
					}
					if (this.armor[k].type == 377)
					{
						this.meleeCrit += 5;
						this.meleeDamage += 0.1f;
					}
					if (this.armor[k].type == 378)
					{
						this.rangedDamage += 0.12f;
						this.rangedCrit += 7;
					}
					if (this.armor[k].type == 379)
					{
						this.rangedDamage += 0.05f;
						this.meleeDamage += 0.05f;
						this.magicDamage += 0.05f;
					}
					if (this.armor[k].type == 380)
					{
						this.magicCrit += 3;
						this.meleeCrit += 3;
						this.rangedCrit += 3;
					}
					if (this.armor[k].type >= 2367 && this.armor[k].type <= 2369)
					{
						this.fishingSkill += 5;
					}
					if (this.armor[k].type == 400)
					{
						this.magicDamage += 0.11f;
						this.magicCrit += 11;
						this.statManaMax2 += 80;
					}
					if (this.armor[k].type == 401)
					{
						this.meleeCrit += 7;
						this.meleeDamage += 0.14f;
					}
					if (this.armor[k].type == 402)
					{
						this.rangedDamage += 0.14f;
						this.rangedCrit += 8;
					}
					if (this.armor[k].type == 403)
					{
						this.rangedDamage += 0.06f;
						this.meleeDamage += 0.06f;
						this.magicDamage += 0.06f;
					}
					if (this.armor[k].type == 404)
					{
						this.magicCrit += 4;
						this.meleeCrit += 4;
						this.rangedCrit += 4;
						this.moveSpeed += 0.05f;
					}
					if (this.armor[k].type == 1205)
					{
						this.meleeDamage += 0.08f;
						this.meleeSpeed += 0.12f;
					}
					if (this.armor[k].type == 1206)
					{
						this.rangedDamage += 0.09f;
						this.rangedCrit += 9;
					}
					if (this.armor[k].type == 1207)
					{
						this.magicDamage += 0.07f;
						this.magicCrit += 7;
						this.statManaMax2 += 60;
					}
					if (this.armor[k].type == 1208)
					{
						this.meleeDamage += 0.03f;
						this.rangedDamage += 0.03f;
						this.magicDamage += 0.03f;
						this.magicCrit += 2;
						this.meleeCrit += 2;
						this.rangedCrit += 2;
					}
					if (this.armor[k].type == 1209)
					{
						this.meleeDamage += 0.02f;
						this.rangedDamage += 0.02f;
						this.magicDamage += 0.02f;
						this.magicCrit++;
						this.meleeCrit++;
						this.rangedCrit++;
					}
					if (this.armor[k].type == 1210)
					{
						this.meleeDamage += 0.07f;
						this.meleeSpeed += 0.07f;
						this.moveSpeed += 0.07f;
					}
					if (this.armor[k].type == 1211)
					{
						this.rangedCrit += 15;
						this.moveSpeed += 0.08f;
					}
					if (this.armor[k].type == 1212)
					{
						this.magicCrit += 18;
						this.statManaMax2 += 80;
					}
					if (this.armor[k].type == 1213)
					{
						this.magicCrit += 6;
						this.meleeCrit += 6;
						this.rangedCrit += 6;
					}
					if (this.armor[k].type == 1214)
					{
						this.moveSpeed += 0.11f;
					}
					if (this.armor[k].type == 1215)
					{
						this.meleeDamage += 0.08f;
						this.meleeCrit += 8;
						this.meleeSpeed += 0.08f;
					}
					if (this.armor[k].type == 1216)
					{
						this.rangedDamage += 0.16f;
						this.rangedCrit += 7;
					}
					if (this.armor[k].type == 1217)
					{
						this.magicDamage += 0.16f;
						this.magicCrit += 7;
						this.statManaMax2 += 100;
					}
					if (this.armor[k].type == 1218)
					{
						this.meleeDamage += 0.04f;
						this.rangedDamage += 0.04f;
						this.magicDamage += 0.04f;
						this.magicCrit += 3;
						this.meleeCrit += 3;
						this.rangedCrit += 3;
					}
					if (this.armor[k].type == 1219)
					{
						this.meleeDamage += 0.03f;
						this.rangedDamage += 0.03f;
						this.magicDamage += 0.03f;
						this.magicCrit += 3;
						this.meleeCrit += 3;
						this.rangedCrit += 3;
						this.moveSpeed += 0.06f;
					}
					if (this.armor[k].type == 558)
					{
						this.magicDamage += 0.12f;
						this.magicCrit += 12;
						this.statManaMax2 += 100;
					}
					if (this.armor[k].type == 559)
					{
						this.meleeCrit += 10;
						this.meleeDamage += 0.1f;
						this.meleeSpeed += 0.1f;
					}
					if (this.armor[k].type == 553)
					{
						this.rangedDamage += 0.15f;
						this.rangedCrit += 8;
					}
					if (this.armor[k].type == 551)
					{
						this.magicCrit += 7;
						this.meleeCrit += 7;
						this.rangedCrit += 7;
					}
					if (this.armor[k].type == 552)
					{
						this.rangedDamage += 0.07f;
						this.meleeDamage += 0.07f;
						this.magicDamage += 0.07f;
						this.moveSpeed += 0.08f;
					}
					if (this.armor[k].type == 1001)
					{
						this.meleeDamage += 0.16f;
						this.meleeCrit += 6;
					}
					if (this.armor[k].type == 1002)
					{
						this.rangedDamage += 0.16f;
						this.ammoCost80 = true;
					}
					if (this.armor[k].type == 1003)
					{
						this.statManaMax2 += 80;
						this.manaCost -= 0.17f;
						this.magicDamage += 0.16f;
					}
					if (this.armor[k].type == 1004)
					{
						this.meleeDamage += 0.05f;
						this.magicDamage += 0.05f;
						this.rangedDamage += 0.05f;
						this.magicCrit += 7;
						this.meleeCrit += 7;
						this.rangedCrit += 7;
					}
					if (this.armor[k].type == 1005)
					{
						this.magicCrit += 8;
						this.meleeCrit += 8;
						this.rangedCrit += 8;
						this.moveSpeed += 0.05f;
					}
					if (this.armor[k].type == 2189)
					{
						this.statManaMax2 += 60;
						this.manaCost -= 0.13f;
						this.magicDamage += 0.05f;
						this.magicCrit += 5;
					}
					if (this.armor[k].type == 1503)
					{
						this.magicDamage -= 0.4f;
					}
					if (this.armor[k].type == 1504)
					{
						this.magicDamage += 0.07f;
						this.magicCrit += 7;
					}
					if (this.armor[k].type == 1505)
					{
						this.magicDamage += 0.08f;
						this.moveSpeed += 0.08f;
					}
					if (this.armor[k].type == 1546)
					{
						this.rangedCrit += 5;
						this.arrowDamage += 0.15f;
					}
					if (this.armor[k].type == 1547)
					{
						this.rangedCrit += 5;
						this.bulletDamage += 0.15f;
					}
					if (this.armor[k].type == 1548)
					{
						this.rangedCrit += 5;
						this.rocketDamage += 0.15f;
					}
					if (this.armor[k].type == 1549)
					{
						this.rangedCrit += 13;
						this.rangedDamage += 0.13f;
						this.ammoCost80 = true;
					}
					if (this.armor[k].type == 1550)
					{
						this.rangedCrit += 7;
						this.moveSpeed += 0.12f;
					}
					if (this.armor[k].type == 1282)
					{
						this.statManaMax2 += 20;
						this.manaCost -= 0.05f;
					}
					if (this.armor[k].type == 1283)
					{
						this.statManaMax2 += 40;
						this.manaCost -= 0.07f;
					}
					if (this.armor[k].type == 1284)
					{
						this.statManaMax2 += 40;
						this.manaCost -= 0.09f;
					}
					if (this.armor[k].type == 1285)
					{
						this.statManaMax2 += 60;
						this.manaCost -= 0.11f;
					}
					if (this.armor[k].type == 1286)
					{
						this.statManaMax2 += 60;
						this.manaCost -= 0.13f;
					}
					if (this.armor[k].type == 1287)
					{
						this.statManaMax2 += 80;
						this.manaCost -= 0.15f;
					}
					if (this.armor[k].type == 1316 || this.armor[k].type == 1317 || this.armor[k].type == 1318)
					{
						this.aggro += 250;
					}
					if (this.armor[k].type == 1316)
					{
						this.meleeDamage += 0.06f;
					}
					if (this.armor[k].type == 1317)
					{
						this.meleeDamage += 0.08f;
						this.meleeCrit += 8;
					}
					if (this.armor[k].type == 1318)
					{
						this.meleeCrit += 4;
					}
					if (this.armor[k].type == 2199 || this.armor[k].type == 2202)
					{
						this.aggro += 250;
					}
					if (this.armor[k].type == 2201)
					{
						this.aggro += 400;
					}
					if (this.armor[k].type == 2199)
					{
						this.meleeDamage += 0.06f;
					}
					if (this.armor[k].type == 2200)
					{
						this.meleeDamage += 0.08f;
						this.meleeCrit += 8;
						this.meleeSpeed += 0.06f;
						this.moveSpeed += 0.06f;
					}
					if (this.armor[k].type == 2201)
					{
						this.meleeDamage += 0.05f;
						this.meleeCrit += 5;
					}
					if (this.armor[k].type == 2202)
					{
						this.meleeSpeed += 0.06f;
						this.moveSpeed += 0.06f;
					}
					if (this.armor[k].type == 684)
					{
						this.rangedDamage += 0.16f;
						this.meleeDamage += 0.16f;
					}
					if (this.armor[k].type == 685)
					{
						this.meleeCrit += 11;
						this.rangedCrit += 11;
					}
					if (this.armor[k].type == 686)
					{
						this.moveSpeed += 0.08f;
						this.meleeSpeed += 0.07f;
					}
					if (this.armor[k].type == 2361)
					{
						this.maxMinions++;
						this.minionDamage += 0.04f;
					}
					if (this.armor[k].type == 2362)
					{
						this.maxMinions++;
						this.minionDamage += 0.04f;
					}
					if (this.armor[k].type == 2363)
					{
						this.minionDamage += 0.05f;
					}
					if (this.armor[k].type >= 1158 && this.armor[k].type <= 1161)
					{
						this.maxMinions++;
					}
					if (this.armor[k].type >= 1159 && this.armor[k].type <= 1161)
					{
						this.minionDamage += 0.1f;
					}
					if (this.armor[k].type >= 2370 && this.armor[k].type <= 2371)
					{
						this.minionDamage += 0.05f;
						this.maxMinions++;
					}
					if (this.armor[k].type == 2372)
					{
						this.minionDamage += 0.06f;
						this.maxMinions++;
					}
					if (this.armor[k].type == 3381 || this.armor[k].type == 3382 || this.armor[k].type == 3383)
					{
						if (this.armor[k].type != 3381)
						{
							this.maxMinions++;
						}
						this.maxMinions++;
						this.minionDamage += 0.22f;
					}
					if (this.armor[k].type == 2763)
					{
						this.aggro += 300;
						this.meleeCrit += 17;
					}
					if (this.armor[k].type == 2764)
					{
						this.aggro += 300;
						this.meleeDamage += 0.22f;
					}
					if (this.armor[k].type == 2765)
					{
						this.aggro += 300;
						this.meleeSpeed += 0.15f;
						this.moveSpeed += 0.15f;
					}
					if (this.armor[k].type == 2757)
					{
						this.rangedCrit += 7;
						this.rangedDamage += 0.16f;
					}
					if (this.armor[k].type == 2758)
					{
						this.ammoCost75 = true;
						this.rangedCrit += 12;
						this.rangedDamage += 0.12f;
					}
					if (this.armor[k].type == 2759)
					{
						this.rangedCrit += 8;
						this.rangedDamage += 0.08f;
						this.moveSpeed += 0.1f;
					}
					if (this.armor[k].type == 2760)
					{
						this.statManaMax2 += 60;
						this.manaCost -= 0.15f;
						this.magicCrit += 7;
						this.magicDamage += 0.07f;
					}
					if (this.armor[k].type == 2761)
					{
						this.magicDamage += 0.09f;
						this.magicCrit += 9;
					}
					if (this.armor[k].type == 2762)
					{
						this.moveSpeed += 0.1f;
						this.magicDamage += 0.1f;
					}
					if (this.armor[k].type >= 1832 && this.armor[k].type <= 1834)
					{
						this.maxMinions++;
					}
					if (this.armor[k].type >= 1832 && this.armor[k].type <= 1834)
					{
						this.minionDamage += 0.11f;
					}
					if (this.armor[k].prefix == 62)
					{
						this.statDefense++;
					}
					if (this.armor[k].prefix == 63)
					{
						this.statDefense += 2;
					}
					if (this.armor[k].prefix == 64)
					{
						this.statDefense += 3;
					}
					if (this.armor[k].prefix == 65)
					{
						this.statDefense += 4;
					}
					if (this.armor[k].prefix == 66)
					{
						this.statManaMax2 += 20;
					}
					if (this.armor[k].prefix == 67)
					{
						this.meleeCrit += 2;
						this.rangedCrit += 2;
						this.magicCrit += 2;
						this.thrownCrit += 2;
					}
					if (this.armor[k].prefix == 68)
					{
						this.meleeCrit += 4;
						this.rangedCrit += 4;
						this.magicCrit += 4;
						this.thrownCrit += 4;
					}
					if (this.armor[k].prefix == 69)
					{
						this.meleeDamage += 0.01f;
						this.rangedDamage += 0.01f;
						this.magicDamage += 0.01f;
						this.minionDamage += 0.01f;
						this.thrownDamage += 0.01f;
					}
					if (this.armor[k].prefix == 70)
					{
						this.meleeDamage += 0.02f;
						this.rangedDamage += 0.02f;
						this.magicDamage += 0.02f;
						this.minionDamage += 0.02f;
						this.thrownDamage += 0.02f;
					}
					if (this.armor[k].prefix == 71)
					{
						this.meleeDamage += 0.03f;
						this.rangedDamage += 0.03f;
						this.magicDamage += 0.03f;
						this.minionDamage += 0.03f;
						this.thrownDamage += 0.03f;
					}
					if (this.armor[k].prefix == 72)
					{
						this.meleeDamage += 0.04f;
						this.rangedDamage += 0.04f;
						this.magicDamage += 0.04f;
						this.minionDamage += 0.04f;
						this.thrownDamage += 0.04f;
					}
					if (this.armor[k].prefix == 73)
					{
						this.moveSpeed += 0.01f;
					}
					if (this.armor[k].prefix == 74)
					{
						this.moveSpeed += 0.02f;
					}
					if (this.armor[k].prefix == 75)
					{
						this.moveSpeed += 0.03f;
					}
					if (this.armor[k].prefix == 76)
					{
						this.moveSpeed += 0.04f;
					}
					if (this.armor[k].prefix == 77)
					{
						this.meleeSpeed += 0.01f;
					}
					if (this.armor[k].prefix == 78)
					{
						this.meleeSpeed += 0.02f;
					}
					if (this.armor[k].prefix == 79)
					{
						this.meleeSpeed += 0.03f;
					}
					if (this.armor[k].prefix == 80)
					{
						this.meleeSpeed += 0.04f;
					}
				}
			}
			bool flag = false;
			bool flag2 = false;
			bool flag3 = false;
			for (int l = 3; l < 8 + this.extraAccessorySlots; l++)
			{
				if (!this.armor[l].expertOnly || Main.expertMode)
				{
					if (this.armor[l].type == 3810 || this.armor[l].type == 3809 || this.armor[l].type == 3812 || this.armor[l].type == 3811)
					{
						this.dd2Accessory = true;
					}
					if (this.armor[l].type == 3015)
					{
						this.aggro -= 400;
						this.meleeCrit += 5;
						this.magicCrit += 5;
						this.rangedCrit += 5;
						this.thrownCrit += 5;
						this.meleeDamage += 0.05f;
						this.magicDamage += 0.05f;
						this.rangedDamage += 0.05f;
						this.thrownDamage += 0.05f;
						this.minionDamage += 0.05f;
					}
					if (this.armor[l].type == 3016)
					{
						this.aggro += 400;
					}
					if (this.armor[l].type == 2373)
					{
						this.accFishingLine = true;
					}
					if (this.armor[l].type == 2374)
					{
						this.fishingSkill += 10;
					}
					if (this.armor[l].type == 2375)
					{
						this.accTackleBox = true;
					}
					if (this.armor[l].type == 3721)
					{
						this.accFishingLine = true;
						this.accTackleBox = true;
						this.fishingSkill += 10;
					}
					if (this.armor[l].type == 3090)
					{
						this.npcTypeNoAggro[1] = true;
						this.npcTypeNoAggro[16] = true;
						this.npcTypeNoAggro[59] = true;
						this.npcTypeNoAggro[71] = true;
						this.npcTypeNoAggro[81] = true;
						this.npcTypeNoAggro[138] = true;
						this.npcTypeNoAggro[121] = true;
						this.npcTypeNoAggro[122] = true;
						this.npcTypeNoAggro[141] = true;
						this.npcTypeNoAggro[147] = true;
						this.npcTypeNoAggro[183] = true;
						this.npcTypeNoAggro[184] = true;
						this.npcTypeNoAggro[204] = true;
						this.npcTypeNoAggro[225] = true;
						this.npcTypeNoAggro[244] = true;
						this.npcTypeNoAggro[302] = true;
						this.npcTypeNoAggro[333] = true;
						this.npcTypeNoAggro[335] = true;
						this.npcTypeNoAggro[334] = true;
						this.npcTypeNoAggro[336] = true;
						this.npcTypeNoAggro[537] = true;
					}
					if (this.armor[l].stringColor > 0)
					{
						this.yoyoString = true;
					}
					if (this.armor[l].type == 3366)
					{
						this.counterWeight = 556 + Main.rand.Next(6);
						this.yoyoGlove = true;
						this.yoyoString = true;
					}
					if (this.armor[l].type >= 3309 && this.armor[l].type <= 3314)
					{
						this.counterWeight = 556 + this.armor[l].type - 3309;
					}
					if (this.armor[l].type == 3334)
					{
						this.yoyoGlove = true;
					}
					if (this.armor[l].type == 3337)
					{
						this.shinyStone = true;
					}
					if (this.armor[l].type == 3336)
					{
						this.SporeSac();
						this.sporeSac = true;
					}
					if (this.armor[l].type == 2423)
					{
						this.autoJump = true;
						this.jumpSpeedBoost += 2.4f;
						this.extraFall += 15;
					}
					if (this.armor[l].type == 857)
					{
						this.doubleJumpSandstorm = true;
					}
					if (this.armor[l].type == 983)
					{
						this.doubleJumpSandstorm = true;
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 987)
					{
						this.doubleJumpBlizzard = true;
					}
					if (this.armor[l].type == 1163)
					{
						this.doubleJumpBlizzard = true;
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 1724)
					{
						this.doubleJumpFart = true;
					}
					if (this.armor[l].type == 1863)
					{
						this.doubleJumpFart = true;
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 1164)
					{
						this.doubleJumpCloud = true;
						this.doubleJumpSandstorm = true;
						this.doubleJumpBlizzard = true;
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 1250)
					{
						this.jumpBoost = true;
						this.doubleJumpCloud = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 1252)
					{
						this.doubleJumpSandstorm = true;
						this.jumpBoost = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 1251)
					{
						this.doubleJumpBlizzard = true;
						this.jumpBoost = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 3250)
					{
						this.doubleJumpFart = true;
						this.jumpBoost = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 3252)
					{
						this.doubleJumpSail = true;
						this.jumpBoost = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 3251)
					{
						this.jumpBoost = true;
						this.bee = true;
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 1249)
					{
						this.jumpBoost = true;
						this.bee = true;
					}
					if (this.armor[l].type == 3241)
					{
						this.jumpBoost = true;
						this.doubleJumpSail = true;
					}
					if (this.armor[l].type == 1253 && (double)this.statLife <= (double)this.statLifeMax2 * 0.5)
					{
						this.AddBuff(62, 5, true);
					}
					if (this.armor[l].type == 1290)
					{
						this.panic = true;
					}
					if ((this.armor[l].type == 1300 || this.armor[l].type == 1858) && (this.inventory[this.selectedItem].useAmmo == AmmoID.Bullet || this.inventory[this.selectedItem].useAmmo == AmmoID.CandyCorn || this.inventory[this.selectedItem].useAmmo == AmmoID.Stake || this.inventory[this.selectedItem].useAmmo == 23))
					{
						this.scope = true;
					}
					if (this.armor[l].type == 1858)
					{
						this.rangedCrit += 10;
						this.rangedDamage += 0.1f;
					}
					if (this.armor[l].type == 1303 && this.wet)
					{
						Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.2f, 0.6f);
					}
					if (this.armor[l].type == 1301)
					{
						this.meleeCrit += 8;
						this.rangedCrit += 8;
						this.magicCrit += 8;
						this.thrownCrit += 8;
						this.meleeDamage += 0.1f;
						this.rangedDamage += 0.1f;
						this.magicDamage += 0.1f;
						this.minionDamage += 0.1f;
						this.thrownDamage += 0.1f;
					}
					if (this.armor[l].type == 982)
					{
						this.statManaMax2 += 20;
						this.manaRegenDelayBonus++;
						this.manaRegenBonus += 25;
					}
					if (this.armor[l].type == 1595)
					{
						this.statManaMax2 += 20;
						this.magicCuffs = true;
					}
					if (this.armor[l].type == 2219)
					{
						this.manaMagnet = true;
					}
					if (this.armor[l].type == 2220)
					{
						this.manaMagnet = true;
						this.magicDamage += 0.15f;
					}
					if (this.armor[l].type == 2221)
					{
						this.manaMagnet = true;
						this.magicCuffs = true;
					}
					if (this.whoAmI == Main.myPlayer && this.armor[l].type == 1923)
					{
						Player.tileRangeX++;
						Player.tileRangeY++;
					}
					if (this.armor[l].type == 1247)
					{
						this.starCloak = true;
						this.bee = true;
					}
					if (this.armor[l].type == 1248)
					{
						this.meleeCrit += 10;
						this.rangedCrit += 10;
						this.magicCrit += 10;
						this.thrownCrit += 10;
					}
					if (this.armor[l].type == 854)
					{
						this.discount = true;
					}
					if (this.armor[l].type == 855)
					{
						this.coins = true;
					}
					if (this.armor[l].type == 3033)
					{
						this.goldRing = true;
					}
					if (this.armor[l].type == 3034)
					{
						this.goldRing = true;
						this.coins = true;
					}
					if (this.armor[l].type == 3035)
					{
						this.goldRing = true;
						this.coins = true;
						this.discount = true;
					}
					if (this.armor[l].type == 53)
					{
						this.doubleJumpCloud = true;
					}
					if (this.armor[l].type == 3201)
					{
						this.doubleJumpSail = true;
					}
					if (this.armor[l].type == 54)
					{
						this.accRunSpeed = 6f;
					}
					if (this.armor[l].type == 3068)
					{
						this.cordage = true;
					}
					if (this.armor[l].type == 1579)
					{
						this.accRunSpeed = 6f;
						this.coldDash = true;
					}
					if (this.armor[l].type == 3200)
					{
						this.accRunSpeed = 6f;
						this.sailDash = true;
					}
					if (this.armor[l].type == 128)
					{
						this.rocketBoots = 1;
					}
					if (this.armor[l].type == 156)
					{
						this.noKnockback = true;
					}
					if (this.armor[l].type == 158)
					{
						this.noFallDmg = true;
					}
					if (this.armor[l].type == 934)
					{
						this.carpet = true;
					}
					if (this.armor[l].type == 953)
					{
						this.spikedBoots++;
					}
					if (this.armor[l].type == 975)
					{
						this.spikedBoots++;
					}
					if (this.armor[l].type == 976)
					{
						this.spikedBoots += 2;
					}
					if (this.armor[l].type == 977)
					{
						this.dash = 1;
					}
					if (this.armor[l].type == 3097)
					{
						this.dash = 2;
					}
					if (this.armor[l].type == 963)
					{
						this.blackBelt = true;
					}
					if (this.armor[l].type == 984)
					{
						this.blackBelt = true;
						this.dash = 1;
						this.spikedBoots = 2;
					}
					if (this.armor[l].type == 1131)
					{
						this.gravControl2 = true;
					}
					if (this.armor[l].type == 1132)
					{
						this.bee = true;
					}
					if (this.armor[l].type == 1578)
					{
						this.bee = true;
						this.panic = true;
					}
					if (this.armor[l].type == 3224)
					{
						this.endurance += 0.17f;
					}
					if (this.armor[l].type == 3223)
					{
						this.brainOfConfusion = true;
					}
					if (this.armor[l].type == 950)
					{
						this.iceSkate = true;
					}
					if (this.armor[l].type == 159)
					{
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 3225)
					{
						this.jumpBoost = true;
					}
					if (this.armor[l].type == 187)
					{
						this.accFlipper = true;
					}
					if (this.armor[l].type == 211)
					{
						this.meleeSpeed += 0.12f;
					}
					if (this.armor[l].type == 223)
					{
						this.manaCost -= 0.06f;
					}
					if (this.armor[l].type == 285)
					{
						this.moveSpeed += 0.05f;
					}
					if (this.armor[l].type == 212)
					{
						this.moveSpeed += 0.1f;
					}
					if (this.armor[l].type == 267)
					{
						this.killGuide = true;
					}
					if (this.armor[l].type == 1307)
					{
						this.killClothier = true;
					}
					if (this.armor[l].type == 193)
					{
						this.fireWalk = true;
					}
					if (this.armor[l].type == 861)
					{
						this.accMerman = true;
						this.wolfAcc = true;
						if (this.hideVisual[l])
						{
							this.hideMerman = true;
							this.hideWolf = true;
						}
					}
					if (this.armor[l].type == 862)
					{
						this.starCloak = true;
						this.longInvince = true;
					}
					if (this.armor[l].type == 860)
					{
						this.pStone = true;
					}
					if (this.armor[l].type == 863)
					{
						this.waterWalk2 = true;
					}
					if (this.armor[l].type == 907)
					{
						this.waterWalk2 = true;
						this.fireWalk = true;
					}
					if (this.armor[l].type == 908)
					{
						this.waterWalk = true;
						this.fireWalk = true;
						this.lavaMax += 420;
					}
					if (this.armor[l].type == 906)
					{
						this.lavaMax += 420;
					}
					if (this.armor[l].type == 485)
					{
						this.wolfAcc = true;
						if (this.hideVisual[l])
						{
							this.hideWolf = true;
						}
					}
					if (this.armor[l].type == 486)
					{
						this.rulerLine = true;
					}
					if (this.armor[l].type == 2799)
					{
						this.rulerGrid = true;
					}
					if (this.armor[l].type == 394)
					{
						this.accFlipper = true;
						this.accDivingHelm = true;
					}
					if (this.armor[l].type == 396)
					{
						this.noFallDmg = true;
						this.fireWalk = true;
					}
					if (this.armor[l].type == 397)
					{
						this.noKnockback = true;
						this.fireWalk = true;
					}
					if (this.armor[l].type == 399)
					{
						this.jumpBoost = true;
						this.doubleJumpCloud = true;
					}
					if (this.armor[l].type == 405)
					{
						this.accRunSpeed = 6f;
						this.rocketBoots = 2;
					}
					if (this.armor[l].type == 1860)
					{
						this.accFlipper = true;
						this.accDivingHelm = true;
						if (this.wet)
						{
							Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.2f, 0.6f);
						}
					}
					if (this.armor[l].type == 1861)
					{
						this.arcticDivingGear = true;
						this.accFlipper = true;
						this.accDivingHelm = true;
						this.iceSkate = true;
						if (this.wet)
						{
							Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.2f, 0.8f, 0.9f);
						}
					}
					if (this.armor[l].type == 2214)
					{
						flag2 = true;
					}
					if (this.armor[l].type == 2215)
					{
						flag3 = true;
					}
					if (this.armor[l].type == 2216)
					{
						this.autoPaint = true;
					}
					if (this.armor[l].type == 2217)
					{
						flag = true;
					}
					if (this.armor[l].type == 3061)
					{
						flag = true;
						flag2 = true;
						this.autoPaint = true;
						flag3 = true;
					}
					if (this.armor[l].type == 3624)
					{
						this.autoActuator = true;
					}
					if (this.armor[l].type == 897)
					{
						this.kbGlove = true;
						this.meleeSpeed += 0.12f;
					}
					if (this.armor[l].type == 1343)
					{
						this.kbGlove = true;
						this.meleeSpeed += 0.1f;
						this.meleeDamage += 0.1f;
						this.magmaStone = true;
					}
					if (this.armor[l].type == 1167)
					{
						this.minionKB += 2f;
						this.minionDamage += 0.15f;
					}
					if (this.armor[l].type == 1864)
					{
						this.minionKB += 2f;
						this.minionDamage += 0.15f;
						this.maxMinions++;
					}
					if (this.armor[l].type == 1845)
					{
						this.minionDamage += 0.1f;
						this.maxMinions++;
					}
					if (this.armor[l].type == 1321)
					{
						this.magicQuiver = true;
						this.arrowDamage += 0.1f;
					}
					if (this.armor[l].type == 1322)
					{
						this.magmaStone = true;
					}
					if (this.armor[l].type == 1323)
					{
						this.lavaRose = true;
					}
					if (this.armor[l].type == 3333)
					{
						this.strongBees = true;
					}
					if (this.armor[l].type == 938)
					{
						this.noKnockback = true;
						if ((float)this.statLife > (float)this.statLifeMax2 * 0.25f)
						{
							this.hasPaladinShield = true;
							if (i != Main.myPlayer && this.miscCounter % 10 == 0)
							{
								int myPlayer = Main.myPlayer;
								if (Main.player[myPlayer].team == this.team && this.team != 0)
								{
									float arg_4364_0 = this.position.X - Main.player[myPlayer].position.X;
									float num3 = this.position.Y - Main.player[myPlayer].position.Y;
									if ((float)Math.Sqrt((double)(arg_4364_0 * arg_4364_0 + num3 * num3)) < 800f)
									{
										Main.player[myPlayer].AddBuff(43, 20, true);
									}
								}
							}
						}
					}
					if (this.armor[l].type == 936)
					{
						this.kbGlove = true;
						this.meleeSpeed += 0.12f;
						this.meleeDamage += 0.12f;
					}
					if (this.armor[l].type == 898)
					{
						this.accRunSpeed = 6.75f;
						this.rocketBoots = 2;
						this.moveSpeed += 0.08f;
					}
					if (this.armor[l].type == 1862)
					{
						this.accRunSpeed = 6.75f;
						this.rocketBoots = 3;
						this.moveSpeed += 0.08f;
						this.iceSkate = true;
					}
					if (this.armor[l].type == 3110)
					{
						this.accMerman = true;
						this.wolfAcc = true;
						if (this.hideVisual[l])
						{
							this.hideMerman = true;
							this.hideWolf = true;
						}
					}
					if (this.armor[l].type == 1865 || this.armor[l].type == 3110)
					{
						this.lifeRegen += 2;
						this.statDefense += 4;
						this.meleeSpeed += 0.1f;
						this.meleeDamage += 0.1f;
						this.meleeCrit += 2;
						this.rangedDamage += 0.1f;
						this.rangedCrit += 2;
						this.magicDamage += 0.1f;
						this.magicCrit += 2;
						this.pickSpeed -= 0.15f;
						this.minionDamage += 0.1f;
						this.minionKB += 0.5f;
						this.thrownDamage += 0.1f;
						this.thrownCrit += 2;
					}
					if (this.armor[l].type == 899 && Main.dayTime)
					{
						this.lifeRegen += 2;
						this.statDefense += 4;
						this.meleeSpeed += 0.1f;
						this.meleeDamage += 0.1f;
						this.meleeCrit += 2;
						this.rangedDamage += 0.1f;
						this.rangedCrit += 2;
						this.magicDamage += 0.1f;
						this.magicCrit += 2;
						this.pickSpeed -= 0.15f;
						this.minionDamage += 0.1f;
						this.minionKB += 0.5f;
						this.thrownDamage += 0.1f;
						this.thrownCrit += 2;
					}
					if (this.armor[l].type == 900 && (!Main.dayTime || Main.eclipse))
					{
						this.lifeRegen += 2;
						this.statDefense += 4;
						this.meleeSpeed += 0.1f;
						this.meleeDamage += 0.1f;
						this.meleeCrit += 2;
						this.rangedDamage += 0.1f;
						this.rangedCrit += 2;
						this.magicDamage += 0.1f;
						this.magicCrit += 2;
						this.pickSpeed -= 0.15f;
						this.minionDamage += 0.1f;
						this.minionKB += 0.5f;
						this.thrownDamage += 0.1f;
						this.thrownCrit += 2;
					}
					if (this.armor[l].type == 407)
					{
						this.blockRange = 1;
					}
					if (this.armor[l].type == 489)
					{
						this.magicDamage += 0.15f;
					}
					if (this.armor[l].type == 490)
					{
						this.meleeDamage += 0.15f;
					}
					if (this.armor[l].type == 491)
					{
						this.rangedDamage += 0.15f;
					}
					if (this.armor[l].type == 2998)
					{
						this.minionDamage += 0.15f;
					}
					if (this.armor[l].type == 935)
					{
						this.magicDamage += 0.12f;
						this.meleeDamage += 0.12f;
						this.rangedDamage += 0.12f;
						this.minionDamage += 0.12f;
						this.thrownDamage += 0.12f;
					}
					if (this.armor[l].type == 492)
					{
						this.wingTimeMax = 100;
					}
					if (this.armor[l].type == 493)
					{
						this.wingTimeMax = 100;
					}
					if (this.armor[l].type == 748)
					{
						this.wingTimeMax = 115;
					}
					if (this.armor[l].type == 749)
					{
						this.wingTimeMax = 130;
					}
					if (this.armor[l].type == 761)
					{
						this.wingTimeMax = 130;
					}
					if (this.armor[l].type == 785)
					{
						this.wingTimeMax = 140;
					}
					if (this.armor[l].type == 786)
					{
						this.wingTimeMax = 140;
					}
					if (this.armor[l].type == 821)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 822)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 823)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 2280)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 2494)
					{
						this.wingTimeMax = 100;
					}
					if (this.armor[l].type == 2609)
					{
						this.wingTimeMax = 180;
						this.ignoreWater = true;
					}
					if (this.armor[l].type == 948)
					{
						this.wingTimeMax = 180;
					}
					if (this.armor[l].type == 1162)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 1165)
					{
						this.wingTimeMax = 140;
					}
					if (this.armor[l].type == 1515)
					{
						this.wingTimeMax = 130;
					}
					if (this.armor[l].type == 665)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 1583)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 1584)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 1585)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 1586)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3228)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3580)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3582)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3588)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3592)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3924)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 3928)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 1797)
					{
						this.wingTimeMax = 180;
					}
					if (this.armor[l].type == 1830)
					{
						this.wingTimeMax = 180;
					}
					if (this.armor[l].type == 1866)
					{
						this.wingTimeMax = 170;
					}
					if (this.armor[l].type == 1871)
					{
						this.wingTimeMax = 170;
					}
					if (this.armor[l].type == 2770)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 3468)
					{
						this.wingTimeMax = 180;
					}
					if (this.armor[l].type == 3469)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 3470)
					{
						this.wingTimeMax = 160;
					}
					if (this.armor[l].type == 3471)
					{
						this.wingTimeMax = 180;
					}
					if (this.armor[l].type == 3883)
					{
						this.wingTimeMax = 150;
					}
					if (this.armor[l].type == 885)
					{
						this.buffImmune[30] = true;
					}
					if (this.armor[l].type == 886)
					{
						this.buffImmune[36] = true;
					}
					if (this.armor[l].type == 887)
					{
						this.buffImmune[20] = true;
					}
					if (this.armor[l].type == 888)
					{
						this.buffImmune[22] = true;
					}
					if (this.armor[l].type == 889)
					{
						this.buffImmune[32] = true;
					}
					if (this.armor[l].type == 890)
					{
						this.buffImmune[35] = true;
					}
					if (this.armor[l].type == 891)
					{
						this.buffImmune[23] = true;
					}
					if (this.armor[l].type == 892)
					{
						this.buffImmune[33] = true;
					}
					if (this.armor[l].type == 893)
					{
						this.buffImmune[31] = true;
					}
					if (this.armor[l].type == 3781)
					{
						this.buffImmune[156] = true;
					}
					if (this.armor[l].type == 901)
					{
						this.buffImmune[33] = true;
						this.buffImmune[36] = true;
					}
					if (this.armor[l].type == 902)
					{
						this.buffImmune[30] = true;
						this.buffImmune[20] = true;
					}
					if (this.armor[l].type == 903)
					{
						this.buffImmune[32] = true;
						this.buffImmune[31] = true;
					}
					if (this.armor[l].type == 904)
					{
						this.buffImmune[35] = true;
						this.buffImmune[23] = true;
					}
					if (this.armor[l].type == 1921)
					{
						this.buffImmune[46] = true;
						this.buffImmune[47] = true;
					}
					if (this.armor[l].type == 1612)
					{
						this.buffImmune[33] = true;
						this.buffImmune[36] = true;
						this.buffImmune[30] = true;
						this.buffImmune[20] = true;
						this.buffImmune[32] = true;
						this.buffImmune[31] = true;
						this.buffImmune[35] = true;
						this.buffImmune[23] = true;
						this.buffImmune[22] = true;
					}
					if (this.armor[l].type == 1613)
					{
						this.buffImmune[46] = true;
						this.noKnockback = true;
						this.fireWalk = true;
						this.buffImmune[33] = true;
						this.buffImmune[36] = true;
						this.buffImmune[30] = true;
						this.buffImmune[20] = true;
						this.buffImmune[32] = true;
						this.buffImmune[31] = true;
						this.buffImmune[35] = true;
						this.buffImmune[23] = true;
						this.buffImmune[22] = true;
					}
					if (this.armor[l].type == 497)
					{
						this.accMerman = true;
						if (this.hideVisual[l])
						{
							this.hideMerman = true;
						}
					}
					if (this.armor[l].type == 535)
					{
						this.pStone = true;
					}
					if (this.armor[l].type == 536)
					{
						this.kbGlove = true;
					}
					if (this.armor[l].type == 532)
					{
						this.starCloak = true;
					}
					if (this.armor[l].type == 554)
					{
						this.longInvince = true;
					}
					if (this.armor[l].type == 555)
					{
						this.manaFlower = true;
						this.manaCost -= 0.08f;
					}
					if (Main.myPlayer == this.whoAmI)
					{
						if (this.armor[l].type == 576 && Main.rand.Next(10800) == 0 && Main.curMusic > 0 && Main.curMusic <= 41)
						{
							int num4 = 0;
							if (Main.curMusic == 1)
							{
								num4 = 0;
							}
							if (Main.curMusic == 2)
							{
								num4 = 1;
							}
							if (Main.curMusic == 3)
							{
								num4 = 2;
							}
							if (Main.curMusic == 4)
							{
								num4 = 4;
							}
							if (Main.curMusic == 5)
							{
								num4 = 5;
							}
							if (Main.curMusic == 6)
							{
								num4 = 3;
							}
							if (Main.curMusic == 7)
							{
								num4 = 6;
							}
							if (Main.curMusic == 8)
							{
								num4 = 7;
							}
							if (Main.curMusic == 9)
							{
								num4 = 9;
							}
							if (Main.curMusic == 10)
							{
								num4 = 8;
							}
							if (Main.curMusic == 11)
							{
								num4 = 11;
							}
							if (Main.curMusic == 12)
							{
								num4 = 10;
							}
							if (Main.curMusic == 13)
							{
								num4 = 12;
							}
							if (Main.curMusic == 28)
							{
								this.armor[l].SetDefaults(1963, false);
							}
							else if (Main.curMusic == 29)
							{
								this.armor[l].SetDefaults(1610, false);
							}
							else if (Main.curMusic == 30)
							{
								this.armor[l].SetDefaults(1963, false);
							}
							else if (Main.curMusic == 31)
							{
								this.armor[l].SetDefaults(1964, false);
							}
							else if (Main.curMusic == 32)
							{
								this.armor[l].SetDefaults(1965, false);
							}
							else if (Main.curMusic == 33)
							{
								this.armor[l].SetDefaults(2742, false);
							}
							else if (Main.curMusic == 34)
							{
								this.armor[l].SetDefaults(3370, false);
							}
							else if (Main.curMusic == 35)
							{
								this.armor[l].SetDefaults(3236, false);
							}
							else if (Main.curMusic == 36)
							{
								this.armor[l].SetDefaults(3237, false);
							}
							else if (Main.curMusic == 37)
							{
								this.armor[l].SetDefaults(3235, false);
							}
							else if (Main.curMusic == 38)
							{
								this.armor[l].SetDefaults(3044, false);
							}
							else if (Main.curMusic == 39)
							{
								this.armor[l].SetDefaults(3371, false);
							}
							else if (Main.curMusic == 40)
							{
								this.armor[l].SetDefaults(3796, false);
							}
							else if (Main.curMusic == 41)
							{
								this.armor[l].SetDefaults(3869, false);
							}
							else if (Main.curMusic > 13)
							{
								this.armor[l].SetDefaults(1596 + Main.curMusic - 14, false);
							}
							else
							{
								this.armor[l].SetDefaults(num4 + 562, false);
							}
						}
						if (this.armor[l].type >= 562 && this.armor[l].type <= 574)
						{
							Main.musicBox2 = this.armor[l].type - 562;
						}
						if (this.armor[l].type >= 1596 && this.armor[l].type <= 1609)
						{
							Main.musicBox2 = this.armor[l].type - 1596 + 13;
						}
						if (this.armor[l].type == 1610)
						{
							Main.musicBox2 = 27;
						}
						if (this.armor[l].type == 1963)
						{
							Main.musicBox2 = 28;
						}
						if (this.armor[l].type == 1964)
						{
							Main.musicBox2 = 29;
						}
						if (this.armor[l].type == 1965)
						{
							Main.musicBox2 = 30;
						}
						if (this.armor[l].type == 2742)
						{
							Main.musicBox2 = 31;
						}
						if (this.armor[l].type == 3044)
						{
							Main.musicBox2 = 32;
						}
						if (this.armor[l].type == 3235)
						{
							Main.musicBox2 = 33;
						}
						if (this.armor[l].type == 3236)
						{
							Main.musicBox2 = 34;
						}
						if (this.armor[l].type == 3237)
						{
							Main.musicBox2 = 35;
						}
						if (this.armor[l].type == 3370)
						{
							Main.musicBox2 = 36;
						}
						if (this.armor[l].type == 3371)
						{
							Main.musicBox2 = 37;
						}
						if (this.armor[l].type == 3796)
						{
							Main.musicBox2 = 38;
						}
						if (this.armor[l].type == 3869)
						{
							Main.musicBox2 = 39;
						}
					}
				}
			}
			if (this.dd2Accessory)
			{
				this.minionDamage += 0.1f;
				this.maxTurrets++;
			}
			for (int m = 3; m < 8 + this.extraAccessorySlots; m++)
			{
				if (this.armor[m].wingSlot > 0)
				{
					if (!this.hideVisual[m] || (this.velocity.Y != 0f && !this.mount.Active))
					{
						this.wings = (int)this.armor[m].wingSlot;
					}
					this.wingsLogic = (int)this.armor[m].wingSlot;
				}
			}
			for (int n = 13; n < 18 + this.extraAccessorySlots; n++)
			{
				int type4 = this.armor[n].type;
				if (this.armor[n].wingSlot > 0)
				{
					this.wings = (int)this.armor[n].wingSlot;
				}
				if (type4 == 861 || type4 == 3110 || type4 == 485)
				{
					this.hideWolf = false;
					this.forceWerewolf = true;
				}
				if (((this.wet && !this.lavaWet && (!this.mount.Active || this.mount.Type != 3)) || !this.forceWerewolf) && (type4 == 861 || type4 == 3110 || type4 == 497))
				{
					this.hideMerman = false;
					this.forceMerman = true;
				}
			}
			if (this.whoAmI == Main.myPlayer && Main.clock && this.accWatch < 3)
			{
				this.accWatch++;
			}
			if (flag2)
			{
				this.tileSpeed += 0.5f;
			}
			if (flag)
			{
				this.wallSpeed += 0.5f;
			}
			if (flag3 && this.whoAmI == Main.myPlayer)
			{
				Player.tileRangeX += 3;
				Player.tileRangeY += 2;
			}
			if (!this.accThirdEye)
			{
				this.accThirdEyeCounter = 0;
			}
			if (Main.netMode == 1 && this.whoAmI == Main.myPlayer)
			{
				for (int num5 = 0; num5 < 255; num5++)
				{
					if (num5 != this.whoAmI && Main.player[num5].active && !Main.player[num5].dead && Main.player[num5].team == this.team && Main.player[num5].team != 0)
					{
						int num6 = 800;
						if ((Main.player[num5].Center - base.Center).Length() < (float)num6)
						{
							if (Main.player[num5].accWatch > this.accWatch)
							{
								this.accWatch = Main.player[num5].accWatch;
							}
							if (Main.player[num5].accCompass > this.accCompass)
							{
								this.accCompass = Main.player[num5].accCompass;
							}
							if (Main.player[num5].accDepthMeter > this.accDepthMeter)
							{
								this.accDepthMeter = Main.player[num5].accDepthMeter;
							}
							if (Main.player[num5].accFishFinder)
							{
								this.accFishFinder = true;
							}
							if (Main.player[num5].accWeatherRadio)
							{
								this.accWeatherRadio = true;
							}
							if (Main.player[num5].accThirdEye)
							{
								this.accThirdEye = true;
							}
							if (Main.player[num5].accJarOfSouls)
							{
								this.accJarOfSouls = true;
							}
							if (Main.player[num5].accCalendar)
							{
								this.accCalendar = true;
							}
							if (Main.player[num5].accStopwatch)
							{
								this.accStopwatch = true;
							}
							if (Main.player[num5].accOreFinder)
							{
								this.accOreFinder = true;
							}
							if (Main.player[num5].accCritterGuide)
							{
								this.accCritterGuide = true;
							}
							if (Main.player[num5].accDreamCatcher)
							{
								this.accDreamCatcher = true;
							}
						}
					}
				}
			}
			if (!this.accDreamCatcher && this.dpsStarted)
			{
				this.dpsStarted = false;
				this.dpsEnd = DateTime.Now;
			}
		}

		// Token: 0x06000418 RID: 1048 RVA: 0x002854C4 File Offset: 0x002836C4
		public void UpdateForbiddenSetLock()
		{
			List<int> list = new List<int>();
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.type == 656 && projectile.owner == this.whoAmI)
				{
					list.Add(i);
				}
			}
			this.setForbiddenCooldownLocked = (list.Count > 1);
		}

		// Token: 0x0600038A RID: 906 RVA: 0x0024415C File Offset: 0x0024235C
		public void UpdateImmunity()
		{
			if (this.immune)
			{
				this.immuneTime--;
				if (this.immuneTime <= 0)
				{
					this.immune = false;
					this.immuneNoBlink = false;
				}
				if (this.immuneNoBlink)
				{
					this.immuneAlpha = 0;
				}
				else
				{
					this.immuneAlpha += this.immuneAlphaDirection * 50;
					if (this.immuneAlpha <= 50)
					{
						this.immuneAlphaDirection = 1;
					}
					else if (this.immuneAlpha >= 205)
					{
						this.immuneAlphaDirection = -1;
					}
				}
			}
			else
			{
				this.immuneAlpha = 0;
			}
			for (int i = 0; i < this.hurtCooldowns.Length; i++)
			{
				if (this.hurtCooldowns[i] > 0)
				{
					this.hurtCooldowns[i]--;
				}
			}
		}

		// Token: 0x0600038D RID: 909 RVA: 0x00245098 File Offset: 0x00243298
		public void UpdateJumpHeight()
		{
			if (this.mount.Active)
			{
				Player.jumpHeight = this.mount.JumpHeight(this.velocity.X);
				Player.jumpSpeed = this.mount.JumpSpeed(this.velocity.X);
			}
			else
			{
				if (this.jumpBoost)
				{
					Player.jumpHeight = 20;
					Player.jumpSpeed = 6.51f;
				}
				if (this.wereWolf)
				{
					Player.jumpHeight += 2;
					Player.jumpSpeed += 0.2f;
				}
				Player.jumpSpeed += this.jumpSpeedBoost;
			}
			if (this.sticky)
			{
				Player.jumpHeight /= 10;
				Player.jumpSpeed /= 5f;
			}
			if (this.dazed)
			{
				Player.jumpHeight /= 5;
				Player.jumpSpeed /= 2f;
			}
		}

		// Token: 0x0600038B RID: 907 RVA: 0x0024421C File Offset: 0x0024241C
		public void UpdateLifeRegen()
		{
			bool flag = false;
			if (this.shinyStone && (double)Math.Abs(this.velocity.X) < 0.05 && (double)Math.Abs(this.velocity.Y) < 0.05 && this.itemAnimation == 0)
			{
				flag = true;
			}
			if (this.poisoned)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 4;
			}
			if (this.venom)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 12;
			}
			if (this.onFire)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 8;
			}
			if (this.onFrostBurn)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 12;
			}
			if (this.onFire2)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 12;
			}
			if (this.burned)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 60;
				this.moveSpeed *= 0.5f;
			}
			if (this.suffocating)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 40;
			}
			if (this.electrified)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 8;
				if (this.controlLeft || this.controlRight)
				{
					this.lifeRegen -= 32;
				}
			}
			if (this.tongued && Main.expertMode)
			{
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
				this.lifeRegenTime = 0;
				this.lifeRegen -= 100;
			}
			if (this.honey && this.lifeRegen < 0)
			{
				this.lifeRegen += 4;
				if (this.lifeRegen > 0)
				{
					this.lifeRegen = 0;
				}
			}
			if (this.lifeRegen < 0 && this.nebulaLevelLife > 0)
			{
				this.lifeRegen = 0;
			}
			if (flag && this.lifeRegen < 0)
			{
				this.lifeRegen /= 2;
			}
			this.lifeRegenTime++;
			if (this.crimsonRegen)
			{
				this.lifeRegenTime++;
			}
			if (this.soulDrain > 0)
			{
				this.lifeRegenTime += 2;
			}
			if (flag)
			{
				if (this.lifeRegenTime > 90 && this.lifeRegenTime < 1800)
				{
					this.lifeRegenTime = 1800;
				}
				this.lifeRegenTime += 4;
				this.lifeRegen += 4;
			}
			if (this.honey)
			{
				this.lifeRegenTime += 2;
				this.lifeRegen += 2;
			}
			if (this.soulDrain > 0)
			{
				int num = (5 + this.soulDrain) / 2;
				this.lifeRegenTime += num;
				this.lifeRegen += num;
			}
			if (this.whoAmI == Main.myPlayer && Main.campfire)
			{
				this.lifeRegen++;
			}
			if (this.whoAmI == Main.myPlayer && Main.heartLantern)
			{
				this.lifeRegen += 2;
			}
			if (this.bleed)
			{
				this.lifeRegenTime = 0;
			}
			float num2 = 0f;
			if (this.lifeRegenTime >= 300)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 600)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 900)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 1200)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 1500)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 1800)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 2400)
			{
				num2 += 1f;
			}
			if (this.lifeRegenTime >= 3000)
			{
				num2 += 1f;
			}
			if (flag)
			{
				float num3 = (float)(this.lifeRegenTime - 3000);
				num3 /= 300f;
				if (num3 > 0f)
				{
					if (num3 > 30f)
					{
						num3 = 30f;
					}
					num2 += num3;
				}
			}
			else if (this.lifeRegenTime >= 3600)
			{
				num2 += 1f;
				this.lifeRegenTime = 3600;
			}
			if (this.velocity.X == 0f || this.grappling[0] > 0)
			{
				num2 *= 1.25f;
			}
			else
			{
				num2 *= 0.5f;
			}
			if (this.crimsonRegen)
			{
				num2 *= 1.5f;
			}
			if (this.shinyStone)
			{
				num2 *= 1.1f;
			}
			if (this.whoAmI == Main.myPlayer && Main.campfire)
			{
				num2 *= 1.1f;
			}
			if (Main.expertMode && !this.wellFed)
			{
				if (this.shinyStone)
				{
					num2 *= 0.75f;
				}
				else
				{
					num2 /= 2f;
				}
			}
			if (this.rabid)
			{
				if (this.shinyStone)
				{
					num2 *= 0.75f;
				}
				else
				{
					num2 /= 2f;
				}
			}
			float num4 = (float)this.statLifeMax2 / 400f * 0.85f + 0.15f;
			num2 *= num4;
			this.lifeRegen += (int)Math.Round((double)num2);
			this.lifeRegenCount += this.lifeRegen;
			if (this.palladiumRegen)
			{
				this.lifeRegenCount += 6;
			}
			if (flag && this.lifeRegen > 0 && this.statLife < this.statLifeMax2)
			{
				this.lifeRegenCount++;
				if (flag && (Main.rand.Next(30000) < this.lifeRegenTime || Main.rand.Next(30) == 0))
				{
					int num5 = Dust.NewDust(this.position, this.width, this.height, 55, 0f, 0f, 200, default(Color), 0.5f);
					Main.dust[num5].noGravity = true;
					Main.dust[num5].velocity *= 0.75f;
					Main.dust[num5].fadeIn = 1.3f;
					Vector2 vector = new Vector2((float)Main.rand.Next(-100, 101), (float)Main.rand.Next(-100, 101));
					vector.Normalize();
					vector *= (float)Main.rand.Next(50, 100) * 0.04f;
					Main.dust[num5].velocity = vector;
					vector.Normalize();
					vector *= 34f;
					Main.dust[num5].position = base.Center - vector;
				}
			}
			while (this.lifeRegenCount >= 120)
			{
				this.lifeRegenCount -= 120;
				if (this.statLife < this.statLifeMax2)
				{
					this.statLife++;
					if (this.crimsonRegen)
					{
						for (int i = 0; i < 10; i++)
						{
							int num6 = Dust.NewDust(this.position, this.width, this.height, 5, 0f, 0f, 175, default(Color), 1.75f);
							Main.dust[num6].noGravity = true;
							Main.dust[num6].velocity *= 0.75f;
							int num7 = Main.rand.Next(-40, 41);
							int num8 = Main.rand.Next(-40, 41);
							Dust expr_7F8_cp_0_cp_0 = Main.dust[num6];
							expr_7F8_cp_0_cp_0.position.X = expr_7F8_cp_0_cp_0.position.X + (float)num7;
							Dust expr_811_cp_0_cp_0 = Main.dust[num6];
							expr_811_cp_0_cp_0.position.Y = expr_811_cp_0_cp_0.position.Y + (float)num8;
							Main.dust[num6].velocity.X = (float)(-(float)num7) * 0.075f;
							Main.dust[num6].velocity.Y = (float)(-(float)num8) * 0.075f;
						}
					}
				}
				if (this.statLife > this.statLifeMax2)
				{
					this.statLife = this.statLifeMax2;
				}
			}
			if (!this.burned && !this.suffocating)
			{
				if (!this.tongued || !Main.expertMode)
				{
					while (this.lifeRegenCount <= -120)
					{
						if (this.lifeRegenCount <= -480)
						{
							this.lifeRegenCount += 480;
							this.statLife -= 4;
							CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.LifeRegen, 4, false, true);
						}
						else if (this.lifeRegenCount <= -360)
						{
							this.lifeRegenCount += 360;
							this.statLife -= 3;
							CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.LifeRegen, 3, false, true);
						}
						else if (this.lifeRegenCount <= -240)
						{
							this.lifeRegenCount += 240;
							this.statLife -= 2;
							CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.LifeRegen, 2, false, true);
						}
						else
						{
							this.lifeRegenCount += 120;
							this.statLife--;
							CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.LifeRegen, 1, false, true);
						}
						if (this.statLife <= 0 && this.whoAmI == Main.myPlayer)
						{
							if (this.poisoned || this.venom)
							{
								this.KillMe(PlayerDeathReason.ByOther(9), 10.0, 0, false);
							}
							else if (this.electrified)
							{
								this.KillMe(PlayerDeathReason.ByOther(10), 10.0, 0, false);
							}
							else
							{
								this.KillMe(PlayerDeathReason.ByOther(8), 10.0, 0, false);
							}
						}
					}
					return;
				}
			}
			while (this.lifeRegenCount <= -600)
			{
				this.lifeRegenCount += 600;
				this.statLife -= 5;
				CombatText.NewText(new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height), CombatText.LifeRegen, 5, false, true);
				if (this.statLife <= 0 && this.whoAmI == Main.myPlayer)
				{
					if (this.suffocating)
					{
						this.KillMe(PlayerDeathReason.ByOther(7), 10.0, 0, false);
					}
					else
					{
						this.KillMe(PlayerDeathReason.ByOther(8), 10.0, 0, false);
					}
				}
			}
		}

		// Token: 0x0600038C RID: 908 RVA: 0x00244DA8 File Offset: 0x00242FA8
		public void UpdateManaRegen()
		{
			if (this.nebulaLevelMana > 0)
			{
				int num = 6;
				this.nebulaManaCounter += this.nebulaLevelMana;
				if (this.nebulaManaCounter >= num)
				{
					this.nebulaManaCounter -= num;
					this.statMana++;
					if (this.statMana >= this.statManaMax2)
					{
						this.statMana = this.statManaMax2;
					}
				}
			}
			else
			{
				this.nebulaManaCounter = 0;
			}
			if (this.manaRegenDelay > 0)
			{
				this.manaRegenDelay--;
				this.manaRegenDelay -= this.manaRegenDelayBonus;
				if ((this.velocity.X == 0f && this.velocity.Y == 0f) || this.grappling[0] >= 0 || this.manaRegenBuff)
				{
					this.manaRegenDelay--;
				}
			}
			if (this.manaRegenBuff && this.manaRegenDelay > 20)
			{
				this.manaRegenDelay = 20;
			}
			if (this.manaRegenDelay <= 0)
			{
				this.manaRegenDelay = 0;
				this.manaRegen = this.statManaMax2 / 7 + 1 + this.manaRegenBonus;
				if ((this.velocity.X == 0f && this.velocity.Y == 0f) || this.grappling[0] >= 0 || this.manaRegenBuff)
				{
					this.manaRegen += this.statManaMax2 / 2;
				}
				float num2 = (float)this.statMana / (float)this.statManaMax2 * 0.8f + 0.2f;
				if (this.manaRegenBuff)
				{
					num2 = 1f;
				}
				this.manaRegen = (int)((double)((float)this.manaRegen * num2) * 1.15);
			}
			else
			{
				this.manaRegen = 0;
			}
			this.manaRegenCount += this.manaRegen;
			while (this.manaRegenCount >= 120)
			{
				bool flag = false;
				this.manaRegenCount -= 120;
				if (this.statMana < this.statManaMax2)
				{
					this.statMana++;
					flag = true;
				}
				if (this.statMana >= this.statManaMax2)
				{
					if (this.whoAmI == Main.myPlayer & flag)
					{
						Main.PlaySound(25, -1, -1, 1, 1f, 0f);
						for (int i = 0; i < 5; i++)
						{
							int num3 = Dust.NewDust(this.position, this.width, this.height, 45, 0f, 0f, 255, default(Color), (float)Main.rand.Next(20, 26) * 0.1f);
							Main.dust[num3].noLight = true;
							Main.dust[num3].noGravity = true;
							Main.dust[num3].velocity *= 0.5f;
						}
					}
					this.statMana = this.statManaMax2;
				}
			}
		}

		// Token: 0x060003ED RID: 1005 RVA: 0x0027F070 File Offset: 0x0027D270
		public void UpdateMaxTurrets()
		{
			List<Projectile> list = new List<Projectile>();
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].WipableTurret)
				{
					list.Add(Main.projectile[i]);
				}
			}
			int num = 0;
			while (list.Count > this.maxTurrets && ++num < 1000)
			{
				Projectile projectile = list[0];
				for (int j = 1; j < list.Count; j++)
				{
					if (list[j].timeLeft < projectile.timeLeft)
					{
						projectile = list[j];
					}
				}
				projectile.Kill();
				list.Remove(projectile);
			}
		}

		// Token: 0x0600041D RID: 1053 RVA: 0x00285B7C File Offset: 0x00283D7C
		public void UpdateMinionTarget()
		{
			if (this.whoAmI != Main.myPlayer)
			{
				return;
			}
			if (base.Distance(this.MinionRestTargetPoint) > 1000f)
			{
				this.MinionRestTargetPoint = Vector2.Zero;
			}
			if (this.MinionAttackTargetNPC != -1 && (!Main.npc[this.MinionAttackTargetNPC].CanBeChasedBy(this, false) || Main.npc[this.MinionAttackTargetNPC].Hitbox.Distance(base.Center) > 3000f))
			{
				this.MinionAttackTargetNPC = -1;
			}
			if (this.stardustGuardian && this.HasMinionRestTarget)
			{
				Vector2 minionRestTargetPoint = this.MinionRestTargetPoint;
				float num = (float)this.miscCounter / 150f;
				float num2 = 2.09439516f;
				for (int i = 0; i < 3; i++)
				{
					int num3 = Dust.NewDust(minionRestTargetPoint, 0, 0, 135, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num3].noGravity = true;
					Main.dust[num3].velocity = Vector2.Zero;
					Main.dust[num3].noLight = true;
					Main.dust[num3].position = minionRestTargetPoint + (num * 6.28318548f + num2 * (float)i).ToRotationVector2() * 4f;
					Main.dust[num3].shader = GameShaders.Armor.GetSecondaryShader(this.cPet, this);
				}
			}
			if (this.MinionAttackTargetNPC != -1)
			{
				Vector2 center = Main.npc[this.MinionAttackTargetNPC].Center;
				float num4 = (float)this.miscCounter / 60f;
				float num5 = 2.09439516f;
				for (int j = 0; j < 3; j++)
				{
					int num6 = Dust.NewDust(center, 0, 0, 272, 0f, 0f, 100, default(Color), 0.5f);
					Main.dust[num6].noGravity = true;
					Main.dust[num6].velocity = Vector2.Zero;
					Main.dust[num6].noLight = true;
					Main.dust[num6].position = center + (num4 * 6.28318548f + num5 * (float)j).ToRotationVector2() * 12f;
				}
			}
		}

		// Token: 0x0600037F RID: 895 RVA: 0x0023B898 File Offset: 0x00239A98
		public void UpdatePet(int i)
		{
			if (i != Main.myPlayer)
			{
				return;
			}
			if (this.miscEquips[0].buffType < 1 || this.miscEquips[0].stack < 1)
			{
				return;
			}
			int num = this.miscEquips[0].buffType;
			if (!Main.vanityPet[num] && !Main.lightPet[num])
			{
				return;
			}
			if (this.hideMisc[0])
			{
				return;
			}
			if (this.miscEquips[0].type == 603 && !Main.cEd)
			{
				return;
			}
			if (this.FindBuffIndex(num) == -1)
			{
				this.AddBuff(num, 3600, true);
				Main.PlaySound(this.miscEquips[0].UseSound, this.position);
			}
		}

		// Token: 0x06000380 RID: 896 RVA: 0x0023B94C File Offset: 0x00239B4C
		public void UpdatePetLight(int i)
		{
			if (i != Main.myPlayer)
			{
				return;
			}
			if (this.miscEquips[1].buffType < 1 || this.miscEquips[1].stack < 1)
			{
				return;
			}
			int num = this.miscEquips[1].buffType;
			if (!Main.vanityPet[num] && !Main.lightPet[num])
			{
				return;
			}
			if (this.hideMisc[1])
			{
				return;
			}
			if (this.miscEquips[1].type == 603 && !Main.cEd)
			{
				return;
			}
			int num2 = this.FindBuffIndex(num);
			if (num == 27 && num2 == -1)
			{
				num2 = this.FindBuffIndex(102);
			}
			if (num == 27 && num2 == -1)
			{
				num2 = this.FindBuffIndex(101);
			}
			if (num2 == -1)
			{
				if (num == 27)
				{
					num = Utils.SelectRandom<int>(Main.rand, new int[]
					{
						27,
						102,
						101
					});
				}
				this.AddBuff(num, 3600, true);
				Main.PlaySound(this.miscEquips[1].UseSound, this.position);
			}
		}

		// Token: 0x0600037A RID: 890 RVA: 0x0023A1D0 File Offset: 0x002383D0
		public void UpdateSocialShadow()
		{
			for (int i = 2; i > 0; i--)
			{
				this.shadowDirection[i] = this.shadowDirection[i - 1];
			}
			this.shadowDirection[0] = this.direction;
			this.shadowCount++;
			if (this.shadowCount == 1)
			{
				this.shadowPos[2] = this.shadowPos[1];
				this.shadowRotation[2] = this.shadowRotation[1];
				this.shadowOrigin[2] = this.shadowOrigin[1];
				return;
			}
			if (this.shadowCount == 2)
			{
				this.shadowPos[1] = this.shadowPos[0];
				this.shadowRotation[1] = this.shadowRotation[0];
				this.shadowOrigin[1] = this.shadowOrigin[0];
				return;
			}
			if (this.shadowCount >= 3)
			{
				this.shadowCount = 0;
				this.shadowPos[0] = this.position;
				Vector2[] expr_101_cp_0_cp_0 = this.shadowPos;
				int expr_101_cp_0_cp_1 = 0;
				expr_101_cp_0_cp_0[expr_101_cp_0_cp_1].Y = expr_101_cp_0_cp_0[expr_101_cp_0_cp_1].Y + this.gfxOffY;
				this.shadowRotation[0] = this.fullRotation;
				this.shadowOrigin[0] = this.fullRotationOrigin;
			}
		}

		// Token: 0x0600037B RID: 891 RVA: 0x0023A308 File Offset: 0x00238508
		public void UpdateTeleportVisuals()
		{
			if (this.teleportTime > 0f)
			{
				if (this.teleportStyle == 0)
				{
					if ((float)Main.rand.Next(100) <= 100f * this.teleportTime * 2f)
					{
						int num = Dust.NewDust(new Vector2((float)this.getRect().X, (float)this.getRect().Y), this.getRect().Width, this.getRect().Height, 159, 0f, 0f, 0, default(Color), 1f);
						Main.dust[num].scale = this.teleportTime * 1.5f;
						Main.dust[num].noGravity = true;
						Main.dust[num].velocity *= 1.1f;
					}
				}
				else if (this.teleportStyle == 1)
				{
					if ((float)Main.rand.Next(100) <= 100f * this.teleportTime)
					{
						int num2 = Dust.NewDust(new Vector2((float)this.getRect().X, (float)this.getRect().Y), this.getRect().Width, this.getRect().Height, 164, 0f, 0f, 0, default(Color), 1f);
						Main.dust[num2].scale = this.teleportTime * 1.5f;
						Main.dust[num2].noGravity = true;
						Main.dust[num2].velocity *= 1.1f;
					}
				}
				else if (this.teleportStyle == 2)
				{
					this.teleportTime = 0.005f;
				}
				else if (this.teleportStyle == 3)
				{
					this.teleportTime = 0.005f;
				}
				else if (this.teleportStyle == 4)
				{
					this.teleportTime -= 0.02f;
					if ((float)Main.rand.Next(100) <= 100f * this.teleportTime)
					{
						Dust expr_249 = Main.dust[Dust.NewDust(this.position, this.width, this.height, 263, 0f, 0f, 0, default(Color), 1f)];
						expr_249.color = PortalHelper.GetPortalColor(this.lastPortalColorIndex);
						expr_249.noLight = true;
						expr_249.noGravity = true;
						expr_249.scale = 1.2f;
						expr_249.fadeIn = 0.4f;
					}
				}
				this.teleportTime -= 0.005f;
			}
		}

		// Token: 0x0600041F RID: 1055 RVA: 0x00285EBC File Offset: 0x002840BC
		public void UpdateTouchingTiles()
		{
			this.TouchedTiles.Clear();
			List<Point> list = null;
			List<Point> list2 = null;
			if (!Collision.IsClearSpotTest(this.position + this.velocity, 16f, this.width, this.height, false, false, (int)this.gravDir, true, true))
			{
				list = Collision.FindCollisionTile((Math.Sign(this.velocity.Y) == 1) ? 2 : 3, this.position + this.velocity, 16f, this.width, this.height, false, false, (int)this.gravDir, true, false);
			}
			if (!Collision.IsClearSpotTest(this.position, Math.Abs(this.velocity.Y), this.width, this.height, false, false, (int)this.gravDir, true, true))
			{
				list2 = Collision.FindCollisionTile((Math.Sign(this.velocity.Y) == 1) ? 2 : 3, this.position, Math.Abs(this.velocity.Y), this.width, this.height, false, false, (int)this.gravDir, true, true);
			}
			if (list != null && list2 != null)
			{
				for (int i = 0; i < list2.Count; i++)
				{
					if (!list.Contains(list2[i]))
					{
						list.Add(list2[i]);
					}
				}
			}
			if (list == null && list2 != null)
			{
				list = list2;
			}
			if (list != null)
			{
				this.TouchedTiles = list;
			}
		}

		// Token: 0x060003AE RID: 942 RVA: 0x00259184 File Offset: 0x00257384
		private void Update_NPCCollision()
		{
			Rectangle rectangle = new Rectangle((int)this.position.X, (int)this.position.Y, this.width, this.height);
			for (int i = 0; i < 200; i++)
			{
				if (Main.npc[i].active && !Main.npc[i].friendly && Main.npc[i].damage > 0)
				{
					int num = -1;
					int type = Main.npc[i].type;
					if (type == 398 || type == 400 || type == 397 || type == 396 || type == 401)
					{
						num = 1;
					}
					if ((num != -1 || !this.immune) && (this.dash != 2 || i != this.eocHit || this.eocDash <= 0) && !this.npcTypeNoAggro[Main.npc[i].type])
					{
						float num2 = 1f;
						Rectangle rectangle2 = new Rectangle((int)Main.npc[i].position.X, (int)Main.npc[i].position.Y, Main.npc[i].width, Main.npc[i].height);
						NPC.GetMeleeCollisionData(rectangle, i, ref num, ref num2, ref rectangle2);
						if (rectangle.Intersects(rectangle2) && !this.npcTypeNoAggro[Main.npc[i].type])
						{
							bool flag = true;
							bool flag2 = false;
							bool arg_19A_0 = this.CanParryAgainst(rectangle, rectangle2, Main.npc[i].velocity);
							float num3 = this.thorns;
							float knockback = 10f;
							if (this.turtleThorns)
							{
								num3 = 1f;
							}
							if (arg_19A_0)
							{
								num3 = 2f;
								knockback = 5f;
								flag = false;
								flag2 = true;
							}
							int num4 = -1;
							if (Main.npc[i].position.X + (float)(Main.npc[i].width / 2) < this.position.X + (float)(this.width / 2))
							{
								num4 = 1;
							}
							int num5 = Main.DamageVar((float)Main.npc[i].damage * num2);
							int num6 = Item.NPCtoBanner(Main.npc[i].BannerID());
							if (num6 > 0 && this.NPCBannerBuff[num6])
							{
								if (Main.expertMode)
								{
									num5 = (int)((float)num5 * ItemID.Sets.BannerStrength[Item.BannerToItem(num6)].ExpertDamageReceived);
								}
								else
								{
									num5 = (int)((float)num5 * ItemID.Sets.BannerStrength[Item.BannerToItem(num6)].NormalDamageReceived);
								}
							}
							if (this.whoAmI == Main.myPlayer && num3 > 0f && !this.immune && !Main.npc[i].dontTakeDamage)
							{
								int damage = (int)((float)num5 * num3);
								this.ApplyDamageToNPC(Main.npc[i], damage, knockback, -num4, false);
							}
							if (this.resistCold && Main.npc[i].coldDamage)
							{
								num5 = (int)((float)num5 * 0.7f);
							}
							if (!this.immune && !flag2)
							{
								this.StatusPlayer(Main.npc[i]);
							}
							if (flag)
							{
								this.Hurt(PlayerDeathReason.ByNPC(i), num5, num4, false, false, false, num);
							}
							if (arg_19A_0)
							{
								this.immune = true;
								this.immuneNoBlink = true;
								this.immuneTime = 30;
								if (this.longInvince)
								{
									this.immuneTime = 60;
								}
								this.AddBuff(198, 300, false);
							}
						}
					}
				}
			}
		}

		// Token: 0x06000395 RID: 917 RVA: 0x00249AC4 File Offset: 0x00247CC4
		public void WallslideMovement()
		{
			this.sliding = false;
			if (this.slideDir != 0 && this.spikedBoots > 0 && !this.mount.Active && ((this.controlLeft && this.slideDir == -1) || (this.controlRight && this.slideDir == 1)))
			{
				bool flag = false;
				float num = this.position.X;
				if (this.slideDir == 1)
				{
					num += (float)this.width;
				}
				num += (float)this.slideDir;
				float num2 = this.position.Y + (float)this.height + 1f;
				if (this.gravDir < 0f)
				{
					num2 = this.position.Y - 1f;
				}
				num /= 16f;
				num2 /= 16f;
				if (WorldGen.SolidTile((int)num, (int)num2) && WorldGen.SolidTile((int)num, (int)num2 - 1))
				{
					flag = true;
				}
				if (this.spikedBoots >= 2)
				{
					if (flag && ((this.velocity.Y > 0f && this.gravDir == 1f) || (this.velocity.Y < this.gravity && this.gravDir == -1f)))
					{
						float num3 = this.gravity;
						if (this.slowFall)
						{
							if (this.controlUp)
							{
								num3 = this.gravity / 10f * this.gravDir;
							}
							else
							{
								num3 = this.gravity / 3f * this.gravDir;
							}
						}
						this.fallStart = (int)(this.position.Y / 16f);
						if ((this.controlDown && this.gravDir == 1f) || (this.controlUp && this.gravDir == -1f))
						{
							this.velocity.Y = 4f * this.gravDir;
							int num4 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)((this.width / 2 - 4) * this.slideDir), this.position.Y + (float)(this.height / 2) + (float)(this.height / 2 - 4) * this.gravDir), 8, 8, 31, 0f, 0f, 0, default(Color), 1f);
							if (this.slideDir < 0)
							{
								Dust expr_270_cp_0_cp_0 = Main.dust[num4];
								expr_270_cp_0_cp_0.position.X = expr_270_cp_0_cp_0.position.X - 10f;
							}
							if (this.gravDir < 0f)
							{
								Dust expr_298_cp_0_cp_0 = Main.dust[num4];
								expr_298_cp_0_cp_0.position.Y = expr_298_cp_0_cp_0.position.Y - 12f;
							}
							Main.dust[num4].velocity *= 0.1f;
							Main.dust[num4].scale *= 1.2f;
							Main.dust[num4].noGravity = true;
							Main.dust[num4].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
						}
						else if (this.gravDir == -1f)
						{
							this.velocity.Y = (-num3 + 1E-05f) * this.gravDir;
						}
						else
						{
							this.velocity.Y = (-num3 + 1E-05f) * this.gravDir;
						}
						this.sliding = true;
						return;
					}
				}
				else if ((flag && (double)this.velocity.Y > 0.5 && this.gravDir == 1f) || ((double)this.velocity.Y < -0.5 && this.gravDir == -1f))
				{
					this.fallStart = (int)(this.position.Y / 16f);
					if (this.controlDown)
					{
						this.velocity.Y = 4f * this.gravDir;
					}
					else
					{
						this.velocity.Y = 0.5f * this.gravDir;
					}
					this.sliding = true;
					int num5 = Dust.NewDust(new Vector2(this.position.X + (float)(this.width / 2) + (float)((this.width / 2 - 4) * this.slideDir), this.position.Y + (float)(this.height / 2) + (float)(this.height / 2 - 4) * this.gravDir), 8, 8, 31, 0f, 0f, 0, default(Color), 1f);
					if (this.slideDir < 0)
					{
						Dust expr_48D_cp_0_cp_0 = Main.dust[num5];
						expr_48D_cp_0_cp_0.position.X = expr_48D_cp_0_cp_0.position.X - 10f;
					}
					if (this.gravDir < 0f)
					{
						Dust expr_4B5_cp_0_cp_0 = Main.dust[num5];
						expr_4B5_cp_0_cp_0.position.Y = expr_4B5_cp_0_cp_0.position.Y - 12f;
					}
					Main.dust[num5].velocity *= 0.1f;
					Main.dust[num5].scale *= 1.2f;
					Main.dust[num5].noGravity = true;
					Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(this.cShoe, this);
				}
			}
		}

		// Token: 0x060003A4 RID: 932 RVA: 0x0024D720 File Offset: 0x0024B920
		public void WaterCollision(bool fallThrough, bool ignorePlats)
		{
			int height;
			if (this.onTrack)
			{
				height = this.height - 20;
			}
			else
			{
				height = this.height;
			}
			Vector2 velocity = this.velocity;
			this.velocity = Collision.TileCollision(this.position, this.velocity, this.width, height, fallThrough, ignorePlats, (int)this.gravDir);
			Vector2 value = this.velocity * 0.5f;
			if (this.velocity.X != velocity.X)
			{
				value.X = this.velocity.X;
			}
			if (this.velocity.Y != velocity.Y)
			{
				value.Y = this.velocity.Y;
			}
			this.position += value;
		}

		// Token: 0x06000398 RID: 920 RVA: 0x0024AD50 File Offset: 0x00248F50
		public void WingMovement()
		{
			if (this.wingsLogic == 4 && this.controlUp)
			{
				this.velocity.Y = this.velocity.Y - 0.2f * this.gravDir;
				if (this.gravDir == 1f)
				{
					if (this.velocity.Y > 0f)
					{
						this.velocity.Y = this.velocity.Y - 1f;
					}
					else if (this.velocity.Y > -Player.jumpSpeed)
					{
						this.velocity.Y = this.velocity.Y - 0.2f;
					}
					if (this.velocity.Y < -Player.jumpSpeed * 3f)
					{
						this.velocity.Y = -Player.jumpSpeed * 3f;
					}
				}
				else
				{
					if (this.velocity.Y < 0f)
					{
						this.velocity.Y = this.velocity.Y + 1f;
					}
					else if (this.velocity.Y < Player.jumpSpeed)
					{
						this.velocity.Y = this.velocity.Y + 0.2f;
					}
					if (this.velocity.Y > Player.jumpSpeed * 3f)
					{
						this.velocity.Y = Player.jumpSpeed * 3f;
					}
				}
				this.wingTime -= 2f;
				return;
			}
			float num = 0.1f;
			float num2 = 0.5f;
			float num3 = 1.5f;
			float num4 = 0.5f;
			float num5 = 0.1f;
			if (this.wingsLogic == 26)
			{
				num2 = 0.75f;
				num5 = 0.15f;
				num4 = 1f;
				num3 = 2.5f;
				num = 0.125f;
			}
			if (this.wingsLogic == 37)
			{
				num2 = 0.75f;
				num5 = 0.15f;
				num4 = 1f;
				num3 = 2.5f;
				num = 0.125f;
			}
			if (this.wingsLogic == 29 || this.wingsLogic == 32)
			{
				num2 = 0.85f;
				num5 = 0.15f;
				num4 = 1f;
				num3 = 3f;
				num = 0.135f;
			}
			if (this.wingsLogic == 30 || this.wingsLogic == 31)
			{
				num4 = 1f;
				num3 = 2f;
				num = 0.15f;
			}
			this.velocity.Y = this.velocity.Y - num * this.gravDir;
			if (this.gravDir == 1f)
			{
				if (this.velocity.Y > 0f)
				{
					this.velocity.Y = this.velocity.Y - num2;
				}
				else if (this.velocity.Y > -Player.jumpSpeed * num4)
				{
					this.velocity.Y = this.velocity.Y - num5;
				}
				if (this.velocity.Y < -Player.jumpSpeed * num3)
				{
					this.velocity.Y = -Player.jumpSpeed * num3;
				}
			}
			else
			{
				if (this.velocity.Y < 0f)
				{
					this.velocity.Y = this.velocity.Y + num2;
				}
				else if (this.velocity.Y < Player.jumpSpeed * num4)
				{
					this.velocity.Y = this.velocity.Y + num5;
				}
				if (this.velocity.Y > Player.jumpSpeed * num3)
				{
					this.velocity.Y = Player.jumpSpeed * num3;
				}
			}
			if ((this.wingsLogic == 22 || this.wingsLogic == 28 || this.wingsLogic == 30 || this.wingsLogic == 31 || this.wingsLogic == 37) && this.controlDown && !this.controlLeft && !this.controlRight)
			{
				this.wingTime -= 0.5f;
				return;
			}
			this.wingTime -= 1f;
		}

		// Token: 0x060003EC RID: 1004 RVA: 0x0027EFEC File Offset: 0x0027D1EC
		public void WipeOldestTurret()
		{
			List<Projectile> list = new List<Projectile>();
			for (int i = 0; i < 1000; i++)
			{
				if (Main.projectile[i].WipableTurret)
				{
					list.Add(Main.projectile[i]);
				}
			}
			if (list.Count == 0)
			{
				return;
			}
			Projectile projectile = list[0];
			for (int j = 1; j < list.Count; j++)
			{
				if (list[j].timeLeft < projectile.timeLeft)
				{
					projectile = list[j];
				}
			}
			projectile.Kill();
		}

		// Token: 0x0600039A RID: 922 RVA: 0x0024B1F8 File Offset: 0x002493F8
		public void WOFTongue()
		{
			if (Main.wof >= 0 && Main.npc[Main.wof].active)
			{
				float num = Main.npc[Main.wof].position.X + 40f;
				if (Main.npc[Main.wof].direction > 0)
				{
					num -= 96f;
				}
				if (this.position.X + (float)this.width > num && this.position.X < num + 140f && this.gross)
				{
					this.noKnockback = false;
					this.Hurt(PlayerDeathReason.LegacyDefault(), 50, Main.npc[Main.wof].direction, false, false, false, -1);
				}
				if (!this.gross && this.position.Y > (float)((Main.maxTilesY - 250) * 16) && this.position.X > num - 1920f && this.position.X < num + 1920f)
				{
					this.AddBuff(37, 10, true);
					Main.PlaySound(4, (int)Main.npc[Main.wof].position.X, (int)Main.npc[Main.wof].position.Y, 10, 1f, 0f);
				}
				if (this.gross)
				{
					if (this.position.Y < (float)((Main.maxTilesY - 200) * 16))
					{
						this.AddBuff(38, 10, true);
					}
					if (Main.npc[Main.wof].direction < 0)
					{
						if (this.position.X + (float)(this.width / 2) > Main.npc[Main.wof].position.X + (float)(Main.npc[Main.wof].width / 2) + 40f)
						{
							this.AddBuff(38, 10, true);
						}
					}
					else if (this.position.X + (float)(this.width / 2) < Main.npc[Main.wof].position.X + (float)(Main.npc[Main.wof].width / 2) - 40f)
					{
						this.AddBuff(38, 10, true);
					}
				}
				if (this.tongued)
				{
					this.controlHook = false;
					this.controlUseItem = false;
					for (int i = 0; i < 1000; i++)
					{
						if (Main.projectile[i].active && Main.projectile[i].owner == Main.myPlayer && Main.projectile[i].aiStyle == 7)
						{
							Main.projectile[i].Kill();
						}
					}
					Vector2 center = base.Center;
					float arg_301_0 = Main.npc[Main.wof].position.X + (float)(Main.npc[Main.wof].width / 2) - center.X;
					float num2 = Main.npc[Main.wof].position.Y + (float)(Main.npc[Main.wof].height / 2) - center.Y;
					if ((float)Math.Sqrt((double)(arg_301_0 * arg_301_0 + num2 * num2)) > 3000f)
					{
						this.KillMe(PlayerDeathReason.ByOther(11), 1000.0, 0, false);
						return;
					}
					if (Main.npc[Main.wof].position.X < 608f || Main.npc[Main.wof].position.X > (float)((Main.maxTilesX - 38) * 16))
					{
						this.KillMe(PlayerDeathReason.ByOther(12), 1000.0, 0, false);
					}
				}
			}
		}

		// Token: 0x060003EA RID: 1002 RVA: 0x0027EDD4 File Offset: 0x0027CFD4
		public static bool WouldSpotOverlapWithSentry(int worldX, int worldY)
		{
			Point value = new Point(worldX, worldY - 8);
			Point value2 = new Point(worldX + 16, worldY - 8);
			Point value3 = new Point(worldX - 16, worldY - 8);
			bool result = false;
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.sentry)
				{
					Rectangle hitbox = projectile.Hitbox;
					if (hitbox.Contains(value) || hitbox.Contains(value2) || hitbox.Contains(value3))
					{
						result = true;
						break;
					}
				}
			}
			return result;
		}

		// Token: 0x06000377 RID: 887 RVA: 0x002329BC File Offset: 0x00230BBC
		public void Yoraiz0rEye()
		{
			int num = 0;
			num += this.bodyFrame.Y / 56;
			if (num >= Main.OffsetsPlayerHeadgear.Length)
			{
				num = 0;
			}
			Vector2 vector = new Vector2((float)(3 * this.direction - ((this.direction == 1) ? 1 : 0)), -11.5f * this.gravDir) + Vector2.UnitY * this.gfxOffY + base.Size / 2f + Main.OffsetsPlayerHeadgear[num];
			Vector2 vector2 = new Vector2((float)(3 * this.shadowDirection[1] - ((this.direction == 1) ? 1 : 0)), -11.5f * this.gravDir) + base.Size / 2f + Main.OffsetsPlayerHeadgear[num];
			Vector2 vector3 = Vector2.Zero;
			if (this.mount.Active && this.mount.Cart)
			{
				int num2 = Math.Sign(this.velocity.X);
				if (num2 == 0)
				{
					num2 = this.direction;
				}
				vector3 = new Vector2(MathHelper.Lerp(0f, -8f, this.fullRotation / 0.7853982f), MathHelper.Lerp(0f, 2f, Math.Abs(this.fullRotation / 0.7853982f))).RotatedBy((double)this.fullRotation, default(Vector2));
				if (num2 == Math.Sign(this.fullRotation))
				{
					vector3 *= MathHelper.Lerp(1f, 0.6f, Math.Abs(this.fullRotation / 0.7853982f));
				}
			}
			if (this.fullRotation != 0f)
			{
				vector = vector.RotatedBy((double)this.fullRotation, this.fullRotationOrigin);
				vector2 = vector2.RotatedBy((double)this.fullRotation, this.fullRotationOrigin);
			}
			float num3 = 0f;
			if (this.mount.Active)
			{
				num3 = (float)this.mount.PlayerOffset;
			}
			Vector2 vector4 = this.position + vector + vector3;
			Vector2 vector5 = this.oldPosition + vector2 + vector3;
			vector5.Y -= num3 / 2f;
			vector4.Y -= num3 / 2f;
			float num4 = 1f;
			switch (this.yoraiz0rEye % 10)
			{
				case 1:
					return;
				case 2:
					num4 = 0.5f;
					break;
				case 3:
					num4 = 0.625f;
					break;
				case 4:
					num4 = 0.75f;
					break;
				case 5:
					num4 = 0.875f;
					break;
				case 6:
					num4 = 1f;
					break;
				case 7:
					num4 = 1.1f;
					break;
			}
			if (this.yoraiz0rEye < 7)
			{
				DelegateMethods.v3_1 = Main.hslToRgb(Main.rgbToHsl(this.eyeColor).X, 1f, 0.5f).ToVector3() * 0.5f * num4;
				if (this.velocity != Vector2.Zero)
				{
					Utils.PlotTileLine(base.Center, base.Center + this.velocity * 2f, 4f, new Utils.PerLinePoint(DelegateMethods.CastLightOpen));
				}
				else
				{
					Utils.PlotTileLine(base.Left, base.Right, 4f, new Utils.PerLinePoint(DelegateMethods.CastLightOpen));
				}
			}
			int num5 = (int)Vector2.Distance(vector4, vector5) / 3 + 1;
			if (Vector2.Distance(vector4, vector5) % 3f != 0f)
			{
				num5++;
			}
			for (float num6 = 1f; num6 <= (float)num5; num6 += 1f)
			{
				Dust expr_3D9 = Main.dust[Dust.NewDust(base.Center, 0, 0, 182, 0f, 0f, 0, default(Color), 1f)];
				expr_3D9.position = Vector2.Lerp(vector5, vector4, num6 / (float)num5);
				expr_3D9.noGravity = true;
				expr_3D9.velocity = Vector2.Zero;
				expr_3D9.customData = this;
				expr_3D9.scale = num4;
				expr_3D9.shader = GameShaders.Armor.GetSecondaryShader(this.cYorai, this);
			}
		}

		// Token: 0x17000061 RID: 97
		public Vector2 BlehOldPositionFixer
		{
			// Token: 0x0600030A RID: 778 RVA: 0x00225CA8 File Offset: 0x00223EA8
			get
			{
				return -Vector2.UnitY;
			}
		}

		// Token: 0x17000063 RID: 99
		public bool CCed
		{
			// Token: 0x0600030F RID: 783 RVA: 0x00225DB0 File Offset: 0x00223FB0
			get
			{
				return this.frozen || this.webbed || this.stoned;
			}
		}

		// Token: 0x17000081 RID: 129
		public Vector2 DefaultSize
		{
			// Token: 0x06000347 RID: 839 RVA: 0x00226148 File Offset: 0x00224348
			get
			{
				return new Vector2(20f, 42f);
			}
		}

		// Token: 0x1700007F RID: 127
		public Vector2 Directions
		{
			// Token: 0x06000345 RID: 837 RVA: 0x00226125 File Offset: 0x00224325
			get
			{
				return new Vector2((float)this.direction, this.gravDir);
			}
		}

		// Token: 0x17000064 RID: 100
		public bool ExtraAccessorySlotsShouldShow
		{
			// Token: 0x06000310 RID: 784 RVA: 0x00225DCA File Offset: 0x00223FCA
			get
			{
				return this.extraAccessorySlots > 0 || this.armor[8].type > 0 || this.armor[18].type > 0 || this.dye[8].type > 0;
			}
		}

		// Token: 0x17000085 RID: 133
		public bool HasMinionAttackTargetNPC
		{
			// Token: 0x0600034B RID: 843 RVA: 0x002261D2 File Offset: 0x002243D2
			get
			{
				return this.MinionAttackTargetNPC != -1;
			}
		}

		// Token: 0x17000084 RID: 132
		public bool HasMinionRestTarget
		{
			// Token: 0x0600034A RID: 842 RVA: 0x002261C0 File Offset: 0x002243C0
			get
			{
				return this.MinionRestTargetPoint != Vector2.Zero;
			}
		}

		// Token: 0x17000080 RID: 128
		public Item HeldItem
		{
			// Token: 0x06000346 RID: 838 RVA: 0x00226139 File Offset: 0x00224339
			get
			{
				return this.inventory[this.selectedItem];
			}
		}

		// Token: 0x17000065 RID: 101
		public bool Male
		{
			// Token: 0x06000311 RID: 785 RVA: 0x00225E08 File Offset: 0x00224008
			get
			{
				return PlayerVariantID.Sets.Male[this.skinVariant];
			}
			// Token: 0x06000312 RID: 786 RVA: 0x00225E16 File Offset: 0x00224016
			set
			{
				if (value)
				{
					if (!this.Male)
					{
						this.skinVariant = PlayerVariantID.Sets.AltGenderReference[this.skinVariant];
						return;
					}
				}
				else if (this.Male)
				{
					this.skinVariant = PlayerVariantID.Sets.AltGenderReference[this.skinVariant];
				}
			}
		}

		// Token: 0x17000062 RID: 98
		public Vector2 MountedCenter
		{
			// Token: 0x0600030B RID: 779 RVA: 0x00225CB4 File Offset: 0x00223EB4
			get
			{
				return new Vector2(this.position.X + (float)(this.width / 2), this.position.Y + 21f + (float)this.mount.PlayerOffsetHitbox);
			}
			// Token: 0x0600030C RID: 780 RVA: 0x00225CEE File Offset: 0x00223EEE
			set
			{
				this.position = new Vector2(value.X - (float)(this.width / 2), value.Y - 21f - (float)this.mount.PlayerOffsetHitbox);
			}
		}

		// Token: 0x17000083 RID: 131
		public bool MountFishronSpecial
		{
			// Token: 0x06000349 RID: 841 RVA: 0x00226174 File Offset: 0x00224374
			get
			{
				return this.statLife < this.statLifeMax2 / 2 || (this.wet && !this.lavaWet && !this.honeyWet) || this.dripping || this.MountFishronSpecialCounter > 0f;
			}
		}

		// Token: 0x17000082 RID: 130
		public bool PortalPhysicsEnabled
		{
			// Token: 0x06000348 RID: 840 RVA: 0x00226159 File Offset: 0x00224359
			get
			{
				return this._portalPhysicsTime > 0 && !this.mount.Active;
			}
		}

		// Token: 0x17000086 RID: 134
		public bool SlimeDontHyperJump
		{
			// Token: 0x06000392 RID: 914 RVA: 0x00247319 File Offset: 0x00245519
			get
			{
				return this.mount.Active && this.mount.Type == 3 && this.wetSlime > 0 && !this.controlJump;
			}
		}

		// Token: 0x1700007B RID: 123
		public bool ZoneBeach
		{
			// Token: 0x0600033D RID: 829 RVA: 0x002260B1 File Offset: 0x002242B1
			get
			{
				return this.zone3[5];
			}
			// Token: 0x0600033E RID: 830 RVA: 0x002260BF File Offset: 0x002242BF
			set
			{
				this.zone3[5] = value;
			}
		}

		// Token: 0x17000067 RID: 103
		public bool ZoneCorrupt
		{
			// Token: 0x06000315 RID: 789 RVA: 0x00225E6D File Offset: 0x0022406D
			get
			{
				return this.zone1[1];
			}
			// Token: 0x06000316 RID: 790 RVA: 0x00225E7B File Offset: 0x0022407B
			set
			{
				this.zone1[1] = value;
			}
		}

		// Token: 0x1700006C RID: 108
		public bool ZoneCrimson
		{
			// Token: 0x0600031F RID: 799 RVA: 0x00225EFE File Offset: 0x002240FE
			get
			{
				return this.zone1[6];
			}
			// Token: 0x06000320 RID: 800 RVA: 0x00225F0C File Offset: 0x0022410C
			set
			{
				this.zone1[6] = value;
			}
		}

		// Token: 0x17000073 RID: 115
		public bool ZoneDesert
		{
			// Token: 0x0600032D RID: 813 RVA: 0x00225FC9 File Offset: 0x002241C9
			get
			{
				return this.zone2[5];
			}
			// Token: 0x0600032E RID: 814 RVA: 0x00225FD7 File Offset: 0x002241D7
			set
			{
				this.zone2[5] = value;
			}
		}

		// Token: 0x17000078 RID: 120
		public bool ZoneDirtLayerHeight
		{
			// Token: 0x06000337 RID: 823 RVA: 0x0022605A File Offset: 0x0022425A
			get
			{
				return this.zone3[2];
			}
			// Token: 0x06000338 RID: 824 RVA: 0x00226068 File Offset: 0x00224268
			set
			{
				this.zone3[2] = value;
			}
		}

		// Token: 0x17000066 RID: 102
		public bool ZoneDungeon
		{
			// Token: 0x06000313 RID: 787 RVA: 0x00225E50 File Offset: 0x00224050
			get
			{
				return this.zone1[0];
			}
			// Token: 0x06000314 RID: 788 RVA: 0x00225E5E File Offset: 0x0022405E
			set
			{
				this.zone1[0] = value;
			}
		}

		// Token: 0x17000074 RID: 116
		public bool ZoneGlowshroom
		{
			// Token: 0x0600032F RID: 815 RVA: 0x00225FE6 File Offset: 0x002241E6
			get
			{
				return this.zone2[6];
			}
			// Token: 0x06000330 RID: 816 RVA: 0x00225FF4 File Offset: 0x002241F4
			set
			{
				this.zone2[6] = value;
			}
		}

		// Token: 0x17000068 RID: 104
		public bool ZoneHoly
		{
			// Token: 0x06000317 RID: 791 RVA: 0x00225E8A File Offset: 0x0022408A
			get
			{
				return this.zone1[2];
			}
			// Token: 0x06000318 RID: 792 RVA: 0x00225E98 File Offset: 0x00224098
			set
			{
				this.zone1[2] = value;
			}
		}

		// Token: 0x1700006A RID: 106
		public bool ZoneJungle
		{
			// Token: 0x0600031B RID: 795 RVA: 0x00225EC4 File Offset: 0x002240C4
			get
			{
				return this.zone1[4];
			}
			// Token: 0x0600031C RID: 796 RVA: 0x00225ED2 File Offset: 0x002240D2
			set
			{
				this.zone1[4] = value;
			}
		}

		// Token: 0x17000069 RID: 105
		public bool ZoneMeteor
		{
			// Token: 0x06000319 RID: 793 RVA: 0x00225EA7 File Offset: 0x002240A7
			get
			{
				return this.zone1[3];
			}
			// Token: 0x0600031A RID: 794 RVA: 0x00225EB5 File Offset: 0x002240B5
			set
			{
				this.zone1[3] = value;
			}
		}

		// Token: 0x1700007E RID: 126
		public bool ZoneOldOneArmy
		{
			// Token: 0x06000343 RID: 835 RVA: 0x00226108 File Offset: 0x00224308
			get
			{
				return this.zone4[0];
			}
			// Token: 0x06000344 RID: 836 RVA: 0x00226116 File Offset: 0x00224316
			set
			{
				this.zone4[0] = value;
			}
		}

		// Token: 0x17000077 RID: 119
		public bool ZoneOverworldHeight
		{
			// Token: 0x06000335 RID: 821 RVA: 0x0022603D File Offset: 0x0022423D
			get
			{
				return this.zone3[1];
			}
			// Token: 0x06000336 RID: 822 RVA: 0x0022604B File Offset: 0x0022424B
			set
			{
				this.zone3[1] = value;
			}
		}

		// Token: 0x1700006E RID: 110
		public bool ZonePeaceCandle
		{
			// Token: 0x06000323 RID: 803 RVA: 0x00225F38 File Offset: 0x00224138
			get
			{
				return this.zone2[0];
			}
			// Token: 0x06000324 RID: 804 RVA: 0x00225F46 File Offset: 0x00224146
			set
			{
				this.zone2[0] = value;
			}
		}

		// Token: 0x1700007C RID: 124
		public bool ZoneRain
		{
			// Token: 0x0600033F RID: 831 RVA: 0x002260CE File Offset: 0x002242CE
			get
			{
				return this.zone3[6];
			}
			// Token: 0x06000340 RID: 832 RVA: 0x002260DC File Offset: 0x002242DC
			set
			{
				this.zone3[6] = value;
			}
		}

		// Token: 0x17000079 RID: 121
		public bool ZoneRockLayerHeight
		{
			// Token: 0x06000339 RID: 825 RVA: 0x00226077 File Offset: 0x00224277
			get
			{
				return this.zone3[3];
			}
			// Token: 0x0600033A RID: 826 RVA: 0x00226085 File Offset: 0x00224285
			set
			{
				this.zone3[3] = value;
			}
		}

		// Token: 0x1700007D RID: 125
		public bool ZoneSandstorm
		{
			// Token: 0x06000341 RID: 833 RVA: 0x002260EB File Offset: 0x002242EB
			get
			{
				return this.zone3[7];
			}
			// Token: 0x06000342 RID: 834 RVA: 0x002260F9 File Offset: 0x002242F9
			set
			{
				this.zone3[7] = value;
			}
		}

		// Token: 0x17000076 RID: 118
		public bool ZoneSkyHeight
		{
			// Token: 0x06000333 RID: 819 RVA: 0x00226020 File Offset: 0x00224220
			get
			{
				return this.zone3[0];
			}
			// Token: 0x06000334 RID: 820 RVA: 0x0022602E File Offset: 0x0022422E
			set
			{
				this.zone3[0] = value;
			}
		}

		// Token: 0x1700006B RID: 107
		public bool ZoneSnow
		{
			// Token: 0x0600031D RID: 797 RVA: 0x00225EE1 File Offset: 0x002240E1
			get
			{
				return this.zone1[5];
			}
			// Token: 0x0600031E RID: 798 RVA: 0x00225EEF File Offset: 0x002240EF
			set
			{
				this.zone1[5] = value;
			}
		}

		// Token: 0x17000071 RID: 113
		public bool ZoneTowerNebula
		{
			// Token: 0x06000329 RID: 809 RVA: 0x00225F8F File Offset: 0x0022418F
			get
			{
				return this.zone2[3];
			}
			// Token: 0x0600032A RID: 810 RVA: 0x00225F9D File Offset: 0x0022419D
			set
			{
				this.zone2[3] = value;
			}
		}

		// Token: 0x1700006F RID: 111
		public bool ZoneTowerSolar
		{
			// Token: 0x06000325 RID: 805 RVA: 0x00225F55 File Offset: 0x00224155
			get
			{
				return this.zone2[1];
			}
			// Token: 0x06000326 RID: 806 RVA: 0x00225F63 File Offset: 0x00224163
			set
			{
				this.zone2[1] = value;
			}
		}

		// Token: 0x17000072 RID: 114
		public bool ZoneTowerStardust
		{
			// Token: 0x0600032B RID: 811 RVA: 0x00225FAC File Offset: 0x002241AC
			get
			{
				return this.zone2[4];
			}
			// Token: 0x0600032C RID: 812 RVA: 0x00225FBA File Offset: 0x002241BA
			set
			{
				this.zone2[4] = value;
			}
		}

		// Token: 0x17000070 RID: 112
		public bool ZoneTowerVortex
		{
			// Token: 0x06000327 RID: 807 RVA: 0x00225F72 File Offset: 0x00224172
			get
			{
				return this.zone2[2];
			}
			// Token: 0x06000328 RID: 808 RVA: 0x00225F80 File Offset: 0x00224180
			set
			{
				this.zone2[2] = value;
			}
		}

		// Token: 0x17000075 RID: 117
		public bool ZoneUndergroundDesert
		{
			// Token: 0x06000331 RID: 817 RVA: 0x00226003 File Offset: 0x00224203
			get
			{
				return this.zone2[7];
			}
			// Token: 0x06000332 RID: 818 RVA: 0x00226011 File Offset: 0x00224211
			set
			{
				this.zone2[7] = value;
			}
		}

		// Token: 0x1700007A RID: 122
		public bool ZoneUnderworldHeight
		{
			// Token: 0x0600033B RID: 827 RVA: 0x00226094 File Offset: 0x00224294
			get
			{
				return this.zone3[4];
			}
			// Token: 0x0600033C RID: 828 RVA: 0x002260A2 File Offset: 0x002242A2
			set
			{
				this.zone3[4] = value;
			}
		}

		// Token: 0x1700006D RID: 109
		public bool ZoneWaterCandle
		{
			// Token: 0x06000321 RID: 801 RVA: 0x00225F1B File Offset: 0x0022411B
			get
			{
				return this.zone1[7];
			}
			// Token: 0x06000322 RID: 802 RVA: 0x00225F29 File Offset: 0x00224129
			set
			{
				this.zone1[7] = value;
			}
		}

		// Token: 0x040005CC RID: 1484
		public bool accCalendar;

		// Token: 0x040005C6 RID: 1478
		public int accCompass;

		// Token: 0x040005D4 RID: 1492
		public bool accCritterGuide;

		// Token: 0x040005D5 RID: 1493
		public byte accCritterGuideCounter;

		// Token: 0x040005D6 RID: 1494
		public byte accCritterGuideNumber;

		// Token: 0x040005C8 RID: 1480
		public int accDepthMeter;

		// Token: 0x040005E4 RID: 1508
		public bool accDivingHelm;

		// Token: 0x040005D7 RID: 1495
		public bool accDreamCatcher;

		// Token: 0x040005C9 RID: 1481
		public bool accFishFinder;

		// Token: 0x04000415 RID: 1045
		public bool accFishingLine;

		// Token: 0x040005E5 RID: 1509
		public bool accFlipper;

		// Token: 0x040005CB RID: 1483
		public bool accJarOfSouls;

		// Token: 0x0400056E RID: 1390
		public bool accMerman;

		// Token: 0x040005D2 RID: 1490
		public bool accOreFinder;

		// Token: 0x040003DD RID: 989
		public float accRunSpeed;

		// Token: 0x040005D1 RID: 1489
		public bool accStopwatch;

		// Token: 0x04000416 RID: 1046
		public bool accTackleBox;

		// Token: 0x040005CE RID: 1486
		public bool accThirdEye;

		// Token: 0x040005CF RID: 1487
		public byte accThirdEyeCounter;

		// Token: 0x040005D0 RID: 1488
		public byte accThirdEyeNumber;

		// Token: 0x040005C7 RID: 1479
		public int accWatch;

		// Token: 0x040005CA RID: 1482
		public bool accWeatherRadio;

		// Token: 0x04000454 RID: 1108
		public float activeNPCs;

		// Token: 0x040005D8 RID: 1496
		public bool ActuationRodLock;

		// Token: 0x040005D9 RID: 1497
		public bool ActuationRodLockSetting;

		// Token: 0x040005AF RID: 1455
		public bool adjHoney;

		// Token: 0x040005B0 RID: 1456
		public bool adjLava;

		// Token: 0x040005B4 RID: 1460
		public bool[] adjTile = new bool[470];

		// Token: 0x040005AE RID: 1454
		public bool adjWater;

		// Token: 0x04000453 RID: 1107
		public int aggro;

		// Token: 0x04000377 RID: 887
		public bool alchemyTable;

		// Token: 0x040004DC RID: 1244
		public int altFunctionUse;

		// Token: 0x04000516 RID: 1302
		public bool ammoBox;

		// Token: 0x04000510 RID: 1296
		public bool ammoCost75;

		// Token: 0x0400050F RID: 1295
		public bool ammoCost80;

		// Token: 0x04000517 RID: 1303
		public bool ammoPotion;

		// Token: 0x040004FA RID: 1274
		public int anglerQuestsFinished;

		// Token: 0x04000553 RID: 1363
		public bool archery;

		// Token: 0x04000530 RID: 1328
		public bool arcticDivingGear;

		// Token: 0x04000463 RID: 1123
		public Item[] armor = new Item[20];

		// Token: 0x04000481 RID: 1153
		public bool armorEffectDrawOutlines;

		// Token: 0x04000484 RID: 1156
		public bool armorEffectDrawOutlinesForbidden;

		// Token: 0x0400047F RID: 1151
		public bool armorEffectDrawShadow;

		// Token: 0x04000483 RID: 1155
		public bool armorEffectDrawShadowBasilisk;

		// Token: 0x04000485 RID: 1157
		public bool armorEffectDrawShadowEOCShield;

		// Token: 0x04000482 RID: 1154
		public bool armorEffectDrawShadowLokis;

		// Token: 0x04000480 RID: 1152
		public bool armorEffectDrawShadowSubtle;

		// Token: 0x040004FD RID: 1277
		public int armorPenetration;

		// Token: 0x0400058B RID: 1419
		public float arrowDamage = 1f;

		// Token: 0x040004A3 RID: 1187
		public int attackCD;

		// Token: 0x04000599 RID: 1433
		public bool autoActuator;

		// Token: 0x040005F8 RID: 1528
		public bool autoJump;

		// Token: 0x04000598 RID: 1432
		public bool autoPaint;

		// Token: 0x04000541 RID: 1345
		public bool babyFaceMonster;

		// Token: 0x040004AE RID: 1198
		public sbyte back = -1;

		// Token: 0x04000582 RID: 1410
		public bool ballistaPanic;

		// Token: 0x040004B5 RID: 1205
		public sbyte balloon = -1;

		// Token: 0x0400048F RID: 1167
		public Chest bank = new Chest(true);

		// Token: 0x04000490 RID: 1168
		public Chest bank2 = new Chest(true);

		// Token: 0x04000491 RID: 1169
		public Chest bank3 = new Chest(true);

		// Token: 0x040004FB RID: 1275
		public int bartenderQuestLog;

		// Token: 0x0400038C RID: 908
		public float basiliskCharge;

		// Token: 0x0400062F RID: 1583
		public bool bee;

		// Token: 0x0400039F RID: 927
		public bool beetleBuff;

		// Token: 0x0400039C RID: 924
		public int beetleCountdown;

		// Token: 0x0400039B RID: 923
		public float beetleCounter;

		// Token: 0x0400039D RID: 925
		public bool beetleDefense;

		// Token: 0x040003BB RID: 955
		public int beetleFrame;

		// Token: 0x040003BC RID: 956
		public int beetleFrameCounter;

		// Token: 0x0400039E RID: 926
		public bool beetleOffense;

		// Token: 0x0400039A RID: 922
		public int beetleOrbs;

		// Token: 0x040003B9 RID: 953
		public Vector2[] beetlePos = new Vector2[3];

		// Token: 0x040003BA RID: 954
		public Vector2[] beetleVel = new Vector2[3];

		// Token: 0x0400065B RID: 1627
		public bool behindBackWall;

		// Token: 0x040005D3 RID: 1491
		public int bestOre = -1;

		// Token: 0x040003E7 RID: 999
		public bool blackBelt;

		// Token: 0x0400053A RID: 1338
		public bool blackCat;

		// Token: 0x04000557 RID: 1367
		public bool blackout;

		// Token: 0x0400056C RID: 1388
		public bool bleed;

		// Token: 0x04000556 RID: 1366
		public bool blind;

		// Token: 0x040005FD RID: 1533
		public int blockRange;

		// Token: 0x04000522 RID: 1314
		public bool blueFairy;

		// Token: 0x040004AA RID: 1194
		public int body = -1;

		// Token: 0x040004B9 RID: 1209
		public Rectangle bodyFrame;

		// Token: 0x04000443 RID: 1091
		public double bodyFrameCounter;

		// Token: 0x04000496 RID: 1174
		public Vector2 bodyPosition;

		// Token: 0x04000493 RID: 1171
		public float bodyRotation;

		// Token: 0x04000499 RID: 1177
		public Vector2 bodyVelocity;

		// Token: 0x04000438 RID: 1080
		public bool boneArmor;

		// Token: 0x04000406 RID: 1030
		public bool brainOfConfusion;

		// Token: 0x0400047A RID: 1146
		public int breath = 200;

		// Token: 0x04000478 RID: 1144
		public int breathCD;

		// Token: 0x04000479 RID: 1145
		public int breathMax = 200;

		// Token: 0x04000570 RID: 1392
		public bool brokenArmor;

		// Token: 0x04000476 RID: 1142
		public bool[] buffImmune = new bool[206];

		// Token: 0x04000475 RID: 1141
		public int[] buffTime = new int[22];

		// Token: 0x04000474 RID: 1140
		public int[] buffType = new int[22];

		// Token: 0x0400037C RID: 892
		public int[] builderAccStatus = new int[10];

		// Token: 0x0400058A RID: 1418
		public float bulletDamage = 1f;

		// Token: 0x04000525 RID: 1317
		public bool bunny;

		// Token: 0x0400055B RID: 1371
		public bool burned;

		// Token: 0x040003AF RID: 943
		public bool calmed;

		// Token: 0x040003F0 RID: 1008
		public bool canCarpet;

		// Token: 0x04000607 RID: 1543
		public bool canRocket;

		// Token: 0x040003EC RID: 1004
		public bool carpet;

		// Token: 0x040003EE RID: 1006
		public int carpetFrame = -1;

		// Token: 0x040003EF RID: 1007
		public float carpetFrameCounter;

		// Token: 0x040003F1 RID: 1009
		public int carpetTime;

		// Token: 0x04000536 RID: 1334
		public bool cartFlip;

		// Token: 0x04000535 RID: 1333
		public int cartRampTime;

		// Token: 0x04000640 RID: 1600
		public int cBack;

		// Token: 0x04000647 RID: 1607
		public int cBalloon;

		// Token: 0x0400063C RID: 1596
		public int cBody;

		// Token: 0x04000649 RID: 1609
		public int cCarpet;

		// Token: 0x04000646 RID: 1606
		public int cFace;

		// Token: 0x04000641 RID: 1601
		public int cFront;

		// Token: 0x0400064A RID: 1610
		public int cGrapple;

		// Token: 0x0400063F RID: 1599
		public int cHandOff;

		// Token: 0x0400063E RID: 1598
		public int cHandOn;

		// Token: 0x04000458 RID: 1112
		public int changeItem = -1;

		// Token: 0x040004F8 RID: 1272
		public bool channel;

		// Token: 0x04000518 RID: 1304
		public bool chaosState;

		// Token: 0x04000373 RID: 883
		public Player.OverheadMessage chatOverhead;

		// Token: 0x0400063B RID: 1595
		public int cHead;

		// Token: 0x04000633 RID: 1587
		public int chest = -1;

		// Token: 0x04000634 RID: 1588
		public int chestX;

		// Token: 0x04000635 RID: 1589
		public int chestY;

		// Token: 0x040003CD RID: 973
		public bool chilled;

		// Token: 0x04000375 RID: 885
		public Player.SelectionRadial CircularRadial = new Player.SelectionRadial(Player.SelectionRadial.SelectionMode.RadialCircular);

		// Token: 0x0400063D RID: 1597
		public int cLegs;

		// Token: 0x0400064E RID: 1614
		public int cLight;

		// Token: 0x0400064C RID: 1612
		public int cMinecart;

		// Token: 0x0400064B RID: 1611
		public int cMount;

		// Token: 0x04000645 RID: 1605
		public int cNeck;

		// Token: 0x040005E2 RID: 1506
		public bool coins;

		// Token: 0x04000543 RID: 1347
		public bool coldDash;

		// Token: 0x04000540 RID: 1344
		public bool companionCube;

		// Token: 0x0400056D RID: 1389
		public bool confused;

		// Token: 0x040004BF RID: 1215
		public bool controlDown;

		// Token: 0x040004C5 RID: 1221
		public bool controlHook;

		// Token: 0x040004C4 RID: 1220
		public bool controlInv;

		// Token: 0x040004C0 RID: 1216
		public bool controlJump;

		// Token: 0x040004BC RID: 1212
		public bool controlLeft;

		// Token: 0x040004C7 RID: 1223
		public bool controlMap;

		// Token: 0x040004C9 RID: 1225
		public bool controlMount;

		// Token: 0x040004D9 RID: 1241
		public bool controlQuickHeal;

		// Token: 0x040004D8 RID: 1240
		public bool controlQuickMana;

		// Token: 0x040004BD RID: 1213
		public bool controlRight;

		// Token: 0x040004C8 RID: 1224
		public bool controlSmart;

		// Token: 0x040004C3 RID: 1219
		public bool controlThrow;

		// Token: 0x040004C6 RID: 1222
		public bool controlTorch;

		// Token: 0x040004BE RID: 1214
		public bool controlUp;

		// Token: 0x040004C1 RID: 1217
		public bool controlUseItem;

		// Token: 0x040004C2 RID: 1218
		public bool controlUseTile;

		// Token: 0x040003DE RID: 990
		public bool cordage;

		// Token: 0x04000397 RID: 919
		public int counterWeight;

		// Token: 0x0400064D RID: 1613
		public int cPet;

		// Token: 0x04000413 RID: 1043
		public bool cratePotion;

		// Token: 0x04000520 RID: 1312
		public bool crimsonHeart;

		// Token: 0x040003F5 RID: 1013
		public bool crimsonRegen;

		// Token: 0x0400043B RID: 1083
		public bool crystalLeaf;

		// Token: 0x0400038A RID: 906
		public static int crystalLeafDamage = 100;

		// Token: 0x0400038B RID: 907
		public static int crystalLeafKB = 10;

		// Token: 0x04000550 RID: 1360
		public bool cSapling;

		// Token: 0x04000644 RID: 1604
		public int cShield;

		// Token: 0x04000642 RID: 1602
		public int cShoe;

		// Token: 0x04000643 RID: 1603
		public int cWaist;

		// Token: 0x04000648 RID: 1608
		public int cWings;

		// Token: 0x0400064F RID: 1615
		public int cYorai;

		// Token: 0x040003FE RID: 1022
		public bool dangerSense;

		// Token: 0x040003D8 RID: 984
		public int dash;

		// Token: 0x040003DA RID: 986
		public int dashDelay;

		// Token: 0x040003D9 RID: 985
		public int dashTime;

		// Token: 0x040003CE RID: 974
		public bool dazed;

		// Token: 0x04000381 RID: 897
		public bool dd2Accessory;

		// Token: 0x040004A1 RID: 1185
		public bool dead;

		// Token: 0x040004A0 RID: 1184
		public static bool deadForGood = false;

		// Token: 0x04000424 RID: 1060
		public bool DeadlySphereMinion;

		// Token: 0x040005A6 RID: 1446
		public static float defaultGravity = 0.4f;

		// Token: 0x040004E9 RID: 1257
		public const int defaultHeight = 42;

		// Token: 0x040005B6 RID: 1462
		public static int defaultItemGrabRange = 38;

		// Token: 0x040004E8 RID: 1256
		public const int defaultWidth = 20;

		// Token: 0x0400043E RID: 1086
		public bool defendedByPaladin;

		// Token: 0x040004E7 RID: 1255
		public bool delayUseItem;

		// Token: 0x04000612 RID: 1554
		public bool detectCreature;

		// Token: 0x040004A5 RID: 1189
		public byte difficulty;

		// Token: 0x04000548 RID: 1352
		public bool dino;

		// Token: 0x040005E1 RID: 1505
		public bool discount;

		// Token: 0x040005E0 RID: 1504
		public string displayedFishingInfo = "";

		// Token: 0x040005EE RID: 1518
		public bool dJumpEffectBlizzard;

		// Token: 0x040005E8 RID: 1512
		public bool dJumpEffectCloud;

		// Token: 0x040005F1 RID: 1521
		public bool dJumpEffectFart;

		// Token: 0x040005F4 RID: 1524
		public bool dJumpEffectSail;

		// Token: 0x040005EB RID: 1515
		public bool dJumpEffectSandstorm;

		// Token: 0x040005F7 RID: 1527
		public bool dJumpEffectUnicorn;

		// Token: 0x040005EC RID: 1516
		public bool doubleJumpBlizzard;

		// Token: 0x040005E6 RID: 1510
		public bool doubleJumpCloud;

		// Token: 0x040005EF RID: 1519
		public bool doubleJumpFart;

		// Token: 0x040005F2 RID: 1522
		public bool doubleJumpSail;

		// Token: 0x040005E9 RID: 1513
		public bool doubleJumpSandstorm;

		// Token: 0x040005F5 RID: 1525
		public bool doubleJumpUnicorn;

		// Token: 0x0400043C RID: 1084
		public int[] doubleTapCardinalTimer = new int[4];

		// Token: 0x040004FC RID: 1276
		public bool downedDD2EventAnyDifficulty;

		// Token: 0x04000374 RID: 884
		public Player.SelectionRadial DpadRadial = new Player.SelectionRadial(Player.SelectionRadial.SelectionMode.Dpad4);

		// Token: 0x040005DE RID: 1502
		public int dpsDamage;

		// Token: 0x040005DC RID: 1500
		public DateTime dpsEnd;

		// Token: 0x040005DD RID: 1501
		public DateTime dpsLastHit;

		// Token: 0x040005DB RID: 1499
		public DateTime dpsStart;

		// Token: 0x040005DF RID: 1503
		public bool dpsStarted;

		// Token: 0x04000380 RID: 896
		public float drainBoost;

		// Token: 0x0400055E RID: 1374
		public bool dripping;

		// Token: 0x0400055F RID: 1375
		public bool drippingSlime;

		// Token: 0x04000404 RID: 1028
		public bool dryadWard;

		// Token: 0x04000464 RID: 1124
		public Item[] dye = new Item[10];

		// Token: 0x04000527 RID: 1319
		public bool eater;

		// Token: 0x04000451 RID: 1105
		public bool editedChestName;

		// Token: 0x04000403 RID: 1027
		public bool electrified;

		// Token: 0x04000372 RID: 882
		private static byte[] ENCRYPTION_KEY = new UnicodeEncoding().GetBytes("h3y_gUyZ");

		// Token: 0x040003FF RID: 1023
		public float endurance;

		// Token: 0x04000614 RID: 1556
		public bool enemySpawns;

		// Token: 0x040003DB RID: 987
		public int eocDash;

		// Token: 0x040003DC RID: 988
		public int eocHit;

		// Token: 0x04000393 RID: 915
		public bool extraAccessory;

		// Token: 0x04000392 RID: 914
		public int extraAccessorySlots = 2;

		// Token: 0x040005FB RID: 1531
		public int extraFall;

		// Token: 0x040005BE RID: 1470
		public Color eyeColor = new Color(105, 90, 75);

		// Token: 0x04000545 RID: 1349
		public bool eyeSpring;

		// Token: 0x040004B4 RID: 1204
		public sbyte face = -1;

		// Token: 0x04000637 RID: 1591
		public int fallStart;

		// Token: 0x04000638 RID: 1592
		public int fallStart2;

		// Token: 0x04000610 RID: 1552
		public bool findTreasure;

		// Token: 0x040004F7 RID: 1271
		public bool fireWalk;

		// Token: 0x04000412 RID: 1042
		public int fishingSkill;

		// Token: 0x040003B4 RID: 948
		public byte flameRingAlpha;

		// Token: 0x040003B3 RID: 947
		public byte flameRingFrame;

		// Token: 0x040003B1 RID: 945
		public float flameRingRot;

		// Token: 0x040003B2 RID: 946
		public float flameRingScale = 1f;

		// Token: 0x040003FC RID: 1020
		public bool flapSound;

		// Token: 0x04000632 RID: 1586
		public int flyingPigChest = -1;

		// Token: 0x04000568 RID: 1384
		public bool forceMerman;

		// Token: 0x04000569 RID: 1385
		public bool forceWerewolf;

		// Token: 0x040004AF RID: 1199
		public sbyte front = -1;

		// Token: 0x04000439 RID: 1081
		public bool frostArmor;

		// Token: 0x04000559 RID: 1369
		public bool frostBurn;

		// Token: 0x040003CF RID: 975
		public bool frozen;

		// Token: 0x0400049B RID: 1179
		public float fullRotation;

		// Token: 0x0400049C RID: 1180
		public Vector2 fullRotationOrigin = Vector2.Zero;

		// Token: 0x040003DF RID: 991
		public int gem = -1;

		// Token: 0x040003E0 RID: 992
		public int gemCount;

		// Token: 0x0400049E RID: 1182
		public float gfxOffY;

		// Token: 0x0400042F RID: 1071
		public bool ghost;

		// Token: 0x04000472 RID: 1138
		public float ghostDir = 1f;

		// Token: 0x040003C8 RID: 968
		public float ghostDmg;

		// Token: 0x04000471 RID: 1137
		public float ghostFade;

		// Token: 0x04000430 RID: 1072
		public int ghostFrame;

		// Token: 0x04000431 RID: 1073
		public int ghostFrameCounter;

		// Token: 0x040003F6 RID: 1014
		public bool ghostHeal;

		// Token: 0x040003F7 RID: 1015
		public bool ghostHurt;

		// Token: 0x0400060E RID: 1550
		public bool gills;

		// Token: 0x04000379 RID: 889
		public bool GoingDownWithGrapple;

		// Token: 0x040005E3 RID: 1507
		public bool goldRing;

		// Token: 0x040005FF RID: 1535
		public int grapCount;

		// Token: 0x040005FE RID: 1534
		public int[] grappling = new int[20];

		// Token: 0x0400062D RID: 1581
		public bool gravControl;

		// Token: 0x0400062E RID: 1582
		public bool gravControl2;

		// Token: 0x0400050E RID: 1294
		public float gravDir = 1f;

		// Token: 0x040005A9 RID: 1449
		public float gravity = Player.defaultGravity;

		// Token: 0x04000524 RID: 1316
		public bool greenFairy;

		// Token: 0x0400052E RID: 1326
		public bool grinch;

		// Token: 0x04000573 RID: 1395
		public bool gross;

		// Token: 0x040005C3 RID: 1475
		public int hair;

		// Token: 0x040005BC RID: 1468
		public Color hairColor = new Color(215, 90, 55);

		// Token: 0x040005B9 RID: 1465
		public byte hairDye;

		// Token: 0x040005BA RID: 1466
		public Color hairDyeColor = Color.Transparent;

		// Token: 0x040005BB RID: 1467
		public float hairDyeVar;

		// Token: 0x040004BB RID: 1211
		public Rectangle hairFrame;

		// Token: 0x040004AD RID: 1197
		public sbyte handoff = -1;

		// Token: 0x040004AC RID: 1196
		public sbyte handon = -1;

		// Token: 0x0400038E RID: 910
		public bool hasBanner;

		// Token: 0x0400043F RID: 1087
		public bool hasPaladinShield;

		// Token: 0x04000663 RID: 1635
		public bool hasRaisableShield;

		// Token: 0x0400044D RID: 1101
		public bool hbLocked;

		// Token: 0x040004A9 RID: 1193
		public int head = -1;

		// Token: 0x04000558 RID: 1368
		public bool headcovered;

		// Token: 0x040004B8 RID: 1208
		public Rectangle headFrame;

		// Token: 0x04000442 RID: 1090
		public double headFrameCounter;

		// Token: 0x04000495 RID: 1173
		public Vector2 headPosition;

		// Token: 0x04000492 RID: 1170
		public float headRotation;

		// Token: 0x04000498 RID: 1176
		public Vector2 headVelocity;

		// Token: 0x04000477 RID: 1143
		public int heldProj = -1;

		// Token: 0x040005C5 RID: 1477
		public SoundPlaySet hermesStepSound = new SoundPlaySet();

		// Token: 0x0400037B RID: 891
		public bool[] hideInfo = new bool[13];

		// Token: 0x04000566 RID: 1382
		public bool hideMerman;

		// Token: 0x040004B7 RID: 1207
		public BitsByte hideMisc = 0;

		// Token: 0x040004B6 RID: 1206
		public bool[] hideVisual = new bool[10];

		// Token: 0x04000567 RID: 1383
		public bool hideWolf;

		// Token: 0x040004A7 RID: 1191
		public HitTile hitTile;

		// Token: 0x0400043D RID: 1085
		public int[] holdDownCardinalTimer = new int[4];

		// Token: 0x0400043A RID: 1082
		public bool honey;

		// Token: 0x0400054A RID: 1354
		public bool hornet;

		// Token: 0x0400041D RID: 1053
		public bool hornetMinion;

		// Token: 0x040005C4 RID: 1476
		public bool hostile;

		// Token: 0x04000378 RID: 888
		public int HotbarOffset;

		// Token: 0x04000667 RID: 1639
		public int[] hurtCooldowns = new int[2];

		// Token: 0x040003FD RID: 1021
		public bool iceBarrier;

		// Token: 0x04000407 RID: 1031
		public byte iceBarrierFrame;

		// Token: 0x04000408 RID: 1032
		public byte iceBarrierFrameCounter;

		// Token: 0x040003EB RID: 1003
		public bool iceSkate;

		// Token: 0x040003D2 RID: 978
		public bool ichor;

		// Token: 0x0400047E RID: 1150
		public bool ignoreWater;

		// Token: 0x04000447 RID: 1095
		public bool immune;

		// Token: 0x0400044B RID: 1099
		public int immuneAlpha;

		// Token: 0x0400044A RID: 1098
		public int immuneAlphaDirection;

		// Token: 0x04000448 RID: 1096
		public bool immuneNoBlink;

		// Token: 0x04000449 RID: 1097
		public int immuneTime;

		// Token: 0x0400041E RID: 1054
		public bool impMinion;

		// Token: 0x040003B0 RID: 944
		public bool inferno;

		// Token: 0x040003F3 RID: 1011
		public int infernoCounter;

		// Token: 0x040005DA RID: 1498
		public bool InfoAccMechShowWires;

		// Token: 0x0400045D RID: 1117
		public const int InitialAccSlotCount = 5;

		// Token: 0x0400048D RID: 1165
		public Item[] inventory = new Item[59];

		// Token: 0x0400048E RID: 1166
		public bool[] inventoryChestStack = new bool[59];

		// Token: 0x04000611 RID: 1553
		public bool invis;

		// Token: 0x04000468 RID: 1128
		public int itemAnimation;

		// Token: 0x04000469 RID: 1129
		public int itemAnimationMax;

		// Token: 0x040003C5 RID: 965
		public int itemFlameCount;

		// Token: 0x040003C4 RID: 964
		public Vector2[] itemFlamePos = new Vector2[7];

		// Token: 0x040005B7 RID: 1463
		private static float itemGrabSpeed = 0.45f;

		// Token: 0x040005B8 RID: 1464
		private static float itemGrabSpeedMax = 4f;

		// Token: 0x0400046E RID: 1134
		public int itemHeight;

		// Token: 0x0400046F RID: 1135
		public Vector2 itemLocation;

		// Token: 0x0400046C RID: 1132
		public float itemRotation;

		// Token: 0x0400046A RID: 1130
		public int itemTime;

		// Token: 0x0400046D RID: 1133
		public int itemWidth;

		// Token: 0x040004A8 RID: 1192
		public int jump;

		// Token: 0x040005ED RID: 1517
		public bool jumpAgainBlizzard;

		// Token: 0x040005E7 RID: 1511
		public bool jumpAgainCloud;

		// Token: 0x040005F0 RID: 1520
		public bool jumpAgainFart;

		// Token: 0x040005F3 RID: 1523
		public bool jumpAgainSail;

		// Token: 0x040005EA RID: 1514
		public bool jumpAgainSandstorm;

		// Token: 0x040005F6 RID: 1526
		public bool jumpAgainUnicorn;

		// Token: 0x04000608 RID: 1544
		public bool jumpBoost;

		// Token: 0x040005A7 RID: 1447
		public static int jumpHeight = 15;

		// Token: 0x040005A8 RID: 1448
		public static float jumpSpeed = 5.01f;

		// Token: 0x040005FA RID: 1530
		public float jumpSpeedBoost;

		// Token: 0x040005F9 RID: 1529
		public bool justJumped;

		// Token: 0x04000576 RID: 1398
		public bool kbBuff;

		// Token: 0x04000575 RID: 1397
		public bool kbGlove;

		// Token: 0x0400060C RID: 1548
		public bool killClothier;

		// Token: 0x0400060B RID: 1547
		public bool killGuide;

		// Token: 0x04000538 RID: 1336
		public Vector2 lastBoost = Vector2.Zero;

		// Token: 0x04000631 RID: 1585
		public int lastChest;

		// Token: 0x040005CD RID: 1485
		public int lastCreatureHit = -1;

		// Token: 0x0400038F RID: 911
		public Vector2 lastDeathPostion;

		// Token: 0x04000390 RID: 912
		public DateTime lastDeathTime;

		// Token: 0x04000456 RID: 1110
		public bool lastMouseInterface;

		// Token: 0x04000652 RID: 1618
		public int lastPortalColorIndex;

		// Token: 0x04000668 RID: 1640
		public static bool lastPound = true;

		// Token: 0x040003D1 RID: 977
		public bool lastStoned;

		// Token: 0x040005A2 RID: 1442
		public int lastTileRangeX;

		// Token: 0x040005A3 RID: 1443
		public int lastTileRangeY;

		// Token: 0x040003EA RID: 1002
		public int launcherWait;

		// Token: 0x0400047B RID: 1147
		public int lavaCD;

		// Token: 0x0400060D RID: 1549
		public bool lavaImmune;

		// Token: 0x0400047C RID: 1148
		public int lavaMax;

		// Token: 0x04000514 RID: 1300
		public bool lavaRose;

		// Token: 0x0400047D RID: 1149
		public int lavaTime;

		// Token: 0x040004E5 RID: 1253
		public int leftTimer;

		// Token: 0x040004BA RID: 1210
		public Rectangle legFrame;

		// Token: 0x04000444 RID: 1092
		public double legFrameCounter;

		// Token: 0x04000497 RID: 1175
		public Vector2 legPosition;

		// Token: 0x04000494 RID: 1172
		public float legRotation;

		// Token: 0x040004AB RID: 1195
		public int legs = -1;

		// Token: 0x0400049A RID: 1178
		public Vector2 legVelocity;

		// Token: 0x0400051E RID: 1310
		public bool leinforsHair;

		// Token: 0x040003AE RID: 942
		public bool lifeForce;

		// Token: 0x040003AD RID: 941
		public bool lifeMagnet;

		// Token: 0x04000505 RID: 1285
		public int lifeRegen;

		// Token: 0x04000506 RID: 1286
		public int lifeRegenCount;

		// Token: 0x04000507 RID: 1287
		public int lifeRegenTime;

		// Token: 0x040003C7 RID: 967
		public float lifeSteal = 99999f;

		// Token: 0x04000521 RID: 1313
		public bool lightOrb;

		// Token: 0x04000552 RID: 1362
		public bool lizard;

		// Token: 0x040003C3 RID: 963
		public int loadStatus;

		// Token: 0x04000578 RID: 1400
		public bool longInvince;

		// Token: 0x0400037D RID: 893
		public int lostCoins;

		// Token: 0x0400037E RID: 894
		public string lostCoinString = "";

		// Token: 0x04000400 RID: 1024
		public bool loveStruck;

		// Token: 0x04000585 RID: 1413
		public int magicCrit = 4;

		// Token: 0x04000542 RID: 1346
		public bool magicCuffs;

		// Token: 0x0400058D RID: 1421
		public float magicDamage = 1f;

		// Token: 0x04000529 RID: 1321
		public bool magicLantern;

		// Token: 0x04000512 RID: 1298
		public bool magicQuiver;

		// Token: 0x04000513 RID: 1299
		public bool magmaStone;

		// Token: 0x0400065A RID: 1626
		private bool makeStrongBee;

		// Token: 0x040004F6 RID: 1270
		public float manaCost = 1f;

		// Token: 0x0400057A RID: 1402
		public bool manaFlower;

		// Token: 0x040003AC RID: 940
		public bool manaMagnet;

		// Token: 0x04000508 RID: 1288
		public int manaRegen;

		// Token: 0x040003D6 RID: 982
		public int manaRegenBonus;

		// Token: 0x0400050B RID: 1291
		public bool manaRegenBuff;

		// Token: 0x04000509 RID: 1289
		public int manaRegenCount;

		// Token: 0x0400050A RID: 1290
		public int manaRegenDelay;

		// Token: 0x040003D7 RID: 983
		public int manaRegenDelayBonus;

		// Token: 0x040003C1 RID: 961
		public bool manaSick;

		// Token: 0x040003BF RID: 959
		public static float manaSickLessDmg = 0.25f;

		// Token: 0x040003C0 RID: 960
		public float manaSickReduction;

		// Token: 0x040003BD RID: 957
		public static int manaSickTime = 300;

		// Token: 0x040003BE RID: 958
		public static int manaSickTimeMax = 600;

		// Token: 0x040004E0 RID: 1248
		public bool mapAlphaDown;

		// Token: 0x040004DF RID: 1247
		public bool mapAlphaUp;

		// Token: 0x040004E1 RID: 1249
		public bool mapFullScreen;

		// Token: 0x040004E2 RID: 1250
		public bool mapStyle;

		// Token: 0x040004DD RID: 1245
		public bool mapZoomIn;

		// Token: 0x040004DE RID: 1246
		public bool mapZoomOut;

		// Token: 0x04000473 RID: 1139
		public const int maxBuffs = 22;

		// Token: 0x040005AA RID: 1450
		public float maxFallSpeed = 10f;

		// Token: 0x04000417 RID: 1047
		public int maxMinions = 1;

		// Token: 0x0400044F RID: 1103
		public float maxRegenDelay;

		// Token: 0x040005AB RID: 1451
		public float maxRunSpeed = 3f;

		// Token: 0x040003A2 RID: 930
		public const int maxSolarShields = 3;

		// Token: 0x04000628 RID: 1576
		public int maxTurrets = 1;

		// Token: 0x04000629 RID: 1577
		public int maxTurretsOld = 1;

		// Token: 0x04000583 RID: 1411
		public int meleeCrit = 4;

		// Token: 0x04000587 RID: 1415
		public float meleeDamage = 1f;

		// Token: 0x040003E2 RID: 994
		public byte meleeEnchant;

		// Token: 0x04000590 RID: 1424
		public float meleeSpeed = 1f;

		// Token: 0x0400056F RID: 1391
		public bool merman;

		// Token: 0x04000532 RID: 1330
		public bool minecartLeft;

		// Token: 0x0400052F RID: 1327
		public bool miniMinotaur;

		// Token: 0x04000657 RID: 1623
		public int MinionAttackTargetNPC = -1;

		// Token: 0x0400058E RID: 1422
		public float minionDamage = 1f;

		// Token: 0x0400058F RID: 1423
		public float minionKB;

		// Token: 0x04000656 RID: 1622
		public Vector2 MinionRestTargetPoint = Vector2.Zero;

		// Token: 0x040003F2 RID: 1010
		public int miscCounter;

		// Token: 0x04000466 RID: 1126
		public Item[] miscDyes = new Item[5];

		// Token: 0x04000465 RID: 1125
		public Item[] miscEquips = new Item[5];

		// Token: 0x04000460 RID: 1120
		public const int miscSlotCart = 2;

		// Token: 0x04000462 RID: 1122
		public const int miscSlotHook = 4;

		// Token: 0x0400045F RID: 1119
		public const int miscSlotLight = 1;

		// Token: 0x04000461 RID: 1121
		public const int miscSlotMount = 3;

		// Token: 0x0400045E RID: 1118
		public const int miscSlotPet = 0;

		// Token: 0x04000432 RID: 1074
		public int miscTimer;

		// Token: 0x0400057B RID: 1403
		public bool moonLeech;

		// Token: 0x04000539 RID: 1337
		public Mount mount;

		// Token: 0x04000655 RID: 1621
		public float MountFishronSpecialCounter;

		// Token: 0x04000455 RID: 1109
		public bool mouseInterface;

		// Token: 0x04000594 RID: 1428
		public float moveSpeed = 1f;

		// Token: 0x04000386 RID: 902
		public string name = "";

		// Token: 0x0400044E RID: 1102
		public static int nameLen = 20;

		// Token: 0x0400061C RID: 1564
		public int nebulaCD;

		// Token: 0x040003AB RID: 939
		public int nebulaLevelDamage;

		// Token: 0x040003A8 RID: 936
		public int nebulaLevelLife;

		// Token: 0x040003A9 RID: 937
		public int nebulaLevelMana;

		// Token: 0x040003AA RID: 938
		public int nebulaManaCounter;

		// Token: 0x040003A7 RID: 935
		public const int nebulaMaxLevel = 3;

		// Token: 0x040004B3 RID: 1203
		public sbyte neck = -1;

		// Token: 0x040003B8 RID: 952
		public bool netLife;

		// Token: 0x040003B6 RID: 950
		public int netLifeTime;

		// Token: 0x040003B7 RID: 951
		public bool netMana;

		// Token: 0x040003B5 RID: 949
		public int netManaTime;

		// Token: 0x04000445 RID: 1093
		public int netSkip;

		// Token: 0x04000613 RID: 1555
		public bool nightVision;

		// Token: 0x040003D4 RID: 980
		public bool noBuilding;

		// Token: 0x04000609 RID: 1545
		public bool noFallDmg;

		// Token: 0x04000562 RID: 1378
		public bool noItems;

		// Token: 0x0400050C RID: 1292
		public bool noKnockback;

		// Token: 0x0400049D RID: 1181
		public int nonTorch = -1;

		// Token: 0x04000457 RID: 1111
		public int noThrow;

		// Token: 0x0400038D RID: 909
		public bool[] NPCBannerBuff = new bool[267];

		// Token: 0x04000651 RID: 1617
		public bool[] npcTypeNoAggro = new bool[580];

		// Token: 0x04000418 RID: 1048
		public int numMinions;

		// Token: 0x040005B2 RID: 1458
		public bool oldAdjHoney;

		// Token: 0x040005B3 RID: 1459
		public bool oldAdjLava;

		// Token: 0x040005B5 RID: 1461
		public bool[] oldAdjTile = new bool[470];

		// Token: 0x040005B1 RID: 1457
		public bool oldAdjWater;

		// Token: 0x04000446 RID: 1094
		public int oldSelectItem;

		// Token: 0x04000560 RID: 1376
		public bool onFire;

		// Token: 0x04000561 RID: 1377
		public bool onFire2;

		// Token: 0x0400055A RID: 1370
		public bool onFrostBurn;

		// Token: 0x0400040C RID: 1036
		public bool onHitDodge;

		// Token: 0x0400040E RID: 1038
		public bool onHitPetal;

		// Token: 0x0400040D RID: 1037
		public bool onHitRegen;

		// Token: 0x04000534 RID: 1332
		public bool onTrack;

		// Token: 0x04000533 RID: 1331
		public bool onWrongGround;

		// Token: 0x040003C6 RID: 966
		public bool outOfRange;

		// Token: 0x040003E1 RID: 993
		public BitsByte ownedLargeGems;

		// Token: 0x04000650 RID: 1616
		public int[] ownedProjectileCounts = new int[714];

		// Token: 0x0400040B RID: 1035
		public bool palladiumRegen;

		// Token: 0x04000405 RID: 1029
		public bool panic;

		// Token: 0x040005C1 RID: 1473
		public Color pantsColor = new Color(255, 230, 175);

		// Token: 0x0400054D RID: 1357
		public bool parrot;

		// Token: 0x04000581 RID: 1409
		public bool parryDamageBuff;

		// Token: 0x04000528 RID: 1320
		public bool penguin;

		// Token: 0x0400040F RID: 1039
		public int petalTimer;

		// Token: 0x0400053F RID: 1343
		public bool petFlagDD2Dragon;

		// Token: 0x0400053D RID: 1341
		public bool petFlagDD2Gato;

		// Token: 0x0400053E RID: 1342
		public bool petFlagDD2Ghost;

		// Token: 0x04000515 RID: 1301
		public int phantasmTime;

		// Token: 0x04000411 RID: 1041
		public int phantomPhoneixCounter;

		// Token: 0x04000595 RID: 1429
		public float pickSpeed = 1f;

		// Token: 0x04000421 RID: 1057
		public bool pirateMinion;

		// Token: 0x04000554 RID: 1364
		public bool poisoned;

		// Token: 0x04000654 RID: 1620
		public bool portalPhysicsFlag;

		// Token: 0x040004A4 RID: 1188
		public int potionDelay;

		// Token: 0x04000639 RID: 1593
		public int potionDelayTime = Item.potionDelay;

		// Token: 0x04000470 RID: 1136
		public bool poundRelease;

		// Token: 0x040003FB RID: 1019
		public bool powerrun;

		// Token: 0x04000579 RID: 1401
		public bool pStone;

		// Token: 0x040003E4 RID: 996
		public bool pulley;

		// Token: 0x040003E3 RID: 995
		public byte pulleyDir;

		// Token: 0x040003E5 RID: 997
		public int pulleyFrame;

		// Token: 0x040003E6 RID: 998
		public float pulleyFrameCounter;

		// Token: 0x0400052D RID: 1325
		public bool puppy;

		// Token: 0x04000433 RID: 1075
		public bool pvpDeath;

		// Token: 0x0400041A RID: 1050
		public bool pygmy;

		// Token: 0x04000376 RID: 886
		public Player.SelectionRadial QuicksRadial = new Player.SelectionRadial(Player.SelectionRadial.SelectionMode.RadialQuicks);

		// Token: 0x0400052A RID: 1322
		public bool rabid;

		// Token: 0x04000584 RID: 1412
		public int rangedCrit = 4;

		// Token: 0x04000588 RID: 1416
		public float rangedDamage = 1f;

		// Token: 0x0400041B RID: 1051
		public bool raven;

		// Token: 0x04000523 RID: 1315
		public bool redFairy;

		// Token: 0x040004D7 RID: 1239
		public bool releaseDown;

		// Token: 0x040004CF RID: 1231
		public bool releaseHook;

		// Token: 0x040004CE RID: 1230
		public bool releaseInventory;

		// Token: 0x040004CA RID: 1226
		public bool releaseJump;

		// Token: 0x040004D3 RID: 1235
		public bool releaseLeft;

		// Token: 0x040004E3 RID: 1251
		public bool releaseMapFullscreen;

		// Token: 0x040004E4 RID: 1252
		public bool releaseMapStyle;

		// Token: 0x040004D6 RID: 1238
		public bool releaseMount;

		// Token: 0x040004D2 RID: 1234
		public bool releaseQuickHeal;

		// Token: 0x040004D1 RID: 1233
		public bool releaseQuickMana;

		// Token: 0x040004D4 RID: 1236
		public bool releaseRight;

		// Token: 0x040004D5 RID: 1237
		public bool releaseSmart;

		// Token: 0x040004D0 RID: 1232
		public bool releaseThrow;

		// Token: 0x040004CB RID: 1227
		public bool releaseUp;

		// Token: 0x040004CC RID: 1228
		public bool releaseUseItem;

		// Token: 0x040004CD RID: 1229
		public bool releaseUseTile;

		// Token: 0x04000402 RID: 1026
		public bool resistCold;

		// Token: 0x040004A2 RID: 1186
		public int respawnTimer;

		// Token: 0x0400063A RID: 1594
		public int restorationDelayTime = Item.restorationDelay;

		// Token: 0x04000452 RID: 1106
		public int reuseDelay;

		// Token: 0x040004E6 RID: 1254
		public int rightTimer;

		// Token: 0x04000606 RID: 1542
		public int rocketBoots;

		// Token: 0x0400058C RID: 1420
		public float rocketDamage = 1f;

		// Token: 0x04000602 RID: 1538
		public int rocketDelay;

		// Token: 0x04000603 RID: 1539
		public int rocketDelay2;

		// Token: 0x04000605 RID: 1541
		public bool rocketFrame;

		// Token: 0x04000604 RID: 1540
		public bool rocketRelease;

		// Token: 0x04000600 RID: 1536
		public int rocketTime;

		// Token: 0x04000601 RID: 1537
		public int rocketTimeMax = 7;

		// Token: 0x040003D5 RID: 981
		public int ropeCount;

		// Token: 0x0400056A RID: 1386
		public bool rulerGrid;

		// Token: 0x0400056B RID: 1387
		public bool rulerLine;

		// Token: 0x040005AC RID: 1452
		public float runAcceleration = 0.08f;

		// Token: 0x040005AD RID: 1453
		public float runSlowdown = 0.2f;

		// Token: 0x040004EE RID: 1262
		public int runSoundDelay;

		// Token: 0x04000544 RID: 1348
		public bool sailDash;

		// Token: 0x040003F4 RID: 1012
		public bool sandStorm;

		// Token: 0x0400054F RID: 1359
		public bool sapling;

		// Token: 0x04000547 RID: 1351
		public bool scope;

		// Token: 0x04000459 RID: 1113
		public int selectedItem;

		// Token: 0x04000626 RID: 1574
		public bool setApprenticeT2;

		// Token: 0x04000622 RID: 1570
		public bool setApprenticeT3;

		// Token: 0x0400048C RID: 1164
		public string setBonus = "";

		// Token: 0x0400061E RID: 1566
		public bool setForbidden;

		// Token: 0x0400061F RID: 1567
		public bool setForbiddenCooldownLocked;

		// Token: 0x04000625 RID: 1573
		public bool setHuntressT2;

		// Token: 0x04000621 RID: 1569
		public bool setHuntressT3;

		// Token: 0x04000627 RID: 1575
		public bool setMonkT2;

		// Token: 0x04000623 RID: 1571
		public bool setMonkT3;

		// Token: 0x0400061B RID: 1563
		public bool setNebula;

		// Token: 0x04000619 RID: 1561
		public bool setSolar;

		// Token: 0x04000624 RID: 1572
		public bool setSquireT2;

		// Token: 0x04000620 RID: 1568
		public bool setSquireT3;

		// Token: 0x0400061D RID: 1565
		public bool setStardust;

		// Token: 0x0400061A RID: 1562
		public bool setVortex;

		// Token: 0x040004EF RID: 1263
		public float shadow;

		// Token: 0x040004F5 RID: 1269
		public int shadowCount;

		// Token: 0x040004F4 RID: 1268
		public int[] shadowDirection = new int[3];

		// Token: 0x04000409 RID: 1033
		public bool shadowDodge;

		// Token: 0x0400040A RID: 1034
		public float shadowDodgeCount;

		// Token: 0x04000410 RID: 1040
		public int shadowDodgeTimer;

		// Token: 0x040004F0 RID: 1264
		public const int shadowMax = 3;

		// Token: 0x040004F3 RID: 1267
		public Vector2[] shadowOrigin = new Vector2[3];

		// Token: 0x040004F1 RID: 1265
		public Vector2[] shadowPos = new Vector2[3];

		// Token: 0x040004F2 RID: 1266
		public float[] shadowRotation = new float[3];

		// Token: 0x04000422 RID: 1058
		public bool sharknadoMinion;

		// Token: 0x040004B2 RID: 1202
		public sbyte shield = -1;

		// Token: 0x04000665 RID: 1637
		public int shieldParryTimeLeft;

		// Token: 0x04000664 RID: 1636
		public bool shieldRaised;

		// Token: 0x04000666 RID: 1638
		public int shield_parry_cooldown;

		// Token: 0x04000662 RID: 1634
		public const int SHIELD_PARRY_DAMAGE_BUFF_MULTIPLIER = 5;

		// Token: 0x04000660 RID: 1632
		public const int SHIELD_PARRY_DURATION = 20;

		// Token: 0x04000661 RID: 1633
		public const int SHIELD_PARRY_DURATION_DRAWING_TWEAKER = 20;

		// Token: 0x0400051B RID: 1307
		public bool shinyStone;

		// Token: 0x040005BF RID: 1471
		public Color shirtColor = new Color(175, 165, 140);

		// Token: 0x040004B0 RID: 1200
		public sbyte shoe = -1;

		// Token: 0x040005C2 RID: 1474
		public Color shoeColor = new Color(160, 105, 60);

		// Token: 0x040004EA RID: 1258
		public bool showItemIcon;

		// Token: 0x040004EC RID: 1260
		public int showItemIcon2;

		// Token: 0x040004EB RID: 1259
		public bool showItemIconR;

		// Token: 0x040004ED RID: 1261
		public string showItemIconText = "";

		// Token: 0x04000391 RID: 913
		public bool showLastDeath;

		// Token: 0x04000488 RID: 1160
		public bool shroomiteStealth;

		// Token: 0x04000450 RID: 1104
		public int sign = -1;

		// Token: 0x04000571 RID: 1393
		public bool silence;

		// Token: 0x04000549 RID: 1353
		public bool skeletron;

		// Token: 0x040005BD RID: 1469
		public Color skinColor = new Color(255, 125, 90);

		// Token: 0x0400042E RID: 1070
		public int skinVariant;

		// Token: 0x040003E9 RID: 1001
		public int slideDir;

		// Token: 0x040003E8 RID: 1000
		public bool sliding;

		// Token: 0x0400041C RID: 1052
		public bool slime;

		// Token: 0x040003F9 RID: 1017
		public bool slippy;

		// Token: 0x040003FA RID: 1018
		public bool slippy2;

		// Token: 0x040003CC RID: 972
		public bool sloping;

		// Token: 0x04000419 RID: 1049
		public float slotsMinions;

		// Token: 0x04000572 RID: 1394
		public bool slow;

		// Token: 0x0400060F RID: 1551
		public bool slowFall;

		// Token: 0x04000580 RID: 1408
		public bool slowOgreSpit;

		// Token: 0x04000546 RID: 1350
		public bool snowman;

		// Token: 0x04000487 RID: 1159
		public bool socialGhost;

		// Token: 0x04000489 RID: 1161
		public bool socialIgnoreLight;

		// Token: 0x04000486 RID: 1158
		public bool socialShadowRocketBoots;

		// Token: 0x040003A1 RID: 929
		public int solarCounter;

		// Token: 0x040003A6 RID: 934
		public bool solarDashConsumedFlare;

		// Token: 0x040003A5 RID: 933
		public bool solarDashing;

		// Token: 0x040003A3 RID: 931
		public Vector2[] solarShieldPos = new Vector2[3];

		// Token: 0x040003A0 RID: 928
		public int solarShields;

		// Token: 0x040003A4 RID: 932
		public Vector2[] solarShieldVel = new Vector2[3];

		// Token: 0x04000414 RID: 1044
		public bool sonarPotion;

		// Token: 0x0400037F RID: 895
		public int soulDrain;

		// Token: 0x0400050D RID: 1293
		public bool spaceGun;

		// Token: 0x040005FC RID: 1532
		public bool spawnMax;

		// Token: 0x0400059A RID: 1434
		public int SpawnX = -1;

		// Token: 0x0400059B RID: 1435
		public int SpawnY = -1;

		// Token: 0x04000440 RID: 1088
		public float[] speedSlice = new float[60];

		// Token: 0x0400037A RID: 890
		public byte spelunkerTimer;

		// Token: 0x0400059F RID: 1439
		public int[] spI = new int[200];

		// Token: 0x0400053B RID: 1339
		public bool spider;

		// Token: 0x04000618 RID: 1560
		public bool spiderArmor;

		// Token: 0x04000420 RID: 1056
		public bool spiderMinion;

		// Token: 0x040003ED RID: 1005
		public int spikedBoots;

		// Token: 0x0400059E RID: 1438
		public string[] spN = new string[200];

		// Token: 0x0400051A RID: 1306
		public bool sporeSac;

		// Token: 0x0400059C RID: 1436
		public int[] spX = new int[200];

		// Token: 0x0400059D RID: 1437
		public int[] spY = new int[200];

		// Token: 0x0400053C RID: 1340
		public bool squashling;

		// Token: 0x040003C2 RID: 962
		public bool stairFall;

		// Token: 0x04000577 RID: 1399
		public bool starCloak;

		// Token: 0x04000427 RID: 1063
		public bool stardustDragon;

		// Token: 0x04000426 RID: 1062
		public bool stardustGuardian;

		// Token: 0x04000425 RID: 1061
		public bool stardustMinion;

		// Token: 0x040004FE RID: 1278
		public int statDefense;

		// Token: 0x04000501 RID: 1281
		public int statLife = 100;

		// Token: 0x040004FF RID: 1279
		public int statLifeMax = 100;

		// Token: 0x04000500 RID: 1280
		public int statLifeMax2 = 100;

		// Token: 0x04000502 RID: 1282
		public int statMana;

		// Token: 0x04000503 RID: 1283
		public int statManaMax;

		// Token: 0x04000504 RID: 1284
		public int statManaMax2;

		// Token: 0x0400048B RID: 1163
		public float stealth = 1f;

		// Token: 0x0400048A RID: 1162
		public int stealthTimer;

		// Token: 0x040004F9 RID: 1273
		public int step = -1;

		// Token: 0x0400049F RID: 1183
		public float stepSpeed = 1f;

		// Token: 0x040003F8 RID: 1016
		public bool sticky;

		// Token: 0x04000511 RID: 1297
		public int stickyBreak;

		// Token: 0x04000401 RID: 1025
		public bool stinky;

		// Token: 0x040003D0 RID: 976
		public bool stoned;

		// Token: 0x04000659 RID: 1625
		public static int StopMoneyTroughFromWorking = 3;

		// Token: 0x04000396 RID: 918
		public int stringColor;

		// Token: 0x04000519 RID: 1305
		public bool strongBees;

		// Token: 0x0400055D RID: 1373
		public byte suffocateDelay;

		// Token: 0x0400055C RID: 1372
		public bool suffocating;

		// Token: 0x0400052B RID: 1323
		public bool sunflower;

		// Token: 0x0400045B RID: 1115
		public const int SupportedSlotsAccs = 7;

		// Token: 0x0400045A RID: 1114
		public const int SupportedSlotsArmor = 3;

		// Token: 0x0400045C RID: 1116
		public const int SupportedSlotSets = 10;

		// Token: 0x0400051F RID: 1311
		public bool suspiciouslookingTentacle;

		// Token: 0x0400060A RID: 1546
		public int swimTime;

		// Token: 0x04000636 RID: 1590
		public int talkNPC = -1;

		// Token: 0x04000394 RID: 916
		public int tankPet = -1;

		// Token: 0x04000395 RID: 917
		public bool tankPetReset;

		// Token: 0x04000387 RID: 903
		public int taxMoney;

		// Token: 0x04000389 RID: 905
		public static int taxRate = 3600;

		// Token: 0x04000388 RID: 904
		public int taxTimer;

		// Token: 0x0400044C RID: 1100
		public int team;

		// Token: 0x040003C9 RID: 969
		public bool teleporting;

		// Token: 0x040003CB RID: 971
		public int teleportStyle;

		// Token: 0x040003CA RID: 970
		public float teleportTime;

		// Token: 0x04000615 RID: 1557
		public float thorns;

		// Token: 0x04000593 RID: 1427
		public bool thrownCost33;

		// Token: 0x04000592 RID: 1426
		public bool thrownCost50;

		// Token: 0x04000586 RID: 1414
		public int thrownCrit = 4;

		// Token: 0x04000589 RID: 1417
		public float thrownDamage = 1f;

		// Token: 0x04000591 RID: 1425
		public float thrownVelocity = 1f;

		// Token: 0x0400054C RID: 1356
		public bool tiki;

		// Token: 0x040004DB RID: 1243
		public bool tileInteractAttempted;

		// Token: 0x040004DA RID: 1242
		public bool tileInteractionHappened;

		// Token: 0x040005A0 RID: 1440
		public static int tileRangeX = 5;

		// Token: 0x040005A1 RID: 1441
		public static int tileRangeY = 4;

		// Token: 0x04000597 RID: 1431
		public float tileSpeed = 1f;

		// Token: 0x040005A4 RID: 1444
		public static int tileTargetX;

		// Token: 0x040005A5 RID: 1445
		public static int tileTargetY;

		// Token: 0x04000574 RID: 1396
		public bool tongued;

		// Token: 0x0400046B RID: 1131
		public int toolTime;

		// Token: 0x04000658 RID: 1624
		public List<Point> TouchedTiles = new List<Point>();

		// Token: 0x04000441 RID: 1089
		public float townNPCs;

		// Token: 0x04000537 RID: 1335
		public float trackBoost;

		// Token: 0x0400057D RID: 1405
		public bool trapDebuffSource;

		// Token: 0x04000467 RID: 1127
		public Item trashItem = new Item();

		// Token: 0x0400054E RID: 1358
		public bool truffle;

		// Token: 0x04000526 RID: 1318
		public bool turtle;

		// Token: 0x04000616 RID: 1558
		public bool turtleArmor;

		// Token: 0x04000617 RID: 1559
		public bool turtleThorns;

		// Token: 0x0400041F RID: 1055
		public bool twinsMinion;

		// Token: 0x04000423 RID: 1059
		public bool UFOMinion;

		// Token: 0x040005C0 RID: 1472
		public Color underShirtColor = new Color(160, 180, 215);

		// Token: 0x04000555 RID: 1365
		public bool venom;

		// Token: 0x0400057C RID: 1404
		public bool vortexDebuff;

		// Token: 0x0400062A RID: 1578
		public bool vortexStealthActive;

		// Token: 0x040004B1 RID: 1201
		public sbyte waist = -1;

		// Token: 0x04000596 RID: 1430
		public float wallSpeed = 1f;

		// Token: 0x0400062B RID: 1579
		public bool waterWalk;

		// Token: 0x0400062C RID: 1580
		public bool waterWalk2;

		// Token: 0x04000531 RID: 1329
		public bool wearsRobe;

		// Token: 0x040003D3 RID: 979
		public bool webbed;

		// Token: 0x0400052C RID: 1324
		public bool wellFed;

		// Token: 0x04000564 RID: 1380
		public bool wereWolf;

		// Token: 0x040004A6 RID: 1190
		public byte wetSlime;

		// Token: 0x04000563 RID: 1379
		public bool windPushed;

		// Token: 0x0400042C RID: 1068
		public int wingFrame;

		// Token: 0x0400042D RID: 1069
		public int wingFrameCounter;

		// Token: 0x04000429 RID: 1065
		public int wings;

		// Token: 0x0400042A RID: 1066
		public int wingsLogic;

		// Token: 0x04000428 RID: 1064
		public float wingTime;

		// Token: 0x0400042B RID: 1067
		public int wingTimeMax;

		// Token: 0x04000630 RID: 1584
		public int wireOperationsCooldown;

		// Token: 0x04000551 RID: 1361
		public bool wisp;

		// Token: 0x0400057E RID: 1406
		public bool witheredArmor;

		// Token: 0x0400057F RID: 1407
		public bool witheredWeapon;

		// Token: 0x04000565 RID: 1381
		public bool wolfAcc;

		// Token: 0x0400051D RID: 1309
		public bool yoraiz0rDarkness;

		// Token: 0x0400051C RID: 1308
		public int yoraiz0rEye;

		// Token: 0x04000399 RID: 921
		public bool yoyoGlove;

		// Token: 0x04000398 RID: 920
		public bool yoyoString;

		// Token: 0x0400054B RID: 1355
		public bool zephyrfish;

		// Token: 0x04000434 RID: 1076
		public BitsByte zone1 = 0;

		// Token: 0x04000435 RID: 1077
		public BitsByte zone2 = 0;

		// Token: 0x04000436 RID: 1078
		public BitsByte zone3 = 0;

		// Token: 0x04000437 RID: 1079
		public BitsByte zone4 = 0;

		// Token: 0x04000382 RID: 898
		private static float _blizzardSoundVolume = 0f;

		// Token: 0x0400065C RID: 1628
		public int _funkytownCheckCD;

		// Token: 0x04000385 RID: 901
		private static SlotId _insideBlizzardSound = SlotId.Invalid;

		// Token: 0x04000653 RID: 1619
		public int _portalPhysicsTime;

		// Token: 0x0400065F RID: 1631
		private int _quickGrappleCooldown;

		// Token: 0x0400065E RID: 1630
		private float _shaderObstructionInternalValue = 1f;

		// Token: 0x0400065D RID: 1629
		private float _stormShaderObstruction = 1f;

		// Token: 0x04000383 RID: 899
		private static SlotId _strongBlizzardSound = SlotId.Invalid;

		// Token: 0x04000384 RID: 900
		private static SlotId _weakBlizzardSound = SlotId.Invalid;

		// Token: 0x020001C5 RID: 453
		public static class Hooks
		{
			// Token: 0x0600140F RID: 5135 RVA: 0x0041C1E7 File Offset: 0x0041A3E7
			public static void EnterWorld(int playerIndex)
			{
				if (Player.Hooks.OnEnterWorld != null)
				{
					Player.Hooks.OnEnterWorld(Main.player[playerIndex]);
				}
			}

			// Token: 0x0600140D RID: 5133 RVA: 0x0041C1DF File Offset: 0x0041A3DF
			public static void PlayerConnect(int playerIndex)
			{
				PressurePlateHelper.ResetPlayer(playerIndex);
			}

			// Token: 0x0600140E RID: 5134 RVA: 0x0041C1DF File Offset: 0x0041A3DF
			public static void PlayerDisconnect(int playerIndex)
			{
				PressurePlateHelper.ResetPlayer(playerIndex);
			}

			// Token: 0x14000034 RID: 52
			// Token: 0x0600140B RID: 5131 RVA: 0x0041C178 File Offset: 0x0041A378
			// Token: 0x0600140C RID: 5132 RVA: 0x0041C1AC File Offset: 0x0041A3AC
			[method: CompilerGenerated]
			[CompilerGenerated]
			public static event Action<Player> OnEnterWorld;
		}

		// Token: 0x020001C8 RID: 456
		public struct OverheadMessage
		{
			// Token: 0x0600141B RID: 5147 RVA: 0x0041C604 File Offset: 0x0041A804
			public void NewMessage(string message, int displayTime)
			{
				this.chatText = message;
				this.snippets = ChatManager.ParseMessage(this.chatText, Color.White).ToArray();
				this.messageSize = ChatManager.GetStringSize(Main.fontMouseText, this.snippets, Vector2.One, -1f);
				this.timeLeft = displayTime;
			}

			// Token: 0x0400368B RID: 13963
			public string chatText;

			// Token: 0x0400368C RID: 13964
			public TextSnippet[] snippets;

			// Token: 0x0400368D RID: 13965
			public Vector2 messageSize;

			// Token: 0x0400368E RID: 13966
			public int timeLeft;
		}

		// Token: 0x020001C7 RID: 455
		public class SelectionRadial
		{
			// Token: 0x06001414 RID: 5140 RVA: 0x0041C238 File Offset: 0x0041A438
			public SelectionRadial(Player.SelectionRadial.SelectionMode mode = Player.SelectionRadial.SelectionMode.Dpad4)
			{
				this.Mode = mode;
				int radialCount = 0;
				switch (mode)
				{
					case Player.SelectionRadial.SelectionMode.Dpad4:
						radialCount = 4;
						break;
					case Player.SelectionRadial.SelectionMode.RadialCircular:
						radialCount = 10;
						break;
					case Player.SelectionRadial.SelectionMode.RadialQuicks:
						radialCount = 3;
						break;
				}
				this.RadialCount = radialCount;
				this.Bindings = new int[this.RadialCount];
				for (int i = 0; i < this.RadialCount; i++)
				{
					this.Bindings[i] = -1;
				}
			}

			// Token: 0x06001418 RID: 5144 RVA: 0x0041C500 File Offset: 0x0041A700
			private void Bind(int itemslot, int radialslot)
			{
				this.ChangeSelection(-1);
				if (this.Bindings[radialslot] == itemslot)
				{
					this.Bindings[radialslot] = -1;
					return;
				}
				for (int i = 0; i < this.RadialCount; i++)
				{
					if (this.Bindings[i] == itemslot)
					{
						this.Bindings[i] = -1;
					}
				}
				this.Bindings[radialslot] = itemslot;
			}

			// Token: 0x06001416 RID: 5142 RVA: 0x0041C460 File Offset: 0x0041A660
			public void ChangeBinding(int itemSlot)
			{
				if (itemSlot < 0 || itemSlot >= 50)
				{
					return;
				}
				if (this.Mode == Player.SelectionRadial.SelectionMode.Dpad4)
				{
					if (PlayerInput.Triggers.JustPressed.DpadRadial1)
					{
						this.Bind(itemSlot, 0);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial2)
					{
						this.Bind(itemSlot, 1);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial3)
					{
						this.Bind(itemSlot, 2);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial4)
					{
						this.Bind(itemSlot, 3);
					}
				}
			}

			// Token: 0x06001417 RID: 5143 RVA: 0x0041C4E5 File Offset: 0x0041A6E5
			public void ChangeSelection(int to)
			{
				if (this._SelectedBinding == to)
				{
					this._SelectedBinding = -1;
					return;
				}
				this._SelectedBinding = to;
			}

			// Token: 0x0600141A RID: 5146 RVA: 0x0041C5A0 File Offset: 0x0041A7A0
			public void CopyTo(Player.SelectionRadial that)
			{
				that._SelectedBinding = this._SelectedBinding;
				that.Mode = this.Mode;
				that.RadialCount = this.RadialCount;
				Array.Resize<int>(ref that.Bindings, this.RadialCount);
				for (int i = 0; i < this.RadialCount; i++)
				{
					that.Bindings[i] = this.Bindings[i];
				}
			}

			// Token: 0x06001419 RID: 5145 RVA: 0x0041C558 File Offset: 0x0041A758
			public int GetDrawMode(int itemslot)
			{
				if (this.SelectedBinding != -1 && this.Bindings[this.SelectedBinding] == itemslot)
				{
					return 2;
				}
				for (int i = 0; i < this.RadialCount; i++)
				{
					if (this.Bindings[i] == itemslot)
					{
						return 1;
					}
				}
				return 0;
			}

			// Token: 0x06001415 RID: 5141 RVA: 0x0041C2AC File Offset: 0x0041A4AC
			public void Update()
			{
				Player.SelectionRadial.SelectionMode mode = this.Mode;
				if (mode != Player.SelectionRadial.SelectionMode.Dpad4)
				{
					if (mode - Player.SelectionRadial.SelectionMode.RadialCircular > 1)
					{
						return;
					}
					for (int i = 0; i < this.RadialCount; i++)
					{
						this.Bindings[i] = i;
					}
					if ((this.Mode == Player.SelectionRadial.SelectionMode.RadialCircular && PlayerInput.Triggers.Current.RadialHotbar) || (this.Mode == Player.SelectionRadial.SelectionMode.RadialQuicks && PlayerInput.Triggers.Current.RadialQuickbar))
					{
						bool flag = this.Mode == Player.SelectionRadial.SelectionMode.RadialCircular;
						float num = 6.28318548f / (float)this.RadialCount / 2f;
						Vector2 vector = PlayerInput.GamepadThumbstickRight.RotatedBy((double)(-1.57079637f + num), default(Vector2));
						if (vector.Length() == 0f)
						{
							vector = PlayerInput.GamepadThumbstickLeft.RotatedBy((double)(-1.57079637f + num), default(Vector2));
						}
						int num2 = -1;
						if (vector.Length() > 0.3f)
						{
							num2 = (int)((vector.ToRotation() + 3.14159274f) / (6.28318548f / (float)this.RadialCount));
							if (num2 >= this.RadialCount)
							{
								num2 -= this.RadialCount;
							}
						}
						if ((num2 != -1 || !flag) && this._SelectedBinding != num2 && (num2 != -1 || !(vector != Vector2.Zero)))
						{
							this.ChangeSelection(num2);
						}
					}
				}
				else
				{
					if (PlayerInput.Triggers.JustPressed.DpadRadial1)
					{
						this.ChangeSelection(0);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial2)
					{
						this.ChangeSelection(1);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial3)
					{
						this.ChangeSelection(2);
					}
					if (PlayerInput.Triggers.JustPressed.DpadRadial4)
					{
						this.ChangeSelection(3);
						return;
					}
				}
			}

			// Token: 0x170001B5 RID: 437
			public int SelectedBinding
			{
				// Token: 0x06001412 RID: 5138 RVA: 0x0041C215 File Offset: 0x0041A415
				get
				{
					return this._SelectedBinding;
				}
			}

			// Token: 0x170001B6 RID: 438
			public int SelectedItem
			{
				// Token: 0x06001413 RID: 5139 RVA: 0x0041C21D File Offset: 0x0041A41D
				get
				{
					if (this._SelectedBinding == -1)
					{
						return -1;
					}
					return this.Bindings[this._SelectedBinding];
				}
			}

			// Token: 0x04003689 RID: 13961
			public int[] Bindings;

			// Token: 0x0400368A RID: 13962
			public Player.SelectionRadial.SelectionMode Mode;

			// Token: 0x04003688 RID: 13960
			public int RadialCount;

			// Token: 0x04003687 RID: 13959
			private int _SelectedBinding = -1;

			// Token: 0x02000301 RID: 769
			public enum SelectionMode
			{
				// Token: 0x04003D7C RID: 15740
				Dpad4,
				// Token: 0x04003D7D RID: 15741
				RadialCircular,
				// Token: 0x04003D7E RID: 15742
				RadialQuicks
			}
		}

		// Token: 0x020001C6 RID: 454
		public class SmartCursorSettings
		{
			// Token: 0x04003686 RID: 13958
			public static bool SmartAxeAfterPickaxe = false;

			// Token: 0x04003684 RID: 13956
			public static bool SmartBlocksEnabled = false;

			// Token: 0x04003685 RID: 13957
			public static bool SmartWallReplacement = true;
		}
	}
}
